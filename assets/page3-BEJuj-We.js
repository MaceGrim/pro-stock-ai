import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */var y0="http://www.w3.org/1999/xhtml";const zy={svg:"http://www.w3.org/2000/svg",xhtml:y0,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Tp(n){var t=n+="",e=t.indexOf(":");return e>=0&&(t=n.slice(0,e))!=="xmlns"&&(n=n.slice(e+1)),zy.hasOwnProperty(t)?{space:zy[t],local:n}:n}function h6(n){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===y0&&t.documentElement.namespaceURI===y0?t.createElement(n):t.createElementNS(e,n)}}function d6(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function rb(n){var t=Tp(n);return(t.local?d6:h6)(t)}function _6(){}function sg(n){return n==null?_6:function(){return this.querySelector(n)}}function p6(n){typeof n!="function"&&(n=sg(n));for(var t=this._groups,e=t.length,r=new Array(e),s=0;s<e;++s)for(var o=t[s],f=o.length,c=r[s]=new Array(f),l,d,p=0;p<f;++p)(l=o[p])&&(d=n.call(l,l.__data__,p,o))&&("__data__"in l&&(d.__data__=l.__data__),c[p]=d);return new Ai(r,this._parents)}function m6(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function g6(){return[]}function ib(n){return n==null?g6:function(){return this.querySelectorAll(n)}}function y6(n){return function(){return m6(n.apply(this,arguments))}}function v6(n){typeof n=="function"?n=y6(n):n=ib(n);for(var t=this._groups,e=t.length,r=[],s=[],o=0;o<e;++o)for(var f=t[o],c=f.length,l,d=0;d<c;++d)(l=f[d])&&(r.push(n.call(l,l.__data__,d,f)),s.push(l));return new Ai(r,s)}function sb(n){return function(){return this.matches(n)}}function ab(n){return function(t){return t.matches(n)}}var b6=Array.prototype.find;function w6(n){return function(){return b6.call(this.children,n)}}function x6(){return this.firstElementChild}function S6(n){return this.select(n==null?x6:w6(typeof n=="function"?n:ab(n)))}var A6=Array.prototype.filter;function E6(){return Array.from(this.children)}function T6(n){return function(){return A6.call(this.children,n)}}function I6(n){return this.selectAll(n==null?E6:T6(typeof n=="function"?n:ab(n)))}function O6(n){typeof n!="function"&&(n=sb(n));for(var t=this._groups,e=t.length,r=new Array(e),s=0;s<e;++s)for(var o=t[s],f=o.length,c=r[s]=[],l,d=0;d<f;++d)(l=o[d])&&n.call(l,l.__data__,d,o)&&c.push(l);return new Ai(r,this._parents)}function ob(n){return new Array(n.length)}function B6(){return new Ai(this._enter||this._groups.map(ob),this._parents)}function F_(n,t){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=t}F_.prototype={constructor:F_,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,t){return this._parent.insertBefore(n,t)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function M6(n){return function(){return n}}function L6(n,t,e,r,s,o){for(var f=0,c,l=t.length,d=o.length;f<d;++f)(c=t[f])?(c.__data__=o[f],r[f]=c):e[f]=new F_(n,o[f]);for(;f<l;++f)(c=t[f])&&(s[f]=c)}function R6(n,t,e,r,s,o,f){var c,l,d=new Map,p=t.length,w=o.length,I=new Array(p),C;for(c=0;c<p;++c)(l=t[c])&&(I[c]=C=f.call(l,l.__data__,c,t)+"",d.has(C)?s[c]=l:d.set(C,l));for(c=0;c<w;++c)C=f.call(n,o[c],c,o)+"",(l=d.get(C))?(r[c]=l,l.__data__=o[c],d.delete(C)):e[c]=new F_(n,o[c]);for(c=0;c<p;++c)(l=t[c])&&d.get(I[c])===l&&(s[c]=l)}function N6(n){return n.__data__}function D6(n,t){if(!arguments.length)return Array.from(this,N6);var e=t?R6:L6,r=this._parents,s=this._groups;typeof n!="function"&&(n=M6(n));for(var o=s.length,f=new Array(o),c=new Array(o),l=new Array(o),d=0;d<o;++d){var p=r[d],w=s[d],I=w.length,C=F6(n.call(p,p&&p.__data__,d,r)),V=C.length,Wt=c[d]=new Array(V),Qt=f[d]=new Array(V),Rt=l[d]=new Array(I);e(p,w,Wt,Qt,Rt,C,t);for(var oe=0,Zt=0,st,zt;oe<V;++oe)if(st=Wt[oe]){for(oe>=Zt&&(Zt=oe+1);!(zt=Qt[Zt])&&++Zt<V;);st._next=zt||null}}return f=new Ai(f,r),f._enter=c,f._exit=l,f}function F6(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function C6(){return new Ai(this._exit||this._groups.map(ob),this._parents)}function k6(n,t,e){var r=this.enter(),s=this,o=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),t!=null&&(s=t(s),s&&(s=s.selection())),e==null?o.remove():e(o),r&&s?r.merge(s).order():s}function P6(n){for(var t=n.selection?n.selection():n,e=this._groups,r=t._groups,s=e.length,o=r.length,f=Math.min(s,o),c=new Array(s),l=0;l<f;++l)for(var d=e[l],p=r[l],w=d.length,I=c[l]=new Array(w),C,V=0;V<w;++V)(C=d[V]||p[V])&&(I[V]=C);for(;l<s;++l)c[l]=e[l];return new Ai(c,this._parents)}function z6(){for(var n=this._groups,t=-1,e=n.length;++t<e;)for(var r=n[t],s=r.length-1,o=r[s],f;--s>=0;)(f=r[s])&&(o&&f.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(f,o),o=f);return this}function U6(n){n||(n=G6);function t(w,I){return w&&I?n(w.__data__,I.__data__):!w-!I}for(var e=this._groups,r=e.length,s=new Array(r),o=0;o<r;++o){for(var f=e[o],c=f.length,l=s[o]=new Array(c),d,p=0;p<c;++p)(d=f[p])&&(l[p]=d);l.sort(t)}return new Ai(s,this._parents).order()}function G6(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function $6(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function V6(){return Array.from(this)}function j6(){for(var n=this._groups,t=0,e=n.length;t<e;++t)for(var r=n[t],s=0,o=r.length;s<o;++s){var f=r[s];if(f)return f}return null}function W6(){let n=0;for(const t of this)++n;return n}function Y6(){return!this.node()}function H6(n){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var s=t[e],o=0,f=s.length,c;o<f;++o)(c=s[o])&&n.call(c,c.__data__,o,s);return this}function X6(n){return function(){this.removeAttribute(n)}}function q6(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Z6(n,t){return function(){this.setAttribute(n,t)}}function K6(n,t){return function(){this.setAttributeNS(n.space,n.local,t)}}function J6(n,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(n):this.setAttribute(n,e)}}function Q6(n,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}}function t4(n,t){var e=Tp(n);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((t==null?e.local?q6:X6:typeof t=="function"?e.local?Q6:J6:e.local?K6:Z6)(e,t))}function fb(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function e4(n){return function(){this.style.removeProperty(n)}}function n4(n,t,e){return function(){this.style.setProperty(n,t,e)}}function r4(n,t,e){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,e)}}function i4(n,t,e){return arguments.length>1?this.each((t==null?e4:typeof t=="function"?r4:n4)(n,t,e??"")):zc(this.node(),n)}function zc(n,t){return n.style.getPropertyValue(t)||fb(n).getComputedStyle(n,null).getPropertyValue(t)}function s4(n){return function(){delete this[n]}}function a4(n,t){return function(){this[n]=t}}function o4(n,t){return function(){var e=t.apply(this,arguments);e==null?delete this[n]:this[n]=e}}function f4(n,t){return arguments.length>1?this.each((t==null?s4:typeof t=="function"?o4:a4)(n,t)):this.node()[n]}function ub(n){return n.trim().split(/^|\s+/)}function ag(n){return n.classList||new cb(n)}function cb(n){this._node=n,this._names=ub(n.getAttribute("class")||"")}cb.prototype={add:function(n){var t=this._names.indexOf(n);t<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var t=this._names.indexOf(n);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function lb(n,t){for(var e=ag(n),r=-1,s=t.length;++r<s;)e.add(t[r])}function hb(n,t){for(var e=ag(n),r=-1,s=t.length;++r<s;)e.remove(t[r])}function u4(n){return function(){lb(this,n)}}function c4(n){return function(){hb(this,n)}}function l4(n,t){return function(){(t.apply(this,arguments)?lb:hb)(this,n)}}function h4(n,t){var e=ub(n+"");if(arguments.length<2){for(var r=ag(this.node()),s=-1,o=e.length;++s<o;)if(!r.contains(e[s]))return!1;return!0}return this.each((typeof t=="function"?l4:t?u4:c4)(e,t))}function d4(){this.textContent=""}function _4(n){return function(){this.textContent=n}}function p4(n){return function(){var t=n.apply(this,arguments);this.textContent=t??""}}function m4(n){return arguments.length?this.each(n==null?d4:(typeof n=="function"?p4:_4)(n)):this.node().textContent}function g4(){this.innerHTML=""}function y4(n){return function(){this.innerHTML=n}}function v4(n){return function(){var t=n.apply(this,arguments);this.innerHTML=t??""}}function b4(n){return arguments.length?this.each(n==null?g4:(typeof n=="function"?v4:y4)(n)):this.node().innerHTML}function w4(){this.nextSibling&&this.parentNode.appendChild(this)}function x4(){return this.each(w4)}function S4(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function A4(){return this.each(S4)}function E4(n){var t=typeof n=="function"?n:rb(n);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function T4(){return null}function I4(n,t){var e=typeof n=="function"?n:rb(n),r=t==null?T4:typeof t=="function"?t:sg(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})}function O4(){var n=this.parentNode;n&&n.removeChild(this)}function B4(){return this.each(O4)}function M4(){var n=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(n,this.nextSibling):n}function L4(){var n=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(n,this.nextSibling):n}function R4(n){return this.select(n?L4:M4)}function N4(n){return arguments.length?this.property("__data__",n):this.node().__data__}function D4(n){return function(t){n.call(this,t,this.__data__)}}function F4(n){return n.trim().split(/^|\s+/).map(function(t){var e="",r=t.indexOf(".");return r>=0&&(e=t.slice(r+1),t=t.slice(0,r)),{type:t,name:e}})}function C4(n){return function(){var t=this.__on;if(t){for(var e=0,r=-1,s=t.length,o;e<s;++e)o=t[e],(!n.type||o.type===n.type)&&o.name===n.name?this.removeEventListener(o.type,o.listener,o.options):t[++r]=o;++r?t.length=r:delete this.__on}}}function k4(n,t,e){return function(){var r=this.__on,s,o=D4(t);if(r){for(var f=0,c=r.length;f<c;++f)if((s=r[f]).type===n.type&&s.name===n.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=o,s.options=e),s.value=t;return}}this.addEventListener(n.type,o,e),s={type:n.type,name:n.name,value:t,listener:o,options:e},r?r.push(s):this.__on=[s]}}function P4(n,t,e){var r=F4(n+""),s,o=r.length,f;if(arguments.length<2){var c=this.node().__on;if(c){for(var l=0,d=c.length,p;l<d;++l)for(s=0,p=c[l];s<o;++s)if((f=r[s]).type===p.type&&f.name===p.name)return p.value}return}for(c=t?k4:C4,s=0;s<o;++s)this.each(c(r[s],t,e));return this}function db(n,t,e){var r=fb(n),s=r.CustomEvent;typeof s=="function"?s=new s(t,e):(s=r.document.createEvent("Event"),e?(s.initEvent(t,e.bubbles,e.cancelable),s.detail=e.detail):s.initEvent(t,!1,!1)),n.dispatchEvent(s)}function z4(n,t){return function(){return db(this,n,t)}}function U4(n,t){return function(){return db(this,n,t.apply(this,arguments))}}function G4(n,t){return this.each((typeof t=="function"?U4:z4)(n,t))}function*$4(){for(var n=this._groups,t=0,e=n.length;t<e;++t)for(var r=n[t],s=0,o=r.length,f;s<o;++s)(f=r[s])&&(yield f)}var _b=[null];function Ai(n,t){this._groups=n,this._parents=t}function rd(){return new Ai([[document.documentElement]],_b)}function V4(){return this}Ai.prototype=rd.prototype={constructor:Ai,select:p6,selectAll:v6,selectChild:S6,selectChildren:I6,filter:O6,data:D6,enter:B6,exit:C6,join:k6,merge:P6,selection:V4,order:z6,sort:U6,call:$6,nodes:V6,node:j6,size:W6,empty:Y6,each:H6,attr:t4,style:i4,property:f4,classed:h4,text:m4,html:b4,raise:x4,lower:A4,append:E4,insert:I4,remove:B4,clone:R4,datum:N4,on:P4,dispatch:G4,[Symbol.iterator]:$4};function Wn(n){return typeof n=="string"?new Ai([[document.querySelector(n)]],[document.documentElement]):new Ai([[n]],_b)}function j4(n){let t;for(;t=n.sourceEvent;)n=t;return n}function qa(n,t){if(n=j4(n),t===void 0&&(t=n.currentTarget),t){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var r=e.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var s=t.getBoundingClientRect();return[n.clientX-s.left-t.clientLeft,n.clientY-s.top-t.clientTop]}}return[n.pageX,n.pageY]}function x_(n,t){return n==null||t==null?NaN:n<t?-1:n>t?1:n>=t?0:NaN}function W4(n,t){return n==null||t==null?NaN:t<n?-1:t>n?1:t>=n?0:NaN}function pb(n){let t,e,r;n.length!==2?(t=x_,e=(c,l)=>x_(n(c),l),r=(c,l)=>n(c)-l):(t=n===x_||n===W4?n:Y4,e=n,r=n);function s(c,l,d=0,p=c.length){if(d<p){if(t(l,l)!==0)return p;do{const w=d+p>>>1;e(c[w],l)<0?d=w+1:p=w}while(d<p)}return d}function o(c,l,d=0,p=c.length){if(d<p){if(t(l,l)!==0)return p;do{const w=d+p>>>1;e(c[w],l)<=0?d=w+1:p=w}while(d<p)}return d}function f(c,l,d=0,p=c.length){const w=s(c,l,d,p-1);return w>d&&r(c[w-1],l)>-r(c[w],l)?w-1:w}return{left:s,center:f,right:o}}function Y4(){return 0}function H4(n){return n===null?NaN:+n}const mb=pb(x_),X4=mb.right,v0=mb.left;pb(H4).center;function Gh(n,t){let e,r;if(t===void 0)for(const s of n)s!=null&&(e===void 0?s>=s&&(e=r=s):(e>s&&(e=s),r<s&&(r=s)));else{let s=-1;for(let o of n)(o=t(o,++s,n))!=null&&(e===void 0?o>=o&&(e=r=o):(e>o&&(e=o),r<o&&(r=o)))}return[e,r]}class Uc{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let r=0;for(let s=0;s<this._n&&s<32;s++){const o=e[s],f=t+o,c=Math.abs(t)<Math.abs(o)?t-(f-o):o-(f-t);c&&(e[r++]=c),t=f}return e[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let e=this._n,r,s,o,f=0;if(e>0){for(f=t[--e];e>0&&(r=f,s=t[--e],f=r+s,o=s-(f-r),!o););e>0&&(o<0&&t[e-1]<0||o>0&&t[e-1]>0)&&(s=o*2,r=f+s,s==r-f&&(f=r))}return f}}class Uy extends Map{constructor(t,e=K4){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),t!=null)for(const[r,s]of t)this.set(r,s)}get(t){return super.get(Gy(this,t))}has(t){return super.has(Gy(this,t))}set(t,e){return super.set(q4(this,t),e)}delete(t){return super.delete(Z4(this,t))}}function Gy({_intern:n,_key:t},e){const r=t(e);return n.has(r)?n.get(r):e}function q4({_intern:n,_key:t},e){const r=t(e);return n.has(r)?n.get(r):(n.set(r,e),e)}function Z4({_intern:n,_key:t},e){const r=t(e);return n.has(r)&&(e=n.get(e),n.delete(r)),e}function K4(n){return n!==null&&typeof n=="object"?n.valueOf():n}const J4=Math.sqrt(50),Q4=Math.sqrt(10),t5=Math.sqrt(2);function C_(n,t,e){const r=(t-n)/Math.max(0,e),s=Math.floor(Math.log10(r)),o=r/Math.pow(10,s),f=o>=J4?10:o>=Q4?5:o>=t5?2:1;let c,l,d;return s<0?(d=Math.pow(10,-s)/f,c=Math.round(n*d),l=Math.round(t*d),c/d<n&&++c,l/d>t&&--l,d=-d):(d=Math.pow(10,s)*f,c=Math.round(n/d),l=Math.round(t/d),c*d<n&&++c,l*d>t&&--l),l<c&&.5<=e&&e<2?C_(n,t,e*2):[c,l,d]}function b0(n,t,e){if(t=+t,n=+n,e=+e,!(e>0))return[];if(n===t)return[n];const r=t<n,[s,o,f]=r?C_(t,n,e):C_(n,t,e);if(!(o>=s))return[];const c=o-s+1,l=new Array(c);if(r)if(f<0)for(let d=0;d<c;++d)l[d]=(o-d)/-f;else for(let d=0;d<c;++d)l[d]=(o-d)*f;else if(f<0)for(let d=0;d<c;++d)l[d]=(s+d)/-f;else for(let d=0;d<c;++d)l[d]=(s+d)*f;return l}function w0(n,t,e){return t=+t,n=+n,e=+e,C_(n,t,e)[2]}function e5(n,t,e){t=+t,n=+n,e=+e;const r=t<n,s=r?w0(t,n,e):w0(n,t,e);return(r?-1:1)*(s<0?1/-s:s)}function x0(n,t){let e;if(t===void 0)for(const r of n)r!=null&&(e<r||e===void 0&&r>=r)&&(e=r);else{let r=-1;for(let s of n)(s=t(s,++r,n))!=null&&(e<s||e===void 0&&s>=s)&&(e=s)}return e}function S0(n,t){let e;if(t===void 0)for(const r of n)r!=null&&(e>r||e===void 0&&r>=r)&&(e=r);else{let r=-1;for(let s of n)(s=t(s,++r,n))!=null&&(e>s||e===void 0&&s>=s)&&(e=s)}return e}function a_(n,t){let e=0,r=0;if(t===void 0)for(let s of n)s!=null&&(s=+s)>=s&&(++e,r+=s);else{let s=-1;for(let o of n)(o=t(o,++s,n))!=null&&(o=+o)>=o&&(++e,r+=o)}if(e)return r/e}function*n5(n){for(const t of n)yield*t}function r5(n){return Array.from(n5(n))}function ou(n,t,e){n=+n,t=+t,e=(s=arguments.length)<2?(t=n,n=0,1):s<3?1:+e;for(var r=-1,s=Math.max(0,Math.ceil((t-n)/e))|0,o=new Array(s);++r<s;)o[r]=n+r*e;return o}function i5(n){return function(e,r=0,s=e.length){let o=s-(r=+r);for(;o;){const f=n()*o--|0,c=e[o+r];e[o+r]=e[f+r],e[f+r]=c}return e}}function s5(n,t){let e=0;if(t===void 0)for(let r of n)(r=+r)&&(e+=r);else{let r=-1;for(let s of n)(s=+t(s,++r,n))&&(e+=s)}return e}var Ic=1e-6,og=Math.PI,a5=og*2,o5=180/og,f5=og/180,Oc=Math.abs,u5=Math.cos,c5=Math.sin,fg=Math.sqrt;function Gi(){}function k_(n,t){n&&Vy.hasOwnProperty(n.type)&&Vy[n.type](n,t)}var $y={Feature:function(n,t){k_(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,s=e.length;++r<s;)k_(e[r].geometry,t)}},Vy={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,s=e.length;++r<s;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){A0(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,s=e.length;++r<s;)A0(e[r],t,0)},Polygon:function(n,t){jy(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,s=e.length;++r<s;)jy(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,s=e.length;++r<s;)k_(e[r],t)}};function A0(n,t,e){var r=-1,s=n.length-e,o;for(t.lineStart();++r<s;)o=n[r],t.point(o[0],o[1],o[2]);t.lineEnd()}function jy(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)A0(n[e],t,1);t.polygonEnd()}function bc(n,t){n&&$y.hasOwnProperty(n.type)?$y[n.type](n,t):k_(n,t)}function l5(){var n=[],t;return{point:function(e,r,s){t.push([e,r,s])},lineStart:function(){n.push(t=[])},lineEnd:Gi,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],t=null,e}}}function h5(n,t){return Oc(n[0]-t[0])<Ic&&Oc(n[1]-t[1])<Ic}function o_(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function d5(n,t,e,r,s){var o=[],f=[],c,l;if(n.forEach(function(V){if(!((Wt=V.length-1)<=0)){var Wt,Qt=V[0],Rt=V[Wt],oe;if(h5(Qt,Rt)){if(!Qt[2]&&!Rt[2]){for(s.lineStart(),c=0;c<Wt;++c)s.point((Qt=V[c])[0],Qt[1]);s.lineEnd();return}Rt[0]+=2*Ic}o.push(oe=new o_(Qt,V,null,!0)),f.push(oe.o=new o_(Qt,null,oe,!1)),o.push(oe=new o_(Rt,V,null,!1)),f.push(oe.o=new o_(Rt,null,oe,!0))}}),!!o.length){for(f.sort(t),Wy(o),Wy(f),c=0,l=f.length;c<l;++c)f[c].e=e=!e;for(var d=o[0],p,w;;){for(var I=d,C=!0;I.v;)if((I=I.n)===d)return;p=I.z,s.lineStart();do{if(I.v=I.o.v=!0,I.e){if(C)for(c=0,l=p.length;c<l;++c)s.point((w=p[c])[0],w[1]);else r(I.x,I.n.x,1,s);I=I.n}else{if(C)for(p=I.p.z,c=p.length-1;c>=0;--c)s.point((w=p[c])[0],w[1]);else r(I.x,I.p.x,-1,s);I=I.p}I=I.o,p=I.z,C=!C}while(!I.v);s.lineEnd()}}}function Wy(n){if(t=n.length){for(var t,e=0,r=n[0],s;++e<t;)r.n=s=n[e],s.p=r,r=s;r.n=s=n[0],s.p=r}}function _5(n,t,e,r,s,o){var f=n[0],c=n[1],l=t[0],d=t[1],p=0,w=1,I=l-f,C=d-c,V;if(V=e-f,!(!I&&V>0)){if(V/=I,I<0){if(V<p)return;V<w&&(w=V)}else if(I>0){if(V>w)return;V>p&&(p=V)}if(V=s-f,!(!I&&V<0)){if(V/=I,I<0){if(V>w)return;V>p&&(p=V)}else if(I>0){if(V<p)return;V<w&&(w=V)}if(V=r-c,!(!C&&V>0)){if(V/=C,C<0){if(V<p)return;V<w&&(w=V)}else if(C>0){if(V>w)return;V>p&&(p=V)}if(V=o-c,!(!C&&V<0)){if(V/=C,C<0){if(V>w)return;V>p&&(p=V)}else if(C>0){if(V<p)return;V<w&&(w=V)}return p>0&&(n[0]=f+p*I,n[1]=c+p*C),w<1&&(t[0]=f+w*I,t[1]=c+w*C),!0}}}}}var Bh=1e9,f_=-Bh;function p5(n,t,e,r){function s(d,p){return n<=d&&d<=e&&t<=p&&p<=r}function o(d,p,w,I){var C=0,V=0;if(d==null||(C=f(d,w))!==(V=f(p,w))||l(d,p)<0^w>0)do I.point(C===0||C===3?n:e,C>1?r:t);while((C=(C+w+4)%4)!==V);else I.point(p[0],p[1])}function f(d,p){return Oc(d[0]-n)<Ic?p>0?0:3:Oc(d[0]-e)<Ic?p>0?2:1:Oc(d[1]-t)<Ic?p>0?1:0:p>0?3:2}function c(d,p){return l(d.x,p.x)}function l(d,p){var w=f(d,1),I=f(p,1);return w!==I?w-I:w===0?p[1]-d[1]:w===1?d[0]-p[0]:w===2?d[1]-p[1]:p[0]-d[0]}return function(d){var p=d,w=l5(),I,C,V,Wt,Qt,Rt,oe,Zt,st,zt,ue,ve={point:an,lineStart:Bt,lineEnd:Dt,polygonStart:Y,polygonEnd:rt};function an(ft,H){s(ft,H)&&p.point(ft,H)}function at(){for(var ft=0,H=0,yt=C.length;H<yt;++H)for(var Lt=C[H],Kt=1,ee=Lt.length,de=Lt[0],Oe,ye,Ze=de[0],on=de[1];Kt<ee;++Kt)Oe=Ze,ye=on,de=Lt[Kt],Ze=de[0],on=de[1],ye<=r?on>r&&(Ze-Oe)*(r-ye)>(on-ye)*(n-Oe)&&++ft:on<=r&&(Ze-Oe)*(r-ye)<(on-ye)*(n-Oe)&&--ft;return ft}function Y(){p=w,I=[],C=[],ue=!0}function rt(){var ft=at(),H=ue&&ft,yt=(I=r5(I)).length;(H||yt)&&(d.polygonStart(),H&&(d.lineStart(),o(null,null,1,d),d.lineEnd()),yt&&d5(I,c,ft,o,d),d.polygonEnd()),p=d,I=C=V=null}function Bt(){ve.point=F,C&&C.push(V=[]),zt=!0,st=!1,oe=Zt=NaN}function Dt(){I&&(F(Wt,Qt),Rt&&st&&w.rejoin(),I.push(w.result())),ve.point=an,st&&p.lineEnd()}function F(ft,H){var yt=s(ft,H);if(C&&V.push([ft,H]),zt)Wt=ft,Qt=H,Rt=yt,zt=!1,yt&&(p.lineStart(),p.point(ft,H));else if(yt&&st)p.point(ft,H);else{var Lt=[oe=Math.max(f_,Math.min(Bh,oe)),Zt=Math.max(f_,Math.min(Bh,Zt))],Kt=[ft=Math.max(f_,Math.min(Bh,ft)),H=Math.max(f_,Math.min(Bh,H))];_5(Lt,Kt,n,t,e,r)?(st||(p.lineStart(),p.point(Lt[0],Lt[1])),p.point(Kt[0],Kt[1]),yt||p.lineEnd(),ue=!1):yt&&(p.lineStart(),p.point(ft,H),ue=!1)}oe=ft,Zt=H,st=yt}return ve}}const E0=n=>n;var e0=new Uc,T0=new Uc,gb,yb,I0,O0,Ko={point:Gi,lineStart:Gi,lineEnd:Gi,polygonStart:function(){Ko.lineStart=m5,Ko.lineEnd=y5},polygonEnd:function(){Ko.lineStart=Ko.lineEnd=Ko.point=Gi,e0.add(Oc(T0)),T0=new Uc},result:function(){var n=e0/2;return e0=new Uc,n}};function m5(){Ko.point=g5}function g5(n,t){Ko.point=vb,gb=I0=n,yb=O0=t}function vb(n,t){T0.add(O0*n-I0*t),I0=n,O0=t}function y5(){vb(gb,yb)}const Yy=Ko;var Gc=1/0,P_=Gc,$h=-Gc,z_=$h,v5={point:b5,lineStart:Gi,lineEnd:Gi,polygonStart:Gi,polygonEnd:Gi,result:function(){var n=[[Gc,P_],[$h,z_]];return $h=z_=-(P_=Gc=1/0),n}};function b5(n,t){n<Gc&&(Gc=n),n>$h&&($h=n),t<P_&&(P_=t),t>z_&&(z_=t)}const U_=v5;var B0=0,M0=0,Mh=0,G_=0,$_=0,Ec=0,L0=0,R0=0,Lh=0,bb,wb,Ys,Hs,cs={point:lu,lineStart:Hy,lineEnd:Xy,polygonStart:function(){cs.lineStart=S5,cs.lineEnd=A5},polygonEnd:function(){cs.point=lu,cs.lineStart=Hy,cs.lineEnd=Xy},result:function(){var n=Lh?[L0/Lh,R0/Lh]:Ec?[G_/Ec,$_/Ec]:Mh?[B0/Mh,M0/Mh]:[NaN,NaN];return B0=M0=Mh=G_=$_=Ec=L0=R0=Lh=0,n}};function lu(n,t){B0+=n,M0+=t,++Mh}function Hy(){cs.point=w5}function w5(n,t){cs.point=x5,lu(Ys=n,Hs=t)}function x5(n,t){var e=n-Ys,r=t-Hs,s=fg(e*e+r*r);G_+=s*(Ys+n)/2,$_+=s*(Hs+t)/2,Ec+=s,lu(Ys=n,Hs=t)}function Xy(){cs.point=lu}function S5(){cs.point=E5}function A5(){xb(bb,wb)}function E5(n,t){cs.point=xb,lu(bb=Ys=n,wb=Hs=t)}function xb(n,t){var e=n-Ys,r=t-Hs,s=fg(e*e+r*r);G_+=s*(Ys+n)/2,$_+=s*(Hs+t)/2,Ec+=s,s=Hs*n-Ys*t,L0+=s*(Ys+n),R0+=s*(Hs+t),Lh+=s*3,lu(Ys=n,Hs=t)}const qy=cs;function Sb(n){this._context=n}Sb.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:{this._context.moveTo(n,t),this._point=1;break}case 1:{this._context.lineTo(n,t);break}default:{this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,a5);break}}},result:Gi};var N0=new Uc,n0,Ab,Eb,Rh,Nh,V_={point:Gi,lineStart:function(){V_.point=T5},lineEnd:function(){n0&&Tb(Ab,Eb),V_.point=Gi},polygonStart:function(){n0=!0},polygonEnd:function(){n0=null},result:function(){var n=+N0;return N0=new Uc,n}};function T5(n,t){V_.point=Tb,Ab=Rh=n,Eb=Nh=t}function Tb(n,t){Rh-=n,Nh-=t,N0.add(fg(Rh*Rh+Nh*Nh)),Rh=n,Nh=t}const Zy=V_;let Ky,j_,Jy,Qy;class tv{constructor(t){this._append=t==null?Ib:I5(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,e){switch(this._point){case 0:{this._append`M${t},${e}`,this._point=1;break}case 1:{this._append`L${t},${e}`;break}default:{if(this._append`M${t},${e}`,this._radius!==Jy||this._append!==j_){const r=this._radius,s=this._;this._="",this._append`m0,${r}a${r},${r} 0 1,1 0,${-2*r}a${r},${r} 0 1,1 0,${2*r}z`,Jy=r,j_=this._append,Qy=this._,this._=s}this._+=Qy;break}}}result(){const t=this._;return this._="",t.length?t:null}}function Ib(n){let t=1;this._+=n[0];for(const e=n.length;t<e;++t)this._+=arguments[t]+n[t]}function I5(n){const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);if(t>15)return Ib;if(t!==Ky){const e=10**t;Ky=t,j_=function(s){let o=1;this._+=s[0];for(const f=s.length;o<f;++o)this._+=Math.round(arguments[o]*e)/e+s[o]}}return j_}function O5(n,t){let e=3,r=4.5,s,o;function f(c){return c&&(typeof r=="function"&&o.pointRadius(+r.apply(this,arguments)),bc(c,s(o))),o.result()}return f.area=function(c){return bc(c,s(Yy)),Yy.result()},f.measure=function(c){return bc(c,s(Zy)),Zy.result()},f.bounds=function(c){return bc(c,s(U_)),U_.result()},f.centroid=function(c){return bc(c,s(qy)),qy.result()},f.projection=function(c){return arguments.length?(s=c==null?(n=null,E0):(n=c).stream,f):n},f.context=function(c){return arguments.length?(o=c==null?(t=null,new tv(e)):new Sb(t=c),typeof r!="function"&&o.pointRadius(r),f):t},f.pointRadius=function(c){return arguments.length?(r=typeof c=="function"?c:(o.pointRadius(+c),+c),f):r},f.digits=function(c){if(!arguments.length)return e;if(c==null)e=null;else{const l=Math.floor(c);if(!(l>=0))throw new RangeError(`invalid digits: ${c}`);e=l}return t===null&&(o=new tv(e)),f},f.projection(n).digits(e).context(t)}function B5(n){return function(t){var e=new D0;for(var r in n)e[r]=n[r];return e.stream=t,e}}function D0(){}D0.prototype={constructor:D0,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function ug(n,t,e){var r=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),r!=null&&n.clipExtent(null),bc(e,n.stream(U_)),t(U_.result()),r!=null&&n.clipExtent(r),n}function Ob(n,t,e){return ug(n,function(r){var s=t[1][0]-t[0][0],o=t[1][1]-t[0][1],f=Math.min(s/(r[1][0]-r[0][0]),o/(r[1][1]-r[0][1])),c=+t[0][0]+(s-f*(r[1][0]+r[0][0]))/2,l=+t[0][1]+(o-f*(r[1][1]+r[0][1]))/2;n.scale(150*f).translate([c,l])},e)}function M5(n,t,e){return Ob(n,[[0,0],t],e)}function L5(n,t,e){return ug(n,function(r){var s=+t,o=s/(r[1][0]-r[0][0]),f=(s-o*(r[1][0]+r[0][0]))/2,c=-o*r[0][1];n.scale(150*o).translate([f,c])},e)}function R5(n,t,e){return ug(n,function(r){var s=+t,o=s/(r[1][1]-r[0][1]),f=-o*r[0][0],c=(s-o*(r[1][1]+r[0][1]))/2;n.scale(150*o).translate([f,c])},e)}function N5(){var n=1,t=0,e=0,r=1,s=1,o=0,f,c,l=null,d,p,w,I=1,C=1,V=B5({point:function(st,zt){var ue=Zt([st,zt]);this.stream.point(ue[0],ue[1])}}),Wt=E0,Qt,Rt;function oe(){return I=n*r,C=n*s,Qt=Rt=null,Zt}function Zt(st){var zt=st[0]*I,ue=st[1]*C;if(o){var ve=ue*f-zt*c;zt=zt*f+ue*c,ue=ve}return[zt+t,ue+e]}return Zt.invert=function(st){var zt=st[0]-t,ue=st[1]-e;if(o){var ve=ue*f+zt*c;zt=zt*f-ue*c,ue=ve}return[zt/I,ue/C]},Zt.stream=function(st){return Qt&&Rt===st?Qt:Qt=V(Wt(Rt=st))},Zt.postclip=function(st){return arguments.length?(Wt=st,l=d=p=w=null,oe()):Wt},Zt.clipExtent=function(st){return arguments.length?(Wt=st==null?(l=d=p=w=null,E0):p5(l=+st[0][0],d=+st[0][1],p=+st[1][0],w=+st[1][1]),oe()):l==null?null:[[l,d],[p,w]]},Zt.scale=function(st){return arguments.length?(n=+st,oe()):n},Zt.translate=function(st){return arguments.length?(t=+st[0],e=+st[1],oe()):[t,e]},Zt.angle=function(st){return arguments.length?(o=st%360*f5,c=c5(o),f=u5(o),oe()):o*o5},Zt.reflectX=function(st){return arguments.length?(r=st?-1:1,oe()):r<0},Zt.reflectY=function(st){return arguments.length?(s=st?-1:1,oe()):s<0},Zt.fitExtent=function(st,zt){return Ob(Zt,st,zt)},Zt.fitSize=function(st,zt){return M5(Zt,st,zt)},Zt.fitWidth=function(st,zt){return L5(Zt,st,zt)},Zt.fitHeight=function(st,zt){return R5(Zt,st,zt)},Zt}var ls=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},W_={},D5={get exports(){return W_},set exports(n){W_=n}};(function(n,t){var e=200,r="__lodash_hash_undefined__",s=800,o=16,f=9007199254740991,c="[object Arguments]",l="[object Array]",d="[object AsyncFunction]",p="[object Boolean]",w="[object Date]",I="[object Error]",C="[object Function]",V="[object GeneratorFunction]",Wt="[object Map]",Qt="[object Number]",Rt="[object Null]",oe="[object Object]",Zt="[object Proxy]",st="[object RegExp]",zt="[object Set]",ue="[object String]",ve="[object Undefined]",an="[object WeakMap]",at="[object ArrayBuffer]",Y="[object DataView]",rt="[object Float32Array]",Bt="[object Float64Array]",Dt="[object Int8Array]",F="[object Int16Array]",ft="[object Int32Array]",H="[object Uint8Array]",yt="[object Uint8ClampedArray]",Lt="[object Uint16Array]",Kt="[object Uint32Array]",ee=/[\\^$.*+?()[\]{}|]/g,de=/^\[object .+?Constructor\]$/,Oe=/^(?:0|[1-9]\d*)$/,ye={};ye[rt]=ye[Bt]=ye[Dt]=ye[F]=ye[ft]=ye[H]=ye[yt]=ye[Lt]=ye[Kt]=!0,ye[c]=ye[l]=ye[at]=ye[p]=ye[Y]=ye[w]=ye[I]=ye[C]=ye[Wt]=ye[Qt]=ye[oe]=ye[st]=ye[zt]=ye[ue]=ye[an]=!1;var Ze=typeof ls=="object"&&ls&&ls.Object===Object&&ls,on=typeof self=="object"&&self&&self.Object===Object&&self,En=Ze||on||Function("return this")(),Dn=t&&!t.nodeType&&t,hn=Dn&&!0&&n&&!n.nodeType&&n,Fn=hn&&hn.exports===Dn,ir=Fn&&Ze.process,Kn=function(){try{var B=hn&&hn.require&&hn.require("util").types;return B||ir&&ir.binding&&ir.binding("util")}catch{}}(),Yr=Kn&&Kn.isTypedArray;function rf(B,G,it){switch(it.length){case 0:return B.call(G);case 1:return B.call(G,it[0]);case 2:return B.call(G,it[0],it[1]);case 3:return B.call(G,it[0],it[1],it[2])}return B.apply(G,it)}function Rr(B,G){for(var it=-1,ie=Array(B);++it<B;)ie[it]=G(it);return ie}function ws(B){return function(G){return B(G)}}function gu(B,G){return B==null?void 0:B[G]}function oi(B,G){return function(it){return B(G(it))}}var yr=Array.prototype,yu=Function.prototype,kr=Object.prototype,Ir=En["__core-js_shared__"],Ei=yu.toString,b=kr.hasOwnProperty,vu=function(){var B=/[^.]+$/.exec(Ir&&Ir.keys&&Ir.keys.IE_PROTO||"");return B?"Symbol(src)_1."+B:""}(),xs=kr.toString,ol=Ei.call(Object),ua=RegExp("^"+Ei.call(b).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),lr=Fn?En.Buffer:void 0,ca=En.Symbol,Ti=En.Uint8Array,la=lr?lr.allocUnsafe:void 0,lo=oi(Object.getPrototypeOf,Object),ho=Object.create,_o=kr.propertyIsEnumerable,hr=yr.splice,Pr=ca?ca.toStringTag:void 0,ji=function(){try{var B=Es(Object,"defineProperty");return B({},"",{}),B}catch{}}(),fl=lr?lr.isBuffer:void 0,bu=Math.max,ul=Date.now,sf=Es(En,"Map"),Ss=Es(Object,"create"),wu=function(){function B(){}return function(G){if(!ui(G))return{};if(ho)return ho(G);B.prototype=G;var it=new B;return B.prototype=void 0,it}}();function Ii(B){var G=-1,it=B==null?0:B.length;for(this.clear();++G<it;){var ie=B[G];this.set(ie[0],ie[1])}}function cl(){this.__data__=Ss?Ss(null):{},this.size=0}function ll(B){var G=this.has(B)&&delete this.__data__[B];return this.size-=G?1:0,G}function vr(B){var G=this.__data__;if(Ss){var it=G[B];return it===r?void 0:it}return b.call(G,B)?G[B]:void 0}function hl(B){var G=this.__data__;return Ss?G[B]!==void 0:b.call(G,B)}function dl(B,G){var it=this.__data__;return this.size+=this.has(B)?0:1,it[B]=Ss&&G===void 0?r:G,this}Ii.prototype.clear=cl,Ii.prototype.delete=ll,Ii.prototype.get=vr,Ii.prototype.has=hl,Ii.prototype.set=dl;function fi(B){var G=-1,it=B==null?0:B.length;for(this.clear();++G<it;){var ie=B[G];this.set(ie[0],ie[1])}}function af(){this.__data__=[],this.size=0}function _l(B){var G=this.__data__,it=Hi(G,B);if(it<0)return!1;var ie=G.length-1;return it==ie?G.pop():hr.call(G,it,1),--this.size,!0}function of(B){var G=this.__data__,it=Hi(G,B);return it<0?void 0:G[it][1]}function pl(B){return Hi(this.__data__,B)>-1}function ml(B,G){var it=this.__data__,ie=Hi(it,B);return ie<0?(++this.size,it.push([B,G])):it[ie][1]=G,this}fi.prototype.clear=af,fi.prototype.delete=_l,fi.prototype.get=of,fi.prototype.has=pl,fi.prototype.set=ml;function Wi(B){var G=-1,it=B==null?0:B.length;for(this.clear();++G<it;){var ie=B[G];this.set(ie[0],ie[1])}}function xu(){this.size=0,this.__data__={hash:new Ii,map:new(sf||fi),string:new Ii}}function Cn(B){var G=Oi(this,B).delete(B);return this.size-=G?1:0,G}function gl(B){return Oi(this,B).get(B)}function yl(B){return Oi(this,B).has(B)}function vl(B,G){var it=Oi(this,B),ie=it.size;return it.set(B,G),this.size+=it.size==ie?0:1,this}Wi.prototype.clear=xu,Wi.prototype.delete=Cn,Wi.prototype.get=gl,Wi.prototype.has=yl,Wi.prototype.set=vl;function Yi(B){var G=this.__data__=new fi(B);this.size=G.size}function bl(){this.__data__=new fi,this.size=0}function wl(B){var G=this.__data__,it=G.delete(B);return this.size=G.size,it}function xl(B){return this.__data__.get(B)}function Sl(B){return this.__data__.has(B)}function Al(B,G){var it=this.__data__;if(it instanceof fi){var ie=it.__data__;if(!sf||ie.length<e-1)return ie.push([B,G]),this.size=++it.size,this;it=this.__data__=new Wi(ie)}return it.set(B,G),this.size=it.size,this}Yi.prototype.clear=bl,Yi.prototype.delete=wl,Yi.prototype.get=xl,Yi.prototype.has=Sl,Yi.prototype.set=Al;function El(B,G){var it=gf(B),ie=!it&&_a(B),Ke=!it&&!ie&&Nu(B),_n=!it&&!ie&&!Ke&&Fu(B),De=it||ie||Ke||_n,We=De?Rr(B.length,String):[],dn=We.length;for(var Or in B)(G||b.call(B,Or))&&!(De&&(Or=="length"||Ke&&(Or=="offset"||Or=="parent")||_n&&(Or=="buffer"||Or=="byteLength"||Or=="byteOffset")||Mu(Or,dn)))&&We.push(Or);return We}function As(B,G,it){(it!==void 0&&!vo(B[G],it)||it===void 0&&!(G in B))&&ff(B,G,it)}function Tl(B,G,it){var ie=B[G];(!(b.call(B,G)&&vo(ie,it))||it===void 0&&!(G in B))&&ff(B,G,it)}function Hi(B,G){for(var it=B.length;it--;)if(vo(B[it][0],G))return it;return-1}function ff(B,G,it){G=="__proto__"&&ji?ji(B,G,{configurable:!0,enumerable:!0,value:it,writable:!0}):B[G]=it}var Il=Bu();function po(B){return B==null?B===void 0?ve:Rt:Pr&&Pr in Object(B)?hf(B):da(B)}function uf(B){return pa(B)&&po(B)==c}function Su(B){if(!ui(B)||_f(B))return!1;var G=yf(B)?ua:de;return G.test(Ru(B))}function Au(B){return pa(B)&&Du(B.length)&&!!ye[po(B)]}function Ol(B){if(!ui(B))return br(B);var G=Jn(B),it=[];for(var ie in B)ie=="constructor"&&(G||!b.call(B,ie))||it.push(ie);return it}function Eu(B,G,it,ie,Ke){B!==G&&Il(G,function(_n,De){if(Ke||(Ke=new Yi),ui(_n))Bl(B,G,De,it,Eu,ie,Ke);else{var We=ie?ie(yo(B,De),_n,De+"",B,G,Ke):void 0;We===void 0&&(We=_n),As(B,De,We)}},ma)}function Bl(B,G,it,ie,Ke,_n,De){var We=yo(B,it),dn=yo(G,it),Or=De.get(dn);if(Or){As(B,it,Or);return}var dr=_n?_n(We,dn,it+"",B,G,De):void 0,sr=dr===void 0;if(sr){var wo=gf(dn),zr=!wo&&Nu(dn),bf=!wo&&!zr&&Fu(dn);dr=dn,wo||zr||bf?gf(We)?dr=We:Rl(We)?dr=mo(We):zr?(sr=!1,dr=Iu(dn,!0)):bf?(sr=!1,dr=cf(dn,!0)):dr=[]:Xi(dn)||_a(dn)?(dr=We,_a(We)?dr=Nl(We):(!ui(We)||yf(We))&&(dr=ha(dn))):sr=!1}sr&&(De.set(dn,dr),Ke(dr,dn,ie,_n,De),De.delete(dn)),As(B,it,dr)}function Ml(B,G){return pf(Ll(B,G,vf),B+"")}var Tu=ji?function(B,G){return ji(B,"toString",{configurable:!0,enumerable:!1,value:vn(G),writable:!0})}:vf;function Iu(B,G){if(G)return B.slice();var it=B.length,ie=la?la(it):new B.constructor(it);return B.copy(ie),ie}function Ou(B){var G=new B.constructor(B.byteLength);return new Ti(G).set(new Ti(B)),G}function cf(B,G){var it=G?Ou(B.buffer):B.buffer;return new B.constructor(it,B.byteOffset,B.length)}function mo(B,G){var it=-1,ie=B.length;for(G||(G=Array(ie));++it<ie;)G[it]=B[it];return G}function lf(B,G,it,ie){var Ke=!it;it||(it={});for(var _n=-1,De=G.length;++_n<De;){var We=G[_n],dn=ie?ie(it[We],B[We],We,it,B):void 0;dn===void 0&&(dn=B[We]),Ke?ff(it,We,dn):Tl(it,We,dn)}return it}function go(B){return Ml(function(G,it){var ie=-1,Ke=it.length,_n=Ke>1?it[Ke-1]:void 0,De=Ke>2?it[2]:void 0;for(_n=B.length>3&&typeof _n=="function"?(Ke--,_n):void 0,De&&Lu(it[0],it[1],De)&&(_n=Ke<3?void 0:_n,Ke=1),G=Object(G);++ie<Ke;){var We=it[ie];We&&B(G,We,ie,_n)}return G})}function Bu(B){return function(G,it,ie){for(var Ke=-1,_n=Object(G),De=ie(G),We=De.length;We--;){var dn=De[B?We:++Ke];if(it(_n[dn],dn,_n)===!1)break}return G}}function Oi(B,G){var it=B.__data__;return df(G)?it[typeof G=="string"?"string":"hash"]:it.map}function Es(B,G){var it=gu(B,G);return Su(it)?it:void 0}function hf(B){var G=b.call(B,Pr),it=B[Pr];try{B[Pr]=void 0;var ie=!0}catch{}var Ke=xs.call(B);return ie&&(G?B[Pr]=it:delete B[Pr]),Ke}function ha(B){return typeof B.constructor=="function"&&!Jn(B)?wu(lo(B)):{}}function Mu(B,G){var it=typeof B;return G=G??f,!!G&&(it=="number"||it!="symbol"&&Oe.test(B))&&B>-1&&B%1==0&&B<G}function Lu(B,G,it){if(!ui(it))return!1;var ie=typeof G;return(ie=="number"?bo(it)&&Mu(G,it.length):ie=="string"&&G in it)?vo(it[G],B):!1}function df(B){var G=typeof B;return G=="string"||G=="number"||G=="symbol"||G=="boolean"?B!=="__proto__":B===null}function _f(B){return!!vu&&vu in B}function Jn(B){var G=B&&B.constructor,it=typeof G=="function"&&G.prototype||kr;return B===it}function br(B){var G=[];if(B!=null)for(var it in Object(B))G.push(it);return G}function da(B){return xs.call(B)}function Ll(B,G,it){return G=bu(G===void 0?B.length-1:G,0),function(){for(var ie=arguments,Ke=-1,_n=bu(ie.length-G,0),De=Array(_n);++Ke<_n;)De[Ke]=ie[G+Ke];Ke=-1;for(var We=Array(G+1);++Ke<G;)We[Ke]=ie[Ke];return We[G]=it(De),rf(B,this,We)}}function yo(B,G){if(!(G==="constructor"&&typeof B[G]=="function")&&G!="__proto__")return B[G]}var pf=mf(Tu);function mf(B){var G=0,it=0;return function(){var ie=ul(),Ke=o-(ie-it);if(it=ie,Ke>0){if(++G>=s)return arguments[0]}else G=0;return B.apply(void 0,arguments)}}function Ru(B){if(B!=null){try{return Ei.call(B)}catch{}try{return B+""}catch{}}return""}function vo(B,G){return B===G||B!==B&&G!==G}var _a=uf(function(){return arguments}())?uf:function(B){return pa(B)&&b.call(B,"callee")&&!_o.call(B,"callee")},gf=Array.isArray;function bo(B){return B!=null&&Du(B.length)&&!yf(B)}function Rl(B){return pa(B)&&bo(B)}var Nu=fl||Dl;function yf(B){if(!ui(B))return!1;var G=po(B);return G==C||G==V||G==d||G==Zt}function Du(B){return typeof B=="number"&&B>-1&&B%1==0&&B<=f}function ui(B){var G=typeof B;return B!=null&&(G=="object"||G=="function")}function pa(B){return B!=null&&typeof B=="object"}function Xi(B){if(!pa(B)||po(B)!=oe)return!1;var G=lo(B);if(G===null)return!0;var it=b.call(G,"constructor")&&G.constructor;return typeof it=="function"&&it instanceof it&&Ei.call(it)==ol}var Fu=Yr?ws(Yr):Au;function Nl(B){return lf(B,ma(B))}function ma(B){return bo(B)?El(B,!0):Ol(B)}var yn=go(function(B,G,it){Eu(B,G,it)});function vn(B){return function(){return B}}function vf(B){return B}function Dl(){return!1}n.exports=yn})(D5,W_);var $c=0,Dh=0,Th=0,Bb=1e3,Y_,Fh,H_=0,hu=0,Ip=0,Vh=typeof performance=="object"&&performance.now?performance:Date,Mb=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function cg(){return hu||(Mb(F5),hu=Vh.now()+Ip)}function F5(){hu=0}function X_(){this._call=this._time=this._next=null}X_.prototype=id.prototype={constructor:X_,restart:function(n,t,e){if(typeof n!="function")throw new TypeError("callback is not a function");e=(e==null?cg():+e)+(t==null?0:+t),!this._next&&Fh!==this&&(Fh?Fh._next=this:Y_=this,Fh=this),this._call=n,this._time=e,F0()},stop:function(){this._call&&(this._call=null,this._time=1/0,F0())}};function id(n,t,e){var r=new X_;return r.restart(n,t,e),r}function C5(){cg(),++$c;for(var n=Y_,t;n;)(t=hu-n._time)>=0&&n._call.call(void 0,t),n=n._next;--$c}function ev(){hu=(H_=Vh.now())+Ip,$c=Dh=0;try{C5()}finally{$c=0,P5(),hu=0}}function k5(){var n=Vh.now(),t=n-H_;t>Bb&&(Ip-=t,H_=n)}function P5(){for(var n,t=Y_,e,r=1/0;t;)t._call?(r>t._time&&(r=t._time),n=t,t=t._next):(e=t._next,t._next=null,t=n?n._next=e:Y_=e);Fh=n,F0(r)}function F0(n){if(!$c){Dh&&(Dh=clearTimeout(Dh));var t=n-hu;t>24?(n<1/0&&(Dh=setTimeout(ev,n-Vh.now()-Ip)),Th&&(Th=clearInterval(Th))):(Th||(H_=Vh.now(),Th=setInterval(k5,Bb)),$c=1,Mb(ev))}}function nv(n,t,e){var r=new X_;return t=t==null?0:+t,r.restart(s=>{r.stop(),n(s+t)},t,e),r}var z5={value:()=>{}};function Op(){for(var n=0,t=arguments.length,e={},r;n<t;++n){if(!(r=arguments[n]+"")||r in e||/[\s.]/.test(r))throw new Error("illegal type: "+r);e[r]=[]}return new S_(e)}function S_(n){this._=n}function U5(n,t){return n.trim().split(/^|\s+/).map(function(e){var r="",s=e.indexOf(".");if(s>=0&&(r=e.slice(s+1),e=e.slice(0,s)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}S_.prototype=Op.prototype={constructor:S_,on:function(n,t){var e=this._,r=U5(n+"",e),s,o=-1,f=r.length;if(arguments.length<2){for(;++o<f;)if((s=(n=r[o]).type)&&(s=G5(e[s],n.name)))return s;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<f;)if(s=(n=r[o]).type)e[s]=rv(e[s],n.name,t);else if(t==null)for(s in e)e[s]=rv(e[s],n.name,null);return this},copy:function(){var n={},t=this._;for(var e in t)n[e]=t[e].slice();return new S_(n)},call:function(n,t){if((s=arguments.length-2)>0)for(var e=new Array(s),r=0,s,o;r<s;++r)e[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(o=this._[n],r=0,s=o.length;r<s;++r)o[r].value.apply(t,e)},apply:function(n,t,e){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],s=0,o=r.length;s<o;++s)r[s].value.apply(t,e)}};function G5(n,t){for(var e=0,r=n.length,s;e<r;++e)if((s=n[e]).name===t)return s.value}function rv(n,t,e){for(var r=0,s=n.length;r<s;++r)if(n[r].name===t){n[r]=z5,n=n.slice(0,r).concat(n.slice(r+1));break}return e!=null&&n.push({name:t,value:e}),n}const $5={passive:!1},jh={capture:!0,passive:!1};function r0(n){n.stopImmediatePropagation()}function Bc(n){n.preventDefault(),n.stopImmediatePropagation()}function Lb(n){var t=n.document.documentElement,e=Wn(n).on("dragstart.drag",Bc,jh);"onselectstart"in t?e.on("selectstart.drag",Bc,jh):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Rb(n,t){var e=n.document.documentElement,r=Wn(n).on("dragstart.drag",null);t&&(r.on("click.drag",Bc,jh),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in e?r.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}const u_=n=>()=>n;function C0(n,{sourceEvent:t,subject:e,target:r,identifier:s,active:o,x:f,y:c,dx:l,dy:d,dispatch:p}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:e,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:f,enumerable:!0,configurable:!0},y:{value:c,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:p}})}C0.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function V5(n){return!n.ctrlKey&&!n.button}function j5(){return this.parentNode}function W5(n,t){return t??{x:n.x,y:n.y}}function Y5(){return navigator.maxTouchPoints||"ontouchstart"in this}function H5(){var n=V5,t=j5,e=W5,r=Y5,s={},o=Op("start","drag","end"),f=0,c,l,d,p,w=0;function I(st){st.on("mousedown.drag",C).filter(r).on("touchstart.drag",Qt).on("touchmove.drag",Rt,$5).on("touchend.drag touchcancel.drag",oe).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function C(st,zt){if(!(p||!n.call(this,st,zt))){var ue=Zt(this,t.call(this,st,zt),st,zt,"mouse");ue&&(Wn(st.view).on("mousemove.drag",V,jh).on("mouseup.drag",Wt,jh),Lb(st.view),r0(st),d=!1,c=st.clientX,l=st.clientY,ue("start",st))}}function V(st){if(Bc(st),!d){var zt=st.clientX-c,ue=st.clientY-l;d=zt*zt+ue*ue>w}s.mouse("drag",st)}function Wt(st){Wn(st.view).on("mousemove.drag mouseup.drag",null),Rb(st.view,d),Bc(st),s.mouse("end",st)}function Qt(st,zt){if(n.call(this,st,zt)){var ue=st.changedTouches,ve=t.call(this,st,zt),an=ue.length,at,Y;for(at=0;at<an;++at)(Y=Zt(this,ve,st,zt,ue[at].identifier,ue[at]))&&(r0(st),Y("start",st,ue[at]))}}function Rt(st){var zt=st.changedTouches,ue=zt.length,ve,an;for(ve=0;ve<ue;++ve)(an=s[zt[ve].identifier])&&(Bc(st),an("drag",st,zt[ve]))}function oe(st){var zt=st.changedTouches,ue=zt.length,ve,an;for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),ve=0;ve<ue;++ve)(an=s[zt[ve].identifier])&&(r0(st),an("end",st,zt[ve]))}function Zt(st,zt,ue,ve,an,at){var Y=o.copy(),rt=qa(at||ue,zt),Bt,Dt,F;if((F=e.call(st,new C0("beforestart",{sourceEvent:ue,target:I,identifier:an,active:f,x:rt[0],y:rt[1],dx:0,dy:0,dispatch:Y}),ve))!=null)return Bt=F.x-rt[0]||0,Dt=F.y-rt[1]||0,function ft(H,yt,Lt){var Kt=rt,ee;switch(H){case"start":s[an]=ft,ee=f++;break;case"end":delete s[an],--f;case"drag":rt=qa(Lt||yt,zt),ee=f;break}Y.call(H,st,new C0(H,{sourceEvent:yt,subject:F,target:I,identifier:an,active:ee,x:rt[0]+Bt,y:rt[1]+Dt,dx:rt[0]-Kt[0],dy:rt[1]-Kt[1],dispatch:Y}),ve)}}return I.filter=function(st){return arguments.length?(n=typeof st=="function"?st:u_(!!st),I):n},I.container=function(st){return arguments.length?(t=typeof st=="function"?st:u_(st),I):t},I.subject=function(st){return arguments.length?(e=typeof st=="function"?st:u_(st),I):e},I.touchable=function(st){return arguments.length?(r=typeof st=="function"?st:u_(!!st),I):r},I.on=function(){var st=o.on.apply(o,arguments);return st===o?I:st},I.clickDistance=function(st){return arguments.length?(w=(st=+st)*st,I):Math.sqrt(w)},I}function Bp(n,t,e){n.prototype=t.prototype=e,e.constructor=n}function lg(n,t){var e=Object.create(n.prototype);for(var r in t)e[r]=t[r];return e}function nl(){}var du=.7,Vc=1/du,Mc="\\s*([+-]?\\d+)\\s*",Wh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",na="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",X5=/^#([0-9a-f]{3,8})$/,q5=new RegExp(`^rgb\\(${Mc},${Mc},${Mc}\\)$`),Z5=new RegExp(`^rgb\\(${na},${na},${na}\\)$`),K5=new RegExp(`^rgba\\(${Mc},${Mc},${Mc},${Wh}\\)$`),J5=new RegExp(`^rgba\\(${na},${na},${na},${Wh}\\)$`),Q5=new RegExp(`^hsl\\(${Wh},${na},${na}\\)$`),t8=new RegExp(`^hsla\\(${Wh},${na},${na},${Wh}\\)$`),iv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Bp(nl,_u,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:sv,formatHex:sv,formatHex8:e8,formatHsl:n8,formatRgb:av,toString:av});function sv(){return this.rgb().formatHex()}function e8(){return this.rgb().formatHex8()}function n8(){return Db(this).formatHsl()}function av(){return this.rgb().formatRgb()}function _u(n){var t,e;return n=(n+"").trim().toLowerCase(),(t=X5.exec(n))?(e=t[1].length,t=parseInt(t[1],16),e===6?ov(t):e===3?new Fr(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?c_(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?c_(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=q5.exec(n))?new Fr(t[1],t[2],t[3],1):(t=Z5.exec(n))?new Fr(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=K5.exec(n))?c_(t[1],t[2],t[3],t[4]):(t=J5.exec(n))?c_(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Q5.exec(n))?cv(t[1],t[2]/100,t[3]/100,1):(t=t8.exec(n))?cv(t[1],t[2]/100,t[3]/100,t[4]):iv.hasOwnProperty(n)?ov(iv[n]):n==="transparent"?new Fr(NaN,NaN,NaN,0):null}function ov(n){return new Fr(n>>16&255,n>>8&255,n&255,1)}function c_(n,t,e,r){return r<=0&&(n=t=e=NaN),new Fr(n,t,e,r)}function Nb(n){return n instanceof nl||(n=_u(n)),n?(n=n.rgb(),new Fr(n.r,n.g,n.b,n.opacity)):new Fr}function ro(n,t,e,r){return arguments.length===1?Nb(n):new Fr(n,t,e,r??1)}function Fr(n,t,e,r){this.r=+n,this.g=+t,this.b=+e,this.opacity=+r}Bp(Fr,ro,lg(nl,{brighter(n){return n=n==null?Vc:Math.pow(Vc,n),new Fr(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?du:Math.pow(du,n),new Fr(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Fr(fu(this.r),fu(this.g),fu(this.b),q_(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:fv,formatHex:fv,formatHex8:r8,formatRgb:uv,toString:uv}));function fv(){return`#${Qf(this.r)}${Qf(this.g)}${Qf(this.b)}`}function r8(){return`#${Qf(this.r)}${Qf(this.g)}${Qf(this.b)}${Qf((isNaN(this.opacity)?1:this.opacity)*255)}`}function uv(){const n=q_(this.opacity);return`${n===1?"rgb(":"rgba("}${fu(this.r)}, ${fu(this.g)}, ${fu(this.b)}${n===1?")":`, ${n})`}`}function q_(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function fu(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Qf(n){return n=fu(n),(n<16?"0":"")+n.toString(16)}function cv(n,t,e,r){return r<=0?n=t=e=NaN:e<=0||e>=1?n=t=NaN:t<=0&&(n=NaN),new hs(n,t,e,r)}function Db(n){if(n instanceof hs)return new hs(n.h,n.s,n.l,n.opacity);if(n instanceof nl||(n=_u(n)),!n)return new hs;if(n instanceof hs)return n;n=n.rgb();var t=n.r/255,e=n.g/255,r=n.b/255,s=Math.min(t,e,r),o=Math.max(t,e,r),f=NaN,c=o-s,l=(o+s)/2;return c?(t===o?f=(e-r)/c+(e<r)*6:e===o?f=(r-t)/c+2:f=(t-e)/c+4,c/=l<.5?o+s:2-o-s,f*=60):c=l>0&&l<1?0:f,new hs(f,c,l,n.opacity)}function i8(n,t,e,r){return arguments.length===1?Db(n):new hs(n,t,e,r??1)}function hs(n,t,e,r){this.h=+n,this.s=+t,this.l=+e,this.opacity=+r}Bp(hs,i8,lg(nl,{brighter(n){return n=n==null?Vc:Math.pow(Vc,n),new hs(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?du:Math.pow(du,n),new hs(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,t=isNaN(n)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*t,s=2*e-r;return new Fr(i0(n>=240?n-240:n+120,s,r),i0(n,s,r),i0(n<120?n+240:n-120,s,r),this.opacity)},clamp(){return new hs(lv(this.h),l_(this.s),l_(this.l),q_(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=q_(this.opacity);return`${n===1?"hsl(":"hsla("}${lv(this.h)}, ${l_(this.s)*100}%, ${l_(this.l)*100}%${n===1?")":`, ${n})`}`}}));function lv(n){return n=(n||0)%360,n<0?n+360:n}function l_(n){return Math.max(0,Math.min(1,n||0))}function i0(n,t,e){return(n<60?t+(e-t)*n/60:n<180?e:n<240?t+(e-t)*(240-n)/60:t)*255}const s8=Math.PI/180,a8=180/Math.PI;var Fb=-.14861,hg=1.78277,dg=-.29227,Mp=-.90649,Yh=1.97294,hv=Yh*Mp,dv=Yh*hg,_v=hg*dg-Mp*Fb;function o8(n){if(n instanceof uu)return new uu(n.h,n.s,n.l,n.opacity);n instanceof Fr||(n=Nb(n));var t=n.r/255,e=n.g/255,r=n.b/255,s=(_v*r+hv*t-dv*e)/(_v+hv-dv),o=r-s,f=(Yh*(e-s)-dg*o)/Mp,c=Math.sqrt(f*f+o*o)/(Yh*s*(1-s)),l=c?Math.atan2(f,o)*a8-120:NaN;return new uu(l<0?l+360:l,c,s,n.opacity)}function ra(n,t,e,r){return arguments.length===1?o8(n):new uu(n,t,e,r??1)}function uu(n,t,e,r){this.h=+n,this.s=+t,this.l=+e,this.opacity=+r}Bp(uu,ra,lg(nl,{brighter(n){return n=n==null?Vc:Math.pow(Vc,n),new uu(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?du:Math.pow(du,n),new uu(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=isNaN(this.h)?0:(this.h+120)*s8,t=+this.l,e=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(n),s=Math.sin(n);return new Fr(255*(t+e*(Fb*r+hg*s)),255*(t+e*(dg*r+Mp*s)),255*(t+e*(Yh*r)),this.opacity)}}));function f8(n,t,e,r,s){var o=n*n,f=o*n;return((1-3*n+3*o-f)*t+(4-6*o+3*f)*e+(1+3*n+3*o-3*f)*r+f*s)/6}function u8(n){var t=n.length-1;return function(e){var r=e<=0?e=0:e>=1?(e=1,t-1):Math.floor(e*t),s=n[r],o=n[r+1],f=r>0?n[r-1]:2*s-o,c=r<t-1?n[r+2]:2*o-s;return f8((e-r/t)*t,f,s,o,c)}}const Lp=n=>()=>n;function Cb(n,t){return function(e){return n+e*t}}function c8(n,t,e){return n=Math.pow(n,e),t=Math.pow(t,e)-n,e=1/e,function(r){return Math.pow(n+r*t,e)}}function l8(n,t){var e=t-n;return e?Cb(n,e>180||e<-180?e-360*Math.round(e/360):e):Lp(isNaN(n)?t:n)}function h8(n){return(n=+n)==1?Lc:function(t,e){return e-t?c8(t,e,n):Lp(isNaN(t)?e:t)}}function Lc(n,t){var e=t-n;return e?Cb(n,e):Lp(isNaN(n)?t:n)}const Z_=function n(t){var e=h8(t);function r(s,o){var f=e((s=ro(s)).r,(o=ro(o)).r),c=e(s.g,o.g),l=e(s.b,o.b),d=Lc(s.opacity,o.opacity);return function(p){return s.r=f(p),s.g=c(p),s.b=l(p),s.opacity=d(p),s+""}}return r.gamma=n,r}(1);function d8(n){return function(t){var e=t.length,r=new Array(e),s=new Array(e),o=new Array(e),f,c;for(f=0;f<e;++f)c=ro(t[f]),r[f]=c.r||0,s[f]=c.g||0,o[f]=c.b||0;return r=n(r),s=n(s),o=n(o),c.opacity=1,function(l){return c.r=r(l),c.g=s(l),c.b=o(l),c+""}}}var _8=d8(u8);function p8(n,t){t||(t=[]);var e=n?Math.min(t.length,n.length):0,r=t.slice(),s;return function(o){for(s=0;s<e;++s)r[s]=n[s]*(1-o)+t[s]*o;return r}}function m8(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function g8(n,t){var e=t?t.length:0,r=n?Math.min(e,n.length):0,s=new Array(r),o=new Array(e),f;for(f=0;f<r;++f)s[f]=Rp(n[f],t[f]);for(;f<e;++f)o[f]=t[f];return function(c){for(f=0;f<r;++f)o[f]=s[f](c);return o}}function y8(n,t){var e=new Date;return n=+n,t=+t,function(r){return e.setTime(n*(1-r)+t*r),e}}function us(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function v8(n,t){var e={},r={},s;(n===null||typeof n!="object")&&(n={}),(t===null||typeof t!="object")&&(t={});for(s in t)s in n?e[s]=Rp(n[s],t[s]):r[s]=t[s];return function(o){for(s in e)r[s]=e[s](o);return r}}var k0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,s0=new RegExp(k0.source,"g");function b8(n){return function(){return n}}function w8(n){return function(t){return n(t)+""}}function kb(n,t){var e=k0.lastIndex=s0.lastIndex=0,r,s,o,f=-1,c=[],l=[];for(n=n+"",t=t+"";(r=k0.exec(n))&&(s=s0.exec(t));)(o=s.index)>e&&(o=t.slice(e,o),c[f]?c[f]+=o:c[++f]=o),(r=r[0])===(s=s[0])?c[f]?c[f]+=s:c[++f]=s:(c[++f]=null,l.push({i:f,x:us(r,s)})),e=s0.lastIndex;return e<t.length&&(o=t.slice(e),c[f]?c[f]+=o:c[++f]=o),c.length<2?l[0]?w8(l[0].x):b8(t):(t=l.length,function(d){for(var p=0,w;p<t;++p)c[(w=l[p]).i]=w.x(d);return c.join("")})}function Rp(n,t){var e=typeof t,r;return t==null||e==="boolean"?Lp(t):(e==="number"?us:e==="string"?(r=_u(t))?(t=r,Z_):kb:t instanceof _u?Z_:t instanceof Date?y8:m8(t)?p8:Array.isArray(t)?g8:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?v8:us)(n,t)}function Pb(n,t){return n=+n,t=+t,function(e){return Math.round(n*(1-e)+t*e)}}var pv=180/Math.PI,P0={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function zb(n,t,e,r,s,o){var f,c,l;return(f=Math.sqrt(n*n+t*t))&&(n/=f,t/=f),(l=n*e+t*r)&&(e-=n*l,r-=t*l),(c=Math.sqrt(e*e+r*r))&&(e/=c,r/=c,l/=c),n*r<t*e&&(n=-n,t=-t,l=-l,f=-f),{translateX:s,translateY:o,rotate:Math.atan2(t,n)*pv,skewX:Math.atan(l)*pv,scaleX:f,scaleY:c}}var h_;function x8(n){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return t.isIdentity?P0:zb(t.a,t.b,t.c,t.d,t.e,t.f)}function S8(n){return n==null||(h_||(h_=document.createElementNS("http://www.w3.org/2000/svg","g")),h_.setAttribute("transform",n),!(n=h_.transform.baseVal.consolidate()))?P0:(n=n.matrix,zb(n.a,n.b,n.c,n.d,n.e,n.f))}function Ub(n,t,e,r){function s(d){return d.length?d.pop()+" ":""}function o(d,p,w,I,C,V){if(d!==w||p!==I){var Wt=C.push("translate(",null,t,null,e);V.push({i:Wt-4,x:us(d,w)},{i:Wt-2,x:us(p,I)})}else(w||I)&&C.push("translate("+w+t+I+e)}function f(d,p,w,I){d!==p?(d-p>180?p+=360:p-d>180&&(d+=360),I.push({i:w.push(s(w)+"rotate(",null,r)-2,x:us(d,p)})):p&&w.push(s(w)+"rotate("+p+r)}function c(d,p,w,I){d!==p?I.push({i:w.push(s(w)+"skewX(",null,r)-2,x:us(d,p)}):p&&w.push(s(w)+"skewX("+p+r)}function l(d,p,w,I,C,V){if(d!==w||p!==I){var Wt=C.push(s(C)+"scale(",null,",",null,")");V.push({i:Wt-4,x:us(d,w)},{i:Wt-2,x:us(p,I)})}else(w!==1||I!==1)&&C.push(s(C)+"scale("+w+","+I+")")}return function(d,p){var w=[],I=[];return d=n(d),p=n(p),o(d.translateX,d.translateY,p.translateX,p.translateY,w,I),f(d.rotate,p.rotate,w,I),c(d.skewX,p.skewX,w,I),l(d.scaleX,d.scaleY,p.scaleX,p.scaleY,w,I),d=p=null,function(C){for(var V=-1,Wt=I.length,Qt;++V<Wt;)w[(Qt=I[V]).i]=Qt.x(C);return w.join("")}}}var A8=Ub(x8,"px, ","px)","deg)"),E8=Ub(S8,", ",")",")"),T8=1e-12;function mv(n){return((n=Math.exp(n))+1/n)/2}function I8(n){return((n=Math.exp(n))-1/n)/2}function O8(n){return((n=Math.exp(2*n))-1)/(n+1)}const B8=function n(t,e,r){function s(o,f){var c=o[0],l=o[1],d=o[2],p=f[0],w=f[1],I=f[2],C=p-c,V=w-l,Wt=C*C+V*V,Qt,Rt;if(Wt<T8)Rt=Math.log(I/d)/t,Qt=function(ve){return[c+ve*C,l+ve*V,d*Math.exp(t*ve*Rt)]};else{var oe=Math.sqrt(Wt),Zt=(I*I-d*d+r*Wt)/(2*d*e*oe),st=(I*I-d*d-r*Wt)/(2*I*e*oe),zt=Math.log(Math.sqrt(Zt*Zt+1)-Zt),ue=Math.log(Math.sqrt(st*st+1)-st);Rt=(ue-zt)/t,Qt=function(ve){var an=ve*Rt,at=mv(zt),Y=d/(e*oe)*(at*O8(t*an+zt)-I8(zt));return[c+Y*C,l+Y*V,d*at/mv(t*an+zt)]}}return Qt.duration=Rt*1e3*t/Math.SQRT2,Qt}return s.rho=function(o){var f=Math.max(.001,+o),c=f*f,l=c*c;return n(f,c,l)},s}(Math.SQRT2,2,4);function Gb(n){return function t(e){e=+e;function r(s,o){var f=n((s=ra(s)).h,(o=ra(o)).h),c=Lc(s.s,o.s),l=Lc(s.l,o.l),d=Lc(s.opacity,o.opacity);return function(p){return s.h=f(p),s.s=c(p),s.l=l(Math.pow(p,e)),s.opacity=d(p),s+""}}return r.gamma=t,r}(1)}Gb(l8);var _g=Gb(Lc),M8=Op("start","end","cancel","interrupt"),L8=[],$b=0,gv=1,z0=2,A_=3,yv=4,U0=5,E_=6;function Np(n,t,e,r,s,o){var f=n.__transition;if(!f)n.__transition={};else if(e in f)return;R8(n,e,{name:t,index:r,group:s,on:M8,tween:L8,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:$b})}function pg(n,t){var e=vs(n,t);if(e.state>$b)throw new Error("too late; already scheduled");return e}function fa(n,t){var e=vs(n,t);if(e.state>A_)throw new Error("too late; already running");return e}function vs(n,t){var e=n.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function R8(n,t,e){var r=n.__transition,s;r[t]=e,e.timer=id(o,0,e.time);function o(d){e.state=gv,e.timer.restart(f,e.delay,e.time),e.delay<=d&&f(d-e.delay)}function f(d){var p,w,I,C;if(e.state!==gv)return l();for(p in r)if(C=r[p],C.name===e.name){if(C.state===A_)return nv(f);C.state===yv?(C.state=E_,C.timer.stop(),C.on.call("interrupt",n,n.__data__,C.index,C.group),delete r[p]):+p<t&&(C.state=E_,C.timer.stop(),C.on.call("cancel",n,n.__data__,C.index,C.group),delete r[p])}if(nv(function(){e.state===A_&&(e.state=yv,e.timer.restart(c,e.delay,e.time),c(d))}),e.state=z0,e.on.call("start",n,n.__data__,e.index,e.group),e.state===z0){for(e.state=A_,s=new Array(I=e.tween.length),p=0,w=-1;p<I;++p)(C=e.tween[p].value.call(n,n.__data__,e.index,e.group))&&(s[++w]=C);s.length=w+1}}function c(d){for(var p=d<e.duration?e.ease.call(null,d/e.duration):(e.timer.restart(l),e.state=U0,1),w=-1,I=s.length;++w<I;)s[w].call(n,p);e.state===U0&&(e.on.call("end",n,n.__data__,e.index,e.group),l())}function l(){e.state=E_,e.timer.stop(),delete r[t];for(var d in r)return;delete n.__transition}}function T_(n,t){var e=n.__transition,r,s,o=!0,f;if(e){t=t==null?null:t+"";for(f in e){if((r=e[f]).name!==t){o=!1;continue}s=r.state>z0&&r.state<U0,r.state=E_,r.timer.stop(),r.on.call(s?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete e[f]}o&&delete n.__transition}}function N8(n){return this.each(function(){T_(this,n)})}function D8(n,t){var e,r;return function(){var s=fa(this,n),o=s.tween;if(o!==e){r=e=o;for(var f=0,c=r.length;f<c;++f)if(r[f].name===t){r=r.slice(),r.splice(f,1);break}}s.tween=r}}function F8(n,t,e){var r,s;if(typeof e!="function")throw new Error;return function(){var o=fa(this,n),f=o.tween;if(f!==r){s=(r=f).slice();for(var c={name:t,value:e},l=0,d=s.length;l<d;++l)if(s[l].name===t){s[l]=c;break}l===d&&s.push(c)}o.tween=s}}function C8(n,t){var e=this._id;if(n+="",arguments.length<2){for(var r=vs(this.node(),e).tween,s=0,o=r.length,f;s<o;++s)if((f=r[s]).name===n)return f.value;return null}return this.each((t==null?D8:F8)(e,n,t))}function mg(n,t,e){var r=n._id;return n.each(function(){var s=fa(this,r);(s.value||(s.value={}))[t]=e.apply(this,arguments)}),function(s){return vs(s,r).value[t]}}function Vb(n,t){var e;return(typeof t=="number"?us:t instanceof _u?Z_:(e=_u(t))?(t=e,Z_):kb)(n,t)}function k8(n){return function(){this.removeAttribute(n)}}function P8(n){return function(){this.removeAttributeNS(n.space,n.local)}}function z8(n,t,e){var r,s=e+"",o;return function(){var f=this.getAttribute(n);return f===s?null:f===r?o:o=t(r=f,e)}}function U8(n,t,e){var r,s=e+"",o;return function(){var f=this.getAttributeNS(n.space,n.local);return f===s?null:f===r?o:o=t(r=f,e)}}function G8(n,t,e){var r,s,o;return function(){var f,c=e(this),l;return c==null?void this.removeAttribute(n):(f=this.getAttribute(n),l=c+"",f===l?null:f===r&&l===s?o:(s=l,o=t(r=f,c)))}}function $8(n,t,e){var r,s,o;return function(){var f,c=e(this),l;return c==null?void this.removeAttributeNS(n.space,n.local):(f=this.getAttributeNS(n.space,n.local),l=c+"",f===l?null:f===r&&l===s?o:(s=l,o=t(r=f,c)))}}function V8(n,t){var e=Tp(n),r=e==="transform"?E8:Vb;return this.attrTween(n,typeof t=="function"?(e.local?$8:G8)(e,r,mg(this,"attr."+n,t)):t==null?(e.local?P8:k8)(e):(e.local?U8:z8)(e,r,t))}function j8(n,t){return function(e){this.setAttribute(n,t.call(this,e))}}function W8(n,t){return function(e){this.setAttributeNS(n.space,n.local,t.call(this,e))}}function Y8(n,t){var e,r;function s(){var o=t.apply(this,arguments);return o!==r&&(e=(r=o)&&W8(n,o)),e}return s._value=t,s}function H8(n,t){var e,r;function s(){var o=t.apply(this,arguments);return o!==r&&(e=(r=o)&&j8(n,o)),e}return s._value=t,s}function X8(n,t){var e="attr."+n;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var r=Tp(n);return this.tween(e,(r.local?Y8:H8)(r,t))}function q8(n,t){return function(){pg(this,n).delay=+t.apply(this,arguments)}}function Z8(n,t){return t=+t,function(){pg(this,n).delay=t}}function K8(n){var t=this._id;return arguments.length?this.each((typeof n=="function"?q8:Z8)(t,n)):vs(this.node(),t).delay}function J8(n,t){return function(){fa(this,n).duration=+t.apply(this,arguments)}}function Q8(n,t){return t=+t,function(){fa(this,n).duration=t}}function tE(n){var t=this._id;return arguments.length?this.each((typeof n=="function"?J8:Q8)(t,n)):vs(this.node(),t).duration}function eE(n,t){if(typeof t!="function")throw new Error;return function(){fa(this,n).ease=t}}function nE(n){var t=this._id;return arguments.length?this.each(eE(t,n)):vs(this.node(),t).ease}function rE(n,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;fa(this,n).ease=e}}function iE(n){if(typeof n!="function")throw new Error;return this.each(rE(this._id,n))}function sE(n){typeof n!="function"&&(n=sb(n));for(var t=this._groups,e=t.length,r=new Array(e),s=0;s<e;++s)for(var o=t[s],f=o.length,c=r[s]=[],l,d=0;d<f;++d)(l=o[d])&&n.call(l,l.__data__,d,o)&&c.push(l);return new io(r,this._parents,this._name,this._id)}function aE(n){if(n._id!==this._id)throw new Error;for(var t=this._groups,e=n._groups,r=t.length,s=e.length,o=Math.min(r,s),f=new Array(r),c=0;c<o;++c)for(var l=t[c],d=e[c],p=l.length,w=f[c]=new Array(p),I,C=0;C<p;++C)(I=l[C]||d[C])&&(w[C]=I);for(;c<r;++c)f[c]=t[c];return new io(f,this._parents,this._name,this._id)}function oE(n){return(n+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function fE(n,t,e){var r,s,o=oE(t)?pg:fa;return function(){var f=o(this,n),c=f.on;c!==r&&(s=(r=c).copy()).on(t,e),f.on=s}}function uE(n,t){var e=this._id;return arguments.length<2?vs(this.node(),e).on.on(n):this.each(fE(e,n,t))}function cE(n){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==n)return;t&&t.removeChild(this)}}function lE(){return this.on("end.remove",cE(this._id))}function hE(n){var t=this._name,e=this._id;typeof n!="function"&&(n=sg(n));for(var r=this._groups,s=r.length,o=new Array(s),f=0;f<s;++f)for(var c=r[f],l=c.length,d=o[f]=new Array(l),p,w,I=0;I<l;++I)(p=c[I])&&(w=n.call(p,p.__data__,I,c))&&("__data__"in p&&(w.__data__=p.__data__),d[I]=w,Np(d[I],t,e,I,d,vs(p,e)));return new io(o,this._parents,t,e)}function dE(n){var t=this._name,e=this._id;typeof n!="function"&&(n=ib(n));for(var r=this._groups,s=r.length,o=[],f=[],c=0;c<s;++c)for(var l=r[c],d=l.length,p,w=0;w<d;++w)if(p=l[w]){for(var I=n.call(p,p.__data__,w,l),C,V=vs(p,e),Wt=0,Qt=I.length;Wt<Qt;++Wt)(C=I[Wt])&&Np(C,t,e,Wt,I,V);o.push(I),f.push(p)}return new io(o,f,t,e)}var _E=rd.prototype.constructor;function pE(){return new _E(this._groups,this._parents)}function mE(n,t){var e,r,s;return function(){var o=zc(this,n),f=(this.style.removeProperty(n),zc(this,n));return o===f?null:o===e&&f===r?s:s=t(e=o,r=f)}}function jb(n){return function(){this.style.removeProperty(n)}}function gE(n,t,e){var r,s=e+"",o;return function(){var f=zc(this,n);return f===s?null:f===r?o:o=t(r=f,e)}}function yE(n,t,e){var r,s,o;return function(){var f=zc(this,n),c=e(this),l=c+"";return c==null&&(l=c=(this.style.removeProperty(n),zc(this,n))),f===l?null:f===r&&l===s?o:(s=l,o=t(r=f,c))}}function vE(n,t){var e,r,s,o="style."+t,f="end."+o,c;return function(){var l=fa(this,n),d=l.on,p=l.value[o]==null?c||(c=jb(t)):void 0;(d!==e||s!==p)&&(r=(e=d).copy()).on(f,s=p),l.on=r}}function bE(n,t,e){var r=(n+="")=="transform"?A8:Vb;return t==null?this.styleTween(n,mE(n,r)).on("end.style."+n,jb(n)):typeof t=="function"?this.styleTween(n,yE(n,r,mg(this,"style."+n,t))).each(vE(this._id,n)):this.styleTween(n,gE(n,r,t),e).on("end.style."+n,null)}function wE(n,t,e){return function(r){this.style.setProperty(n,t.call(this,r),e)}}function xE(n,t,e){var r,s;function o(){var f=t.apply(this,arguments);return f!==s&&(r=(s=f)&&wE(n,f,e)),r}return o._value=t,o}function SE(n,t,e){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,xE(n,t,e??""))}function AE(n){return function(){this.textContent=n}}function EE(n){return function(){var t=n(this);this.textContent=t??""}}function TE(n){return this.tween("text",typeof n=="function"?EE(mg(this,"text",n)):AE(n==null?"":n+""))}function IE(n){return function(t){this.textContent=n.call(this,t)}}function OE(n){var t,e;function r(){var s=n.apply(this,arguments);return s!==e&&(t=(e=s)&&IE(s)),t}return r._value=n,r}function BE(n){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(n==null)return this.tween(t,null);if(typeof n!="function")throw new Error;return this.tween(t,OE(n))}function ME(){for(var n=this._name,t=this._id,e=Wb(),r=this._groups,s=r.length,o=0;o<s;++o)for(var f=r[o],c=f.length,l,d=0;d<c;++d)if(l=f[d]){var p=vs(l,t);Np(l,n,e,d,f,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new io(r,this._parents,n,e)}function LE(){var n,t,e=this,r=e._id,s=e.size();return new Promise(function(o,f){var c={value:f},l={value:function(){--s===0&&o()}};e.each(function(){var d=fa(this,r),p=d.on;p!==n&&(t=(n=p).copy(),t._.cancel.push(c),t._.interrupt.push(c),t._.end.push(l)),d.on=t}),s===0&&o()})}var RE=0;function io(n,t,e,r){this._groups=n,this._parents=t,this._name=e,this._id=r}function Wb(){return++RE}var Ha=rd.prototype;io.prototype={constructor:io,select:hE,selectAll:dE,selectChild:Ha.selectChild,selectChildren:Ha.selectChildren,filter:sE,merge:aE,selection:pE,transition:ME,call:Ha.call,nodes:Ha.nodes,node:Ha.node,size:Ha.size,empty:Ha.empty,each:Ha.each,on:uE,attr:V8,attrTween:X8,style:bE,styleTween:SE,text:TE,textTween:BE,remove:lE,tween:C8,delay:K8,duration:tE,ease:nE,easeVarying:iE,end:LE,[Symbol.iterator]:Ha[Symbol.iterator]};function NE(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var DE={time:null,delay:0,duration:250,ease:NE};function FE(n,t){for(var e;!(e=n.__transition)||!(e=e[t]);)if(!(n=n.parentNode))throw new Error(`transition ${t} not found`);return e}function CE(n){var t,e;n instanceof io?(t=n._id,n=n._name):(t=Wb(),(e=DE).time=cg(),n=n==null?null:n+"");for(var r=this._groups,s=r.length,o=0;o<s;++o)for(var f=r[o],c=f.length,l,d=0;d<c;++d)(l=f[d])&&Np(l,n,t,d,f,e||FE(l,t));return new io(r,this._parents,n,t)}rd.prototype.interrupt=N8;rd.prototype.transition=CE;const d_=n=>()=>n;function kE(n,{sourceEvent:t,target:e,transform:r,dispatch:s}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:s}})}function to(n,t,e){this.k=n,this.x=t,this.y=e}to.prototype={constructor:to,scale:function(n){return n===1?this:new to(this.k*n,this.x,this.y)},translate:function(n,t){return n===0&t===0?this:new to(this.k,this.x+this.k*n,this.y+this.k*t)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ph=new to(1,0,0);to.prototype;function a0(n){n.stopImmediatePropagation()}function Ih(n){n.preventDefault(),n.stopImmediatePropagation()}function PE(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function zE(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function vv(){return this.__zoom||Ph}function UE(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function GE(){return navigator.maxTouchPoints||"ontouchstart"in this}function $E(n,t,e){var r=n.invertX(t[0][0])-e[0][0],s=n.invertX(t[1][0])-e[1][0],o=n.invertY(t[0][1])-e[0][1],f=n.invertY(t[1][1])-e[1][1];return n.translate(s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s),f>o?(o+f)/2:Math.min(0,o)||Math.max(0,f))}function VE(){var n=PE,t=zE,e=$E,r=UE,s=GE,o=[0,1/0],f=[[-1/0,-1/0],[1/0,1/0]],c=250,l=B8,d=Op("start","zoom","end"),p,w,I,C=500,V=150,Wt=0,Qt=10;function Rt(F){F.property("__zoom",vv).on("wheel.zoom",an,{passive:!1}).on("mousedown.zoom",at).on("dblclick.zoom",Y).filter(s).on("touchstart.zoom",rt).on("touchmove.zoom",Bt).on("touchend.zoom touchcancel.zoom",Dt).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}Rt.transform=function(F,ft,H,yt){var Lt=F.selection?F.selection():F;Lt.property("__zoom",vv),F!==Lt?zt(F,ft,H,yt):Lt.interrupt().each(function(){ue(this,arguments).event(yt).start().zoom(null,typeof ft=="function"?ft.apply(this,arguments):ft).end()})},Rt.scaleBy=function(F,ft,H,yt){Rt.scaleTo(F,function(){var Lt=this.__zoom.k,Kt=typeof ft=="function"?ft.apply(this,arguments):ft;return Lt*Kt},H,yt)},Rt.scaleTo=function(F,ft,H,yt){Rt.transform(F,function(){var Lt=t.apply(this,arguments),Kt=this.__zoom,ee=H==null?st(Lt):typeof H=="function"?H.apply(this,arguments):H,de=Kt.invert(ee),Oe=typeof ft=="function"?ft.apply(this,arguments):ft;return e(Zt(oe(Kt,Oe),ee,de),Lt,f)},H,yt)},Rt.translateBy=function(F,ft,H,yt){Rt.transform(F,function(){return e(this.__zoom.translate(typeof ft=="function"?ft.apply(this,arguments):ft,typeof H=="function"?H.apply(this,arguments):H),t.apply(this,arguments),f)},null,yt)},Rt.translateTo=function(F,ft,H,yt,Lt){Rt.transform(F,function(){var Kt=t.apply(this,arguments),ee=this.__zoom,de=yt==null?st(Kt):typeof yt=="function"?yt.apply(this,arguments):yt;return e(Ph.translate(de[0],de[1]).scale(ee.k).translate(typeof ft=="function"?-ft.apply(this,arguments):-ft,typeof H=="function"?-H.apply(this,arguments):-H),Kt,f)},yt,Lt)};function oe(F,ft){return ft=Math.max(o[0],Math.min(o[1],ft)),ft===F.k?F:new to(ft,F.x,F.y)}function Zt(F,ft,H){var yt=ft[0]-H[0]*F.k,Lt=ft[1]-H[1]*F.k;return yt===F.x&&Lt===F.y?F:new to(F.k,yt,Lt)}function st(F){return[(+F[0][0]+ +F[1][0])/2,(+F[0][1]+ +F[1][1])/2]}function zt(F,ft,H,yt){F.on("start.zoom",function(){ue(this,arguments).event(yt).start()}).on("interrupt.zoom end.zoom",function(){ue(this,arguments).event(yt).end()}).tween("zoom",function(){var Lt=this,Kt=arguments,ee=ue(Lt,Kt).event(yt),de=t.apply(Lt,Kt),Oe=H==null?st(de):typeof H=="function"?H.apply(Lt,Kt):H,ye=Math.max(de[1][0]-de[0][0],de[1][1]-de[0][1]),Ze=Lt.__zoom,on=typeof ft=="function"?ft.apply(Lt,Kt):ft,En=l(Ze.invert(Oe).concat(ye/Ze.k),on.invert(Oe).concat(ye/on.k));return function(Dn){if(Dn===1)Dn=on;else{var hn=En(Dn),Fn=ye/hn[2];Dn=new to(Fn,Oe[0]-hn[0]*Fn,Oe[1]-hn[1]*Fn)}ee.zoom(null,Dn)}})}function ue(F,ft,H){return!H&&F.__zooming||new ve(F,ft)}function ve(F,ft){this.that=F,this.args=ft,this.active=0,this.sourceEvent=null,this.extent=t.apply(F,ft),this.taps=0}ve.prototype={event:function(F){return F&&(this.sourceEvent=F),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(F,ft){return this.mouse&&F!=="mouse"&&(this.mouse[1]=ft.invert(this.mouse[0])),this.touch0&&F!=="touch"&&(this.touch0[1]=ft.invert(this.touch0[0])),this.touch1&&F!=="touch"&&(this.touch1[1]=ft.invert(this.touch1[0])),this.that.__zoom=ft,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(F){var ft=Wn(this.that).datum();d.call(F,this.that,new kE(F,{sourceEvent:this.sourceEvent,target:Rt,type:F,transform:this.that.__zoom,dispatch:d}),ft)}};function an(F,...ft){if(!n.apply(this,arguments))return;var H=ue(this,ft).event(F),yt=this.__zoom,Lt=Math.max(o[0],Math.min(o[1],yt.k*Math.pow(2,r.apply(this,arguments)))),Kt=qa(F);if(H.wheel)(H.mouse[0][0]!==Kt[0]||H.mouse[0][1]!==Kt[1])&&(H.mouse[1]=yt.invert(H.mouse[0]=Kt)),clearTimeout(H.wheel);else{if(yt.k===Lt)return;H.mouse=[Kt,yt.invert(Kt)],T_(this),H.start()}Ih(F),H.wheel=setTimeout(ee,V),H.zoom("mouse",e(Zt(oe(yt,Lt),H.mouse[0],H.mouse[1]),H.extent,f));function ee(){H.wheel=null,H.end()}}function at(F,...ft){if(I||!n.apply(this,arguments))return;var H=F.currentTarget,yt=ue(this,ft,!0).event(F),Lt=Wn(F.view).on("mousemove.zoom",Oe,!0).on("mouseup.zoom",ye,!0),Kt=qa(F,H),ee=F.clientX,de=F.clientY;Lb(F.view),a0(F),yt.mouse=[Kt,this.__zoom.invert(Kt)],T_(this),yt.start();function Oe(Ze){if(Ih(Ze),!yt.moved){var on=Ze.clientX-ee,En=Ze.clientY-de;yt.moved=on*on+En*En>Wt}yt.event(Ze).zoom("mouse",e(Zt(yt.that.__zoom,yt.mouse[0]=qa(Ze,H),yt.mouse[1]),yt.extent,f))}function ye(Ze){Lt.on("mousemove.zoom mouseup.zoom",null),Rb(Ze.view,yt.moved),Ih(Ze),yt.event(Ze).end()}}function Y(F,...ft){if(n.apply(this,arguments)){var H=this.__zoom,yt=qa(F.changedTouches?F.changedTouches[0]:F,this),Lt=H.invert(yt),Kt=H.k*(F.shiftKey?.5:2),ee=e(Zt(oe(H,Kt),yt,Lt),t.apply(this,ft),f);Ih(F),c>0?Wn(this).transition().duration(c).call(zt,ee,yt,F):Wn(this).call(Rt.transform,ee,yt,F)}}function rt(F,...ft){if(n.apply(this,arguments)){var H=F.touches,yt=H.length,Lt=ue(this,ft,F.changedTouches.length===yt).event(F),Kt,ee,de,Oe;for(a0(F),ee=0;ee<yt;++ee)de=H[ee],Oe=qa(de,this),Oe=[Oe,this.__zoom.invert(Oe),de.identifier],Lt.touch0?!Lt.touch1&&Lt.touch0[2]!==Oe[2]&&(Lt.touch1=Oe,Lt.taps=0):(Lt.touch0=Oe,Kt=!0,Lt.taps=1+!!p);p&&(p=clearTimeout(p)),Kt&&(Lt.taps<2&&(w=Oe[0],p=setTimeout(function(){p=null},C)),T_(this),Lt.start())}}function Bt(F,...ft){if(this.__zooming){var H=ue(this,ft).event(F),yt=F.changedTouches,Lt=yt.length,Kt,ee,de,Oe;for(Ih(F),Kt=0;Kt<Lt;++Kt)ee=yt[Kt],de=qa(ee,this),H.touch0&&H.touch0[2]===ee.identifier?H.touch0[0]=de:H.touch1&&H.touch1[2]===ee.identifier&&(H.touch1[0]=de);if(ee=H.that.__zoom,H.touch1){var ye=H.touch0[0],Ze=H.touch0[1],on=H.touch1[0],En=H.touch1[1],Dn=(Dn=on[0]-ye[0])*Dn+(Dn=on[1]-ye[1])*Dn,hn=(hn=En[0]-Ze[0])*hn+(hn=En[1]-Ze[1])*hn;ee=oe(ee,Math.sqrt(Dn/hn)),de=[(ye[0]+on[0])/2,(ye[1]+on[1])/2],Oe=[(Ze[0]+En[0])/2,(Ze[1]+En[1])/2]}else if(H.touch0)de=H.touch0[0],Oe=H.touch0[1];else return;H.zoom("touch",e(Zt(ee,de,Oe),H.extent,f))}}function Dt(F,...ft){if(this.__zooming){var H=ue(this,ft).event(F),yt=F.changedTouches,Lt=yt.length,Kt,ee;for(a0(F),I&&clearTimeout(I),I=setTimeout(function(){I=null},C),Kt=0;Kt<Lt;++Kt)ee=yt[Kt],H.touch0&&H.touch0[2]===ee.identifier?delete H.touch0:H.touch1&&H.touch1[2]===ee.identifier&&delete H.touch1;if(H.touch1&&!H.touch0&&(H.touch0=H.touch1,delete H.touch1),H.touch0)H.touch0[1]=this.__zoom.invert(H.touch0[0]);else if(H.end(),H.taps===2&&(ee=qa(ee,this),Math.hypot(w[0]-ee[0],w[1]-ee[1])<Qt)){var de=Wn(this).on("dblclick.zoom");de&&de.apply(this,arguments)}}}return Rt.wheelDelta=function(F){return arguments.length?(r=typeof F=="function"?F:d_(+F),Rt):r},Rt.filter=function(F){return arguments.length?(n=typeof F=="function"?F:d_(!!F),Rt):n},Rt.touchable=function(F){return arguments.length?(s=typeof F=="function"?F:d_(!!F),Rt):s},Rt.extent=function(F){return arguments.length?(t=typeof F=="function"?F:d_([[+F[0][0],+F[0][1]],[+F[1][0],+F[1][1]]]),Rt):t},Rt.scaleExtent=function(F){return arguments.length?(o[0]=+F[0],o[1]=+F[1],Rt):[o[0],o[1]]},Rt.translateExtent=function(F){return arguments.length?(f[0][0]=+F[0][0],f[1][0]=+F[1][0],f[0][1]=+F[0][1],f[1][1]=+F[1][1],Rt):[[f[0][0],f[0][1]],[f[1][0],f[1][1]]]},Rt.constrain=function(F){return arguments.length?(e=F,Rt):e},Rt.duration=function(F){return arguments.length?(c=+F,Rt):c},Rt.interpolate=function(F){return arguments.length?(l=F,Rt):l},Rt.on=function(){var F=d.on.apply(d,arguments);return F===d?Rt:F},Rt.clickDistance=function(F){return arguments.length?(Wt=(F=+F)*F,Rt):Math.sqrt(Wt)},Rt.tapDistance=function(F){return arguments.length?(Qt=+F,Rt):Qt},Rt}function Dp(n,t){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(t).domain(n);break}return this}function gg(n,t){switch(arguments.length){case 0:break;case 1:{typeof n=="function"?this.interpolator(n):this.range(n);break}default:{this.domain(n),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const bv=Symbol("implicit");function G0(){var n=new Uy,t=[],e=[],r=bv;function s(o){let f=n.get(o);if(f===void 0){if(r!==bv)return r;n.set(o,f=t.push(o)-1)}return e[f%e.length]}return s.domain=function(o){if(!arguments.length)return t.slice();t=[],n=new Uy;for(const f of o)n.has(f)||n.set(f,t.push(f)-1);return s},s.range=function(o){return arguments.length?(e=Array.from(o),s):e.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.copy=function(){return G0(t,e).unknown(r)},Dp.apply(s,arguments),s}function jE(n){return function(){return n}}function $0(n){return+n}var wv=[0,1];function $i(n){return n}function V0(n,t){return(t-=n=+n)?function(e){return(e-n)/t}:jE(isNaN(t)?NaN:.5)}function WE(n,t){var e;return n>t&&(e=n,n=t,t=e),function(r){return Math.max(n,Math.min(t,r))}}function YE(n,t,e){var r=n[0],s=n[1],o=t[0],f=t[1];return s<r?(r=V0(s,r),o=e(f,o)):(r=V0(r,s),o=e(o,f)),function(c){return o(r(c))}}function HE(n,t,e){var r=Math.min(n.length,t.length)-1,s=new Array(r),o=new Array(r),f=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++f<r;)s[f]=V0(n[f],n[f+1]),o[f]=e(t[f],t[f+1]);return function(c){var l=X4(n,c,1,r)-1;return o[l](s[l](c))}}function yg(n,t){return t.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function vg(){var n=wv,t=wv,e=Rp,r,s,o,f=$i,c,l,d;function p(){var I=Math.min(n.length,t.length);return f!==$i&&(f=WE(n[0],n[I-1])),c=I>2?HE:YE,l=d=null,w}function w(I){return I==null||isNaN(I=+I)?o:(l||(l=c(n.map(r),t,e)))(r(f(I)))}return w.invert=function(I){return f(s((d||(d=c(t,n.map(r),us)))(I)))},w.domain=function(I){return arguments.length?(n=Array.from(I,$0),p()):n.slice()},w.range=function(I){return arguments.length?(t=Array.from(I),p()):t.slice()},w.rangeRound=function(I){return t=Array.from(I),e=Pb,p()},w.clamp=function(I){return arguments.length?(f=I?!0:$i,p()):f!==$i},w.interpolate=function(I){return arguments.length?(e=I,p()):e},w.unknown=function(I){return arguments.length?(o=I,w):o},function(I,C){return r=I,s=C,p()}}function XE(){return vg()($i,$i)}function qE(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function K_(n,t){if((e=(n=t?n.toExponential(t-1):n.toExponential()).indexOf("e"))<0)return null;var e,r=n.slice(0,e);return[r.length>1?r[0]+r.slice(2):r,+n.slice(e+1)]}function jc(n){return n=K_(Math.abs(n)),n?n[1]:NaN}function ZE(n,t){return function(e,r){for(var s=e.length,o=[],f=0,c=n[0],l=0;s>0&&c>0&&(l+c+1>r&&(c=Math.max(1,r-l)),o.push(e.substring(s-=c,s+c)),!((l+=c+1)>r));)c=n[f=(f+1)%n.length];return o.reverse().join(t)}}function KE(n){return function(t){return t.replace(/[0-9]/g,function(e){return n[+e]})}}var JE=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Hh(n){if(!(t=JE.exec(n)))throw new Error("invalid format: "+n);var t;return new bg({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Hh.prototype=bg.prototype;function bg(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}bg.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function QE(n){t:for(var t=n.length,e=1,r=-1,s;e<t;++e)switch(n[e]){case".":r=s=e;break;case"0":r===0&&(r=e),s=e;break;default:if(!+n[e])break t;r>0&&(r=0);break}return r>0?n.slice(0,r)+n.slice(s+1):n}var Yb;function tT(n,t){var e=K_(n,t);if(!e)return n+"";var r=e[0],s=e[1],o=s-(Yb=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,f=r.length;return o===f?r:o>f?r+new Array(o-f+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+K_(n,Math.max(0,t+o-1))[0]}function xv(n,t){var e=K_(n,t);if(!e)return n+"";var r=e[0],s=e[1];return s<0?"0."+new Array(-s).join("0")+r:r.length>s+1?r.slice(0,s+1)+"."+r.slice(s+1):r+new Array(s-r.length+2).join("0")}const Sv={"%":(n,t)=>(n*100).toFixed(t),b:n=>Math.round(n).toString(2),c:n=>n+"",d:qE,e:(n,t)=>n.toExponential(t),f:(n,t)=>n.toFixed(t),g:(n,t)=>n.toPrecision(t),o:n=>Math.round(n).toString(8),p:(n,t)=>xv(n*100,t),r:xv,s:tT,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function Av(n){return n}var Ev=Array.prototype.map,Tv=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function eT(n){var t=n.grouping===void 0||n.thousands===void 0?Av:ZE(Ev.call(n.grouping,Number),n.thousands+""),e=n.currency===void 0?"":n.currency[0]+"",r=n.currency===void 0?"":n.currency[1]+"",s=n.decimal===void 0?".":n.decimal+"",o=n.numerals===void 0?Av:KE(Ev.call(n.numerals,String)),f=n.percent===void 0?"%":n.percent+"",c=n.minus===void 0?"":n.minus+"",l=n.nan===void 0?"NaN":n.nan+"";function d(w){w=Hh(w);var I=w.fill,C=w.align,V=w.sign,Wt=w.symbol,Qt=w.zero,Rt=w.width,oe=w.comma,Zt=w.precision,st=w.trim,zt=w.type;zt==="n"?(oe=!0,zt="g"):Sv[zt]||(Zt===void 0&&(Zt=12),st=!0,zt="g"),(Qt||I==="0"&&C==="=")&&(Qt=!0,I="0",C="=");var ue=Wt==="$"?e:Wt==="#"&&/[boxX]/.test(zt)?"0"+zt.toLowerCase():"",ve=Wt==="$"?r:/[%p]/.test(zt)?f:"",an=Sv[zt],at=/[defgprs%]/.test(zt);Zt=Zt===void 0?6:/[gprs]/.test(zt)?Math.max(1,Math.min(21,Zt)):Math.max(0,Math.min(20,Zt));function Y(rt){var Bt=ue,Dt=ve,F,ft,H;if(zt==="c")Dt=an(rt)+Dt,rt="";else{rt=+rt;var yt=rt<0||1/rt<0;if(rt=isNaN(rt)?l:an(Math.abs(rt),Zt),st&&(rt=QE(rt)),yt&&+rt==0&&V!=="+"&&(yt=!1),Bt=(yt?V==="("?V:c:V==="-"||V==="("?"":V)+Bt,Dt=(zt==="s"?Tv[8+Yb/3]:"")+Dt+(yt&&V==="("?")":""),at){for(F=-1,ft=rt.length;++F<ft;)if(H=rt.charCodeAt(F),48>H||H>57){Dt=(H===46?s+rt.slice(F+1):rt.slice(F))+Dt,rt=rt.slice(0,F);break}}}oe&&!Qt&&(rt=t(rt,1/0));var Lt=Bt.length+rt.length+Dt.length,Kt=Lt<Rt?new Array(Rt-Lt+1).join(I):"";switch(oe&&Qt&&(rt=t(Kt+rt,Kt.length?Rt-Dt.length:1/0),Kt=""),C){case"<":rt=Bt+rt+Dt+Kt;break;case"=":rt=Bt+Kt+rt+Dt;break;case"^":rt=Kt.slice(0,Lt=Kt.length>>1)+Bt+rt+Dt+Kt.slice(Lt);break;default:rt=Kt+Bt+rt+Dt;break}return o(rt)}return Y.toString=function(){return w+""},Y}function p(w,I){var C=d((w=Hh(w),w.type="f",w)),V=Math.max(-8,Math.min(8,Math.floor(jc(I)/3)))*3,Wt=Math.pow(10,-V),Qt=Tv[8+V/3];return function(Rt){return C(Wt*Rt)+Qt}}return{format:d,formatPrefix:p}}var __,wg,Hb;nT({thousands:",",grouping:[3],currency:["$",""]});function nT(n){return __=eT(n),wg=__.format,Hb=__.formatPrefix,__}function rT(n){return Math.max(0,-jc(Math.abs(n)))}function iT(n,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(jc(t)/3)))*3-jc(Math.abs(n)))}function sT(n,t){return n=Math.abs(n),t=Math.abs(t)-n,Math.max(0,jc(t)-jc(n))+1}function aT(n,t,e,r){var s=e5(n,t,e),o;switch(r=Hh(r??",f"),r.type){case"s":{var f=Math.max(Math.abs(n),Math.abs(t));return r.precision==null&&!isNaN(o=iT(s,f))&&(r.precision=o),Hb(r,f)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=sT(s,Math.max(Math.abs(n),Math.abs(t))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=rT(s))&&(r.precision=o-(r.type==="%")*2);break}}return wg(r)}function Fp(n){var t=n.domain;return n.ticks=function(e){var r=t();return b0(r[0],r[r.length-1],e??10)},n.tickFormat=function(e,r){var s=t();return aT(s[0],s[s.length-1],e??10,r)},n.nice=function(e){e==null&&(e=10);var r=t(),s=0,o=r.length-1,f=r[s],c=r[o],l,d,p=10;for(c<f&&(d=f,f=c,c=d,d=s,s=o,o=d);p-- >0;){if(d=w0(f,c,e),d===l)return r[s]=f,r[o]=c,t(r);if(d>0)f=Math.floor(f/d)*d,c=Math.ceil(c/d)*d;else if(d<0)f=Math.ceil(f*d)/d,c=Math.floor(c*d)/d;else break;l=d}return n},n}function J_(){var n=XE();return n.copy=function(){return yg(n,J_())},Dp.apply(n,arguments),Fp(n)}function Xb(n){var t;function e(r){return r==null||isNaN(r=+r)?t:r}return e.invert=e,e.domain=e.range=function(r){return arguments.length?(n=Array.from(r,$0),e):n.slice()},e.unknown=function(r){return arguments.length?(t=r,e):t},e.copy=function(){return Xb(n).unknown(t)},n=arguments.length?Array.from(n,$0):[0,1],Fp(e)}function oT(n,t){n=n.slice();var e=0,r=n.length-1,s=n[e],o=n[r],f;return o<s&&(f=e,e=r,r=f,f=s,s=o,o=f),n[e]=t.floor(s),n[r]=t.ceil(o),n}function Iv(n){return Math.log(n)}function Ov(n){return Math.exp(n)}function fT(n){return-Math.log(-n)}function uT(n){return-Math.exp(-n)}function cT(n){return isFinite(n)?+("1e"+n):n<0?0:n}function lT(n){return n===10?cT:n===Math.E?Math.exp:t=>Math.pow(n,t)}function hT(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),t=>Math.log(t)/n)}function Bv(n){return(t,e)=>-n(-t,e)}function qb(n){const t=n(Iv,Ov),e=t.domain;let r=10,s,o;function f(){return s=hT(r),o=lT(r),e()[0]<0?(s=Bv(s),o=Bv(o),n(fT,uT)):n(Iv,Ov),t}return t.base=function(c){return arguments.length?(r=+c,f()):r},t.domain=function(c){return arguments.length?(e(c),f()):e()},t.ticks=c=>{const l=e();let d=l[0],p=l[l.length-1];const w=p<d;w&&([d,p]=[p,d]);let I=s(d),C=s(p),V,Wt;const Qt=c==null?10:+c;let Rt=[];if(!(r%1)&&C-I<Qt){if(I=Math.floor(I),C=Math.ceil(C),d>0){for(;I<=C;++I)for(V=1;V<r;++V)if(Wt=I<0?V/o(-I):V*o(I),!(Wt<d)){if(Wt>p)break;Rt.push(Wt)}}else for(;I<=C;++I)for(V=r-1;V>=1;--V)if(Wt=I>0?V/o(-I):V*o(I),!(Wt<d)){if(Wt>p)break;Rt.push(Wt)}Rt.length*2<Qt&&(Rt=b0(d,p,Qt))}else Rt=b0(I,C,Math.min(C-I,Qt)).map(o);return w?Rt.reverse():Rt},t.tickFormat=(c,l)=>{if(c==null&&(c=10),l==null&&(l=r===10?"s":","),typeof l!="function"&&(!(r%1)&&(l=Hh(l)).precision==null&&(l.trim=!0),l=wg(l)),c===1/0)return l;const d=Math.max(1,r*c/t.ticks().length);return p=>{let w=p/o(Math.round(s(p)));return w*r<r-.5&&(w*=r),w<=d?l(p):""}},t.nice=()=>e(oT(e(),{floor:c=>o(Math.floor(s(c))),ceil:c=>o(Math.ceil(s(c)))})),t}function Zb(){const n=qb(vg()).domain([1,10]);return n.copy=()=>yg(n,Zb()).base(n.base()),Dp.apply(n,arguments),n}function Mv(n){return function(t){return t<0?-Math.pow(-t,n):Math.pow(t,n)}}function dT(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function _T(n){return n<0?-n*n:n*n}function Kb(n){var t=n($i,$i),e=1;function r(){return e===1?n($i,$i):e===.5?n(dT,_T):n(Mv(e),Mv(1/e))}return t.exponent=function(s){return arguments.length?(e=+s,r()):e},Fp(t)}function Jb(){var n=Kb(vg());return n.copy=function(){return yg(n,Jb()).exponent(n.exponent())},Dp.apply(n,arguments),n}function pT(){return Jb.apply(null,arguments).exponent(.5)}function xg(){var n=0,t=1,e,r,s,o,f=$i,c=!1,l;function d(w){return w==null||isNaN(w=+w)?l:f(s===0?.5:(w=(o(w)-e)*s,c?Math.max(0,Math.min(1,w)):w))}d.domain=function(w){return arguments.length?([n,t]=w,e=o(n=+n),r=o(t=+t),s=e===r?0:1/(r-e),d):[n,t]},d.clamp=function(w){return arguments.length?(c=!!w,d):c},d.interpolator=function(w){return arguments.length?(f=w,d):f};function p(w){return function(I){var C,V;return arguments.length?([C,V]=I,f=w(C,V),d):[f(0),f(1)]}}return d.range=p(Rp),d.rangeRound=p(Pb),d.unknown=function(w){return arguments.length?(l=w,d):l},function(w){return o=w,e=w(n),r=w(t),s=e===r?0:1/(r-e),d}}function Sg(n,t){return t.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function Qb(){var n=Fp(xg()($i));return n.copy=function(){return Sg(n,Qb())},gg.apply(n,arguments)}function t1(){var n=qb(xg()).domain([1,10]);return n.copy=function(){return Sg(n,t1()).base(n.base())},gg.apply(n,arguments)}function e1(){var n=Kb(xg());return n.copy=function(){return Sg(n,e1()).exponent(n.exponent())},gg.apply(n,arguments)}class mT{constructor(t,e,r){this.prefs=e,this.svg_element_selection=Wn(t),this.width=+this.svg_element_selection.attr("width"),this.height=+this.svg_element_selection.attr("height"),this.renderers=new Map,this.scatterplot=r,this.renderers=new Map}attach_tiles(t){return this.tileSet=t,this.tileSet._zoom=this,this}attach_renderer(t,e){return this.renderers.set(t,e),e.bind_zoom(this),e.zoom.initialize_zoom(),this}zoom_to(t,e,r,s=4e3){const o=this.scales(),{svg_element_selection:f,zoomer:c,width:l,height:d}=this,p=Ph.translate(l/2,d/2).scale(t).translate(-o.x(e),-o.y(r));f.transition().duration(s).call(c.transform,p)}html_annotation(t){const e=this.svg_element_selection.node().parentNode.parentNode;let r=.75;this.scatterplot.prefs.tooltip_opacity!==void 0&&(r=this.scatterplot.prefs.tooltip_opacity),Wn(e).selectAll("div.tooltip").data(t).join(o=>o.append("div").attr("class","tooltip").style("top",0).style("left",0).style("position","absolute").style("z-index",100).style("border-radius","8px").style("padding","10px").style("background","ivory").style("opacity",r),o=>o.html(f=>this.scatterplot.tooltip_html(f.data,this.scatterplot)),o=>o.call(f=>f.remove())).html(o=>this.scatterplot.tooltip_html(o.data,this)).style("transform",o=>`translate(${+o.x+o.dx}px, ${+o.y+o.dy}px)`)}zoom_to_bbox(t,e=4e3,r=1.111){const s=this.scales();let[o,f]=t.x.map(s.x);const[c,l]=t.y.map(s.y);if(this.scatterplot.prefs.zoom_align==="right"){const V=this.width/this.height,Wt=(f-o)/(l-c);if(Wt<V){const Qt=Wt/V;console.log(Qt,{x0:o}),o=o-(f-o)*Qt}}const{svg_element_selection:d,zoomer:p,width:w,height:I}=this,C=Ph.translate(w/2,I/2).scale(1/r/Math.max((f-o)/w,(l-c)/I)).translate(-(o+f)/2,-(c+l)/2);d.transition().duration(e).call(p.transform,C)}initialize_zoom(){const{width:t,height:e,svg_element_selection:r}=this;this.transform=Ph;const s=VE().scaleExtent([1/3,1e5]).extent([[0,0],[t,e]]).on("zoom",o=>{var f,c,l;try{document.getElementById("tooltipcircle").remove()}catch{}this.transform=o.transform,this.restart_timer(10*1e3),(c=(f=this.scatterplot).on_zoom)==null||c.call(f,o.transform),(l=o==null?void 0:o.sourceEvent)==null||l.stopPropagation()});r.call(s),this.add_mouseover(),this.zoomer=s}set_highlit_points(t){const{x_:e,y_:r}=this.scales(),s=this.scatterplot.dim("x"),o=this.scatterplot.dim("y");this.scatterplot.highlit_point_change(t);const f=t.map(l=>({x:e(s.apply(l)),y:r(o.apply(l)),data:l,dx:0,dy:30}));this.html_annotation(f),this.svg_element_selection.select("#mousepoints").selectAll("circle.label").data(t,l=>l.ix).join(l=>l.append("circle").attr("id","tooltipcircle").attr("class","label").attr("stroke","#110022").attr("r",12).attr("fill",d=>this.scatterplot.dim("color").apply(d)).attr("cx",d=>e(s.apply(d))).attr("cy",d=>r(o.apply(d))),l=>l.attr("fill",d=>this.scatterplot.dim("color").apply(d)),l=>l.call(d=>{d.remove()})).on("click",(l,d)=>{this.scatterplot.click_function(d,this.scatterplot)})}set_highlit_point(t){this.set_highlit_points([t])}add_mouseover(){let t=0;const e=this.renderers.get("regl");this.svg_element_selection.on("mousemove",r=>{if(Date.now()-t<75)return;t=Date.now();const s=e.color_pick(r.offsetX,r.offsetY);s===null?this.set_highlit_points([]):this.set_highlit_points([s])})}current_corners(){const{width:t,height:e}=this,r=this.scales();if(r===void 0)return;const{x_:s,y_:o}=r;return{x:[s.invert(0),s.invert(t)],y:[o.invert(0),o.invert(e)]}}current_center(){const{x:t,y:e}=this.current_corners();return[(t[0]+t[1])/2,(e[0]+e[1])/2]}restart_timer(t=1e4){let e=Date.now()+t;this._timer&&(this._timer.stop_at>e&&(e=this._timer.stop_at),this._timer.stop());const r=id(this.tick.bind(this));return this._timer=r,this._timer.stop_at=e,this._timer}data(t){return t===void 0?this.tileSet:(this.tileSet=t,this)}scales(t=!0){if(this._scales)return this._scales.x_=this.transform.rescaleX(this._scales.x),this._scales.y_=this.transform.rescaleY(this._scales.y),this._scales;const{width:e,height:r}=this;if(this.tileSet===void 0)throw new Error("Error--scales created before tileSet present.");const{extent:s}=this.tileSet,o={};if(s===void 0)throw new Error("Error--scales created before extent present.");const f={};for(const[I,C]of[["x",e],["y",r]]){const V=s[I],Wt=V[1]-V[0];f[I]={limits:V,size_range:Wt,pixels_per_unit:C/Wt}}const c=f.x.pixels_per_unit/f.y.pixels_per_unit;let l=0,d=0,p=e,w=r;return c>1?(p=e/c,l=(e-p)/2):(w=r*c,d=(r-w)/2),o.x=J_().domain(f.x.limits).range([l,e-l]),o.y=J_().domain(f.y.limits).range([d,r-d]),o.x_=this.transform.rescaleX(o.x),o.y_=this.transform.rescaleY(o.y),this._scales=o,o}webgl_scale(t=!0){const{x:e,y:r}=this.scales();return gT(e,r).flat()}tick(t=!1){this._start=this._start||Date.now(),t!==!0&&this._timer&&this._timer.stop_at<=Date.now()&&this._timer.stop()}}function gT(n,t){function e(l){return l[1]-l[0]}const r=a_(n.domain()),s=a_(t.domain()),o=e(n.range())/e(n.domain()),f=e(t.range())/e(t.domain());return[[o,0,-o*r+a_(n.range())],[0,f,-f*s+a_(t.range())],[0,0,1]]}var j0={},yT={get exports(){return j0},set exports(n){j0=n}};(function(n,t){(function(e,r){n.exports=r()})(ls,function(){var e=function(_){return _ instanceof Uint8Array||_ instanceof Uint16Array||_ instanceof Uint32Array||_ instanceof Int8Array||_ instanceof Int16Array||_ instanceof Int32Array||_ instanceof Float32Array||_ instanceof Float64Array||_ instanceof Uint8ClampedArray},r=function(_,v){for(var M=Object.keys(v),tt=0;tt<M.length;++tt)_[M[tt]]=v[M[tt]];return _},s=`
`;function o(_){return typeof atob<"u"?atob(_):"base64:"+_}function f(_){var v=new Error("(regl) "+_);throw console.error(v),v}function c(_,v){_||f(v)}function l(_){return _?": "+_:""}function d(_,v,M){_ in v||f("unknown parameter ("+_+")"+l(M)+". possible values: "+Object.keys(v).join())}function p(_,v){e(_)||f("invalid parameter type"+l(v)+". must be a typed array")}function w(_,v){switch(v){case"number":return typeof _=="number";case"object":return typeof _=="object";case"string":return typeof _=="string";case"boolean":return typeof _=="boolean";case"function":return typeof _=="function";case"undefined":return typeof _>"u";case"symbol":return typeof _=="symbol"}}function I(_,v,M){w(_,v)||f("invalid parameter type"+l(M)+". expected "+v+", got "+typeof _)}function C(_,v){_>=0&&(_|0)===_||f("invalid parameter type, ("+_+")"+l(v)+". must be a nonnegative integer")}function V(_,v,M){v.indexOf(_)<0&&f("invalid value"+l(M)+". must be one of: "+v)}var Wt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Qt(_){Object.keys(_).forEach(function(v){Wt.indexOf(v)<0&&f('invalid regl constructor argument "'+v+'". must be one of '+Wt)})}function Rt(_,v){for(_=_+"";_.length<v;)_=" "+_;return _}function oe(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Zt(_,v){this.number=_,this.line=v,this.errors=[]}function st(_,v,M){this.file=_,this.line=v,this.message=M}function zt(){var _=new Error,v=(_.stack||_).toString(),M=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(v);if(M)return M[1];var tt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(v);return tt?tt[1]:"unknown"}function ue(){var _=new Error,v=(_.stack||_).toString(),M=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(v);if(M)return M[1];var tt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(v);return tt?tt[1]:"unknown"}function ve(_,v){var M=_.split(`
`),tt=1,lt=0,K={unknown:new oe,0:new oe};K.unknown.name=K[0].name=v||zt(),K.unknown.lines.push(new Zt(0,""));for(var et=0;et<M.length;++et){var bt=M[et],vt=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(bt);if(vt)switch(vt[1]){case"line":var It=/(\d+)(\s+\d+)?/.exec(vt[2]);It&&(tt=It[1]|0,It[2]&&(lt=It[2]|0,lt in K||(K[lt]=new oe)));break;case"define":var Mt=/SHADER_NAME(_B64)?\s+(.*)$/.exec(vt[2]);Mt&&(K[lt].name=Mt[1]?o(Mt[2]):Mt[2]);break}K[lt].lines.push(new Zt(tt++,bt))}return Object.keys(K).forEach(function(Ot){var Ct=K[Ot];Ct.lines.forEach(function(wt){Ct.index[wt.number]=wt})}),K}function an(_){var v=[];return _.split(`
`).forEach(function(M){if(!(M.length<5)){var tt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(M);tt?v.push(new st(tt[1]|0,tt[2]|0,tt[3].trim())):M.length>0&&v.push(new st("unknown",0,M))}}),v}function at(_,v){v.forEach(function(M){var tt=_[M.file];if(tt){var lt=tt.index[M.line];if(lt){lt.errors.push(M),tt.hasErrors=!0;return}}_.unknown.hasErrors=!0,_.unknown.lines[0].errors.push(M)})}function Y(_,v,M,tt,lt){if(!_.getShaderParameter(v,_.COMPILE_STATUS)){var K=_.getShaderInfoLog(v),et=tt===_.FRAGMENT_SHADER?"fragment":"vertex";yt(M,"string",et+" shader source must be a string",lt);var bt=ve(M,lt),vt=an(K);at(bt,vt),Object.keys(bt).forEach(function(It){var Mt=bt[It];if(!Mt.hasErrors)return;var Ot=[""],Ct=[""];function wt(Et,z){Ot.push(Et),Ct.push(z||"")}wt("file number "+It+": "+Mt.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Mt.lines.forEach(function(Et){if(Et.errors.length>0){wt(Rt(Et.number,4)+"|  ","background-color:yellow; font-weight:bold"),wt(Et.line+s,"color:red; background-color:yellow; font-weight:bold");var z=0;Et.errors.forEach(function(J){var xt=J.message,Yt=/^\s*'(.*)'\s*:\s*(.*)$/.exec(xt);if(Yt){var pt=Yt[1];switch(xt=Yt[2],pt){case"assign":pt="=";break}z=Math.max(Et.line.indexOf(pt,z),0)}else z=0;wt(Rt("| ",6)),wt(Rt("^^^",z+3)+s,"font-weight:bold"),wt(Rt("| ",6)),wt(xt+s,"font-weight:bold")}),wt(Rt("| ",6)+s)}else wt(Rt(Et.number,4)+"|  "),wt(Et.line+s,"color:red")}),typeof document<"u"&&!window.chrome?(Ct[0]=Ot.join("%c"),console.log.apply(console,Ct)):console.log(Ot.join(""))}),c.raise("Error compiling "+et+" shader, "+bt[0].name)}}function rt(_,v,M,tt,lt){if(!_.getProgramParameter(v,_.LINK_STATUS)){var K=_.getProgramInfoLog(v),et=ve(M,lt),bt=ve(tt,lt),vt='Error linking program with vertex shader, "'+bt[0].name+'", and fragment shader "'+et[0].name+'"';typeof document<"u"?console.log("%c"+vt+s+"%c"+K,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(vt+s+K),c.raise(vt)}}function Bt(_){_._commandRef=zt()}function Dt(_,v,M,tt){Bt(_);function lt(vt){return vt?tt.id(vt):0}_._fragId=lt(_.static.frag),_._vertId=lt(_.static.vert);function K(vt,It){Object.keys(It).forEach(function(Mt){vt[tt.id(Mt)]=!0})}var et=_._uniformSet={};K(et,v.static),K(et,v.dynamic);var bt=_._attributeSet={};K(bt,M.static),K(bt,M.dynamic),_._hasCount="count"in _.static||"count"in _.dynamic||"elements"in _.static||"elements"in _.dynamic}function F(_,v){var M=ue();f(_+" in command "+(v||zt())+(M==="unknown"?"":" called from "+M))}function ft(_,v,M){_||F(v,M||zt())}function H(_,v,M,tt){_ in v||F("unknown parameter ("+_+")"+l(M)+". possible values: "+Object.keys(v).join(),tt||zt())}function yt(_,v,M,tt){w(_,v)||F("invalid parameter type"+l(M)+". expected "+v+", got "+typeof _,tt||zt())}function Lt(_){_()}function Kt(_,v,M){_.texture?V(_.texture._texture.internalformat,v,"unsupported texture format for attachment"):V(_.renderbuffer._renderbuffer.format,M,"unsupported renderbuffer format for attachment")}var ee=33071,de=9728,Oe=9984,ye=9985,Ze=9986,on=9987,En=5120,Dn=5121,hn=5122,Fn=5123,ir=5124,Kn=5125,Yr=5126,rf=32819,Rr=32820,ws=33635,gu=34042,oi=36193,yr={};yr[En]=yr[Dn]=1,yr[hn]=yr[Fn]=yr[oi]=yr[ws]=yr[rf]=yr[Rr]=2,yr[ir]=yr[Kn]=yr[Yr]=yr[gu]=4;function yu(_,v){return _===Rr||_===rf||_===ws?2:_===gu?4:yr[_]*v}function kr(_){return!(_&_-1)&&!!_}function Ir(_,v,M){var tt,lt=v.width,K=v.height,et=v.channels;c(lt>0&&lt<=M.maxTextureSize&&K>0&&K<=M.maxTextureSize,"invalid texture shape"),(_.wrapS!==ee||_.wrapT!==ee)&&c(kr(lt)&&kr(K),"incompatible wrap mode for texture, both width and height must be power of 2"),v.mipmask===1?lt!==1&&K!==1&&c(_.minFilter!==Oe&&_.minFilter!==Ze&&_.minFilter!==ye&&_.minFilter!==on,"min filter requires mipmap"):(c(kr(lt)&&kr(K),"texture must be a square power of 2 to support mipmapping"),c(v.mipmask===(lt<<1)-1,"missing or incomplete mipmap data")),v.type===Yr&&(M.extensions.indexOf("oes_texture_float_linear")<0&&c(_.minFilter===de&&_.magFilter===de,"filter not supported, must enable oes_texture_float_linear"),c(!_.genMipmaps,"mipmap generation not supported with float textures"));var bt=v.images;for(tt=0;tt<16;++tt)if(bt[tt]){var vt=lt>>tt,It=K>>tt;c(v.mipmask&1<<tt,"missing mipmap data");var Mt=bt[tt];if(c(Mt.width===vt&&Mt.height===It,"invalid shape for mip images"),c(Mt.format===v.format&&Mt.internalformat===v.internalformat&&Mt.type===v.type,"incompatible type for mip image"),!Mt.compressed)if(Mt.data){var Ot=Math.ceil(yu(Mt.type,et)*vt/Mt.unpackAlignment)*Mt.unpackAlignment;c(Mt.data.byteLength===Ot*It,"invalid data for image, buffer size is inconsistent with image format")}else Mt.element||Mt.copy}else _.genMipmaps||c((v.mipmask&1<<tt)===0,"extra mipmap data");v.compressed&&c(!_.genMipmaps,"mipmap generation for compressed images not supported")}function Ei(_,v,M,tt){var lt=_.width,K=_.height,et=_.channels;c(lt>0&&lt<=tt.maxTextureSize&&K>0&&K<=tt.maxTextureSize,"invalid texture shape"),c(lt===K,"cube map must be square"),c(v.wrapS===ee&&v.wrapT===ee,"wrap mode not supported by cube map");for(var bt=0;bt<M.length;++bt){var vt=M[bt];c(vt.width===lt&&vt.height===K,"inconsistent cube map face shape"),v.genMipmaps&&(c(!vt.compressed,"can not generate mipmap for compressed textures"),c(vt.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var It=vt.images,Mt=0;Mt<16;++Mt){var Ot=It[Mt];if(Ot){var Ct=lt>>Mt,wt=K>>Mt;c(vt.mipmask&1<<Mt,"missing mipmap data"),c(Ot.width===Ct&&Ot.height===wt,"invalid shape for mip images"),c(Ot.format===_.format&&Ot.internalformat===_.internalformat&&Ot.type===_.type,"incompatible type for mip image"),Ot.compressed||(Ot.data?c(Ot.data.byteLength===Ct*wt*Math.max(yu(Ot.type,et),Ot.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ot.element||Ot.copy)}}}}var b=r(c,{optional:Lt,raise:f,commandRaise:F,command:ft,parameter:d,commandParameter:H,constructor:Qt,type:I,commandType:yt,isTypedArray:p,nni:C,oneOf:V,shaderError:Y,linkError:rt,callSite:ue,saveCommandRef:Bt,saveDrawInfo:Dt,framebufferFormat:Kt,guessCommand:zt,texture2D:Ir,textureCube:Ei}),vu=0,xs=0,ol=5,ua=6;function lr(_,v){this.id=vu++,this.type=_,this.data=v}function ca(_){return _.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Ti(_){if(_.length===0)return[];var v=_.charAt(0),M=_.charAt(_.length-1);if(_.length>1&&v===M&&(v==='"'||v==="'"))return['"'+ca(_.substr(1,_.length-2))+'"'];var tt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(_);if(tt)return Ti(_.substr(0,tt.index)).concat(Ti(tt[1])).concat(Ti(_.substr(tt.index+tt[0].length)));var lt=_.split(".");if(lt.length===1)return['"'+ca(_)+'"'];for(var K=[],et=0;et<lt.length;++et)K=K.concat(Ti(lt[et]));return K}function la(_){return"["+Ti(_).join("][")+"]"}function lo(_,v){return new lr(_,la(v+""))}function ho(_){return typeof _=="function"&&!_._reglType||_ instanceof lr}function _o(_,v){if(typeof _=="function")return new lr(xs,_);if(typeof _=="number"||typeof _=="boolean")return new lr(ol,_);if(Array.isArray(_))return new lr(ua,_.map(function(M,tt){return _o(M,v+"["+tt+"]")}));if(_ instanceof lr)return _;b(!1,"invalid option type in uniform "+v)}var hr={DynamicVariable:lr,define:lo,isDynamic:ho,unbox:_o,accessor:la},Pr={next:typeof requestAnimationFrame=="function"?function(_){return requestAnimationFrame(_)}:function(_){return setTimeout(_,16)},cancel:typeof cancelAnimationFrame=="function"?function(_){return cancelAnimationFrame(_)}:clearTimeout},ji=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function fl(){var _={"":0},v=[""];return{id:function(M){var tt=_[M];return tt||(tt=_[M]=v.length,v.push(M),tt)},str:function(M){return v[M]}}}function bu(_,v,M){var tt=document.createElement("canvas");r(tt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),_.appendChild(tt),_===document.body&&(tt.style.position="absolute",r(_.style,{margin:0,padding:0}));function lt(){var bt=window.innerWidth,vt=window.innerHeight;if(_!==document.body){var It=tt.getBoundingClientRect();bt=It.right-It.left,vt=It.bottom-It.top}tt.width=M*bt,tt.height=M*vt}var K;_!==document.body&&typeof ResizeObserver=="function"?(K=new ResizeObserver(function(){setTimeout(lt)}),K.observe(_)):window.addEventListener("resize",lt,!1);function et(){K?K.disconnect():window.removeEventListener("resize",lt),_.removeChild(tt)}return lt(),{canvas:tt,onDestroy:et}}function ul(_,v){function M(tt){try{return _.getContext(tt,v)}catch{return null}}return M("webgl")||M("experimental-webgl")||M("webgl-experimental")}function sf(_){return typeof _.nodeName=="string"&&typeof _.appendChild=="function"&&typeof _.getBoundingClientRect=="function"}function Ss(_){return typeof _.drawArrays=="function"||typeof _.drawElements=="function"}function wu(_){return typeof _=="string"?_.split():(b(Array.isArray(_),"invalid extension array"),_)}function Ii(_){return typeof _=="string"?(b(typeof document<"u","not supported outside of DOM"),document.querySelector(_)):_}function cl(_){var v=_||{},M,tt,lt,K,et={},bt=[],vt=[],It=typeof window>"u"?1:window.devicePixelRatio,Mt=!1,Ot=function(Et){Et&&b.raise(Et)},Ct=function(){};if(typeof v=="string"?(b(typeof document<"u","selector queries only supported in DOM enviroments"),M=document.querySelector(v),b(M,"invalid query string for element")):typeof v=="object"?sf(v)?M=v:Ss(v)?(K=v,lt=K.canvas):(b.constructor(v),"gl"in v?K=v.gl:"canvas"in v?lt=Ii(v.canvas):"container"in v&&(tt=Ii(v.container)),"attributes"in v&&(et=v.attributes,b.type(et,"object","invalid context attributes")),"extensions"in v&&(bt=wu(v.extensions)),"optionalExtensions"in v&&(vt=wu(v.optionalExtensions)),"onDone"in v&&(b.type(v.onDone,"function","invalid or missing onDone callback"),Ot=v.onDone),"profile"in v&&(Mt=!!v.profile),"pixelRatio"in v&&(It=+v.pixelRatio,b(It>0,"invalid pixel ratio"))):b.raise("invalid arguments to regl"),M&&(M.nodeName.toLowerCase()==="canvas"?lt=M:tt=M),!K){if(!lt){b(typeof document<"u","must manually specify webgl context outside of DOM environments");var wt=bu(tt||document.body,Ot,It);if(!wt)return null;lt=wt.canvas,Ct=wt.onDestroy}et.premultipliedAlpha===void 0&&(et.premultipliedAlpha=!0),K=ul(lt,et)}return K?{gl:K,canvas:lt,container:tt,extensions:bt,optionalExtensions:vt,pixelRatio:It,profile:Mt,onDone:Ot,onDestroy:Ct}:(Ct(),Ot("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ll(_,v){var M={};function tt(et){b.type(et,"string","extension name must be string");var bt=et.toLowerCase(),vt;try{vt=M[bt]=_.getExtension(bt)}catch{}return!!vt}for(var lt=0;lt<v.extensions.length;++lt){var K=v.extensions[lt];if(!tt(K))return v.onDestroy(),v.onDone('"'+K+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return v.optionalExtensions.forEach(tt),{extensions:M,restore:function(){Object.keys(M).forEach(function(et){if(M[et]&&!tt(et))throw new Error("(regl): error restoring extension "+et)})}}}function vr(_,v){for(var M=Array(_),tt=0;tt<_;++tt)M[tt]=v(tt);return M}var hl=5120,dl=5121,fi=5122,af=5123,_l=5124,of=5125,pl=5126;function ml(_){for(var v=16;v<=1<<28;v*=16)if(_<=v)return v;return 0}function Wi(_){var v,M;return v=(_>65535)<<4,_>>>=v,M=(_>255)<<3,_>>>=M,v|=M,M=(_>15)<<2,_>>>=M,v|=M,M=(_>3)<<1,_>>>=M,v|=M,v|_>>1}function xu(){var _=vr(8,function(){return[]});function v(K){var et=ml(K),bt=_[Wi(et)>>2];return bt.length>0?bt.pop():new ArrayBuffer(et)}function M(K){_[Wi(K.byteLength)>>2].push(K)}function tt(K,et){var bt=null;switch(K){case hl:bt=new Int8Array(v(et),0,et);break;case dl:bt=new Uint8Array(v(et),0,et);break;case fi:bt=new Int16Array(v(2*et),0,et);break;case af:bt=new Uint16Array(v(2*et),0,et);break;case _l:bt=new Int32Array(v(4*et),0,et);break;case of:bt=new Uint32Array(v(4*et),0,et);break;case pl:bt=new Float32Array(v(4*et),0,et);break;default:return null}return bt.length!==et?bt.subarray(0,et):bt}function lt(K){M(K.buffer)}return{alloc:v,free:M,allocType:tt,freeType:lt}}var Cn=xu();Cn.zero=xu();var gl=3408,yl=3410,vl=3411,Yi=3412,bl=3413,wl=3414,xl=3415,Sl=33901,Al=33902,El=3379,As=3386,Tl=34921,Hi=36347,ff=36348,Il=35661,po=35660,uf=34930,Su=36349,Au=34076,Ol=34024,Eu=7936,Bl=7937,Ml=7938,Tu=35724,Iu=34047,Ou=36063,cf=34852,mo=3553,lf=34067,go=34069,Bu=33984,Oi=6408,Es=5126,hf=5121,ha=36160,Mu=36053,Lu=36064,df=16384,_f=function(_,v){var M=1;v.ext_texture_filter_anisotropic&&(M=_.getParameter(Iu));var tt=1,lt=1;v.webgl_draw_buffers&&(tt=_.getParameter(cf),lt=_.getParameter(Ou));var K=!!v.oes_texture_float;if(K){var et=_.createTexture();_.bindTexture(mo,et),_.texImage2D(mo,0,Oi,1,1,0,Oi,Es,null);var bt=_.createFramebuffer();if(_.bindFramebuffer(ha,bt),_.framebufferTexture2D(ha,Lu,mo,et,0),_.bindTexture(mo,null),_.checkFramebufferStatus(ha)!==Mu)K=!1;else{_.viewport(0,0,1,1),_.clearColor(1,0,0,1),_.clear(df);var vt=Cn.allocType(Es,4);_.readPixels(0,0,1,1,Oi,Es,vt),_.getError()?K=!1:(_.deleteFramebuffer(bt),_.deleteTexture(et),K=vt[0]===1),Cn.freeType(vt)}}var It=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Mt=!0;if(!It){var Ot=_.createTexture(),Ct=Cn.allocType(hf,36);_.activeTexture(Bu),_.bindTexture(lf,Ot),_.texImage2D(go,0,Oi,3,3,0,Oi,hf,Ct),Cn.freeType(Ct),_.bindTexture(lf,null),_.deleteTexture(Ot),Mt=!_.getError()}return{colorBits:[_.getParameter(yl),_.getParameter(vl),_.getParameter(Yi),_.getParameter(bl)],depthBits:_.getParameter(wl),stencilBits:_.getParameter(xl),subpixelBits:_.getParameter(gl),extensions:Object.keys(v).filter(function(wt){return!!v[wt]}),maxAnisotropic:M,maxDrawbuffers:tt,maxColorAttachments:lt,pointSizeDims:_.getParameter(Sl),lineWidthDims:_.getParameter(Al),maxViewportDims:_.getParameter(As),maxCombinedTextureUnits:_.getParameter(Il),maxCubeMapSize:_.getParameter(Au),maxRenderbufferSize:_.getParameter(Ol),maxTextureUnits:_.getParameter(uf),maxTextureSize:_.getParameter(El),maxAttributes:_.getParameter(Tl),maxVertexUniforms:_.getParameter(Hi),maxVertexTextureUnits:_.getParameter(po),maxVaryingVectors:_.getParameter(ff),maxFragmentUniforms:_.getParameter(Su),glsl:_.getParameter(Tu),renderer:_.getParameter(Bl),vendor:_.getParameter(Eu),version:_.getParameter(Ml),readFloat:K,npotTextureCube:Mt}};function Jn(_){return!!_&&typeof _=="object"&&Array.isArray(_.shape)&&Array.isArray(_.stride)&&typeof _.offset=="number"&&_.shape.length===_.stride.length&&(Array.isArray(_.data)||e(_.data))}var br=function(_){return Object.keys(_).map(function(v){return _[v]})},da={shape:vo,flatten:Ru};function Ll(_,v,M){for(var tt=0;tt<v;++tt)M[tt]=_[tt]}function yo(_,v,M,tt){for(var lt=0,K=0;K<v;++K)for(var et=_[K],bt=0;bt<M;++bt)tt[lt++]=et[bt]}function pf(_,v,M,tt,lt,K){for(var et=K,bt=0;bt<v;++bt)for(var vt=_[bt],It=0;It<M;++It)for(var Mt=vt[It],Ot=0;Ot<tt;++Ot)lt[et++]=Mt[Ot]}function mf(_,v,M,tt,lt){for(var K=1,et=M+1;et<v.length;++et)K*=v[et];var bt=v[M];if(v.length-M===4){var vt=v[M+1],It=v[M+2],Mt=v[M+3];for(et=0;et<bt;++et)pf(_[et],vt,It,Mt,tt,lt),lt+=K}else for(et=0;et<bt;++et)mf(_[et],v,M+1,tt,lt),lt+=K}function Ru(_,v,M,tt){var lt=1;if(v.length)for(var K=0;K<v.length;++K)lt*=v[K];else lt=0;var et=tt||Cn.allocType(M,lt);switch(v.length){case 0:break;case 1:Ll(_,v[0],et);break;case 2:yo(_,v[0],v[1],et);break;case 3:pf(_,v[0],v[1],v[2],et,0);break;default:mf(_,v,0,et,0)}return et}function vo(_){for(var v=[],M=_;M.length;M=M[0])v.push(M.length);return v}var _a={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},gf=5120,bo=5122,Rl=5124,Nu=5121,yf=5123,Du=5125,ui=5126,pa=5126,Xi={int8:gf,int16:bo,int32:Rl,uint8:Nu,uint16:yf,uint32:Du,float:ui,float32:pa},Fu=35048,Nl=35040,ma={dynamic:Fu,stream:Nl,static:35044},yn=da.flatten,vn=da.shape,vf=35044,Dl=35040,B=5121,G=5126,it=[];it[5120]=1,it[5122]=2,it[5124]=4,it[5121]=1,it[5123]=2,it[5125]=4,it[5126]=4;function ie(_){return _a[Object.prototype.toString.call(_)]|0}function Ke(_,v){for(var M=0;M<v.length;++M)_[M]=v[M]}function _n(_,v,M,tt,lt,K,et){for(var bt=0,vt=0;vt<M;++vt)for(var It=0;It<tt;++It)_[bt++]=v[lt*vt+K*It+et]}function De(_,v,M,tt){var lt=0,K={};function et(z){this.id=lt++,this.buffer=_.createBuffer(),this.type=z,this.usage=vf,this.byteLength=0,this.dimension=1,this.dtype=B,this.persistentData=null,M.profile&&(this.stats={size:0})}et.prototype.bind=function(){_.bindBuffer(this.type,this.buffer)},et.prototype.destroy=function(){Ct(this)};var bt=[];function vt(z,J){var xt=bt.pop();return xt||(xt=new et(z)),xt.bind(),Ot(xt,J,Dl,0,1,!1),xt}function It(z){bt.push(z)}function Mt(z,J,xt){z.byteLength=J.byteLength,_.bufferData(z.type,J,xt)}function Ot(z,J,xt,Yt,pt,Vt){var $t;if(z.usage=xt,Array.isArray(J)){if(z.dtype=Yt||G,J.length>0){var re;if(Array.isArray(J[0])){$t=vn(J);for(var dt=1,ht=1;ht<$t.length;++ht)dt*=$t[ht];z.dimension=dt,re=yn(J,$t,z.dtype),Mt(z,re,xt),Vt?z.persistentData=re:Cn.freeType(re)}else if(typeof J[0]=="number"){z.dimension=pt;var qt=Cn.allocType(z.dtype,J.length);Ke(qt,J),Mt(z,qt,xt),Vt?z.persistentData=qt:Cn.freeType(qt)}else e(J[0])?(z.dimension=J[0].length,z.dtype=Yt||ie(J[0])||G,re=yn(J,[J.length,J[0].length],z.dtype),Mt(z,re,xt),Vt?z.persistentData=re:Cn.freeType(re)):b.raise("invalid buffer data")}}else if(e(J))z.dtype=Yt||ie(J),z.dimension=pt,Mt(z,J,xt),Vt&&(z.persistentData=new Uint8Array(new Uint8Array(J.buffer)));else if(Jn(J)){$t=J.shape;var kt=J.stride,St=J.offset,Pt=0,Ut=0,ge=0,_e=0;$t.length===1?(Pt=$t[0],Ut=1,ge=kt[0],_e=0):$t.length===2?(Pt=$t[0],Ut=$t[1],ge=kt[0],_e=kt[1]):b.raise("invalid shape"),z.dtype=Yt||ie(J.data)||G,z.dimension=Ut;var Gt=Cn.allocType(z.dtype,Pt*Ut);_n(Gt,J.data,Pt,Ut,ge,_e,St),Mt(z,Gt,xt),Vt?z.persistentData=Gt:Cn.freeType(Gt)}else J instanceof ArrayBuffer?(z.dtype=B,z.dimension=pt,Mt(z,J,xt),Vt&&(z.persistentData=new Uint8Array(new Uint8Array(J)))):b.raise("invalid buffer data")}function Ct(z){v.bufferCount--,tt(z);var J=z.buffer;b(J,"buffer must not be deleted already"),_.deleteBuffer(J),z.buffer=null,delete K[z.id]}function wt(z,J,xt,Yt){v.bufferCount++;var pt=new et(J);K[pt.id]=pt;function Vt(dt){var ht=vf,qt=null,kt=0,St=0,Pt=1;return Array.isArray(dt)||e(dt)||Jn(dt)||dt instanceof ArrayBuffer?qt=dt:typeof dt=="number"?kt=dt|0:dt&&(b.type(dt,"object","buffer arguments must be an object, a number or an array"),"data"in dt&&(b(qt===null||Array.isArray(qt)||e(qt)||Jn(qt),"invalid data for buffer"),qt=dt.data),"usage"in dt&&(b.parameter(dt.usage,ma,"invalid buffer usage"),ht=ma[dt.usage]),"type"in dt&&(b.parameter(dt.type,Xi,"invalid buffer type"),St=Xi[dt.type]),"dimension"in dt&&(b.type(dt.dimension,"number","invalid dimension"),Pt=dt.dimension|0),"length"in dt&&(b.nni(kt,"buffer length must be a nonnegative integer"),kt=dt.length|0)),pt.bind(),qt?Ot(pt,qt,ht,St,Pt,Yt):(kt&&_.bufferData(pt.type,kt,ht),pt.dtype=St||B,pt.usage=ht,pt.dimension=Pt,pt.byteLength=kt),M.profile&&(pt.stats.size=pt.byteLength*it[pt.dtype]),Vt}function $t(dt,ht){b(ht+dt.byteLength<=pt.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+dt.byteLength+" starting from offset "+ht+" to a buffer of size "+pt.byteLength),_.bufferSubData(pt.type,ht,dt)}function re(dt,ht){var qt=(ht||0)|0,kt;if(pt.bind(),e(dt)||dt instanceof ArrayBuffer)$t(dt,qt);else if(Array.isArray(dt)){if(dt.length>0)if(typeof dt[0]=="number"){var St=Cn.allocType(pt.dtype,dt.length);Ke(St,dt),$t(St,qt),Cn.freeType(St)}else if(Array.isArray(dt[0])||e(dt[0])){kt=vn(dt);var Pt=yn(dt,kt,pt.dtype);$t(Pt,qt),Cn.freeType(Pt)}else b.raise("invalid buffer data")}else if(Jn(dt)){kt=dt.shape;var Ut=dt.stride,ge=0,_e=0,Gt=0,jt=0;kt.length===1?(ge=kt[0],_e=1,Gt=Ut[0],jt=0):kt.length===2?(ge=kt[0],_e=kt[1],Gt=Ut[0],jt=Ut[1]):b.raise("invalid shape");var fe=Array.isArray(dt.data)?pt.dtype:ie(dt.data),me=Cn.allocType(fe,ge*_e);_n(me,dt.data,ge,_e,Gt,jt,dt.offset),$t(me,qt),Cn.freeType(me)}else b.raise("invalid data for buffer subdata");return Vt}return xt||Vt(z),Vt._reglType="buffer",Vt._buffer=pt,Vt.subdata=re,M.profile&&(Vt.stats=pt.stats),Vt.destroy=function(){Ct(pt)},Vt}function Et(){br(K).forEach(function(z){z.buffer=_.createBuffer(),_.bindBuffer(z.type,z.buffer),_.bufferData(z.type,z.persistentData||z.byteLength,z.usage)})}return M.profile&&(v.getTotalBufferSize=function(){var z=0;return Object.keys(K).forEach(function(J){z+=K[J].stats.size}),z}),{create:wt,createStream:vt,destroyStream:It,clear:function(){br(K).forEach(Ct),bt.forEach(Ct)},getBuffer:function(z){return z&&z._buffer instanceof et?z._buffer:null},restore:Et,_initBuffer:Ot}}var We=0,dn=0,Or=1,dr=1,sr=4,wo=4,zr={points:We,point:dn,lines:Or,line:dr,triangles:sr,triangle:wo,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},bf=0,ld=1,xo=4,hd=5120,ar=5121,dd=5122,_r=5123,_d=5124,Ts=5125,Bi=34963,Cu=35040,Fl=35044;function kn(_,v,M,tt){var lt={},K=0,et={uint8:ar,uint16:_r};v.oes_element_index_uint&&(et.uint32=Ts);function bt(Et){this.id=K++,lt[this.id]=this,this.buffer=Et,this.primType=xo,this.vertCount=0,this.type=0}bt.prototype.bind=function(){this.buffer.bind()};var vt=[];function It(Et){var z=vt.pop();return z||(z=new bt(M.create(null,Bi,!0,!1)._buffer)),Ot(z,Et,Cu,-1,-1,0,0),z}function Mt(Et){vt.push(Et)}function Ot(Et,z,J,xt,Yt,pt,Vt){Et.buffer.bind();var $t;if(z){var re=Vt;!Vt&&(!e(z)||Jn(z)&&!e(z.data))&&(re=v.oes_element_index_uint?Ts:_r),M._initBuffer(Et.buffer,z,J,re,3)}else _.bufferData(Bi,pt,J),Et.buffer.dtype=$t||ar,Et.buffer.usage=J,Et.buffer.dimension=3,Et.buffer.byteLength=pt;if($t=Vt,!Vt){switch(Et.buffer.dtype){case ar:case hd:$t=ar;break;case _r:case dd:$t=_r;break;case Ts:case _d:$t=Ts;break;default:b.raise("unsupported type for element array")}Et.buffer.dtype=$t}Et.type=$t,b($t!==Ts||!!v.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var dt=Yt;dt<0&&(dt=Et.buffer.byteLength,$t===_r?dt>>=1:$t===Ts&&(dt>>=2)),Et.vertCount=dt;var ht=xt;if(xt<0){ht=xo;var qt=Et.buffer.dimension;qt===1&&(ht=bf),qt===2&&(ht=ld),qt===3&&(ht=xo)}Et.primType=ht}function Ct(Et){tt.elementsCount--,b(Et.buffer!==null,"must not double destroy elements"),delete lt[Et.id],Et.buffer.destroy(),Et.buffer=null}function wt(Et,z){var J=M.create(null,Bi,!0),xt=new bt(J._buffer);tt.elementsCount++;function Yt(pt){if(!pt)J(),xt.primType=xo,xt.vertCount=0,xt.type=ar;else if(typeof pt=="number")J(pt),xt.primType=xo,xt.vertCount=pt|0,xt.type=ar;else{var Vt=null,$t=Fl,re=-1,dt=-1,ht=0,qt=0;Array.isArray(pt)||e(pt)||Jn(pt)?Vt=pt:(b.type(pt,"object","invalid arguments for elements"),"data"in pt&&(Vt=pt.data,b(Array.isArray(Vt)||e(Vt)||Jn(Vt),"invalid data for element buffer")),"usage"in pt&&(b.parameter(pt.usage,ma,"invalid element buffer usage"),$t=ma[pt.usage]),"primitive"in pt&&(b.parameter(pt.primitive,zr,"invalid element buffer primitive"),re=zr[pt.primitive]),"count"in pt&&(b(typeof pt.count=="number"&&pt.count>=0,"invalid vertex count for elements"),dt=pt.count|0),"type"in pt&&(b.parameter(pt.type,et,"invalid buffer type"),qt=et[pt.type]),"length"in pt?ht=pt.length|0:(ht=dt,qt===_r||qt===dd?ht*=2:(qt===Ts||qt===_d)&&(ht*=4))),Ot(xt,Vt,$t,re,dt,ht,qt)}return Yt}return Yt(Et),Yt._reglType="elements",Yt._elements=xt,Yt.subdata=function(pt,Vt){return J.subdata(pt,Vt),Yt},Yt.destroy=function(){Ct(xt)},Yt}return{create:wt,createStream:It,destroyStream:Mt,getElements:function(Et){return typeof Et=="function"&&Et._elements instanceof bt?Et._elements:null},clear:function(){br(lt).forEach(Ct)}}}var qi=new Float32Array(1),Cl=new Uint32Array(qi.buffer),Kp=5123;function ku(_){for(var v=Cn.allocType(Kp,_.length),M=0;M<_.length;++M)if(isNaN(_[M]))v[M]=65535;else if(_[M]===1/0)v[M]=31744;else if(_[M]===-1/0)v[M]=64512;else{qi[0]=_[M];var tt=Cl[0],lt=tt>>>31<<15,K=(tt<<1>>>24)-127,et=tt>>13&1023;if(K<-24)v[M]=lt;else if(K<-14){var bt=-14-K;v[M]=lt+(et+1024>>bt)}else K>15?v[M]=lt+31744:v[M]=lt+(K+15<<10)+et}return v}function Bn(_){return Array.isArray(_)||e(_)}var pd=function(_){return!(_&_-1)&&!!_},Jp=34467,ci=3553,So=34067,Zi=34069,ga=6408,Pu=6406,wf=6407,ya=6409,Ao=6410,kl=32854,Pl=32855,zu=36194,zl=32819,Qp=32820,md=33635,Ur=34042,xf=6402,Is=34041,Uu=35904,Gu=35906,Eo=36193,Ul=33776,Gl=33777,$l=33778,Vl=33779,va=35986,gd=35987,yd=34798,$u=35840,jl=35841,Ki=35842,Sf=35843,vd=36196,To=5121,Wl=5123,Os=5125,Br=5126,bd=10242,tm=10243,em=10497,Yl=33071,nm=33648,rm=10240,Io=10241,W=9728,gt=9729,ut=9984,se=9985,Be=9986,fn=9987,Qn=33170,pn=4352,Hl=4353,im=4354,Hr=34046,Vu=3317,sm=37440,Oo=37441,ju=37443,Af=37444,un=33984,am=[ut,Be,se,fn],Ef=[0,ya,Ao,wf,ga],Mr={};Mr[ya]=Mr[Pu]=Mr[xf]=1,Mr[Is]=Mr[Ao]=2,Mr[wf]=Mr[Uu]=3,Mr[ga]=Mr[Gu]=4;function Bo(_){return"[object "+_+"]"}var wd=Bo("HTMLCanvasElement"),xd=Bo("OffscreenCanvas"),Tf=Bo("CanvasRenderingContext2D"),Ji=Bo("ImageBitmap"),If=Bo("HTMLImageElement"),Xl=Bo("HTMLVideoElement"),Wu=Object.keys(_a).concat([wd,xd,Tf,Ji,If,Xl]),ba=[];ba[To]=1,ba[Br]=4,ba[Eo]=2,ba[Wl]=2,ba[Os]=4;var tr=[];tr[kl]=2,tr[Pl]=2,tr[zu]=2,tr[Is]=4,tr[Ul]=.5,tr[Gl]=.5,tr[$l]=1,tr[Vl]=1,tr[va]=.5,tr[gd]=1,tr[yd]=1,tr[$u]=.5,tr[jl]=.25,tr[Ki]=.5,tr[Sf]=.25,tr[vd]=.5;function Of(_){return Array.isArray(_)&&(_.length===0||typeof _[0]=="number")}function ql(_){if(!Array.isArray(_))return!1;var v=_.length;return!(v===0||!Bn(_[0]))}function li(_){return Object.prototype.toString.call(_)}function Bs(_){return li(_)===wd}function Bf(_){return li(_)===xd}function om(_){return li(_)===Tf}function fm(_){return li(_)===Ji}function um(_){return li(_)===If}function Yu(_){return li(_)===Xl}function Mo(_){if(!_)return!1;var v=li(_);return Wu.indexOf(v)>=0?!0:Of(_)||ql(_)||Jn(_)}function Hu(_){return _a[Object.prototype.toString.call(_)]|0}function cm(_,v){var M=v.length;switch(_.type){case To:case Wl:case Os:case Br:var tt=Cn.allocType(_.type,M);tt.set(v),_.data=tt;break;case Eo:_.data=ku(v);break;default:b.raise("unsupported texture type, must specify a typed array")}}function Zl(_,v){return Cn.allocType(_.type===Eo?Br:_.type,v)}function Sd(_,v){_.type===Eo?(_.data=ku(v),Cn.freeType(v)):_.data=v}function lm(_,v,M,tt,lt,K){for(var et=_.width,bt=_.height,vt=_.channels,It=et*bt*vt,Mt=Zl(_,It),Ot=0,Ct=0;Ct<bt;++Ct)for(var wt=0;wt<et;++wt)for(var Et=0;Et<vt;++Et)Mt[Ot++]=v[M*wt+tt*Ct+lt*Et+K];Sd(_,Mt)}function $n(_,v,M,tt,lt,K){var et;if(typeof tr[_]<"u"?et=tr[_]:et=Mr[_]*ba[v],K&&(et*=6),lt){for(var bt=0,vt=M;vt>=1;)bt+=et*vt*vt,vt/=2;return bt}else return et*M*tt}function wr(_,v,M,tt,lt,K,et){var bt={"don't care":pn,"dont care":pn,nice:im,fast:Hl},vt={repeat:em,clamp:Yl,mirror:nm},It={nearest:W,linear:gt},Mt=r({mipmap:fn,"nearest mipmap nearest":ut,"linear mipmap nearest":se,"nearest mipmap linear":Be,"linear mipmap linear":fn},It),Ot={none:0,browser:Af},Ct={uint8:To,rgba4:zl,rgb565:md,"rgb5 a1":Qp},wt={alpha:Pu,luminance:ya,"luminance alpha":Ao,rgb:wf,rgba:ga,rgba4:kl,"rgb5 a1":Pl,rgb565:zu},Et={};v.ext_srgb&&(wt.srgb=Uu,wt.srgba=Gu),v.oes_texture_float&&(Ct.float32=Ct.float=Br),v.oes_texture_half_float&&(Ct.float16=Ct["half float"]=Eo),v.webgl_depth_texture&&(r(wt,{depth:xf,"depth stencil":Is}),r(Ct,{uint16:Wl,uint32:Os,"depth stencil":Ur})),v.webgl_compressed_texture_s3tc&&r(Et,{"rgb s3tc dxt1":Ul,"rgba s3tc dxt1":Gl,"rgba s3tc dxt3":$l,"rgba s3tc dxt5":Vl}),v.webgl_compressed_texture_atc&&r(Et,{"rgb atc":va,"rgba atc explicit alpha":gd,"rgba atc interpolated alpha":yd}),v.webgl_compressed_texture_pvrtc&&r(Et,{"rgb pvrtc 4bppv1":$u,"rgb pvrtc 2bppv1":jl,"rgba pvrtc 4bppv1":Ki,"rgba pvrtc 2bppv1":Sf}),v.webgl_compressed_texture_etc1&&(Et["rgb etc1"]=vd);var z=Array.prototype.slice.call(_.getParameter(Jp));Object.keys(Et).forEach(function(T){var nt=Et[T];z.indexOf(nt)>=0&&(wt[T]=nt)});var J=Object.keys(wt);M.textureFormats=J;var xt=[];Object.keys(wt).forEach(function(T){var nt=wt[T];xt[nt]=T});var Yt=[];Object.keys(Ct).forEach(function(T){var nt=Ct[T];Yt[nt]=T});var pt=[];Object.keys(It).forEach(function(T){var nt=It[T];pt[nt]=T});var Vt=[];Object.keys(Mt).forEach(function(T){var nt=Mt[T];Vt[nt]=T});var $t=[];Object.keys(vt).forEach(function(T){var nt=vt[T];$t[nt]=T});var re=J.reduce(function(T,nt){var q=wt[nt];return q===ya||q===Pu||q===ya||q===Ao||q===xf||q===Is||v.ext_srgb&&(q===Uu||q===Gu)?T[q]=q:q===Pl||nt.indexOf("rgba")>=0?T[q]=ga:T[q]=wf,T},{});function dt(){this.internalformat=ga,this.format=ga,this.type=To,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Af,this.width=0,this.height=0,this.channels=0}function ht(T,nt){T.internalformat=nt.internalformat,T.format=nt.format,T.type=nt.type,T.compressed=nt.compressed,T.premultiplyAlpha=nt.premultiplyAlpha,T.flipY=nt.flipY,T.unpackAlignment=nt.unpackAlignment,T.colorSpace=nt.colorSpace,T.width=nt.width,T.height=nt.height,T.channels=nt.channels}function qt(T,nt){if(!(typeof nt!="object"||!nt)){if("premultiplyAlpha"in nt&&(b.type(nt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),T.premultiplyAlpha=nt.premultiplyAlpha),"flipY"in nt&&(b.type(nt.flipY,"boolean","invalid texture flip"),T.flipY=nt.flipY),"alignment"in nt&&(b.oneOf(nt.alignment,[1,2,4,8],"invalid texture unpack alignment"),T.unpackAlignment=nt.alignment),"colorSpace"in nt&&(b.parameter(nt.colorSpace,Ot,"invalid colorSpace"),T.colorSpace=Ot[nt.colorSpace]),"type"in nt){var q=nt.type;b(v.oes_texture_float||!(q==="float"||q==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),b(v.oes_texture_half_float||!(q==="half float"||q==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),b(v.webgl_depth_texture||!(q==="uint16"||q==="uint32"||q==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),b.parameter(q,Ct,"invalid texture type"),T.type=Ct[q]}var Xt=T.width,Ae=T.height,S=T.channels,g=!1;"shape"in nt?(b(Array.isArray(nt.shape)&&nt.shape.length>=2,"shape must be an array"),Xt=nt.shape[0],Ae=nt.shape[1],nt.shape.length===3&&(S=nt.shape[2],b(S>0&&S<=4,"invalid number of channels"),g=!0),b(Xt>=0&&Xt<=M.maxTextureSize,"invalid width"),b(Ae>=0&&Ae<=M.maxTextureSize,"invalid height")):("radius"in nt&&(Xt=Ae=nt.radius,b(Xt>=0&&Xt<=M.maxTextureSize,"invalid radius")),"width"in nt&&(Xt=nt.width,b(Xt>=0&&Xt<=M.maxTextureSize,"invalid width")),"height"in nt&&(Ae=nt.height,b(Ae>=0&&Ae<=M.maxTextureSize,"invalid height")),"channels"in nt&&(S=nt.channels,b(S>0&&S<=4,"invalid number of channels"),g=!0)),T.width=Xt|0,T.height=Ae|0,T.channels=S|0;var R=!1;if("format"in nt){var U=nt.format;b(v.webgl_depth_texture||!(U==="depth"||U==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),b.parameter(U,wt,"invalid texture format");var $=T.internalformat=wt[U];T.format=re[$],U in Ct&&("type"in nt||(T.type=Ct[U])),U in Et&&(T.compressed=!0),R=!0}!g&&R?T.channels=Mr[T.format]:g&&!R?T.channels!==Ef[T.format]&&(T.format=T.internalformat=Ef[T.channels]):R&&g&&b(T.channels===Mr[T.format],"number of channels inconsistent with specified format")}}function kt(T){_.pixelStorei(sm,T.flipY),_.pixelStorei(Oo,T.premultiplyAlpha),_.pixelStorei(ju,T.colorSpace),_.pixelStorei(Vu,T.unpackAlignment)}function St(){dt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Pt(T,nt){var q=null;if(Mo(nt)?q=nt:nt&&(b.type(nt,"object","invalid pixel data type"),qt(T,nt),"x"in nt&&(T.xOffset=nt.x|0),"y"in nt&&(T.yOffset=nt.y|0),Mo(nt.data)&&(q=nt.data)),b(!T.compressed||q instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),nt.copy){b(!q,"can not specify copy and data field for the same texture");var Xt=lt.viewportWidth,Ae=lt.viewportHeight;T.width=T.width||Xt-T.xOffset,T.height=T.height||Ae-T.yOffset,T.needsCopy=!0,b(T.xOffset>=0&&T.xOffset<Xt&&T.yOffset>=0&&T.yOffset<Ae&&T.width>0&&T.width<=Xt&&T.height>0&&T.height<=Ae,"copy texture read out of bounds")}else if(!q)T.width=T.width||1,T.height=T.height||1,T.channels=T.channels||4;else if(e(q))T.channels=T.channels||4,T.data=q,!("type"in nt)&&T.type===To&&(T.type=Hu(q));else if(Of(q))T.channels=T.channels||4,cm(T,q),T.alignment=1,T.needsFree=!0;else if(Jn(q)){var S=q.data;!Array.isArray(S)&&T.type===To&&(T.type=Hu(S));var g=q.shape,R=q.stride,U,$,D,L,P,A;g.length===3?(D=g[2],A=R[2]):(b(g.length===2,"invalid ndarray pixel data, must be 2 or 3D"),D=1,A=1),U=g[0],$=g[1],L=R[0],P=R[1],T.alignment=1,T.width=U,T.height=$,T.channels=D,T.format=T.internalformat=Ef[D],T.needsFree=!0,lm(T,S,L,P,A,q.offset)}else if(Bs(q)||Bf(q)||om(q))Bs(q)||Bf(q)?T.element=q:T.element=q.canvas,T.width=T.element.width,T.height=T.element.height,T.channels=4;else if(fm(q))T.element=q,T.width=q.width,T.height=q.height,T.channels=4;else if(um(q))T.element=q,T.width=q.naturalWidth,T.height=q.naturalHeight,T.channels=4;else if(Yu(q))T.element=q,T.width=q.videoWidth,T.height=q.videoHeight,T.channels=4;else if(ql(q)){var O=T.width||q[0].length,E=T.height||q.length,X=T.channels;Bn(q[0][0])?X=X||q[0][0].length:X=X||1;for(var j=da.shape(q),ct=1,_t=0;_t<j.length;++_t)ct*=j[_t];var Nt=Zl(T,ct);da.flatten(q,j,"",Nt),Sd(T,Nt),T.alignment=1,T.width=O,T.height=E,T.channels=X,T.format=T.internalformat=Ef[X],T.needsFree=!0}T.type===Br?b(M.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):T.type===Eo&&b(M.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Ut(T,nt,q){var Xt=T.element,Ae=T.data,S=T.internalformat,g=T.format,R=T.type,U=T.width,$=T.height;kt(T),Xt?_.texImage2D(nt,q,g,g,R,Xt):T.compressed?_.compressedTexImage2D(nt,q,S,U,$,0,Ae):T.needsCopy?(tt(),_.copyTexImage2D(nt,q,g,T.xOffset,T.yOffset,U,$,0)):_.texImage2D(nt,q,g,U,$,0,g,R,Ae||null)}function ge(T,nt,q,Xt,Ae){var S=T.element,g=T.data,R=T.internalformat,U=T.format,$=T.type,D=T.width,L=T.height;kt(T),S?_.texSubImage2D(nt,Ae,q,Xt,U,$,S):T.compressed?_.compressedTexSubImage2D(nt,Ae,q,Xt,R,D,L,g):T.needsCopy?(tt(),_.copyTexSubImage2D(nt,Ae,q,Xt,T.xOffset,T.yOffset,D,L)):_.texSubImage2D(nt,Ae,q,Xt,D,L,U,$,g)}var _e=[];function Gt(){return _e.pop()||new St}function jt(T){T.needsFree&&Cn.freeType(T.data),St.call(T),_e.push(T)}function fe(){dt.call(this),this.genMipmaps=!1,this.mipmapHint=pn,this.mipmask=0,this.images=Array(16)}function me(T,nt,q){var Xt=T.images[0]=Gt();T.mipmask=1,Xt.width=T.width=nt,Xt.height=T.height=q,Xt.channels=T.channels=4}function Ee(T,nt){var q=null;if(Mo(nt))q=T.images[0]=Gt(),ht(q,T),Pt(q,nt),T.mipmask=1;else if(qt(T,nt),Array.isArray(nt.mipmap))for(var Xt=nt.mipmap,Ae=0;Ae<Xt.length;++Ae)q=T.images[Ae]=Gt(),ht(q,T),q.width>>=Ae,q.height>>=Ae,Pt(q,Xt[Ae]),T.mipmask|=1<<Ae;else q=T.images[0]=Gt(),ht(q,T),Pt(q,nt),T.mipmask=1;ht(T,T.images[0]),T.compressed&&(T.internalformat===Ul||T.internalformat===Gl||T.internalformat===$l||T.internalformat===Vl)&&b(T.width%4===0&&T.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Tn(T,nt){for(var q=T.images,Xt=0;Xt<q.length;++Xt){if(!q[Xt])return;Ut(q[Xt],nt,Xt)}}var xn=[];function Me(){var T=xn.pop()||new fe;dt.call(T),T.mipmask=0;for(var nt=0;nt<16;++nt)T.images[nt]=null;return T}function mn(T){for(var nt=T.images,q=0;q<nt.length;++q)nt[q]&&jt(nt[q]),nt[q]=null;xn.push(T)}function sn(){this.minFilter=W,this.magFilter=W,this.wrapS=Yl,this.wrapT=Yl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=pn}function Vn(T,nt){if("min"in nt){var q=nt.min;b.parameter(q,Mt),T.minFilter=Mt[q],am.indexOf(T.minFilter)>=0&&!("faces"in nt)&&(T.genMipmaps=!0)}if("mag"in nt){var Xt=nt.mag;b.parameter(Xt,It),T.magFilter=It[Xt]}var Ae=T.wrapS,S=T.wrapT;if("wrap"in nt){var g=nt.wrap;typeof g=="string"?(b.parameter(g,vt),Ae=S=vt[g]):Array.isArray(g)&&(b.parameter(g[0],vt),b.parameter(g[1],vt),Ae=vt[g[0]],S=vt[g[1]])}else{if("wrapS"in nt){var R=nt.wrapS;b.parameter(R,vt),Ae=vt[R]}if("wrapT"in nt){var U=nt.wrapT;b.parameter(U,vt),S=vt[U]}}if(T.wrapS=Ae,T.wrapT=S,"anisotropic"in nt){var $=nt.anisotropic;b(typeof $=="number"&&$>=1&&$<=M.maxAnisotropic,"aniso samples must be between 1 and "),T.anisotropic=nt.anisotropic}if("mipmap"in nt){var D=!1;switch(typeof nt.mipmap){case"string":b.parameter(nt.mipmap,bt,"invalid mipmap hint"),T.mipmapHint=bt[nt.mipmap],T.genMipmaps=!0,D=!0;break;case"boolean":D=T.genMipmaps=nt.mipmap;break;case"object":b(Array.isArray(nt.mipmap),"invalid mipmap type"),T.genMipmaps=!1,D=!0;break;default:b.raise("invalid mipmap type")}D&&!("min"in nt)&&(T.minFilter=ut)}}function jn(T,nt){_.texParameteri(nt,Io,T.minFilter),_.texParameteri(nt,rm,T.magFilter),_.texParameteri(nt,bd,T.wrapS),_.texParameteri(nt,tm,T.wrapT),v.ext_texture_filter_anisotropic&&_.texParameteri(nt,Hr,T.anisotropic),T.genMipmaps&&(_.hint(Qn,T.mipmapHint),_.generateMipmap(nt))}var Yn=0,er={},fr=M.maxTextureUnits,Un=Array(fr).map(function(){return null});function we(T){dt.call(this),this.mipmask=0,this.internalformat=ga,this.id=Yn++,this.refCount=1,this.target=T,this.texture=_.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new sn,et.profile&&(this.stats={size:0})}function ur(T){_.activeTexture(un),_.bindTexture(T.target,T.texture)}function en(){var T=Un[0];T?_.bindTexture(T.target,T.texture):_.bindTexture(ci,null)}function ce(T){var nt=T.texture;b(nt,"must not double destroy texture");var q=T.unit,Xt=T.target;q>=0&&(_.activeTexture(un+q),_.bindTexture(Xt,null),Un[q]=null),_.deleteTexture(nt),T.texture=null,T.params=null,T.pixels=null,T.refCount=0,delete er[T.id],K.textureCount--}r(we.prototype,{bind:function(){var T=this;T.bindCount+=1;var nt=T.unit;if(nt<0){for(var q=0;q<fr;++q){var Xt=Un[q];if(Xt){if(Xt.bindCount>0)continue;Xt.unit=-1}Un[q]=T,nt=q;break}nt>=fr&&b.raise("insufficient number of texture units"),et.profile&&K.maxTextureUnits<nt+1&&(K.maxTextureUnits=nt+1),T.unit=nt,_.activeTexture(un+nt),_.bindTexture(T.target,T.texture)}return nt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ce(this)}});function Le(T,nt){var q=new we(ci);er[q.id]=q,K.textureCount++;function Xt(g,R){var U=q.texInfo;sn.call(U);var $=Me();return typeof g=="number"?typeof R=="number"?me($,g|0,R|0):me($,g|0,g|0):g?(b.type(g,"object","invalid arguments to regl.texture"),Vn(U,g),Ee($,g)):me($,1,1),U.genMipmaps&&($.mipmask=($.width<<1)-1),q.mipmask=$.mipmask,ht(q,$),b.texture2D(U,$,M),q.internalformat=$.internalformat,Xt.width=$.width,Xt.height=$.height,ur(q),Tn($,ci),jn(U,ci),en(),mn($),et.profile&&(q.stats.size=$n(q.internalformat,q.type,$.width,$.height,U.genMipmaps,!1)),Xt.format=xt[q.internalformat],Xt.type=Yt[q.type],Xt.mag=pt[U.magFilter],Xt.min=Vt[U.minFilter],Xt.wrapS=$t[U.wrapS],Xt.wrapT=$t[U.wrapT],Xt}function Ae(g,R,U,$){b(!!g,"must specify image data");var D=R|0,L=U|0,P=$|0,A=Gt();return ht(A,q),A.width=0,A.height=0,Pt(A,g),A.width=A.width||(q.width>>P)-D,A.height=A.height||(q.height>>P)-L,b(q.type===A.type&&q.format===A.format&&q.internalformat===A.internalformat,"incompatible format for texture.subimage"),b(D>=0&&L>=0&&D+A.width<=q.width&&L+A.height<=q.height,"texture.subimage write out of bounds"),b(q.mipmask&1<<P,"missing mipmap data"),b(A.data||A.element||A.needsCopy,"missing image data"),ur(q),ge(A,ci,D,L,P),en(),jt(A),Xt}function S(g,R){var U=g|0,$=R|0||U;if(U===q.width&&$===q.height)return Xt;Xt.width=q.width=U,Xt.height=q.height=$,ur(q);for(var D=0;q.mipmask>>D;++D){var L=U>>D,P=$>>D;if(!L||!P)break;_.texImage2D(ci,D,q.format,L,P,0,q.format,q.type,null)}return en(),et.profile&&(q.stats.size=$n(q.internalformat,q.type,U,$,!1,!1)),Xt}return Xt(T,nt),Xt.subimage=Ae,Xt.resize=S,Xt._reglType="texture2d",Xt._texture=q,et.profile&&(Xt.stats=q.stats),Xt.destroy=function(){q.decRef()},Xt}function Ve(T,nt,q,Xt,Ae,S){var g=new we(So);er[g.id]=g,K.cubeCount++;var R=new Array(6);function U(L,P,A,O,E,X){var j,ct=g.texInfo;for(sn.call(ct),j=0;j<6;++j)R[j]=Me();if(typeof L=="number"||!L){var _t=L|0||1;for(j=0;j<6;++j)me(R[j],_t,_t)}else if(typeof L=="object")if(P)Ee(R[0],L),Ee(R[1],P),Ee(R[2],A),Ee(R[3],O),Ee(R[4],E),Ee(R[5],X);else if(Vn(ct,L),qt(g,L),"faces"in L){var Nt=L.faces;for(b(Array.isArray(Nt)&&Nt.length===6,"cube faces must be a length 6 array"),j=0;j<6;++j)b(typeof Nt[j]=="object"&&!!Nt[j],"invalid input for cube map face"),ht(R[j],g),Ee(R[j],Nt[j])}else for(j=0;j<6;++j)Ee(R[j],L);else b.raise("invalid arguments to cube map");for(ht(g,R[0]),b.optional(function(){M.npotTextureCube||b(pd(g.width)&&pd(g.height),"your browser does not support non power or two texture dimensions")}),ct.genMipmaps?g.mipmask=(R[0].width<<1)-1:g.mipmask=R[0].mipmask,b.textureCube(g,ct,R,M),g.internalformat=R[0].internalformat,U.width=R[0].width,U.height=R[0].height,ur(g),j=0;j<6;++j)Tn(R[j],Zi+j);for(jn(ct,So),en(),et.profile&&(g.stats.size=$n(g.internalformat,g.type,U.width,U.height,ct.genMipmaps,!0)),U.format=xt[g.internalformat],U.type=Yt[g.type],U.mag=pt[ct.magFilter],U.min=Vt[ct.minFilter],U.wrapS=$t[ct.wrapS],U.wrapT=$t[ct.wrapT],j=0;j<6;++j)mn(R[j]);return U}function $(L,P,A,O,E){b(!!P,"must specify image data"),b(typeof L=="number"&&L===(L|0)&&L>=0&&L<6,"invalid face");var X=A|0,j=O|0,ct=E|0,_t=Gt();return ht(_t,g),_t.width=0,_t.height=0,Pt(_t,P),_t.width=_t.width||(g.width>>ct)-X,_t.height=_t.height||(g.height>>ct)-j,b(g.type===_t.type&&g.format===_t.format&&g.internalformat===_t.internalformat,"incompatible format for texture.subimage"),b(X>=0&&j>=0&&X+_t.width<=g.width&&j+_t.height<=g.height,"texture.subimage write out of bounds"),b(g.mipmask&1<<ct,"missing mipmap data"),b(_t.data||_t.element||_t.needsCopy,"missing image data"),ur(g),ge(_t,Zi+L,X,j,ct),en(),jt(_t),U}function D(L){var P=L|0;if(P!==g.width){U.width=g.width=P,U.height=g.height=P,ur(g);for(var A=0;A<6;++A)for(var O=0;g.mipmask>>O;++O)_.texImage2D(Zi+A,O,g.format,P>>O,P>>O,0,g.format,g.type,null);return en(),et.profile&&(g.stats.size=$n(g.internalformat,g.type,U.width,U.height,!1,!0)),U}}return U(T,nt,q,Xt,Ae,S),U.subimage=$,U.resize=D,U._reglType="textureCube",U._texture=g,et.profile&&(U.stats=g.stats),U.destroy=function(){g.decRef()},U}function Gn(){for(var T=0;T<fr;++T)_.activeTexture(un+T),_.bindTexture(ci,null),Un[T]=null;br(er).forEach(ce),K.cubeCount=0,K.textureCount=0}et.profile&&(K.getTotalTextureSize=function(){var T=0;return Object.keys(er).forEach(function(nt){T+=er[nt].stats.size}),T});function gi(){for(var T=0;T<fr;++T){var nt=Un[T];nt&&(nt.bindCount=0,nt.unit=-1,Un[T]=null)}br(er).forEach(function(q){q.texture=_.createTexture(),_.bindTexture(q.target,q.texture);for(var Xt=0;Xt<32;++Xt)if(q.mipmask&1<<Xt)if(q.target===ci)_.texImage2D(ci,Xt,q.internalformat,q.width>>Xt,q.height>>Xt,0,q.internalformat,q.type,null);else for(var Ae=0;Ae<6;++Ae)_.texImage2D(Zi+Ae,Xt,q.internalformat,q.width>>Xt,q.height>>Xt,0,q.internalformat,q.type,null);jn(q.texInfo,q.target)})}function Us(){for(var T=0;T<fr;++T){var nt=Un[T];nt&&(nt.bindCount=0,nt.unit=-1,Un[T]=null),_.activeTexture(un+T),_.bindTexture(ci,null),_.bindTexture(So,null)}}return{create2D:Le,createCube:Ve,clear:Gn,getTexture:function(T){return null},restore:gi,refresh:Us}}var Ms=36161,Xu=32854,Kl=32855,Ad=36194,qu=33189,Lo=36168,Zu=34041,wa=35907,Ro=34836,No=34842,Mf=34843,xr=[];xr[Xu]=2,xr[Kl]=2,xr[Ad]=2,xr[qu]=2,xr[Lo]=1,xr[Zu]=4,xr[wa]=4,xr[Ro]=16,xr[No]=8,xr[Mf]=6;function Ed(_,v,M){return xr[_]*v*M}var hm=function(_,v,M,tt,lt){var K={rgba4:Xu,rgb565:Ad,"rgb5 a1":Kl,depth:qu,stencil:Lo,"depth stencil":Zu};v.ext_srgb&&(K.srgba=wa),v.ext_color_buffer_half_float&&(K.rgba16f=No,K.rgb16f=Mf),v.webgl_color_buffer_float&&(K.rgba32f=Ro);var et=[];Object.keys(K).forEach(function(wt){var Et=K[wt];et[Et]=wt});var bt=0,vt={};function It(wt){this.id=bt++,this.refCount=1,this.renderbuffer=wt,this.format=Xu,this.width=0,this.height=0,lt.profile&&(this.stats={size:0})}It.prototype.decRef=function(){--this.refCount<=0&&Mt(this)};function Mt(wt){var Et=wt.renderbuffer;b(Et,"must not double destroy renderbuffer"),_.bindRenderbuffer(Ms,null),_.deleteRenderbuffer(Et),wt.renderbuffer=null,wt.refCount=0,delete vt[wt.id],tt.renderbufferCount--}function Ot(wt,Et){var z=new It(_.createRenderbuffer());vt[z.id]=z,tt.renderbufferCount++;function J(Yt,pt){var Vt=0,$t=0,re=Xu;if(typeof Yt=="object"&&Yt){var dt=Yt;if("shape"in dt){var ht=dt.shape;b(Array.isArray(ht)&&ht.length>=2,"invalid renderbuffer shape"),Vt=ht[0]|0,$t=ht[1]|0}else"radius"in dt&&(Vt=$t=dt.radius|0),"width"in dt&&(Vt=dt.width|0),"height"in dt&&($t=dt.height|0);"format"in dt&&(b.parameter(dt.format,K,"invalid renderbuffer format"),re=K[dt.format])}else typeof Yt=="number"?(Vt=Yt|0,typeof pt=="number"?$t=pt|0:$t=Vt):Yt?b.raise("invalid arguments to renderbuffer constructor"):Vt=$t=1;if(b(Vt>0&&$t>0&&Vt<=M.maxRenderbufferSize&&$t<=M.maxRenderbufferSize,"invalid renderbuffer size"),!(Vt===z.width&&$t===z.height&&re===z.format))return J.width=z.width=Vt,J.height=z.height=$t,z.format=re,_.bindRenderbuffer(Ms,z.renderbuffer),_.renderbufferStorage(Ms,re,Vt,$t),b(_.getError()===0,"invalid render buffer format"),lt.profile&&(z.stats.size=Ed(z.format,z.width,z.height)),J.format=et[z.format],J}function xt(Yt,pt){var Vt=Yt|0,$t=pt|0||Vt;return Vt===z.width&&$t===z.height||(b(Vt>0&&$t>0&&Vt<=M.maxRenderbufferSize&&$t<=M.maxRenderbufferSize,"invalid renderbuffer size"),J.width=z.width=Vt,J.height=z.height=$t,_.bindRenderbuffer(Ms,z.renderbuffer),_.renderbufferStorage(Ms,z.format,Vt,$t),b(_.getError()===0,"invalid render buffer format"),lt.profile&&(z.stats.size=Ed(z.format,z.width,z.height))),J}return J(wt,Et),J.resize=xt,J._reglType="renderbuffer",J._renderbuffer=z,lt.profile&&(J.stats=z.stats),J.destroy=function(){z.decRef()},J}lt.profile&&(tt.getTotalRenderbufferSize=function(){var wt=0;return Object.keys(vt).forEach(function(Et){wt+=vt[Et].stats.size}),wt});function Ct(){br(vt).forEach(function(wt){wt.renderbuffer=_.createRenderbuffer(),_.bindRenderbuffer(Ms,wt.renderbuffer),_.renderbufferStorage(Ms,wt.format,wt.width,wt.height)}),_.bindRenderbuffer(Ms,null)}return{create:Ot,clear:function(){br(vt).forEach(Mt)},restore:Ct}},Qi=36160,Jl=36161,xa=3553,Sa=34069,Do=36064,Ql=36096,y=36128,Aa=33306,Lf=36053,Xr=36054,tn=36055,dm=36057,_m=36061,pm=36193,Ea=5121,mm=5126,Td=6407,Id=6408,gm=6402,ym=[Td,Id],hi=[];hi[Id]=4,hi[Td]=3;var Ku=[];Ku[Ea]=1,Ku[mm]=4,Ku[pm]=2;var vm=32854,bm=32855,wm=36194,xm=33189,ts=36168,Od=34041,Sm=35907,Am=34836,Em=34842,Tm=34843,Ta=[vm,bm,wm,Sm,Em,Tm,Am],Fo={};Fo[Lf]="complete",Fo[Xr]="incomplete attachment",Fo[dm]="incomplete dimensions",Fo[tn]="incomplete, missing attachment",Fo[_m]="unsupported";function Im(_,v,M,tt,lt,K){var et={cur:null,next:null,dirty:!1,setFBO:null},bt=["rgba"],vt=["rgba4","rgb565","rgb5 a1"];v.ext_srgb&&vt.push("srgba"),v.ext_color_buffer_half_float&&vt.push("rgba16f","rgb16f"),v.webgl_color_buffer_float&&vt.push("rgba32f");var It=["uint8"];v.oes_texture_half_float&&It.push("half float","float16"),v.oes_texture_float&&It.push("float","float32");function Mt(St,Pt,Ut){this.target=St,this.texture=Pt,this.renderbuffer=Ut;var ge=0,_e=0;Pt?(ge=Pt.width,_e=Pt.height):Ut&&(ge=Ut.width,_e=Ut.height),this.width=ge,this.height=_e}function Ot(St){St&&(St.texture&&St.texture._texture.decRef(),St.renderbuffer&&St.renderbuffer._renderbuffer.decRef())}function Ct(St,Pt,Ut){if(St)if(St.texture){var ge=St.texture._texture,_e=Math.max(1,ge.width),Gt=Math.max(1,ge.height);b(_e===Pt&&Gt===Ut,"inconsistent width/height for supplied texture"),ge.refCount+=1}else{var jt=St.renderbuffer._renderbuffer;b(jt.width===Pt&&jt.height===Ut,"inconsistent width/height for renderbuffer"),jt.refCount+=1}}function wt(St,Pt){Pt&&(Pt.texture?_.framebufferTexture2D(Qi,St,Pt.target,Pt.texture._texture.texture,0):_.framebufferRenderbuffer(Qi,St,Jl,Pt.renderbuffer._renderbuffer.renderbuffer))}function Et(St){var Pt=xa,Ut=null,ge=null,_e=St;typeof St=="object"&&(_e=St.data,"target"in St&&(Pt=St.target|0)),b.type(_e,"function","invalid attachment data");var Gt=_e._reglType;return Gt==="texture2d"?(Ut=_e,b(Pt===xa)):Gt==="textureCube"?(Ut=_e,b(Pt>=Sa&&Pt<Sa+6,"invalid cube map target")):Gt==="renderbuffer"?(ge=_e,Pt=Jl):b.raise("invalid regl object for attachment"),new Mt(Pt,Ut,ge)}function z(St,Pt,Ut,ge,_e){if(Ut){var Gt=tt.create2D({width:St,height:Pt,format:ge,type:_e});return Gt._texture.refCount=0,new Mt(xa,Gt,null)}else{var jt=lt.create({width:St,height:Pt,format:ge});return jt._renderbuffer.refCount=0,new Mt(Jl,null,jt)}}function J(St){return St&&(St.texture||St.renderbuffer)}function xt(St,Pt,Ut){St&&(St.texture?St.texture.resize(Pt,Ut):St.renderbuffer&&St.renderbuffer.resize(Pt,Ut),St.width=Pt,St.height=Ut)}var Yt=0,pt={};function Vt(){this.id=Yt++,pt[this.id]=this,this.framebuffer=_.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function $t(St){St.colorAttachments.forEach(Ot),Ot(St.depthAttachment),Ot(St.stencilAttachment),Ot(St.depthStencilAttachment)}function re(St){var Pt=St.framebuffer;b(Pt,"must not double destroy framebuffer"),_.deleteFramebuffer(Pt),St.framebuffer=null,K.framebufferCount--,delete pt[St.id]}function dt(St){var Pt;_.bindFramebuffer(Qi,St.framebuffer);var Ut=St.colorAttachments;for(Pt=0;Pt<Ut.length;++Pt)wt(Do+Pt,Ut[Pt]);for(Pt=Ut.length;Pt<M.maxColorAttachments;++Pt)_.framebufferTexture2D(Qi,Do+Pt,xa,null,0);_.framebufferTexture2D(Qi,Aa,xa,null,0),_.framebufferTexture2D(Qi,Ql,xa,null,0),_.framebufferTexture2D(Qi,y,xa,null,0),wt(Ql,St.depthAttachment),wt(y,St.stencilAttachment),wt(Aa,St.depthStencilAttachment);var ge=_.checkFramebufferStatus(Qi);!_.isContextLost()&&ge!==Lf&&b.raise("framebuffer configuration not supported, status = "+Fo[ge]),_.bindFramebuffer(Qi,et.next?et.next.framebuffer:null),et.cur=et.next,_.getError()}function ht(St,Pt){var Ut=new Vt;K.framebufferCount++;function ge(Gt,jt){var fe;b(et.next!==Ut,"can not update framebuffer which is currently in use");var me=0,Ee=0,Tn=!0,xn=!0,Me=null,mn=!0,sn="rgba",Vn="uint8",jn=1,Yn=null,er=null,fr=null,Un=!1;if(typeof Gt=="number")me=Gt|0,Ee=jt|0||me;else if(!Gt)me=Ee=1;else{b.type(Gt,"object","invalid arguments for framebuffer");var we=Gt;if("shape"in we){var ur=we.shape;b(Array.isArray(ur)&&ur.length>=2,"invalid shape for framebuffer"),me=ur[0],Ee=ur[1]}else"radius"in we&&(me=Ee=we.radius),"width"in we&&(me=we.width),"height"in we&&(Ee=we.height);("color"in we||"colors"in we)&&(Me=we.color||we.colors,Array.isArray(Me)&&b(Me.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),Me||("colorCount"in we&&(jn=we.colorCount|0,b(jn>0,"invalid color buffer count")),"colorTexture"in we&&(mn=!!we.colorTexture,sn="rgba4"),"colorType"in we&&(Vn=we.colorType,mn?(b(v.oes_texture_float||!(Vn==="float"||Vn==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),b(v.oes_texture_half_float||!(Vn==="half float"||Vn==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Vn==="half float"||Vn==="float16"?(b(v.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),sn="rgba16f"):(Vn==="float"||Vn==="float32")&&(b(v.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),sn="rgba32f"),b.oneOf(Vn,It,"invalid color type")),"colorFormat"in we&&(sn=we.colorFormat,bt.indexOf(sn)>=0?mn=!0:vt.indexOf(sn)>=0?mn=!1:b.optional(function(){mn?b.oneOf(we.colorFormat,bt,"invalid color format for texture"):b.oneOf(we.colorFormat,vt,"invalid color format for renderbuffer")}))),("depthTexture"in we||"depthStencilTexture"in we)&&(Un=!!(we.depthTexture||we.depthStencilTexture),b(!Un||v.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in we&&(typeof we.depth=="boolean"?Tn=we.depth:(Yn=we.depth,xn=!1)),"stencil"in we&&(typeof we.stencil=="boolean"?xn=we.stencil:(er=we.stencil,Tn=!1)),"depthStencil"in we&&(typeof we.depthStencil=="boolean"?Tn=xn=we.depthStencil:(fr=we.depthStencil,Tn=!1,xn=!1))}var en=null,ce=null,Le=null,Ve=null;if(Array.isArray(Me))en=Me.map(Et);else if(Me)en=[Et(Me)];else for(en=new Array(jn),fe=0;fe<jn;++fe)en[fe]=z(me,Ee,mn,sn,Vn);b(v.webgl_draw_buffers||en.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),b(en.length<=M.maxColorAttachments,"too many color attachments, not supported"),me=me||en[0].width,Ee=Ee||en[0].height,Yn?ce=Et(Yn):Tn&&!xn&&(ce=z(me,Ee,Un,"depth","uint32")),er?Le=Et(er):xn&&!Tn&&(Le=z(me,Ee,!1,"stencil","uint8")),fr?Ve=Et(fr):!Yn&&!er&&xn&&Tn&&(Ve=z(me,Ee,Un,"depth stencil","depth stencil")),b(!!Yn+!!er+!!fr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Gn=null;for(fe=0;fe<en.length;++fe)if(Ct(en[fe],me,Ee),b(!en[fe]||en[fe].texture&&ym.indexOf(en[fe].texture._texture.format)>=0||en[fe].renderbuffer&&Ta.indexOf(en[fe].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+fe+" is invalid"),en[fe]&&en[fe].texture){var gi=hi[en[fe].texture._texture.format]*Ku[en[fe].texture._texture.type];Gn===null?Gn=gi:b(Gn===gi,"all color attachments much have the same number of bits per pixel.")}return Ct(ce,me,Ee),b(!ce||ce.texture&&ce.texture._texture.format===gm||ce.renderbuffer&&ce.renderbuffer._renderbuffer.format===xm,"invalid depth attachment for framebuffer object"),Ct(Le,me,Ee),b(!Le||Le.renderbuffer&&Le.renderbuffer._renderbuffer.format===ts,"invalid stencil attachment for framebuffer object"),Ct(Ve,me,Ee),b(!Ve||Ve.texture&&Ve.texture._texture.format===Od||Ve.renderbuffer&&Ve.renderbuffer._renderbuffer.format===Od,"invalid depth-stencil attachment for framebuffer object"),$t(Ut),Ut.width=me,Ut.height=Ee,Ut.colorAttachments=en,Ut.depthAttachment=ce,Ut.stencilAttachment=Le,Ut.depthStencilAttachment=Ve,ge.color=en.map(J),ge.depth=J(ce),ge.stencil=J(Le),ge.depthStencil=J(Ve),ge.width=Ut.width,ge.height=Ut.height,dt(Ut),ge}function _e(Gt,jt){b(et.next!==Ut,"can not resize a framebuffer which is currently in use");var fe=Math.max(Gt|0,1),me=Math.max(jt|0||fe,1);if(fe===Ut.width&&me===Ut.height)return ge;for(var Ee=Ut.colorAttachments,Tn=0;Tn<Ee.length;++Tn)xt(Ee[Tn],fe,me);return xt(Ut.depthAttachment,fe,me),xt(Ut.stencilAttachment,fe,me),xt(Ut.depthStencilAttachment,fe,me),Ut.width=ge.width=fe,Ut.height=ge.height=me,dt(Ut),ge}return ge(St,Pt),r(ge,{resize:_e,_reglType:"framebuffer",_framebuffer:Ut,destroy:function(){re(Ut),$t(Ut)},use:function(Gt){et.setFBO({framebuffer:ge},Gt)}})}function qt(St){var Pt=Array(6);function Ut(_e){var Gt;b(Pt.indexOf(et.next)<0,"can not update framebuffer which is currently in use");var jt={color:null},fe=0,me=null,Ee="rgba",Tn="uint8",xn=1;if(typeof _e=="number")fe=_e|0;else if(!_e)fe=1;else{b.type(_e,"object","invalid arguments for framebuffer");var Me=_e;if("shape"in Me){var mn=Me.shape;b(Array.isArray(mn)&&mn.length>=2,"invalid shape for framebuffer"),b(mn[0]===mn[1],"cube framebuffer must be square"),fe=mn[0]}else"radius"in Me&&(fe=Me.radius|0),"width"in Me?(fe=Me.width|0,"height"in Me&&b(Me.height===fe,"must be square")):"height"in Me&&(fe=Me.height|0);("color"in Me||"colors"in Me)&&(me=Me.color||Me.colors,Array.isArray(me)&&b(me.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),me||("colorCount"in Me&&(xn=Me.colorCount|0,b(xn>0,"invalid color buffer count")),"colorType"in Me&&(b.oneOf(Me.colorType,It,"invalid color type"),Tn=Me.colorType),"colorFormat"in Me&&(Ee=Me.colorFormat,b.oneOf(Me.colorFormat,bt,"invalid color format for texture"))),"depth"in Me&&(jt.depth=Me.depth),"stencil"in Me&&(jt.stencil=Me.stencil),"depthStencil"in Me&&(jt.depthStencil=Me.depthStencil)}var sn;if(me)if(Array.isArray(me))for(sn=[],Gt=0;Gt<me.length;++Gt)sn[Gt]=me[Gt];else sn=[me];else{sn=Array(xn);var Vn={radius:fe,format:Ee,type:Tn};for(Gt=0;Gt<xn;++Gt)sn[Gt]=tt.createCube(Vn)}for(jt.color=Array(sn.length),Gt=0;Gt<sn.length;++Gt){var jn=sn[Gt];b(typeof jn=="function"&&jn._reglType==="textureCube","invalid cube map"),fe=fe||jn.width,b(jn.width===fe&&jn.height===fe,"invalid cube map shape"),jt.color[Gt]={target:Sa,data:sn[Gt]}}for(Gt=0;Gt<6;++Gt){for(var Yn=0;Yn<sn.length;++Yn)jt.color[Yn].target=Sa+Gt;Gt>0&&(jt.depth=Pt[0].depth,jt.stencil=Pt[0].stencil,jt.depthStencil=Pt[0].depthStencil),Pt[Gt]?Pt[Gt](jt):Pt[Gt]=ht(jt)}return r(Ut,{width:fe,height:fe,color:sn})}function ge(_e){var Gt,jt=_e|0;if(b(jt>0&&jt<=M.maxCubeMapSize,"invalid radius for cube fbo"),jt===Ut.width)return Ut;var fe=Ut.color;for(Gt=0;Gt<fe.length;++Gt)fe[Gt].resize(jt);for(Gt=0;Gt<6;++Gt)Pt[Gt].resize(jt);return Ut.width=Ut.height=jt,Ut}return Ut(St),r(Ut,{faces:Pt,resize:ge,_reglType:"framebufferCube",destroy:function(){Pt.forEach(function(_e){_e.destroy()})}})}function kt(){et.cur=null,et.next=null,et.dirty=!0,br(pt).forEach(function(St){St.framebuffer=_.createFramebuffer(),dt(St)})}return r(et,{getFramebuffer:function(St){if(typeof St=="function"&&St._reglType==="framebuffer"){var Pt=St._framebuffer;if(Pt instanceof Vt)return Pt}return null},create:ht,createCube:qt,clear:function(){br(pt).forEach(re)},restore:kt})}var di=5126,Bd=34962,Ju=34963,Md=["attributes","elements","offset","count","primitive","instances"];function th(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=di,this.offset=0,this.stride=0,this.divisor=0}function Om(_,v,M,tt,lt,K,et){for(var bt=M.maxAttributes,vt=new Array(bt),It=0;It<bt;++It)vt[It]=new th;var Mt=0,Ot={},Ct={Record:th,scope:{},state:vt,currentVAO:null,targetVAO:null,restore:Et()?$t:function(){},createVAO:re,getVAO:J,destroyBuffer:wt,setVAO:Et()?xt:Yt,clear:Et()?pt:function(){}};function wt(dt){for(var ht=0;ht<vt.length;++ht){var qt=vt[ht];qt.buffer===dt&&(_.disableVertexAttribArray(ht),qt.buffer=null)}}function Et(){return v.oes_vertex_array_object}function z(){return v.angle_instanced_arrays}function J(dt){return typeof dt=="function"&&dt._vao?dt._vao:null}function xt(dt){if(dt!==Ct.currentVAO){var ht=Et();dt?ht.bindVertexArrayOES(dt.vao):ht.bindVertexArrayOES(null),Ct.currentVAO=dt}}function Yt(dt){if(dt!==Ct.currentVAO){if(dt)dt.bindAttrs();else{for(var ht=z(),qt=0;qt<vt.length;++qt){var kt=vt[qt];kt.buffer?(_.enableVertexAttribArray(qt),kt.buffer.bind(),_.vertexAttribPointer(qt,kt.size,kt.type,kt.normalized,kt.stride,kt.offfset),ht&&kt.divisor&&ht.vertexAttribDivisorANGLE(qt,kt.divisor)):(_.disableVertexAttribArray(qt),_.vertexAttrib4f(qt,kt.x,kt.y,kt.z,kt.w))}et.elements?_.bindBuffer(Ju,et.elements.buffer.buffer):_.bindBuffer(Ju,null)}Ct.currentVAO=dt}}function pt(){br(Ot).forEach(function(dt){dt.destroy()})}function Vt(){this.id=++Mt,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var dt=Et();dt?this.vao=dt.createVertexArrayOES():this.vao=null,Ot[this.id]=this,this.buffers=[]}Vt.prototype.bindAttrs=function(){for(var dt=z(),ht=this.attributes,qt=0;qt<ht.length;++qt){var kt=ht[qt];kt.buffer?(_.enableVertexAttribArray(qt),_.bindBuffer(Bd,kt.buffer.buffer),_.vertexAttribPointer(qt,kt.size,kt.type,kt.normalized,kt.stride,kt.offset),dt&&kt.divisor&&dt.vertexAttribDivisorANGLE(qt,kt.divisor)):(_.disableVertexAttribArray(qt),_.vertexAttrib4f(qt,kt.x,kt.y,kt.z,kt.w))}for(var St=ht.length;St<bt;++St)_.disableVertexAttribArray(St);var Pt=K.getElements(this.elements);Pt?_.bindBuffer(Ju,Pt.buffer.buffer):_.bindBuffer(Ju,null)},Vt.prototype.refresh=function(){var dt=Et();dt&&(dt.bindVertexArrayOES(this.vao),this.bindAttrs(),Ct.currentVAO=null,dt.bindVertexArrayOES(null))},Vt.prototype.destroy=function(){if(this.vao){var dt=Et();this===Ct.currentVAO&&(Ct.currentVAO=null,dt.bindVertexArrayOES(null)),dt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Ot[this.id]&&(delete Ot[this.id],tt.vaoCount-=1)};function $t(){var dt=Et();dt&&br(Ot).forEach(function(ht){ht.refresh()})}function re(dt){var ht=new Vt;tt.vaoCount+=1;function qt(kt){var St;if(Array.isArray(kt))St=kt,ht.elements&&ht.ownsElements&&ht.elements.destroy(),ht.elements=null,ht.ownsElements=!1,ht.offset=0,ht.count=0,ht.instances=-1,ht.primitive=4;else{if(b(typeof kt=="object","invalid arguments for create vao"),b("attributes"in kt,"must specify attributes for vao"),kt.elements){var Pt=kt.elements;ht.ownsElements?typeof Pt=="function"&&Pt._reglType==="elements"?(ht.elements.destroy(),ht.ownsElements=!1):(ht.elements(Pt),ht.ownsElements=!1):K.getElements(kt.elements)?(ht.elements=kt.elements,ht.ownsElements=!1):(ht.elements=K.create(kt.elements),ht.ownsElements=!0)}else ht.elements=null,ht.ownsElements=!1;St=kt.attributes,ht.offset=0,ht.count=-1,ht.instances=-1,ht.primitive=4,ht.elements&&(ht.count=ht.elements._elements.vertCount,ht.primitive=ht.elements._elements.primType),"offset"in kt&&(ht.offset=kt.offset|0),"count"in kt&&(ht.count=kt.count|0),"instances"in kt&&(ht.instances=kt.instances|0),"primitive"in kt&&(b(kt.primitive in zr,"bad primitive type: "+kt.primitive),ht.primitive=zr[kt.primitive]),b.optional(()=>{for(var Tn=Object.keys(kt),xn=0;xn<Tn.length;++xn)b(Md.indexOf(Tn[xn])>=0,'invalid option for vao: "'+Tn[xn]+'" valid options are '+Md)}),b(Array.isArray(St),"attributes must be an array")}b(St.length<bt,"too many attributes"),b(St.length>0,"must specify at least one attribute");var Ut={},ge=ht.attributes;ge.length=St.length;for(var _e=0;_e<St.length;++_e){var Gt=St[_e],jt=ge[_e]=new th,fe=Gt.data||Gt;if(Array.isArray(fe)||e(fe)||Jn(fe)){var me;ht.buffers[_e]&&(me=ht.buffers[_e],e(fe)&&me._buffer.byteLength>=fe.byteLength?me.subdata(fe):(me.destroy(),ht.buffers[_e]=null)),ht.buffers[_e]||(me=ht.buffers[_e]=lt.create(Gt,Bd,!1,!0)),jt.buffer=lt.getBuffer(me),jt.size=jt.buffer.dimension|0,jt.normalized=!1,jt.type=jt.buffer.dtype,jt.offset=0,jt.stride=0,jt.divisor=0,jt.state=1,Ut[_e]=1}else lt.getBuffer(Gt)?(jt.buffer=lt.getBuffer(Gt),jt.size=jt.buffer.dimension|0,jt.normalized=!1,jt.type=jt.buffer.dtype,jt.offset=0,jt.stride=0,jt.divisor=0,jt.state=1):lt.getBuffer(Gt.buffer)?(jt.buffer=lt.getBuffer(Gt.buffer),jt.size=(+Gt.size||jt.buffer.dimension)|0,jt.normalized=!!Gt.normalized||!1,"type"in Gt?(b.parameter(Gt.type,Xi,"invalid buffer type"),jt.type=Xi[Gt.type]):jt.type=jt.buffer.dtype,jt.offset=(Gt.offset||0)|0,jt.stride=(Gt.stride||0)|0,jt.divisor=(Gt.divisor||0)|0,jt.state=1,b(jt.size>=1&&jt.size<=4,"size must be between 1 and 4"),b(jt.offset>=0,"invalid offset"),b(jt.stride>=0&&jt.stride<=255,"stride must be between 0 and 255"),b(jt.divisor>=0,"divisor must be positive"),b(!jt.divisor||!!v.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Gt?(b(_e>0,"first attribute must not be a constant"),jt.x=+Gt.x||0,jt.y=+Gt.y||0,jt.z=+Gt.z||0,jt.w=+Gt.w||0,jt.state=2):b(!1,"invalid attribute spec for location "+_e)}for(var Ee=0;Ee<ht.buffers.length;++Ee)!Ut[Ee]&&ht.buffers[Ee]&&(ht.buffers[Ee].destroy(),ht.buffers[Ee]=null);return ht.refresh(),qt}return qt.destroy=function(){for(var kt=0;kt<ht.buffers.length;++kt)ht.buffers[kt]&&ht.buffers[kt].destroy();ht.buffers.length=0,ht.ownsElements&&(ht.elements.destroy(),ht.elements=null,ht.ownsElements=!1),ht.destroy()},qt._vao=ht,qt._reglType="vao",qt(dt)}return Ct}var eh=35632,Ld=35633,Bm=35718,Mm=35721;function nh(_,v,M,tt){var lt={},K={};function et(z,J,xt,Yt){this.name=z,this.id=J,this.location=xt,this.info=Yt}function bt(z,J){for(var xt=0;xt<z.length;++xt)if(z[xt].id===J.id){z[xt].location=J.location;return}z.push(J)}function vt(z,J,xt){var Yt=z===eh?lt:K,pt=Yt[J];if(!pt){var Vt=v.str(J);pt=_.createShader(z),_.shaderSource(pt,Vt),_.compileShader(pt),b.shaderError(_,pt,Vt,z,xt),Yt[J]=pt}return pt}var It={},Mt=[],Ot=0;function Ct(z,J){this.id=Ot++,this.fragId=z,this.vertId=J,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,tt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function wt(z,J,xt){var Yt,pt,Vt=vt(eh,z.fragId),$t=vt(Ld,z.vertId),re=z.program=_.createProgram();if(_.attachShader(re,Vt),_.attachShader(re,$t),xt)for(Yt=0;Yt<xt.length;++Yt){var dt=xt[Yt];_.bindAttribLocation(re,dt[0],dt[1])}_.linkProgram(re),b.linkError(_,re,v.str(z.fragId),v.str(z.vertId),J);var ht=_.getProgramParameter(re,Bm);tt.profile&&(z.stats.uniformsCount=ht);var qt=z.uniforms;for(Yt=0;Yt<ht;++Yt)if(pt=_.getActiveUniform(re,Yt),pt){if(pt.size>1)for(var kt=0;kt<pt.size;++kt){var St=pt.name.replace("[0]","["+kt+"]");bt(qt,new et(St,v.id(St),_.getUniformLocation(re,St),pt))}var Pt=pt.name;pt.size>1&&(Pt=Pt.replace("[0]","")),bt(qt,new et(Pt,v.id(Pt),_.getUniformLocation(re,Pt),pt))}var Ut=_.getProgramParameter(re,Mm);tt.profile&&(z.stats.attributesCount=Ut);var ge=z.attributes;for(Yt=0;Yt<Ut;++Yt)pt=_.getActiveAttrib(re,Yt),pt&&bt(ge,new et(pt.name,v.id(pt.name),_.getAttribLocation(re,pt.name),pt))}tt.profile&&(M.getMaxUniformsCount=function(){var z=0;return Mt.forEach(function(J){J.stats.uniformsCount>z&&(z=J.stats.uniformsCount)}),z},M.getMaxAttributesCount=function(){var z=0;return Mt.forEach(function(J){J.stats.attributesCount>z&&(z=J.stats.attributesCount)}),z});function Et(){lt={},K={};for(var z=0;z<Mt.length;++z)wt(Mt[z],null,Mt[z].attributes.map(function(J){return[J.location,J.name]}))}return{clear:function(){var z=_.deleteShader.bind(_);br(lt).forEach(z),lt={},br(K).forEach(z),K={},Mt.forEach(function(J){_.deleteProgram(J.program)}),Mt.length=0,It={},M.shaderCount=0},program:function(z,J,xt,Yt){b.command(z>=0,"missing vertex shader",xt),b.command(J>=0,"missing fragment shader",xt);var pt=It[J];pt||(pt=It[J]={});var Vt=pt[z];if(Vt&&(Vt.refCount++,!Yt))return Vt;var $t=new Ct(J,z);return M.shaderCount++,wt($t,xt,Yt),Vt||(pt[z]=$t),Mt.push($t),r($t,{destroy:function(){if($t.refCount--,$t.refCount<=0){_.deleteProgram($t.program);var re=Mt.indexOf($t);Mt.splice(re,1),M.shaderCount--}pt[$t.vertId].refCount<=0&&(_.deleteShader(K[$t.vertId]),delete K[$t.vertId],delete It[$t.fragId][$t.vertId]),Object.keys(It[$t.fragId]).length||(_.deleteShader(lt[$t.fragId]),delete lt[$t.fragId],delete It[$t.fragId])}})},restore:Et,shader:vt,frag:-1,vert:-1}}var Rf=6408,Ls=5121,Lm=3333,Nf=5126;function Rm(_,v,M,tt,lt,K,et){function bt(Mt){var Ot;v.next===null?(b(lt.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ot=Ls):(b(v.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ot=v.next.colorAttachments[0].texture._texture.type,b.optional(function(){K.oes_texture_float?(b(Ot===Ls||Ot===Nf,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ot===Nf&&b(et.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):b(Ot===Ls,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Ct=0,wt=0,Et=tt.framebufferWidth,z=tt.framebufferHeight,J=null;e(Mt)?J=Mt:Mt&&(b.type(Mt,"object","invalid arguments to regl.read()"),Ct=Mt.x|0,wt=Mt.y|0,b(Ct>=0&&Ct<tt.framebufferWidth,"invalid x offset for regl.read"),b(wt>=0&&wt<tt.framebufferHeight,"invalid y offset for regl.read"),Et=(Mt.width||tt.framebufferWidth-Ct)|0,z=(Mt.height||tt.framebufferHeight-wt)|0,J=Mt.data||null),J&&(Ot===Ls?b(J instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ot===Nf&&b(J instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),b(Et>0&&Et+Ct<=tt.framebufferWidth,"invalid width for read pixels"),b(z>0&&z+wt<=tt.framebufferHeight,"invalid height for read pixels"),M();var xt=Et*z*4;return J||(Ot===Ls?J=new Uint8Array(xt):Ot===Nf&&(J=J||new Float32Array(xt))),b.isTypedArray(J,"data buffer for regl.read() must be a typedarray"),b(J.byteLength>=xt,"data buffer for regl.read() too small"),_.pixelStorei(Lm,4),_.readPixels(Ct,wt,Et,z,Rf,Ot,J),J}function vt(Mt){var Ot;return v.setFBO({framebuffer:Mt.framebuffer},function(){Ot=bt(Mt)}),Ot}function It(Mt){return!Mt||!("framebuffer"in Mt)?bt(Mt):vt(Mt)}return It}function Nr(_){return Array.prototype.slice.call(_)}function Rs(_){return Nr(_).join("")}function Ia(){var _=0,v=[],M=[];function tt(Ot){for(var Ct=0;Ct<M.length;++Ct)if(M[Ct]===Ot)return v[Ct];var wt="g"+_++;return v.push(wt),M.push(Ot),wt}function lt(){var Ot=[];function Ct(){Ot.push.apply(Ot,Nr(arguments))}var wt=[];function Et(){var z="v"+_++;return wt.push(z),arguments.length>0&&(Ot.push(z,"="),Ot.push.apply(Ot,Nr(arguments)),Ot.push(";")),z}return r(Ct,{def:Et,toString:function(){return Rs([wt.length>0?"var "+wt.join(",")+";":"",Rs(Ot)])}})}function K(){var Ot=lt(),Ct=lt(),wt=Ot.toString,Et=Ct.toString;function z(J,xt){Ct(J,xt,"=",Ot.def(J,xt),";")}return r(function(){Ot.apply(Ot,Nr(arguments))},{def:Ot.def,entry:Ot,exit:Ct,save:z,set:function(J,xt,Yt){z(J,xt),Ot(J,xt,"=",Yt,";")},toString:function(){return wt()+Et()}})}function et(){var Ot=Rs(arguments),Ct=K(),wt=K(),Et=Ct.toString,z=wt.toString;return r(Ct,{then:function(){return Ct.apply(Ct,Nr(arguments)),this},else:function(){return wt.apply(wt,Nr(arguments)),this},toString:function(){var J=z();return J&&(J="else{"+J+"}"),Rs(["if(",Ot,"){",Et(),"}",J])}})}var bt=lt(),vt={};function It(Ot,Ct){var wt=[];function Et(){var pt="a"+wt.length;return wt.push(pt),pt}Ct=Ct||0;for(var z=0;z<Ct;++z)Et();var J=K(),xt=J.toString,Yt=vt[Ot]=r(J,{arg:Et,toString:function(){return Rs(["function(",wt.join(),"){",xt(),"}"])}});return Yt}function Mt(){var Ot=['"use strict";',bt,"return {"];Object.keys(vt).forEach(function(Et){Ot.push('"',Et,'":',vt[Et].toString(),",")}),Ot.push("}");var Ct=Rs(Ot).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),wt=Function.apply(null,v.concat(Ct));return wt.apply(null,M)}return{global:bt,link:tt,block:lt,proc:It,scope:K,cond:et,compile:Mt}}var pr="xyzw".split(""),Rd=5121,Oa=1,Qu=2,Ba=0,Mi=1,tc=2,rh=3,Ma=4,Nd=5,ih=6,or="dither",ec="blend.enable",sh="blend.color",qr="blend.equation",Df="blend.func",Ff="depth.enable",Ns="depth.func",ah="depth.range",Sr="depth.mask",Cf="colorMask",Dd="cull.enable",Fd="cull.face",oh="frontFace",kf="lineWidth",Cd="polygonOffset.enable",La="polygonOffset.offset",fh="sample.alpha",kd="sample.enable",uh="sample.coverage",Co="stencil.enable",Pd="stencil.mask",ch="stencil.func",Pf="stencil.opFront",ko="stencil.opBack",zd="scissor.enable",nc="scissor.box",es="viewport",Po="profile",ns="framebuffer",zf="vert",Ra="frag",Ds="elements",Fs="primitive",Cs="count",Na="offset",rc="instances",zo="vao",ic="Width",lh="Height",Da=ns+ic,Uo=ns+lh,hh=es+ic,Ud=es+lh,sc="drawingBuffer",Gd=sc+ic,ac=sc+lh,Ye=[Df,qr,ch,Pf,ko,uh,es,nc,La],Go=34962,dh=34963,Uf=35632,$d=35633,Vd=3553,Nm=34067,Zr=2884,Dm=3042,oc=3024,_h=2960,jd=2929,Wd=3089,Gr=32823,ks=32926,ph=32928,fc=5126,Fa=35664,Gf=35665,$o=35666,uc=5124,Vo=35667,jo=35668,_i=35669,mh=35670,pi=35671,$f=35672,Vf=35673,Ca=35674,jf=35675,Wf=35676,Yf=35678,Wo=35680,cc=4,Hf=1028,Ps=1029,gh=2304,Ar=2305,Li=32775,Fm=32776,Cm=519,mi=7680,ka=0,yh=1,vh=32774,km=513,bh=36160,Yo=36064,Dr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Yd=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Pa={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},rs={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Xf={frag:Uf,vert:$d},lc={cw:gh,ccw:Ar};function za(_){return Array.isArray(_)||e(_)||Jn(_)}function hc(_){return _.sort(function(v,M){return v===es?-1:M===es?1:v<M?-1:1})}function Pn(_,v,M,tt){this.thisDep=_,this.contextDep=v,this.propDep=M,this.append=tt}function zs(_){return _&&!(_.thisDep||_.contextDep||_.propDep)}function zn(_){return new Pn(!1,!1,!1,_)}function mr(_,v){var M=_.type;if(M===Ba){var tt=_.data.length;return new Pn(!0,tt>=1,tt>=2,v)}else if(M===Ma){var lt=_.data;return new Pn(lt.thisDep,lt.contextDep,lt.propDep,v)}else{if(M===Nd)return new Pn(!1,!1,!1,v);if(M===ih){for(var K=!1,et=!1,bt=!1,vt=0;vt<_.data.length;++vt){var It=_.data[vt];if(It.type===Mi)bt=!0;else if(It.type===tc)et=!0;else if(It.type===rh)K=!0;else if(It.type===Ba){K=!0;var Mt=It.data;Mt>=1&&(et=!0),Mt>=2&&(bt=!0)}else It.type===Ma&&(K=K||It.data.thisDep,et=et||It.data.contextDep,bt=bt||It.data.propDep)}return new Pn(K,et,bt,v)}else return new Pn(M===rh,M===tc,M===Mi,v)}}var wh=new Pn(!1,!1,!1,function(){});function xh(_,v,M,tt,lt,K,et,bt,vt,It,Mt,Ot,Ct,wt,Et){var z=It.Record,J={add:32774,subtract:32778,"reverse subtract":32779};M.ext_blend_minmax&&(J.min=Li,J.max=Fm);var xt=M.angle_instanced_arrays,Yt=M.webgl_draw_buffers,pt=M.oes_vertex_array_object,Vt={dirty:!0,profile:Et.profile},$t={},re=[],dt={},ht={};function qt(S){return S.replace(".","_")}function kt(S,g,R){var U=qt(S);re.push(S),$t[U]=Vt[U]=!!R,dt[U]=g}function St(S,g,R){var U=qt(S);re.push(S),Array.isArray(R)?(Vt[U]=R.slice(),$t[U]=R.slice()):Vt[U]=$t[U]=R,ht[U]=g}kt(or,oc),kt(ec,Dm),St(sh,"blendColor",[0,0,0,0]),St(qr,"blendEquationSeparate",[vh,vh]),St(Df,"blendFuncSeparate",[yh,ka,yh,ka]),kt(Ff,jd,!0),St(Ns,"depthFunc",km),St(ah,"depthRange",[0,1]),St(Sr,"depthMask",!0),St(Cf,Cf,[!0,!0,!0,!0]),kt(Dd,Zr),St(Fd,"cullFace",Ps),St(oh,oh,Ar),St(kf,kf,1),kt(Cd,Gr),St(La,"polygonOffset",[0,0]),kt(fh,ks),kt(kd,ph),St(uh,"sampleCoverage",[1,!1]),kt(Co,_h),St(Pd,"stencilMask",-1),St(ch,"stencilFunc",[Cm,0,-1]),St(Pf,"stencilOpSeparate",[Hf,mi,mi,mi]),St(ko,"stencilOpSeparate",[Ps,mi,mi,mi]),kt(zd,Wd),St(nc,"scissor",[0,0,_.drawingBufferWidth,_.drawingBufferHeight]),St(es,es,[0,0,_.drawingBufferWidth,_.drawingBufferHeight]);var Pt={gl:_,context:Ct,strings:v,next:$t,current:Vt,draw:Ot,elements:K,buffer:lt,shader:Mt,attributes:It.state,vao:It,uniforms:vt,framebuffer:bt,extensions:M,timer:wt,isBufferArgs:za},Ut={primTypes:zr,compareFuncs:Pa,blendFuncs:Dr,blendEquations:J,stencilOps:rs,glTypes:Xi,orientationType:lc};b.optional(function(){Pt.isArrayLike=Bn}),Yt&&(Ut.backBuffer=[Ps],Ut.drawBuffer=vr(tt.maxDrawbuffers,function(S){return S===0?[0]:vr(S,function(g){return Yo+g})}));var ge=0;function _e(){var S=Ia(),g=S.link,R=S.global;S.id=ge++,S.batchId="0";var U=g(Pt),$=S.shared={props:"a0"};Object.keys(Pt).forEach(function(O){$[O]=R.def(U,".",O)}),b.optional(function(){S.CHECK=g(b),S.commandStr=b.guessCommand(),S.command=g(S.commandStr),S.assert=function(O,E,X){O("if(!(",E,"))",this.CHECK,".commandRaise(",g(X),",",this.command,");")},Ut.invalidBlendCombinations=Yd});var D=S.next={},L=S.current={};Object.keys(ht).forEach(function(O){Array.isArray(Vt[O])&&(D[O]=R.def($.next,".",O),L[O]=R.def($.current,".",O))});var P=S.constants={};Object.keys(Ut).forEach(function(O){P[O]=R.def(JSON.stringify(Ut[O]))}),S.invoke=function(O,E){switch(E.type){case Ba:var X=["this",$.context,$.props,S.batchId];return O.def(g(E.data),".call(",X.slice(0,Math.max(E.data.length+1,4)),")");case Mi:return O.def($.props,E.data);case tc:return O.def($.context,E.data);case rh:return O.def("this",E.data);case Ma:return E.data.append(S,O),E.data.ref;case Nd:return E.data.toString();case ih:return E.data.map(function(j){return S.invoke(O,j)})}},S.attribCache={};var A={};return S.scopeAttrib=function(O){var E=v.id(O);if(E in A)return A[E];var X=It.scope[E];X||(X=It.scope[E]=new z);var j=A[E]=g(X);return j},S}function Gt(S){var g=S.static,R=S.dynamic,U;if(Po in g){var $=!!g[Po];U=zn(function(L,P){return $}),U.enable=$}else if(Po in R){var D=R[Po];U=mr(D,function(L,P){return L.invoke(P,D)})}return U}function jt(S,g){var R=S.static,U=S.dynamic;if(ns in R){var $=R[ns];return $?($=bt.getFramebuffer($),b.command($,"invalid framebuffer object"),zn(function(L,P){var A=L.link($),O=L.shared;P.set(O.framebuffer,".next",A);var E=O.context;return P.set(E,"."+Da,A+".width"),P.set(E,"."+Uo,A+".height"),A})):zn(function(L,P){var A=L.shared;P.set(A.framebuffer,".next","null");var O=A.context;return P.set(O,"."+Da,O+"."+Gd),P.set(O,"."+Uo,O+"."+ac),"null"})}else if(ns in U){var D=U[ns];return mr(D,function(L,P){var A=L.invoke(P,D),O=L.shared,E=O.framebuffer,X=P.def(E,".getFramebuffer(",A,")");b.optional(function(){L.assert(P,"!"+A+"||"+X,"invalid framebuffer object")}),P.set(E,".next",X);var j=O.context;return P.set(j,"."+Da,X+"?"+X+".width:"+j+"."+Gd),P.set(j,"."+Uo,X+"?"+X+".height:"+j+"."+ac),X})}else return null}function fe(S,g,R){var U=S.static,$=S.dynamic;function D(A){if(A in U){var O=U[A];b.commandType(O,"object","invalid "+A,R.commandStr);var E=!0,X=O.x|0,j=O.y|0,ct,_t;return"width"in O?(ct=O.width|0,b.command(ct>=0,"invalid "+A,R.commandStr)):E=!1,"height"in O?(_t=O.height|0,b.command(_t>=0,"invalid "+A,R.commandStr)):E=!1,new Pn(!E&&g&&g.thisDep,!E&&g&&g.contextDep,!E&&g&&g.propDep,function(ae,Ht){var mt=ae.shared.context,ot=ct;"width"in O||(ot=Ht.def(mt,".",Da,"-",X));var te=_t;return"height"in O||(te=Ht.def(mt,".",Uo,"-",j)),[X,j,ot,te]})}else if(A in $){var Nt=$[A],he=mr(Nt,function(ae,Ht){var mt=ae.invoke(Ht,Nt);b.optional(function(){ae.assert(Ht,mt+"&&typeof "+mt+'==="object"',"invalid "+A)});var ot=ae.shared.context,te=Ht.def(mt,".x|0"),Jt=Ht.def(mt,".y|0"),le=Ht.def('"width" in ',mt,"?",mt,".width|0:","(",ot,".",Da,"-",te,")"),nn=Ht.def('"height" in ',mt,"?",mt,".height|0:","(",ot,".",Uo,"-",Jt,")");return b.optional(function(){ae.assert(Ht,le+">=0&&"+nn+">=0","invalid "+A)}),[te,Jt,le,nn]});return g&&(he.thisDep=he.thisDep||g.thisDep,he.contextDep=he.contextDep||g.contextDep,he.propDep=he.propDep||g.propDep),he}else return g?new Pn(g.thisDep,g.contextDep,g.propDep,function(ae,Ht){var mt=ae.shared.context;return[0,0,Ht.def(mt,".",Da),Ht.def(mt,".",Uo)]}):null}var L=D(es);if(L){var P=L;L=new Pn(L.thisDep,L.contextDep,L.propDep,function(A,O){var E=P.append(A,O),X=A.shared.context;return O.set(X,"."+hh,E[2]),O.set(X,"."+Ud,E[3]),E})}return{viewport:L,scissor_box:D(nc)}}function me(S,g){var R=S.static,U=typeof R[Ra]=="string"&&typeof R[zf]=="string";if(U){if(Object.keys(g.dynamic).length>0)return null;var $=g.static,D=Object.keys($);if(D.length>0&&typeof $[D[0]]=="number"){for(var L=[],P=0;P<D.length;++P)b(typeof $[D[P]]=="number","must specify all vertex attribute locations when using vaos"),L.push([$[D[P]]|0,D[P]]);return L}}return null}function Ee(S,g,R){var U=S.static,$=S.dynamic;function D(E){if(E in U){var X=v.id(U[E]);b.optional(function(){Mt.shader(Xf[E],X,b.guessCommand())});var j=zn(function(){return X});return j.id=X,j}else if(E in $){var ct=$[E];return mr(ct,function(_t,Nt){var he=_t.invoke(Nt,ct),ae=Nt.def(_t.shared.strings,".id(",he,")");return b.optional(function(){Nt(_t.shared.shader,".shader(",Xf[E],",",ae,",",_t.command,");")}),ae})}return null}var L=D(Ra),P=D(zf),A=null,O;return zs(L)&&zs(P)?(A=Mt.program(P.id,L.id,null,R),O=zn(function(E,X){return E.link(A)})):O=new Pn(L&&L.thisDep||P&&P.thisDep,L&&L.contextDep||P&&P.contextDep,L&&L.propDep||P&&P.propDep,function(E,X){var j=E.shared.shader,ct;L?ct=L.append(E,X):ct=X.def(j,".",Ra);var _t;P?_t=P.append(E,X):_t=X.def(j,".",zf);var Nt=j+".program("+_t+","+ct;return b.optional(function(){Nt+=","+E.command}),X.def(Nt+")")}),{frag:L,vert:P,progVar:O,program:A}}function Tn(S,g){var R=S.static,U=S.dynamic,$={},D=!1;function L(){if(zo in R){var Ht=R[zo];return Ht!==null&&It.getVAO(Ht)===null&&(Ht=It.createVAO(Ht)),D=!0,$.vao=Ht,zn(function(ot){var te=It.getVAO(Ht);return te?ot.link(te):"null"})}else if(zo in U){D=!0;var mt=U[zo];return mr(mt,function(ot,te){var Jt=ot.invoke(te,mt);return te.def(ot.shared.vao+".getVAO("+Jt+")")})}return null}var P=L(),A=!1;function O(){if(Ds in R){var Ht=R[Ds];if($.elements=Ht,za(Ht)){var mt=$.elements=K.create(Ht,!0);Ht=K.getElements(mt),A=!0}else Ht&&(Ht=K.getElements(Ht),A=!0,b.command(Ht,"invalid elements",g.commandStr));var ot=zn(function(Jt,le){if(Ht){var nn=Jt.link(Ht);return Jt.ELEMENTS=nn,nn}return Jt.ELEMENTS=null,null});return ot.value=Ht,ot}else if(Ds in U){A=!0;var te=U[Ds];return mr(te,function(Jt,le){var nn=Jt.shared,cr=nn.isBufferArgs,Ga=nn.elements,ss=Jt.invoke(le,te),Ni=le.def("null"),Gs=le.def(cr,"(",ss,")"),$a=Jt.cond(Gs).then(Ni,"=",Ga,".createStream(",ss,");").else(Ni,"=",Ga,".getElements(",ss,");");return b.optional(function(){Jt.assert($a.else,"!"+ss+"||"+Ni,"invalid elements")}),le.entry($a),le.exit(Jt.cond(Gs).then(Ga,".destroyStream(",Ni,");")),Jt.ELEMENTS=Ni,Ni})}else if(D)return new Pn(P.thisDep,P.contextDep,P.propDep,function(Jt,le){return le.def(Jt.shared.vao+".currentVAO?"+Jt.shared.elements+".getElements("+Jt.shared.vao+".currentVAO.elements):null")});return null}var E=O();function X(){if(Fs in R){var Ht=R[Fs];return $.primitive=Ht,b.commandParameter(Ht,zr,"invalid primitve",g.commandStr),zn(function(ot,te){return zr[Ht]})}else if(Fs in U){var mt=U[Fs];return mr(mt,function(ot,te){var Jt=ot.constants.primTypes,le=ot.invoke(te,mt);return b.optional(function(){ot.assert(te,le+" in "+Jt,"invalid primitive, must be one of "+Object.keys(zr))}),te.def(Jt,"[",le,"]")})}else{if(A)return zs(E)?E.value?zn(function(ot,te){return te.def(ot.ELEMENTS,".primType")}):zn(function(){return cc}):new Pn(E.thisDep,E.contextDep,E.propDep,function(ot,te){var Jt=ot.ELEMENTS;return te.def(Jt,"?",Jt,".primType:",cc)});if(D)return new Pn(P.thisDep,P.contextDep,P.propDep,function(ot,te){return te.def(ot.shared.vao+".currentVAO?"+ot.shared.vao+".currentVAO.primitive:"+cc)})}return null}function j(Ht,mt){if(Ht in R){var ot=R[Ht]|0;return mt?$.offset=ot:$.instances=ot,b.command(!mt||ot>=0,"invalid "+Ht,g.commandStr),zn(function(Jt,le){return mt&&(Jt.OFFSET=ot),ot})}else if(Ht in U){var te=U[Ht];return mr(te,function(Jt,le){var nn=Jt.invoke(le,te);return mt&&(Jt.OFFSET=nn,b.optional(function(){Jt.assert(le,nn+">=0","invalid "+Ht)})),nn})}else if(mt){if(A)return zn(function(Jt,le){return Jt.OFFSET=0,0});if(D)return new Pn(P.thisDep,P.contextDep,P.propDep,function(Jt,le){return le.def(Jt.shared.vao+".currentVAO?"+Jt.shared.vao+".currentVAO.offset:0")})}else if(D)return new Pn(P.thisDep,P.contextDep,P.propDep,function(Jt,le){return le.def(Jt.shared.vao+".currentVAO?"+Jt.shared.vao+".currentVAO.instances:-1")});return null}var ct=j(Na,!0);function _t(){if(Cs in R){var Ht=R[Cs]|0;return $.count=Ht,b.command(typeof Ht=="number"&&Ht>=0,"invalid vertex count",g.commandStr),zn(function(){return Ht})}else if(Cs in U){var mt=U[Cs];return mr(mt,function(le,nn){var cr=le.invoke(nn,mt);return b.optional(function(){le.assert(nn,"typeof "+cr+'==="number"&&'+cr+">=0&&"+cr+"===("+cr+"|0)","invalid vertex count")}),cr})}else if(A)if(zs(E)){if(E)return ct?new Pn(ct.thisDep,ct.contextDep,ct.propDep,function(le,nn){var cr=nn.def(le.ELEMENTS,".vertCount-",le.OFFSET);return b.optional(function(){le.assert(nn,cr+">=0","invalid vertex offset/element buffer too small")}),cr}):zn(function(le,nn){return nn.def(le.ELEMENTS,".vertCount")});var ot=zn(function(){return-1});return b.optional(function(){ot.MISSING=!0}),ot}else{var te=new Pn(E.thisDep||ct.thisDep,E.contextDep||ct.contextDep,E.propDep||ct.propDep,function(le,nn){var cr=le.ELEMENTS;return le.OFFSET?nn.def(cr,"?",cr,".vertCount-",le.OFFSET,":-1"):nn.def(cr,"?",cr,".vertCount:-1")});return b.optional(function(){te.DYNAMIC=!0}),te}else if(D){var Jt=new Pn(P.thisDep,P.contextDep,P.propDep,function(le,nn){return nn.def(le.shared.vao,".currentVAO?",le.shared.vao,".currentVAO.count:-1")});return Jt}return null}var Nt=X(),he=_t(),ae=j(rc,!1);return{elements:E,primitive:Nt,count:he,instances:ae,offset:ct,vao:P,vaoActive:D,elementsActive:A,static:$}}function xn(S,g){var R=S.static,U=S.dynamic,$={};return re.forEach(function(D){var L=qt(D);function P(A,O){if(D in R){var E=A(R[D]);$[L]=zn(function(){return E})}else if(D in U){var X=U[D];$[L]=mr(X,function(j,ct){return O(j,ct,j.invoke(ct,X))})}}switch(D){case Dd:case ec:case or:case Co:case Ff:case zd:case Cd:case fh:case kd:case Sr:return P(function(A){return b.commandType(A,"boolean",D,g.commandStr),A},function(A,O,E){return b.optional(function(){A.assert(O,"typeof "+E+'==="boolean"',"invalid flag "+D,A.commandStr)}),E});case Ns:return P(function(A){return b.commandParameter(A,Pa,"invalid "+D,g.commandStr),Pa[A]},function(A,O,E){var X=A.constants.compareFuncs;return b.optional(function(){A.assert(O,E+" in "+X,"invalid "+D+", must be one of "+Object.keys(Pa))}),O.def(X,"[",E,"]")});case ah:return P(function(A){return b.command(Bn(A)&&A.length===2&&typeof A[0]=="number"&&typeof A[1]=="number"&&A[0]<=A[1],"depth range is 2d array",g.commandStr),A},function(A,O,E){b.optional(function(){A.assert(O,A.shared.isArrayLike+"("+E+")&&"+E+".length===2&&typeof "+E+'[0]==="number"&&typeof '+E+'[1]==="number"&&'+E+"[0]<="+E+"[1]","depth range must be a 2d array")});var X=O.def("+",E,"[0]"),j=O.def("+",E,"[1]");return[X,j]});case Df:return P(function(A){b.commandType(A,"object","blend.func",g.commandStr);var O="srcRGB"in A?A.srcRGB:A.src,E="srcAlpha"in A?A.srcAlpha:A.src,X="dstRGB"in A?A.dstRGB:A.dst,j="dstAlpha"in A?A.dstAlpha:A.dst;return b.commandParameter(O,Dr,L+".srcRGB",g.commandStr),b.commandParameter(E,Dr,L+".srcAlpha",g.commandStr),b.commandParameter(X,Dr,L+".dstRGB",g.commandStr),b.commandParameter(j,Dr,L+".dstAlpha",g.commandStr),b.command(Yd.indexOf(O+", "+X)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+O+", "+X+")",g.commandStr),[Dr[O],Dr[X],Dr[E],Dr[j]]},function(A,O,E){var X=A.constants.blendFuncs;b.optional(function(){A.assert(O,E+"&&typeof "+E+'==="object"',"invalid blend func, must be an object")});function j(mt,ot){var te=O.def('"',mt,ot,'" in ',E,"?",E,".",mt,ot,":",E,".",mt);return b.optional(function(){A.assert(O,te+" in "+X,"invalid "+D+"."+mt+ot+", must be one of "+Object.keys(Dr))}),te}var ct=j("src","RGB"),_t=j("dst","RGB");b.optional(function(){var mt=A.constants.invalidBlendCombinations;A.assert(O,mt+".indexOf("+ct+'+", "+'+_t+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Nt=O.def(X,"[",ct,"]"),he=O.def(X,"[",j("src","Alpha"),"]"),ae=O.def(X,"[",_t,"]"),Ht=O.def(X,"[",j("dst","Alpha"),"]");return[Nt,ae,he,Ht]});case qr:return P(function(A){if(typeof A=="string")return b.commandParameter(A,J,"invalid "+D,g.commandStr),[J[A],J[A]];if(typeof A=="object")return b.commandParameter(A.rgb,J,D+".rgb",g.commandStr),b.commandParameter(A.alpha,J,D+".alpha",g.commandStr),[J[A.rgb],J[A.alpha]];b.commandRaise("invalid blend.equation",g.commandStr)},function(A,O,E){var X=A.constants.blendEquations,j=O.def(),ct=O.def(),_t=A.cond("typeof ",E,'==="string"');return b.optional(function(){function Nt(he,ae,Ht){A.assert(he,Ht+" in "+X,"invalid "+ae+", must be one of "+Object.keys(J))}Nt(_t.then,D,E),A.assert(_t.else,E+"&&typeof "+E+'==="object"',"invalid "+D),Nt(_t.else,D+".rgb",E+".rgb"),Nt(_t.else,D+".alpha",E+".alpha")}),_t.then(j,"=",ct,"=",X,"[",E,"];"),_t.else(j,"=",X,"[",E,".rgb];",ct,"=",X,"[",E,".alpha];"),O(_t),[j,ct]});case sh:return P(function(A){return b.command(Bn(A)&&A.length===4,"blend.color must be a 4d array",g.commandStr),vr(4,function(O){return+A[O]})},function(A,O,E){return b.optional(function(){A.assert(O,A.shared.isArrayLike+"("+E+")&&"+E+".length===4","blend.color must be a 4d array")}),vr(4,function(X){return O.def("+",E,"[",X,"]")})});case Pd:return P(function(A){return b.commandType(A,"number",L,g.commandStr),A|0},function(A,O,E){return b.optional(function(){A.assert(O,"typeof "+E+'==="number"',"invalid stencil.mask")}),O.def(E,"|0")});case ch:return P(function(A){b.commandType(A,"object",L,g.commandStr);var O=A.cmp||"keep",E=A.ref||0,X="mask"in A?A.mask:-1;return b.commandParameter(O,Pa,D+".cmp",g.commandStr),b.commandType(E,"number",D+".ref",g.commandStr),b.commandType(X,"number",D+".mask",g.commandStr),[Pa[O],E,X]},function(A,O,E){var X=A.constants.compareFuncs;b.optional(function(){function Nt(){A.assert(O,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Nt(E+"&&typeof ",E,'==="object"'),Nt('!("cmp" in ',E,")||(",E,".cmp in ",X,")")});var j=O.def('"cmp" in ',E,"?",X,"[",E,".cmp]",":",mi),ct=O.def(E,".ref|0"),_t=O.def('"mask" in ',E,"?",E,".mask|0:-1");return[j,ct,_t]});case Pf:case ko:return P(function(A){b.commandType(A,"object",L,g.commandStr);var O=A.fail||"keep",E=A.zfail||"keep",X=A.zpass||"keep";return b.commandParameter(O,rs,D+".fail",g.commandStr),b.commandParameter(E,rs,D+".zfail",g.commandStr),b.commandParameter(X,rs,D+".zpass",g.commandStr),[D===ko?Ps:Hf,rs[O],rs[E],rs[X]]},function(A,O,E){var X=A.constants.stencilOps;b.optional(function(){A.assert(O,E+"&&typeof "+E+'==="object"',"invalid "+D)});function j(ct){return b.optional(function(){A.assert(O,'!("'+ct+'" in '+E+")||("+E+"."+ct+" in "+X+")","invalid "+D+"."+ct+", must be one of "+Object.keys(rs))}),O.def('"',ct,'" in ',E,"?",X,"[",E,".",ct,"]:",mi)}return[D===ko?Ps:Hf,j("fail"),j("zfail"),j("zpass")]});case La:return P(function(A){b.commandType(A,"object",L,g.commandStr);var O=A.factor|0,E=A.units|0;return b.commandType(O,"number",L+".factor",g.commandStr),b.commandType(E,"number",L+".units",g.commandStr),[O,E]},function(A,O,E){b.optional(function(){A.assert(O,E+"&&typeof "+E+'==="object"',"invalid "+D)});var X=O.def(E,".factor|0"),j=O.def(E,".units|0");return[X,j]});case Fd:return P(function(A){var O=0;return A==="front"?O=Hf:A==="back"&&(O=Ps),b.command(!!O,L,g.commandStr),O},function(A,O,E){return b.optional(function(){A.assert(O,E+'==="front"||'+E+'==="back"',"invalid cull.face")}),O.def(E,'==="front"?',Hf,":",Ps)});case kf:return P(function(A){return b.command(typeof A=="number"&&A>=tt.lineWidthDims[0]&&A<=tt.lineWidthDims[1],"invalid line width, must be a positive number between "+tt.lineWidthDims[0]+" and "+tt.lineWidthDims[1],g.commandStr),A},function(A,O,E){return b.optional(function(){A.assert(O,"typeof "+E+'==="number"&&'+E+">="+tt.lineWidthDims[0]+"&&"+E+"<="+tt.lineWidthDims[1],"invalid line width")}),E});case oh:return P(function(A){return b.commandParameter(A,lc,L,g.commandStr),lc[A]},function(A,O,E){return b.optional(function(){A.assert(O,E+'==="cw"||'+E+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),O.def(E+'==="cw"?'+gh+":"+Ar)});case Cf:return P(function(A){return b.command(Bn(A)&&A.length===4,"color.mask must be length 4 array",g.commandStr),A.map(function(O){return!!O})},function(A,O,E){return b.optional(function(){A.assert(O,A.shared.isArrayLike+"("+E+")&&"+E+".length===4","invalid color.mask")}),vr(4,function(X){return"!!"+E+"["+X+"]"})});case uh:return P(function(A){b.command(typeof A=="object"&&A,L,g.commandStr);var O="value"in A?A.value:1,E=!!A.invert;return b.command(typeof O=="number"&&O>=0&&O<=1,"sample.coverage.value must be a number between 0 and 1",g.commandStr),[O,E]},function(A,O,E){b.optional(function(){A.assert(O,E+"&&typeof "+E+'==="object"',"invalid sample.coverage")});var X=O.def('"value" in ',E,"?+",E,".value:1"),j=O.def("!!",E,".invert");return[X,j]})}}),$}function Me(S,g){var R=S.static,U=S.dynamic,$={};return Object.keys(R).forEach(function(D){var L=R[D],P;if(typeof L=="number"||typeof L=="boolean")P=zn(function(){return L});else if(typeof L=="function"){var A=L._reglType;A==="texture2d"||A==="textureCube"?P=zn(function(O){return O.link(L)}):A==="framebuffer"||A==="framebufferCube"?(b.command(L.color.length>0,'missing color attachment for framebuffer sent to uniform "'+D+'"',g.commandStr),P=zn(function(O){return O.link(L.color[0])})):b.commandRaise('invalid data for uniform "'+D+'"',g.commandStr)}else Bn(L)?P=zn(function(O){var E=O.global.def("[",vr(L.length,function(X){return b.command(typeof L[X]=="number"||typeof L[X]=="boolean","invalid uniform "+D,O.commandStr),L[X]}),"]");return E}):b.commandRaise('invalid or missing data for uniform "'+D+'"',g.commandStr);P.value=L,$[D]=P}),Object.keys(U).forEach(function(D){var L=U[D];$[D]=mr(L,function(P,A){return P.invoke(A,L)})}),$}function mn(S,g){var R=S.static,U=S.dynamic,$={};return Object.keys(R).forEach(function(D){var L=R[D],P=v.id(D),A=new z;if(za(L))A.state=Oa,A.buffer=lt.getBuffer(lt.create(L,Go,!1,!0)),A.type=0;else{var O=lt.getBuffer(L);if(O)A.state=Oa,A.buffer=O,A.type=0;else if(b.command(typeof L=="object"&&L,"invalid data for attribute "+D,g.commandStr),"constant"in L){var E=L.constant;A.buffer="null",A.state=Qu,typeof E=="number"?A.x=E:(b.command(Bn(E)&&E.length>0&&E.length<=4,"invalid constant for attribute "+D,g.commandStr),pr.forEach(function(ae,Ht){Ht<E.length&&(A[ae]=E[Ht])}))}else{za(L.buffer)?O=lt.getBuffer(lt.create(L.buffer,Go,!1,!0)):O=lt.getBuffer(L.buffer),b.command(!!O,'missing buffer for attribute "'+D+'"',g.commandStr);var X=L.offset|0;b.command(X>=0,'invalid offset for attribute "'+D+'"',g.commandStr);var j=L.stride|0;b.command(j>=0&&j<256,'invalid stride for attribute "'+D+'", must be integer betweeen [0, 255]',g.commandStr);var ct=L.size|0;b.command(!("size"in L)||ct>0&&ct<=4,'invalid size for attribute "'+D+'", must be 1,2,3,4',g.commandStr);var _t=!!L.normalized,Nt=0;"type"in L&&(b.commandParameter(L.type,Xi,"invalid type for attribute "+D,g.commandStr),Nt=Xi[L.type]);var he=L.divisor|0;b.optional(function(){"divisor"in L&&(b.command(he===0||xt,'cannot specify divisor for attribute "'+D+'", instancing not supported',g.commandStr),b.command(he>=0,'invalid divisor for attribute "'+D+'"',g.commandStr));var ae=g.commandStr,Ht=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(L).forEach(function(mt){b.command(Ht.indexOf(mt)>=0,'unknown parameter "'+mt+'" for attribute pointer "'+D+'" (valid parameters are '+Ht+")",ae)})}),A.buffer=O,A.state=Oa,A.size=ct,A.normalized=_t,A.type=Nt||O.dtype,A.offset=X,A.stride=j,A.divisor=he}}$[D]=zn(function(ae,Ht){var mt=ae.attribCache;if(P in mt)return mt[P];var ot={isStream:!1};return Object.keys(A).forEach(function(te){ot[te]=A[te]}),A.buffer&&(ot.buffer=ae.link(A.buffer),ot.type=ot.type||ot.buffer+".dtype"),mt[P]=ot,ot})}),Object.keys(U).forEach(function(D){var L=U[D];function P(A,O){var E=A.invoke(O,L),X=A.shared,j=A.constants,ct=X.isBufferArgs,_t=X.buffer;b.optional(function(){A.assert(O,E+"&&(typeof "+E+'==="object"||typeof '+E+'==="function")&&('+ct+"("+E+")||"+_t+".getBuffer("+E+")||"+_t+".getBuffer("+E+".buffer)||"+ct+"("+E+'.buffer)||("constant" in '+E+"&&(typeof "+E+'.constant==="number"||'+X.isArrayLike+"("+E+".constant))))",'invalid dynamic attribute "'+D+'"')});var Nt={isStream:O.def(!1)},he=new z;he.state=Oa,Object.keys(he).forEach(function(ot){Nt[ot]=O.def(""+he[ot])});var ae=Nt.buffer,Ht=Nt.type;O("if(",ct,"(",E,")){",Nt.isStream,"=true;",ae,"=",_t,".createStream(",Go,",",E,");",Ht,"=",ae,".dtype;","}else{",ae,"=",_t,".getBuffer(",E,");","if(",ae,"){",Ht,"=",ae,".dtype;",'}else if("constant" in ',E,"){",Nt.state,"=",Qu,";","if(typeof "+E+'.constant === "number"){',Nt[pr[0]],"=",E,".constant;",pr.slice(1).map(function(ot){return Nt[ot]}).join("="),"=0;","}else{",pr.map(function(ot,te){return Nt[ot]+"="+E+".constant.length>"+te+"?"+E+".constant["+te+"]:0;"}).join(""),"}}else{","if(",ct,"(",E,".buffer)){",ae,"=",_t,".createStream(",Go,",",E,".buffer);","}else{",ae,"=",_t,".getBuffer(",E,".buffer);","}",Ht,'="type" in ',E,"?",j.glTypes,"[",E,".type]:",ae,".dtype;",Nt.normalized,"=!!",E,".normalized;");function mt(ot){O(Nt[ot],"=",E,".",ot,"|0;")}return mt("size"),mt("offset"),mt("stride"),mt("divisor"),O("}}"),O.exit("if(",Nt.isStream,"){",_t,".destroyStream(",ae,");","}"),Nt}$[D]=mr(L,P)}),$}function sn(S){var g=S.static,R=S.dynamic,U={};return Object.keys(g).forEach(function($){var D=g[$];U[$]=zn(function(L,P){return typeof D=="number"||typeof D=="boolean"?""+D:L.link(D)})}),Object.keys(R).forEach(function($){var D=R[$];U[$]=mr(D,function(L,P){return L.invoke(P,D)})}),U}function Vn(S,g,R,U,$){var D=S.static,L=S.dynamic;b.optional(function(){var mt=[ns,zf,Ra,Ds,Fs,Na,Cs,rc,Po,zo].concat(re);function ot(te){Object.keys(te).forEach(function(Jt){b.command(mt.indexOf(Jt)>=0,'unknown parameter "'+Jt+'"',$.commandStr)})}ot(D),ot(L)});var P=me(S,g),A=jt(S),O=fe(S,A,$),E=Tn(S,$),X=xn(S,$),j=Ee(S,$,P);function ct(mt){var ot=O[mt];ot&&(X[mt]=ot)}ct(es),ct(qt(nc));var _t=Object.keys(X).length>0,Nt={framebuffer:A,draw:E,shader:j,state:X,dirty:_t,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Nt.profile=Gt(S),Nt.uniforms=Me(R,$),Nt.drawVAO=Nt.scopeVAO=E.vao,!Nt.drawVAO&&j.program&&!P&&M.angle_instanced_arrays&&E.static.elements){var he=!0,ae=j.program.attributes.map(function(mt){var ot=g.static[mt];return he=he&&!!ot,ot});if(he&&ae.length>0){var Ht=It.getVAO(It.createVAO({attributes:ae,elements:E.static.elements}));Nt.drawVAO=new Pn(null,null,null,function(mt,ot){return mt.link(Ht)}),Nt.useVAO=!0}}return P?Nt.useVAO=!0:Nt.attributes=mn(g,$),Nt.context=sn(U),Nt}function jn(S,g,R){var U=S.shared,$=U.context,D=S.scope();Object.keys(R).forEach(function(L){g.save($,"."+L);var P=R[L],A=P.append(S,g);Array.isArray(A)?D($,".",L,"=[",A.join(),"];"):D($,".",L,"=",A,";")}),g(D)}function Yn(S,g,R,U){var $=S.shared,D=$.gl,L=$.framebuffer,P;Yt&&(P=g.def($.extensions,".webgl_draw_buffers"));var A=S.constants,O=A.drawBuffer,E=A.backBuffer,X;R?X=R.append(S,g):X=g.def(L,".next"),U||g("if(",X,"!==",L,".cur){"),g("if(",X,"){",D,".bindFramebuffer(",bh,",",X,".framebuffer);"),Yt&&g(P,".drawBuffersWEBGL(",O,"[",X,".colorAttachments.length]);"),g("}else{",D,".bindFramebuffer(",bh,",null);"),Yt&&g(P,".drawBuffersWEBGL(",E,");"),g("}",L,".cur=",X,";"),U||g("}")}function er(S,g,R){var U=S.shared,$=U.gl,D=S.current,L=S.next,P=U.current,A=U.next,O=S.cond(P,".dirty");re.forEach(function(E){var X=qt(E);if(!(X in R.state)){var j,ct;if(X in L){j=L[X],ct=D[X];var _t=vr(Vt[X].length,function(he){return O.def(j,"[",he,"]")});O(S.cond(_t.map(function(he,ae){return he+"!=="+ct+"["+ae+"]"}).join("||")).then($,".",ht[X],"(",_t,");",_t.map(function(he,ae){return ct+"["+ae+"]="+he}).join(";"),";"))}else{j=O.def(A,".",X);var Nt=S.cond(j,"!==",P,".",X);O(Nt),X in dt?Nt(S.cond(j).then($,".enable(",dt[X],");").else($,".disable(",dt[X],");"),P,".",X,"=",j,";"):Nt($,".",ht[X],"(",j,");",P,".",X,"=",j,";")}}}),Object.keys(R.state).length===0&&O(P,".dirty=false;"),g(O)}function fr(S,g,R,U){var $=S.shared,D=S.current,L=$.current,P=$.gl;hc(Object.keys(R)).forEach(function(A){var O=R[A];if(!(U&&!U(O))){var E=O.append(S,g);if(dt[A]){var X=dt[A];zs(O)?E?g(P,".enable(",X,");"):g(P,".disable(",X,");"):g(S.cond(E).then(P,".enable(",X,");").else(P,".disable(",X,");")),g(L,".",A,"=",E,";")}else if(Bn(E)){var j=D[A];g(P,".",ht[A],"(",E,");",E.map(function(ct,_t){return j+"["+_t+"]="+ct}).join(";"),";")}else g(P,".",ht[A],"(",E,");",L,".",A,"=",E,";")}})}function Un(S,g){xt&&(S.instancing=g.def(S.shared.extensions,".angle_instanced_arrays"))}function we(S,g,R,U,$){var D=S.shared,L=S.stats,P=D.current,A=D.timer,O=R.profile;function E(){return typeof performance>"u"?"Date.now()":"performance.now()"}var X,j;function ct(mt){X=g.def(),mt(X,"=",E(),";"),typeof $=="string"?mt(L,".count+=",$,";"):mt(L,".count++;"),wt&&(U?(j=g.def(),mt(j,"=",A,".getNumPendingQueries();")):mt(A,".beginQuery(",L,");"))}function _t(mt){mt(L,".cpuTime+=",E(),"-",X,";"),wt&&(U?mt(A,".pushScopeStats(",j,",",A,".getNumPendingQueries(),",L,");"):mt(A,".endQuery();"))}function Nt(mt){var ot=g.def(P,".profile");g(P,".profile=",mt,";"),g.exit(P,".profile=",ot,";")}var he;if(O){if(zs(O)){O.enable?(ct(g),_t(g.exit),Nt("true")):Nt("false");return}he=O.append(S,g),Nt(he)}else he=g.def(P,".profile");var ae=S.block();ct(ae),g("if(",he,"){",ae,"}");var Ht=S.block();_t(Ht),g.exit("if(",he,"){",Ht,"}")}function ur(S,g,R,U,$){var D=S.shared;function L(A){switch(A){case Fa:case Vo:case pi:return 2;case Gf:case jo:case $f:return 3;case $o:case _i:case Vf:return 4;default:return 1}}function P(A,O,E){var X=D.gl,j=g.def(A,".location"),ct=g.def(D.attributes,"[",j,"]"),_t=E.state,Nt=E.buffer,he=[E.x,E.y,E.z,E.w],ae=["buffer","normalized","offset","stride"];function Ht(){g("if(!",ct,".buffer){",X,".enableVertexAttribArray(",j,");}");var ot=E.type,te;if(E.size?te=g.def(E.size,"||",O):te=O,g("if(",ct,".type!==",ot,"||",ct,".size!==",te,"||",ae.map(function(le){return ct+"."+le+"!=="+E[le]}).join("||"),"){",X,".bindBuffer(",Go,",",Nt,".buffer);",X,".vertexAttribPointer(",[j,te,ot,E.normalized,E.stride,E.offset],");",ct,".type=",ot,";",ct,".size=",te,";",ae.map(function(le){return ct+"."+le+"="+E[le]+";"}).join(""),"}"),xt){var Jt=E.divisor;g("if(",ct,".divisor!==",Jt,"){",S.instancing,".vertexAttribDivisorANGLE(",[j,Jt],");",ct,".divisor=",Jt,";}")}}function mt(){g("if(",ct,".buffer){",X,".disableVertexAttribArray(",j,");",ct,".buffer=null;","}if(",pr.map(function(ot,te){return ct+"."+ot+"!=="+he[te]}).join("||"),"){",X,".vertexAttrib4f(",j,",",he,");",pr.map(function(ot,te){return ct+"."+ot+"="+he[te]+";"}).join(""),"}")}_t===Oa?Ht():_t===Qu?mt():(g("if(",_t,"===",Oa,"){"),Ht(),g("}else{"),mt(),g("}"))}U.forEach(function(A){var O=A.name,E=R.attributes[O],X;if(E){if(!$(E))return;X=E.append(S,g)}else{if(!$(wh))return;var j=S.scopeAttrib(O);b.optional(function(){S.assert(g,j+".state","missing attribute "+O)}),X={},Object.keys(new z).forEach(function(ct){X[ct]=g.def(j,".",ct)})}P(S.link(A),L(A.info.type),X)})}function en(S,g,R,U,$,D){for(var L=S.shared,P=L.gl,A={},O,E=0;E<U.length;++E){var X=U[E],j=X.name,ct=X.info.type,_t=X.info.size,Nt=R.uniforms[j];if(_t>1){if(!Nt)continue;var he=j.replace("[0]","");if(A[he])continue;A[he]=1}var ae=S.link(X),Ht=ae+".location",mt;if(Nt){if(!$(Nt))continue;if(zs(Nt)){var ot=Nt.value;if(b.command(ot!==null&&typeof ot<"u",'missing uniform "'+j+'"',S.commandStr),ct===Yf||ct===Wo){b.command(typeof ot=="function"&&(ct===Yf&&(ot._reglType==="texture2d"||ot._reglType==="framebuffer")||ct===Wo&&(ot._reglType==="textureCube"||ot._reglType==="framebufferCube")),"invalid texture for uniform "+j,S.commandStr);var te=S.link(ot._texture||ot.color[0]._texture);g(P,".uniform1i(",Ht,",",te+".bind());"),g.exit(te,".unbind();")}else if(ct===Ca||ct===jf||ct===Wf){b.optional(function(){b.command(Bn(ot),"invalid matrix for uniform "+j,S.commandStr),b.command(ct===Ca&&ot.length===4||ct===jf&&ot.length===9||ct===Wf&&ot.length===16,"invalid length for matrix uniform "+j,S.commandStr)});var Jt=S.global.def("new Float32Array(["+Array.prototype.slice.call(ot)+"])"),le=2;ct===jf?le=3:ct===Wf&&(le=4),g(P,".uniformMatrix",le,"fv(",Ht,",false,",Jt,");")}else{switch(ct){case fc:_t===1?b.commandType(ot,"number","uniform "+j,S.commandStr):b.command(Bn(ot)&&ot.length===_t,"uniform "+j,S.commandStr),O="1f";break;case Fa:b.command(Bn(ot)&&ot.length&&ot.length%2===0&&ot.length<=_t*2,"uniform "+j,S.commandStr),O="2f";break;case Gf:b.command(Bn(ot)&&ot.length&&ot.length%3===0&&ot.length<=_t*3,"uniform "+j,S.commandStr),O="3f";break;case $o:b.command(Bn(ot)&&ot.length&&ot.length%4===0&&ot.length<=_t*4,"uniform "+j,S.commandStr),O="4f";break;case mh:_t===1?b.commandType(ot,"boolean","uniform "+j,S.commandStr):b.command(Bn(ot)&&ot.length===_t,"uniform "+j,S.commandStr),O="1i";break;case uc:_t===1?b.commandType(ot,"number","uniform "+j,S.commandStr):b.command(Bn(ot)&&ot.length===_t,"uniform "+j,S.commandStr),O="1i";break;case pi:b.command(Bn(ot)&&ot.length&&ot.length%2===0&&ot.length<=_t*2,"uniform "+j,S.commandStr),O="2i";break;case Vo:b.command(Bn(ot)&&ot.length&&ot.length%2===0&&ot.length<=_t*2,"uniform "+j,S.commandStr),O="2i";break;case $f:b.command(Bn(ot)&&ot.length&&ot.length%3===0&&ot.length<=_t*3,"uniform "+j,S.commandStr),O="3i";break;case jo:b.command(Bn(ot)&&ot.length&&ot.length%3===0&&ot.length<=_t*3,"uniform "+j,S.commandStr),O="3i";break;case Vf:b.command(Bn(ot)&&ot.length&&ot.length%4===0&&ot.length<=_t*4,"uniform "+j,S.commandStr),O="4i";break;case _i:b.command(Bn(ot)&&ot.length&&ot.length%4===0&&ot.length<=_t*4,"uniform "+j,S.commandStr),O="4i";break}_t>1?(O+="v",ot=S.global.def("["+Array.prototype.slice.call(ot)+"]")):ot=Bn(ot)?Array.prototype.slice.call(ot):ot,g(P,".uniform",O,"(",Ht,",",ot,");")}continue}else mt=Nt.append(S,g)}else{if(!$(wh))continue;mt=g.def(L.uniforms,"[",v.id(j),"]")}ct===Yf?(b(!Array.isArray(mt),"must specify a scalar prop for textures"),g("if(",mt,"&&",mt,'._reglType==="framebuffer"){',mt,"=",mt,".color[0];","}")):ct===Wo&&(b(!Array.isArray(mt),"must specify a scalar prop for cube maps"),g("if(",mt,"&&",mt,'._reglType==="framebufferCube"){',mt,"=",mt,".color[0];","}")),b.optional(function(){function $r(Er,qf){S.assert(g,Er,'bad data or missing for uniform "'+j+'".  '+qf)}function Va(Er,qf){qf===1&&b(!Array.isArray(mt),"must not specify an array type for uniform"),$r("Array.isArray("+mt+") && typeof "+mt+'[0]===" '+Er+'" || typeof '+mt+'==="'+Er+'"',"invalid type, expected "+Er)}function Kr(Er,qf,mc){Array.isArray(mt)?b(mt.length&&mt.length%Er===0&&mt.length<=Er*mc,"must have length of "+(mc===1?"":"n * ")+Er):$r(L.isArrayLike+"("+mt+")&&"+mt+".length && "+mt+".length % "+Er+" === 0 && "+mt+".length<="+Er*mc,"invalid vector, should have length of "+(mc===1?"":"n * ")+Er,S.commandStr)}function Kd(Er){b(!Array.isArray(mt),"must not specify a value type"),$r("typeof "+mt+'==="function"&&'+mt+'._reglType==="texture'+(Er===Vd?"2d":"Cube")+'"',"invalid texture type",S.commandStr)}switch(ct){case uc:Va("number",_t);break;case Vo:Kr(2,"number",_t);break;case jo:Kr(3,"number",_t);break;case _i:Kr(4,"number",_t);break;case fc:Va("number",_t);break;case Fa:Kr(2,"number",_t);break;case Gf:Kr(3,"number",_t);break;case $o:Kr(4,"number",_t);break;case mh:Va("boolean",_t);break;case pi:Kr(2,"boolean",_t);break;case $f:Kr(3,"boolean",_t);break;case Vf:Kr(4,"boolean",_t);break;case Ca:Kr(4,"number",_t);break;case jf:Kr(9,"number",_t);break;case Wf:Kr(16,"number",_t);break;case Yf:Kd(Vd);break;case Wo:Kd(Nm);break}});var nn=1;switch(ct){case Yf:case Wo:var cr=g.def(mt,"._texture");g(P,".uniform1i(",Ht,",",cr,".bind());"),g.exit(cr,".unbind();");continue;case uc:case mh:O="1i";break;case Vo:case pi:O="2i",nn=2;break;case jo:case $f:O="3i",nn=3;break;case _i:case Vf:O="4i",nn=4;break;case fc:O="1f";break;case Fa:O="2f",nn=2;break;case Gf:O="3f",nn=3;break;case $o:O="4f",nn=4;break;case Ca:O="Matrix2fv";break;case jf:O="Matrix3fv";break;case Wf:O="Matrix4fv";break}if(O.indexOf("Matrix")===-1&&_t>1&&(O+="v",nn=1),O.charAt(0)==="M"){g(P,".uniform",O,"(",Ht,",");var Ga=Math.pow(ct-Ca+2,2),ss=S.global.def("new Float32Array(",Ga,")");Array.isArray(mt)?g("false,(",vr(Ga,function($r){return ss+"["+$r+"]="+mt[$r]}),",",ss,")"):g("false,(Array.isArray(",mt,")||",mt," instanceof Float32Array)?",mt,":(",vr(Ga,function($r){return ss+"["+$r+"]="+mt+"["+$r+"]"}),",",ss,")"),g(");")}else if(nn>1){for(var Ni=[],Gs=[],$a=0;$a<nn;++$a)Array.isArray(mt)?Gs.push(mt[$a]):Gs.push(g.def(mt+"["+$a+"]")),D&&Ni.push(g.def());D&&g("if(!",S.batchId,"||",Ni.map(function($r,Va){return $r+"!=="+Gs[Va]}).join("||"),"){",Ni.map(function($r,Va){return $r+"="+Gs[Va]+";"}).join("")),g(P,".uniform",O,"(",Ht,",",Gs.join(","),");"),D&&g("}")}else{if(b(!Array.isArray(mt),"uniform value must not be an array"),D){var Zd=g.def();g("if(!",S.batchId,"||",Zd,"!==",mt,"){",Zd,"=",mt,";")}g(P,".uniform",O,"(",Ht,",",mt,");"),D&&g("}")}}}function ce(S,g,R,U){var $=S.shared,D=$.gl,L=$.draw,P=U.draw;function A(){var te=P.elements,Jt,le=g;return te?((te.contextDep&&U.contextDynamic||te.propDep)&&(le=R),Jt=te.append(S,le),P.elementsActive&&le("if("+Jt+")"+D+".bindBuffer("+dh+","+Jt+".buffer.buffer);")):(Jt=le.def(),le(Jt,"=",L,".",Ds,";","if(",Jt,"){",D,".bindBuffer(",dh,",",Jt,".buffer.buffer);}","else if(",$.vao,".currentVAO){",Jt,"=",S.shared.elements+".getElements("+$.vao,".currentVAO.elements);",pt?"":"if("+Jt+")"+D+".bindBuffer("+dh+","+Jt+".buffer.buffer);","}")),Jt}function O(){var te=P.count,Jt,le=g;return te?((te.contextDep&&U.contextDynamic||te.propDep)&&(le=R),Jt=te.append(S,le),b.optional(function(){te.MISSING&&S.assert(g,"false","missing vertex count"),te.DYNAMIC&&S.assert(le,Jt+">=0","missing vertex count")})):(Jt=le.def(L,".",Cs),b.optional(function(){S.assert(le,Jt+">=0","missing vertex count")})),Jt}var E=A();function X(te){var Jt=P[te];return Jt?Jt.contextDep&&U.contextDynamic||Jt.propDep?Jt.append(S,R):Jt.append(S,g):g.def(L,".",te)}var j=X(Fs),ct=X(Na),_t=O();if(typeof _t=="number"){if(_t===0)return}else R("if(",_t,"){"),R.exit("}");var Nt,he;xt&&(Nt=X(rc),he=S.instancing);var ae=E+".type",Ht=P.elements&&zs(P.elements)&&!P.vaoActive;function mt(){function te(){R(he,".drawElementsInstancedANGLE(",[j,_t,ae,ct+"<<(("+ae+"-"+Rd+")>>1)",Nt],");")}function Jt(){R(he,".drawArraysInstancedANGLE(",[j,ct,_t,Nt],");")}E&&E!=="null"?Ht?te():(R("if(",E,"){"),te(),R("}else{"),Jt(),R("}")):Jt()}function ot(){function te(){R(D+".drawElements("+[j,_t,ae,ct+"<<(("+ae+"-"+Rd+")>>1)"]+");")}function Jt(){R(D+".drawArrays("+[j,ct,_t]+");")}E&&E!=="null"?Ht?te():(R("if(",E,"){"),te(),R("}else{"),Jt(),R("}")):Jt()}xt&&(typeof Nt!="number"||Nt>=0)?typeof Nt=="string"?(R("if(",Nt,">0){"),mt(),R("}else if(",Nt,"<0){"),ot(),R("}")):mt():ot()}function Le(S,g,R,U,$){var D=_e(),L=D.proc("body",$);return b.optional(function(){D.commandStr=g.commandStr,D.command=D.link(g.commandStr)}),xt&&(D.instancing=L.def(D.shared.extensions,".angle_instanced_arrays")),S(D,L,R,U),D.compile().body}function Ve(S,g,R,U){Un(S,g),R.useVAO?R.drawVAO?g(S.shared.vao,".setVAO(",R.drawVAO.append(S,g),");"):g(S.shared.vao,".setVAO(",S.shared.vao,".targetVAO);"):(g(S.shared.vao,".setVAO(null);"),ur(S,g,R,U.attributes,function(){return!0})),en(S,g,R,U.uniforms,function(){return!0},!1),ce(S,g,g,R)}function Gn(S,g){var R=S.proc("draw",1);Un(S,R),jn(S,R,g.context),Yn(S,R,g.framebuffer),er(S,R,g),fr(S,R,g.state),we(S,R,g,!1,!0);var U=g.shader.progVar.append(S,R);if(R(S.shared.gl,".useProgram(",U,".program);"),g.shader.program)Ve(S,R,g,g.shader.program);else{R(S.shared.vao,".setVAO(null);");var $=S.global.def("{}"),D=R.def(U,".id"),L=R.def($,"[",D,"]");R(S.cond(L).then(L,".call(this,a0);").else(L,"=",$,"[",D,"]=",S.link(function(P){return Le(Ve,S,g,P,1)}),"(",U,");",L,".call(this,a0);"))}Object.keys(g.state).length>0&&R(S.shared.current,".dirty=true;"),S.shared.vao&&R(S.shared.vao,".setVAO(null);")}function gi(S,g,R,U){S.batchId="a1",Un(S,g);function $(){return!0}ur(S,g,R,U.attributes,$),en(S,g,R,U.uniforms,$,!1),ce(S,g,g,R)}function Us(S,g,R,U){Un(S,g);var $=R.contextDep,D=g.def(),L="a0",P="a1",A=g.def();S.shared.props=A,S.batchId=D;var O=S.scope(),E=S.scope();g(O.entry,"for(",D,"=0;",D,"<",P,";++",D,"){",A,"=",L,"[",D,"];",E,"}",O.exit);function X(ae){return ae.contextDep&&$||ae.propDep}function j(ae){return!X(ae)}if(R.needsContext&&jn(S,E,R.context),R.needsFramebuffer&&Yn(S,E,R.framebuffer),fr(S,E,R.state,X),R.profile&&X(R.profile)&&we(S,E,R,!1,!0),U)R.useVAO?R.drawVAO?X(R.drawVAO)?E(S.shared.vao,".setVAO(",R.drawVAO.append(S,E),");"):O(S.shared.vao,".setVAO(",R.drawVAO.append(S,O),");"):O(S.shared.vao,".setVAO(",S.shared.vao,".targetVAO);"):(O(S.shared.vao,".setVAO(null);"),ur(S,O,R,U.attributes,j),ur(S,E,R,U.attributes,X)),en(S,O,R,U.uniforms,j,!1),en(S,E,R,U.uniforms,X,!0),ce(S,O,E,R);else{var ct=S.global.def("{}"),_t=R.shader.progVar.append(S,E),Nt=E.def(_t,".id"),he=E.def(ct,"[",Nt,"]");E(S.shared.gl,".useProgram(",_t,".program);","if(!",he,"){",he,"=",ct,"[",Nt,"]=",S.link(function(ae){return Le(gi,S,R,ae,2)}),"(",_t,");}",he,".call(this,a0[",D,"],",D,");")}}function T(S,g){var R=S.proc("batch",2);S.batchId="0",Un(S,R);var U=!1,$=!0;Object.keys(g.context).forEach(function(ct){U=U||g.context[ct].propDep}),U||(jn(S,R,g.context),$=!1);var D=g.framebuffer,L=!1;D?(D.propDep?U=L=!0:D.contextDep&&U&&(L=!0),L||Yn(S,R,D)):Yn(S,R,null),g.state.viewport&&g.state.viewport.propDep&&(U=!0);function P(ct){return ct.contextDep&&U||ct.propDep}er(S,R,g),fr(S,R,g.state,function(ct){return!P(ct)}),(!g.profile||!P(g.profile))&&we(S,R,g,!1,"a1"),g.contextDep=U,g.needsContext=$,g.needsFramebuffer=L;var A=g.shader.progVar;if(A.contextDep&&U||A.propDep)Us(S,R,g,null);else{var O=A.append(S,R);if(R(S.shared.gl,".useProgram(",O,".program);"),g.shader.program)Us(S,R,g,g.shader.program);else{R(S.shared.vao,".setVAO(null);");var E=S.global.def("{}"),X=R.def(O,".id"),j=R.def(E,"[",X,"]");R(S.cond(j).then(j,".call(this,a0,a1);").else(j,"=",E,"[",X,"]=",S.link(function(ct){return Le(Us,S,g,ct,2)}),"(",O,");",j,".call(this,a0,a1);"))}}Object.keys(g.state).length>0&&R(S.shared.current,".dirty=true;"),S.shared.vao&&R(S.shared.vao,".setVAO(null);")}function nt(S,g){var R=S.proc("scope",3);S.batchId="a2";var U=S.shared,$=U.current;jn(S,R,g.context),g.framebuffer&&g.framebuffer.append(S,R),hc(Object.keys(g.state)).forEach(function(L){var P=g.state[L],A=P.append(S,R);Bn(A)?A.forEach(function(O,E){R.set(S.next[L],"["+E+"]",O)}):R.set(U.next,"."+L,A)}),we(S,R,g,!0,!0),[Ds,Na,Cs,rc,Fs].forEach(function(L){var P=g.draw[L];P&&R.set(U.draw,"."+L,""+P.append(S,R))}),Object.keys(g.uniforms).forEach(function(L){var P=g.uniforms[L].append(S,R);Array.isArray(P)&&(P="["+P.join()+"]"),R.set(U.uniforms,"["+v.id(L)+"]",P)}),Object.keys(g.attributes).forEach(function(L){var P=g.attributes[L].append(S,R),A=S.scopeAttrib(L);Object.keys(new z).forEach(function(O){R.set(A,"."+O,P[O])})}),g.scopeVAO&&R.set(U.vao,".targetVAO",g.scopeVAO.append(S,R));function D(L){var P=g.shader[L];P&&R.set(U.shader,"."+L,P.append(S,R))}D(zf),D(Ra),Object.keys(g.state).length>0&&(R($,".dirty=true;"),R.exit($,".dirty=true;")),R("a1(",S.shared.context,",a0,",S.batchId,");")}function q(S){if(!(typeof S!="object"||Bn(S))){for(var g=Object.keys(S),R=0;R<g.length;++R)if(hr.isDynamic(S[g[R]]))return!0;return!1}}function Xt(S,g,R){var U=g.static[R];if(!U||!q(U))return;var $=S.global,D=Object.keys(U),L=!1,P=!1,A=!1,O=S.global.def("{}");D.forEach(function(X){var j=U[X];if(hr.isDynamic(j)){typeof j=="function"&&(j=U[X]=hr.unbox(j));var ct=mr(j,null);L=L||ct.thisDep,A=A||ct.propDep,P=P||ct.contextDep}else{switch($(O,".",X,"="),typeof j){case"number":$(j);break;case"string":$('"',j,'"');break;case"object":Array.isArray(j)&&$("[",j.join(),"]");break;default:$(S.link(j));break}$(";")}});function E(X,j){D.forEach(function(ct){var _t=U[ct];if(hr.isDynamic(_t)){var Nt=X.invoke(j,_t);j(O,".",ct,"=",Nt,";")}})}g.dynamic[R]=new hr.DynamicVariable(Ma,{thisDep:L,contextDep:P,propDep:A,ref:O,append:E}),delete g.static[R]}function Ae(S,g,R,U,$){var D=_e();D.stats=D.link($),Object.keys(g.static).forEach(function(P){Xt(D,g,P)}),Ye.forEach(function(P){Xt(D,S,P)});var L=Vn(S,g,R,U,D);return Gn(D,L),nt(D,L),T(D,L),r(D.compile(),{destroy:function(){L.shader.program.destroy()}})}return{next:$t,current:Vt,procs:function(){var S=_e(),g=S.proc("poll"),R=S.proc("refresh"),U=S.block();g(U),R(U);var $=S.shared,D=$.gl,L=$.next,P=$.current;U(P,".dirty=false;"),Yn(S,g),Yn(S,R,null,!0);var A;xt&&(A=S.link(xt)),M.oes_vertex_array_object&&R(S.link(M.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var O=0;O<tt.maxAttributes;++O){var E=R.def($.attributes,"[",O,"]"),X=S.cond(E,".buffer");X.then(D,".enableVertexAttribArray(",O,");",D,".bindBuffer(",Go,",",E,".buffer.buffer);",D,".vertexAttribPointer(",O,",",E,".size,",E,".type,",E,".normalized,",E,".stride,",E,".offset);").else(D,".disableVertexAttribArray(",O,");",D,".vertexAttrib4f(",O,",",E,".x,",E,".y,",E,".z,",E,".w);",E,".buffer=null;"),R(X),xt&&R(A,".vertexAttribDivisorANGLE(",O,",",E,".divisor);")}return R(S.shared.vao,".currentVAO=null;",S.shared.vao,".setVAO(",S.shared.vao,".targetVAO);"),Object.keys(dt).forEach(function(j){var ct=dt[j],_t=U.def(L,".",j),Nt=S.block();Nt("if(",_t,"){",D,".enable(",ct,")}else{",D,".disable(",ct,")}",P,".",j,"=",_t,";"),R(Nt),g("if(",_t,"!==",P,".",j,"){",Nt,"}")}),Object.keys(ht).forEach(function(j){var ct=ht[j],_t=Vt[j],Nt,he,ae=S.block();if(ae(D,".",ct,"("),Bn(_t)){var Ht=_t.length;Nt=S.global.def(L,".",j),he=S.global.def(P,".",j),ae(vr(Ht,function(mt){return Nt+"["+mt+"]"}),");",vr(Ht,function(mt){return he+"["+mt+"]="+Nt+"["+mt+"];"}).join("")),g("if(",vr(Ht,function(mt){return Nt+"["+mt+"]!=="+he+"["+mt+"]"}).join("||"),"){",ae,"}")}else Nt=U.def(L,".",j),he=U.def(P,".",j),ae(Nt,");",P,".",j,"=",Nt,";"),g("if(",Nt,"!==",he,"){",ae,"}");R(ae)}),S.compile()}(),compile:Ae}}function Pm(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Hd=34918,is=34919,Sh=35007,Xd=function(_,v){if(!v.ext_disjoint_timer_query)return null;var M=[];function tt(){return M.pop()||v.ext_disjoint_timer_query.createQueryEXT()}function lt(xt){M.push(xt)}var K=[];function et(xt){var Yt=tt();v.ext_disjoint_timer_query.beginQueryEXT(Sh,Yt),K.push(Yt),wt(K.length-1,K.length,xt)}function bt(){v.ext_disjoint_timer_query.endQueryEXT(Sh)}function vt(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var It=[];function Mt(){return It.pop()||new vt}function Ot(xt){It.push(xt)}var Ct=[];function wt(xt,Yt,pt){var Vt=Mt();Vt.startQueryIndex=xt,Vt.endQueryIndex=Yt,Vt.sum=0,Vt.stats=pt,Ct.push(Vt)}var Et=[],z=[];function J(){var xt,Yt,pt=K.length;if(pt!==0){z.length=Math.max(z.length,pt+1),Et.length=Math.max(Et.length,pt+1),Et[0]=0,z[0]=0;var Vt=0;for(xt=0,Yt=0;Yt<K.length;++Yt){var $t=K[Yt];v.ext_disjoint_timer_query.getQueryObjectEXT($t,is)?(Vt+=v.ext_disjoint_timer_query.getQueryObjectEXT($t,Hd),lt($t)):K[xt++]=$t,Et[Yt+1]=Vt,z[Yt+1]=xt}for(K.length=xt,xt=0,Yt=0;Yt<Ct.length;++Yt){var re=Ct[Yt],dt=re.startQueryIndex,ht=re.endQueryIndex;re.sum+=Et[ht]-Et[dt];var qt=z[dt],kt=z[ht];kt===qt?(re.stats.gpuTime+=re.sum/1e6,Ot(re)):(re.startQueryIndex=qt,re.endQueryIndex=kt,Ct[xt++]=re)}Ct.length=xt}}return{beginQuery:et,endQuery:bt,pushScopeStats:wt,update:J,getNumPendingQueries:function(){return K.length},clear:function(){M.push.apply(M,K);for(var xt=0;xt<M.length;xt++)v.ext_disjoint_timer_query.deleteQueryEXT(M[xt]);K.length=0,M.length=0},restore:function(){K.length=0,M.length=0}}},zm=16384,qd=256,Um=1024,Gm=34962,Ri="webglcontextlost",dc="webglcontextrestored",_c=1,Ah=2,pc=3;function Ua(_,v){for(var M=0;M<_.length;++M)if(_[M]===v)return M;return-1}function be(_){var v=cl(_);if(!v)return null;var M=v.gl,tt=M.getContextAttributes(),lt=M.isContextLost(),K=ll(M,v);if(!K)return null;var et=fl(),bt=Pm(),vt=K.extensions,It=Xd(M,vt),Mt=ji(),Ot=M.drawingBufferWidth,Ct=M.drawingBufferHeight,wt={tick:0,time:0,viewportWidth:Ot,viewportHeight:Ct,framebufferWidth:Ot,framebufferHeight:Ct,drawingBufferWidth:Ot,drawingBufferHeight:Ct,pixelRatio:v.pixelRatio},Et={},z={elements:null,primitive:4,count:-1,offset:0,instances:-1},J=_f(M,vt),xt=De(M,bt,v,Vt),Yt=kn(M,vt,xt,bt),pt=Om(M,vt,J,bt,xt,Yt,z);function Vt(ce){return pt.destroyBuffer(ce)}var $t=nh(M,et,bt,v),re=wr(M,vt,J,function(){qt.procs.poll()},wt,bt,v),dt=hm(M,vt,J,bt,v),ht=Im(M,vt,J,re,dt,bt),qt=xh(M,et,vt,J,xt,Yt,re,ht,Et,pt,$t,z,wt,It,v),kt=Rm(M,ht,qt.procs.poll,wt,tt,vt,J),St=qt.next,Pt=M.canvas,Ut=[],ge=[],_e=[],Gt=[v.onDestroy],jt=null;function fe(){if(Ut.length===0){It&&It.update(),jt=null;return}jt=Pr.next(fe),fr();for(var ce=Ut.length-1;ce>=0;--ce){var Le=Ut[ce];Le&&Le(wt,null,0)}M.flush(),It&&It.update()}function me(){!jt&&Ut.length>0&&(jt=Pr.next(fe))}function Ee(){jt&&(Pr.cancel(fe),jt=null)}function Tn(ce){ce.preventDefault(),lt=!0,Ee(),ge.forEach(function(Le){Le()})}function xn(ce){M.getError(),lt=!1,K.restore(),$t.restore(),xt.restore(),re.restore(),dt.restore(),ht.restore(),pt.restore(),It&&It.restore(),qt.procs.refresh(),me(),_e.forEach(function(Le){Le()})}Pt&&(Pt.addEventListener(Ri,Tn,!1),Pt.addEventListener(dc,xn,!1));function Me(){Ut.length=0,Ee(),Pt&&(Pt.removeEventListener(Ri,Tn),Pt.removeEventListener(dc,xn)),$t.clear(),ht.clear(),dt.clear(),pt.clear(),re.clear(),Yt.clear(),xt.clear(),It&&It.clear(),Gt.forEach(function(ce){ce()})}function mn(ce){b(!!ce,"invalid args to regl({...})"),b.type(ce,"object","invalid args to regl({...})");function Le($){var D=r({},$);delete D.uniforms,delete D.attributes,delete D.context,delete D.vao,"stencil"in D&&D.stencil.op&&(D.stencil.opBack=D.stencil.opFront=D.stencil.op,delete D.stencil.op);function L(P){if(P in D){var A=D[P];delete D[P],Object.keys(A).forEach(function(O){D[P+"."+O]=A[O]})}}return L("blend"),L("depth"),L("cull"),L("stencil"),L("polygonOffset"),L("scissor"),L("sample"),"vao"in $&&(D.vao=$.vao),D}function Ve($,D){var L={},P={};return Object.keys($).forEach(function(A){var O=$[A];if(hr.isDynamic(O)){P[A]=hr.unbox(O,A);return}else if(D&&Array.isArray(O)){for(var E=0;E<O.length;++E)if(hr.isDynamic(O[E])){P[A]=hr.unbox(O,A);return}}L[A]=O}),{dynamic:P,static:L}}var Gn=Ve(ce.context||{},!0),gi=Ve(ce.uniforms||{},!0),Us=Ve(ce.attributes||{},!1),T=Ve(Le(ce),!1),nt={gpuTime:0,cpuTime:0,count:0},q=qt.compile(T,Us,gi,Gn,nt),Xt=q.draw,Ae=q.batch,S=q.scope,g=[];function R($){for(;g.length<$;)g.push(null);return g}function U($,D){var L;if(lt&&b.raise("context lost"),typeof $=="function")return S.call(this,null,$,0);if(typeof D=="function")if(typeof $=="number")for(L=0;L<$;++L)S.call(this,null,D,L);else if(Array.isArray($))for(L=0;L<$.length;++L)S.call(this,$[L],D,L);else return S.call(this,$,D,0);else if(typeof $=="number"){if($>0)return Ae.call(this,R($|0),$|0)}else if(Array.isArray($)){if($.length)return Ae.call(this,$,$.length)}else return Xt.call(this,$)}return r(U,{stats:nt,destroy:function(){q.destroy()}})}var sn=ht.setFBO=mn({framebuffer:hr.define.call(null,_c,"framebuffer")});function Vn(ce,Le){var Ve=0;qt.procs.poll();var Gn=Le.color;Gn&&(M.clearColor(+Gn[0]||0,+Gn[1]||0,+Gn[2]||0,+Gn[3]||0),Ve|=zm),"depth"in Le&&(M.clearDepth(+Le.depth),Ve|=qd),"stencil"in Le&&(M.clearStencil(Le.stencil|0),Ve|=Um),b(!!Ve,"called regl.clear with no buffer specified"),M.clear(Ve)}function jn(ce){if(b(typeof ce=="object"&&ce,"regl.clear() takes an object as input"),"framebuffer"in ce)if(ce.framebuffer&&ce.framebuffer_reglType==="framebufferCube")for(var Le=0;Le<6;++Le)sn(r({framebuffer:ce.framebuffer.faces[Le]},ce),Vn);else sn(ce,Vn);else Vn(null,ce)}function Yn(ce){b.type(ce,"function","regl.frame() callback must be a function"),Ut.push(ce);function Le(){var Ve=Ua(Ut,ce);b(Ve>=0,"cannot cancel a frame twice");function Gn(){var gi=Ua(Ut,Gn);Ut[gi]=Ut[Ut.length-1],Ut.length-=1,Ut.length<=0&&Ee()}Ut[Ve]=Gn}return me(),{cancel:Le}}function er(){var ce=St.viewport,Le=St.scissor_box;ce[0]=ce[1]=Le[0]=Le[1]=0,wt.viewportWidth=wt.framebufferWidth=wt.drawingBufferWidth=ce[2]=Le[2]=M.drawingBufferWidth,wt.viewportHeight=wt.framebufferHeight=wt.drawingBufferHeight=ce[3]=Le[3]=M.drawingBufferHeight}function fr(){wt.tick+=1,wt.time=we(),er(),qt.procs.poll()}function Un(){re.refresh(),er(),qt.procs.refresh(),It&&It.update()}function we(){return(ji()-Mt)/1e3}Un();function ur(ce,Le){b.type(Le,"function","listener callback must be a function");var Ve;switch(ce){case"frame":return Yn(Le);case"lost":Ve=ge;break;case"restore":Ve=_e;break;case"destroy":Ve=Gt;break;default:b.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ve.push(Le),{cancel:function(){for(var Gn=0;Gn<Ve.length;++Gn)if(Ve[Gn]===Le){Ve[Gn]=Ve[Ve.length-1],Ve.pop();return}}}}var en=r(mn,{clear:jn,prop:hr.define.bind(null,_c),context:hr.define.bind(null,Ah),this:hr.define.bind(null,pc),draw:mn({}),buffer:function(ce){return xt.create(ce,Gm,!1,!1)},elements:function(ce){return Yt.create(ce,!1)},texture:re.create2D,cube:re.createCube,renderbuffer:dt.create,framebuffer:ht.create,framebufferCube:ht.createCube,vao:pt.createVAO,attributes:tt,frame:Yn,on:ur,limits:J,hasExtension:function(ce){return J.extensions.indexOf(ce.toLowerCase())>=0},read:kt,destroy:Me,_gl:M,_refresh:Un,poll:function(){fr(),It&&It.update()},now:we,stats:bt});return v.onDone(null,en),en}return be})})(yT);var vT=wT,Ch=new Uint8Array(4),bT=new Float32Array(Ch.buffer);function wT(n,t,e,r){return Ch[0]=r,Ch[1]=e,Ch[2]=t,Ch[3]=n,bT[0]}class Kf{constructor(t,e="arithmetic"){this.transform="arithmetic",this.transform=e,this.start=t,this.value=t,this.target=t}update(t,e){if(e===0){this.value=t,this.timer!==void 0&&this.timer.stop();return}this.start=this.value,this.target=t,this.start_timer(e)}start_timer(t){this.timer!==void 0&&this.timer.stop();const e=id(r=>{const s=r/t;if(s>=1){this.value=this.target,e.stop();return}const o=1-s,f=s;this.value=this.transform==="geometric"?this.start**o*this.target**f:this.start*o+this.target*f});this.timer=e}}class xT{constructor(){this.maxPoints=new Kf(1e4,"geometric"),this.pointSize=new Kf(1,"geometric"),this.targetOpacity=new Kf(50),this.foregroundOpacity=new Kf(1),this.backgroundOpacity=new Kf(.5),this.foregroundSize=new Kf(1,"geometric"),this.backgroundSize=new Kf(1,"geometric")}apply_prefs(t){const{duration:e}=t;this.maxPoints.update(t.max_points,e),this.targetOpacity.update(t.alpha,e),this.pointSize.update(t.point_size,e),this.foregroundOpacity.update(t.background_options.opacity[1],e),this.backgroundOpacity.update(t.background_options.opacity[0],e),this.foregroundSize.update(t.background_options.size[1],e),this.backgroundSize.update(t.background_options.size[0],e)}get max_points(){return this.maxPoints.value}get alpha(){return this.targetOpacity.value}get point_size(){return this.pointSize.value}get foreground_opacity(){return this.foregroundOpacity.value}get background_opacity(){return this.backgroundOpacity.value}get foreground_size(){return this.foregroundSize.value}get background_size(){return this.backgroundSize.value}}class n1{constructor(t,e,r){this._use_scale_to_download_tiles=!0,this._initializations=[],this.render_props=new xT,this.scatterplot=r,this.holder=Wn(t),this.canvas=Wn(this.holder.node().firstElementChild).node(),this.dataset=e,this.width=+Wn(this.canvas).attr("width"),this.height=+Wn(this.canvas).attr("height"),this.deferred_functions=[],this._use_scale_to_download_tiles=!0}get discard_share(){return 0}get prefs(){const t={...this.scatterplot.prefs};return t.arrow_table=void 0,t.arrow_buffer=void 0,t}get alpha(){return this.render_props.alpha}get optimal_alpha(){var t,e,r,s;const o=(t=this.prefs.zoom_balance)!=null?t:1,{alpha:f,point_size:c,max_ix:l,width:d,discard_share:p,height:w}=this,I=(s=(r=(e=this.zoom)==null?void 0:e.transform)==null?void 0:r.k)!=null?s:1,C=f/100,V=1/I**2,Wt=window.devicePixelRatio||1,Qt=d*w/Wt,oe=S0([l,this.dataset.highest_known_ix||1e10])*(1-p),Zt=Math.exp(Math.log(I)*o),st=Math.PI*(Zt*c/Wt/2)**2,zt=C*Qt/(oe*V*st);return zt<1/255?1/255:zt}get point_size(){return this.render_props.point_size}get max_ix(){const{prefs:t}=this,{max_points:e}=this.render_props;if(!this._use_scale_to_download_tiles)return e;const{k:r}=this.zoom.transform,s=Math.exp(Math.log(r)*t.zoom_balance);return e*r*r/s/s}visible_tiles(){const{max_ix:t}=this,{dataset:e}=this;this.aes.dim("x");const s=this.aes.dim("x").current.field=="x"&&this.aes.dim("y").current.field=="y"&&this.aes.dim("x").last.field=="x"&&this.aes.dim("y").last.field=="y"?e.map(o=>o).filter(o=>o.is_visible(t,this.zoom.current_corners())):e.map(o=>o).filter(o=>o.min_ix<this.max_ix);return s.sort((o,f)=>o.min_ix-f.min_ix),s}bind_zoom(t){return this.zoom=t,this}async initialize(){}}const ST=`precision mediump float;
#define GLSLIFY 1

vec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.411764705882353) * direction;
  vec2 off2 = vec2(3.2941176470588234) * direction;
  vec2 off3 = vec2(5.176470588235294) * direction;
  color += texture2D(image, uv) * 0.1964825501511404;
  color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;
  color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;
  color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;
  color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;
  color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;
  color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;
  return color;
}

uniform vec2 iResolution;
uniform sampler2D iChannel0;
uniform vec2 direction;

void main() {
  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);
  gl_FragColor = blur13(iChannel0, uv, iResolution.xy, direction);
}
`,AT=`precision mediump float;
#define GLSLIFY 1

uniform float u_zoom_balance;
uniform float u_tile_id;
uniform float u_update_time;
uniform float u_transition_duration;
uniform vec2 u_wrap_colors_after;
// Type of jitter.
uniform float u_jitter;
uniform float u_last_jitter;

// Whether to plot only a single category.
uniform float u_only_color;
uniform float u_grid_mode;

uniform vec3 u_filter_numeric; // An override for simple numeric operations.
uniform vec3 u_last_filter_numeric; // An override for simple numeric operations.

uniform vec3 u_filter2_numeric; // An override for simple numeric operations.
uniform vec3 u_last_filter2_numeric; // An override for simple numeric operations.

uniform vec3 u_foreground_numeric; // An override for simple numeric operations.
uniform vec3 u_last_foreground_numeric; // An override for simple numeric operations.

// Transform from data space to the open window.
uniform mat3 u_window_scale;
uniform mat3 u_last_window_scale;
// Transform from the open window to the d3-zoom.
uniform mat3 u_zoom;

uniform float u_width;
uniform float u_height;
uniform float u_use_glyphset;
varying vec2 letter_pos; // store which letter to use.

uniform float u_maxix;           // The maximum index to plot.
uniform float u_time;            // The current time.
uniform float u_k;               // The d3-scale factor.
uniform float u_color_picker_mode;
uniform float u_base_size;
uniform float u_alpha;
uniform float u_foreground_number; // -1 -- everything is foreground; 0 -- background; 1 -- foreground.
uniform vec4 u_background_rgba;
uniform float u_foreground_alpha;
uniform float u_background_mouseover;
uniform float u_foreground_size;
uniform float u_background_size;

uniform sampler2D u_one_d_aesthetic_map;
uniform sampler2D u_color_aesthetic_map;

// The same set of items for a variety of aesthetics.

// whether to continuously interpolate between
// x0 and x, y0 and y.
uniform float u_position_interpolation_mode;

float a_color;
float a_last_color;

uniform float u_color_buffer_num;
uniform float u_last_color_buffer_num;

uniform vec3 u_color_constant;
uniform vec3 u_last_color_constant;

uniform float u_color_transform;
uniform float u_last_color_transform;
uniform vec2 u_color_domain;
uniform vec2 u_last_color_domain;
uniform float u_last_color_map_position;
uniform float u_color_map_position;

bool a_color_is_constant;
bool a_last_color_is_constant;

/*
python code to generate what follows.
def autogenerate_code():
  ks = ["x", "y", "jitter_radius", "jitter_speed", "size", "filter", "filter2", "x0", "y0", "foreground"]
  times = ["", "last_"]
  print("""
  //  BEGIN AUTOGENERATED. DO NOT EDIT. 
  // ------------------------------------------------    
  """)
  for k in ks:
    for time in times:
      timek = time + k
      print(f"""
  uniform float u_{timek}_buffer_num;
  uniform float u_{timek}_constant;
  uniform float u_{timek}_transform;
  uniform vec2 u_{timek}_domain;
  uniform vec2 u_{timek}_range;
  uniform float u_{timek}_map_position;
  float a_{timek};
  bool a_{timek}_is_constant;
      """)
  for i in range(0, 16):
    print(f"attribute float buffer_{i};")
  for k in ks:
    for time in times:
      timek = time + k
      print(f"""
    if (u_{timek}_buffer_num > -0.5) {{
      a_{timek} = get_buffer(u_{timek}_buffer_num);
      a_{timek}_is_constant = false;
    }} else {{
      a_{timek} = u_{timek}_constant;
      a_{timek}_is_constant = true;
    }}""")
  print("""
//  END AUTOGENERATED. DO NOT EDIT ABOVE. 
// ------------------------------------------------    
  """)

autogenerate_code()
*/

  //  BEGIN AUTOGENERATED. DO NOT EDIT. 
  // ------------------------------------------------    
  

  uniform float u_x_buffer_num;
  uniform float u_x_constant;
  uniform float u_x_transform;
  uniform vec2 u_x_domain;
  uniform vec2 u_x_range;
  uniform float u_x_map_position;
  float a_x;
  bool a_x_is_constant;
      

  uniform float u_last_x_buffer_num;
  uniform float u_last_x_constant;
  uniform float u_last_x_transform;
  uniform vec2 u_last_x_domain;
  uniform vec2 u_last_x_range;
  uniform float u_last_x_map_position;
  float a_last_x;
  bool a_last_x_is_constant;
      

  uniform float u_y_buffer_num;
  uniform float u_y_constant;
  uniform float u_y_transform;
  uniform vec2 u_y_domain;
  uniform vec2 u_y_range;
  uniform float u_y_map_position;
  float a_y;
  bool a_y_is_constant;
      

  uniform float u_last_y_buffer_num;
  uniform float u_last_y_constant;
  uniform float u_last_y_transform;
  uniform vec2 u_last_y_domain;
  uniform vec2 u_last_y_range;
  uniform float u_last_y_map_position;
  float a_last_y;
  bool a_last_y_is_constant;
      

  uniform float u_jitter_radius_buffer_num;
  uniform float u_jitter_radius_constant;
  uniform float u_jitter_radius_transform;
  uniform vec2 u_jitter_radius_domain;
  uniform vec2 u_jitter_radius_range;
  uniform float u_jitter_radius_map_position;
  float a_jitter_radius;
  bool a_jitter_radius_is_constant;
      

  uniform float u_last_jitter_radius_buffer_num;
  uniform float u_last_jitter_radius_constant;
  uniform float u_last_jitter_radius_transform;
  uniform vec2 u_last_jitter_radius_domain;
  uniform vec2 u_last_jitter_radius_range;
  uniform float u_last_jitter_radius_map_position;
  float a_last_jitter_radius;
  bool a_last_jitter_radius_is_constant;
      

  uniform float u_jitter_speed_buffer_num;
  uniform float u_jitter_speed_constant;
  uniform float u_jitter_speed_transform;
  uniform vec2 u_jitter_speed_domain;
  uniform vec2 u_jitter_speed_range;
  uniform float u_jitter_speed_map_position;
  float a_jitter_speed;
  bool a_jitter_speed_is_constant;
      

  uniform float u_last_jitter_speed_buffer_num;
  uniform float u_last_jitter_speed_constant;
  uniform float u_last_jitter_speed_transform;
  uniform vec2 u_last_jitter_speed_domain;
  uniform vec2 u_last_jitter_speed_range;
  uniform float u_last_jitter_speed_map_position;
  float a_last_jitter_speed;
  bool a_last_jitter_speed_is_constant;
      

  uniform float u_size_buffer_num;
  uniform float u_size_constant;
  uniform float u_size_transform;
  uniform vec2 u_size_domain;
  uniform vec2 u_size_range;
  uniform float u_size_map_position;
  float a_size;
  bool a_size_is_constant;
      

  uniform float u_last_size_buffer_num;
  uniform float u_last_size_constant;
  uniform float u_last_size_transform;
  uniform vec2 u_last_size_domain;
  uniform vec2 u_last_size_range;
  uniform float u_last_size_map_position;
  float a_last_size;
  bool a_last_size_is_constant;
      

  uniform float u_filter_buffer_num;
  uniform float u_filter_constant;
  uniform float u_filter_transform;
  uniform vec2 u_filter_domain;
  uniform vec2 u_filter_range;
  uniform float u_filter_map_position;
  float a_filter;
  bool a_filter_is_constant;
      

  uniform float u_last_filter_buffer_num;
  uniform float u_last_filter_constant;
  uniform float u_last_filter_transform;
  uniform vec2 u_last_filter_domain;
  uniform vec2 u_last_filter_range;
  uniform float u_last_filter_map_position;
  float a_last_filter;
  bool a_last_filter_is_constant;
      

  uniform float u_filter2_buffer_num;
  uniform float u_filter2_constant;
  uniform float u_filter2_transform;
  uniform vec2 u_filter2_domain;
  uniform vec2 u_filter2_range;
  uniform float u_filter2_map_position;
  float a_filter2;
  bool a_filter2_is_constant;
      

  uniform float u_last_filter2_buffer_num;
  uniform float u_last_filter2_constant;
  uniform float u_last_filter2_transform;
  uniform vec2 u_last_filter2_domain;
  uniform vec2 u_last_filter2_range;
  uniform float u_last_filter2_map_position;
  float a_last_filter2;
  bool a_last_filter2_is_constant;
      

  uniform float u_x0_buffer_num;
  uniform float u_x0_constant;
  uniform float u_x0_transform;
  uniform vec2 u_x0_domain;
  uniform vec2 u_x0_range;
  uniform float u_x0_map_position;
  float a_x0;
  bool a_x0_is_constant;
      

  uniform float u_last_x0_buffer_num;
  uniform float u_last_x0_constant;
  uniform float u_last_x0_transform;
  uniform vec2 u_last_x0_domain;
  uniform vec2 u_last_x0_range;
  uniform float u_last_x0_map_position;
  float a_last_x0;
  bool a_last_x0_is_constant;
      

  uniform float u_y0_buffer_num;
  uniform float u_y0_constant;
  uniform float u_y0_transform;
  uniform vec2 u_y0_domain;
  uniform vec2 u_y0_range;
  uniform float u_y0_map_position;
  float a_y0;
  bool a_y0_is_constant;
      

  uniform float u_last_y0_buffer_num;
  uniform float u_last_y0_constant;
  uniform float u_last_y0_transform;
  uniform vec2 u_last_y0_domain;
  uniform vec2 u_last_y0_range;
  uniform float u_last_y0_map_position;
  float a_last_y0;
  bool a_last_y0_is_constant;
      

  uniform float u_foreground_buffer_num;
  uniform float u_foreground_constant;
  uniform float u_foreground_transform;
  uniform vec2 u_foreground_domain;
  uniform vec2 u_foreground_range;
  uniform float u_foreground_map_position;
  float a_foreground;
  bool a_foreground_is_constant;
      

  uniform float u_last_foreground_buffer_num;
  uniform float u_last_foreground_constant;
  uniform float u_last_foreground_transform;
  uniform vec2 u_last_foreground_domain;
  uniform vec2 u_last_foreground_range;
  uniform float u_last_foreground_map_position;
  float a_last_foreground;
  bool a_last_foreground_is_constant;
      
attribute float buffer_0;
attribute float buffer_1;
attribute float buffer_2;
attribute float buffer_3;
attribute float buffer_4;
attribute float buffer_5;
attribute float buffer_6;
attribute float buffer_7;
attribute float buffer_8;
attribute float buffer_9;
attribute float buffer_10;
attribute float buffer_11;
attribute float buffer_12;
attribute float buffer_13;
attribute float buffer_14;
attribute float buffer_15;

//  END AUTOGENERATED. DO NOT EDIT ABOVE. 
// ------------------------------------------------    

highp float ix_to_random(in float ix, in float seed) {
  // For high numbers, taking the log avoids coincidence.
  highp float seed2 = log(ix + 2.) + 1.;
  vec2 co = vec2(seed2, seed);
  highp float a = 12.9898;
  highp float b = 78.233;
  highp float c = 43758.5453;
  highp float dt = dot(co.xy, vec2(a, b));
  highp float sn = mod(dt, 3.14);
  return fract(sin(sn) * c);
}

// The fill color.
varying vec4 fill;
varying float point_size;

uniform float u_jitter_radius_lookup;
uniform float u_jitter_radius_lookup_y_constant;
uniform vec2 u_jitter_radius_lookup_x_domain;
uniform vec2 u_jitter_radius_lookup_y_domain;

float point_size_adjust;

// A coordinate to throw away a vertex point.
vec4 discard_me = vec4(100.0, 100.0, 1.0, 1.0);

// Initialized in the main loop
// mat3 from_coord_to_gl;

const float e = 1.618282;
// I've been convinced.
const float tau = 2. * 3.14159265359;

float interpolate_raw(in float x, in float min, in float max) {
  if (x < min) {return 0.;}
  if (x > max) {return 1.;}
  return (x - min)/(max - min);
}

float interpolate(in float x, in float min, in float max) {
  if (max < min) {
    return 1. - interpolate_raw(x, max, min);
  } else {
    return interpolate_raw(x, min, max);
  }
}

/*

The following glsl code was written in python.

buffers = [*range(16)]

def write_buffs(buffs):
    if len(buffs) == 1:
        return[f"return buffer_{buffs[0]}"]
    condition_1 = ["  " + line for line in write_buffs(buffs[:len(buffs)//2])]
    condition_2 = ["" + line for line in write_buffs(buffs[len(buffs)//2:])]

    args = [
        f"if (i < {buffs[len(buffs) // 2 - 1]}.5) {{",
        *condition_1,
        "}",
        *condition_2
    ]
    return args

print("\\n".join(write_buffs(buffers)))
*/

float get_buffer(in float i) {
  //given an index, returns the appropriate buffer.
  if (i < 7.5) {
    if (i < 3.5) {
      if (i < 1.5) {
        if (i < 0.5) {
          return buffer_0;
        }
        return buffer_1;
      }
      if (i < 2.5) {
        return buffer_2;
      }
      return buffer_3;
    }
    if (i < 5.5) {
      if (i < 4.5) {
        return buffer_4;
      }
      return buffer_5;
    }
    if (i < 6.5) {
      return buffer_6;
    }
    return buffer_7;
  }
  if (i < 11.5) {
    if (i < 9.5) {
      if (i < 8.5) {
        return buffer_8;
      }
      return buffer_9;
    }
    if (i < 10.5) {
      return buffer_10;
    }
    return buffer_11;
  }
  if (i < 13.5) {
    if (i < 12.5) {
      return buffer_12;
    }
    return buffer_13;
  }
  if (i < 14.5) {
    return buffer_14;
  }
  return buffer_15;
}

float linstep(in vec2 range, in float x) {
  return interpolate(x, range.x, range.y);
  float scale_size = range.y - range.x;
  float from_left = x - range.x;
  return clamp(from_left / scale_size, 0.0, 1.0);
}

float linscale(in vec2 range, in float x) {
  float scale_size = range.y - range.x;
  float from_left = x - range.x;
  return from_left / scale_size;
}

vec2 box_muller(in float ix, in float seed) {
  // Box-Muller transform gives you two gaussian randoms for two uniforms.
  highp float U = ix_to_random(ix, seed);
  highp float V = ix_to_random(ix, seed + 17.123123);
  return vec2(sqrt(-2. * log(U)) * cos(tau * V),
              sqrt(-2. * log(U)) * sin(tau * V));
}

/*************** END COLOR SCALES *******************************/

float domainify(in vec2 domain, in float transform, in float attr, in float overflow_behavior) {

  // Clamp an attribute into a domain, with an optional log or sqrt transform.
  if (transform == 2.) {
    domain = sqrt(domain);
    attr = sqrt(attr);
  }
  if (transform == 3.) {
    domain = log(domain);
    attr = log(attr);
  }
  if (overflow_behavior == 1.) {
    // clamp
    return linstep(domain, attr);
  }
  if (overflow_behavior == 2.) {
    //wrap

    return fract(linscale(domain, attr));
  }
  return linscale(domain, attr);
}

mat3 pixelspace_to_glspace;

float run_numeric_filter (in float a_filter,
  in float u_filter_op, in float u_filter_param_1,
  in float u_filter_param_2) {
  bool truthy;
  if (u_filter_op < 1.5) {
    truthy = a_filter < u_filter_param_1;
  } else if (u_filter_op < 2.5) {
    truthy = a_filter > u_filter_param_1;
  } else if (u_filter_op < 3.5) {
    truthy = a_filter == u_filter_param_1;
  } else if (u_filter_op < 4.5) {
    truthy = abs(a_filter - u_filter_param_2) < u_filter_param_1;
  }
  if (truthy) {return 1.;} else {return 0.;}
}

float choose_and_run_filter(
  in vec3 u_filter_numeric,
  in float a_filter,
  in float map_location,
  in bool filter_is_constant
  ) {
    if (filter_is_constant) {
      return 1.;
    }
    if (u_filter_numeric.r < 0.5) {
      // Must be on a dictionary. Unreasonable assumption, maybe?
      float frac_filter = linstep(vec2(-0., 4096.), a_filter);
      float map_coords = (map_location + .5) / 32.;
      return texture2D(u_one_d_aesthetic_map, vec2(map_coords, frac_filter)).a;
    } else {
      return run_numeric_filter(a_filter,
        u_filter_numeric.r, u_filter_numeric.g, u_filter_numeric.b);
    }
}

const float tau_0 = 2. * 3.14159265359;

highp float ix_to_random_1540259130(in float ix, in float seed) {
  // For high numbers, taking the log avoids coincidence.
  highp float seed2 = log(ix) + 1.;
  vec2 co = vec2(seed2, seed);
  highp float a = 12.9898;
  highp float b = 78.233;
  highp float c = 43758.5453;
  highp float dt= dot(co.xy ,vec2(a,b));
  highp float sn= mod(dt,3.14);
  return fract(sin(sn) * c);
}

highp vec2 box_muller_1540259130(in float ix, in float seed) {
  // Box-Muller transform gives you two gaussian randoms for two uniforms.
  highp float U = ix_to_random_1540259130(ix, seed);
  highp float V = ix_to_random_1540259130(ix, seed + 17.123123);
  return vec2(
    sqrt(-2.*log(U))*cos(tau_0*V),
    sqrt(-2.*log(U))*sin(tau_0*V)
  );
}

vec2 logarithmic_spiral_jitter_1540259130(
  in float ix, // a random seed.
  in float a, // offset
  in float angle_parameter_1540259130, // angle parameter
  in float randomize_angle_1540259130, // sd radians
  in float max_r_1540259130, // Maximum radius of spiral.
  in float randomize_rotation_max_radians_1540259130, // in standard deviations to the log-multiplier.
  in float randomize_radius_1540259130, // in standard deviation percentage points.
  in float hole, // donut hole size.
  in float speed_0, // webgl units per second.
  in float time_0,// The time, in seconds, to plot at. Generally passed as a uniform or something.
  in float acceleration,
  in float n_spirals_1540259130,
  in float shear,
  in float aspect_ratio_1540259130
  ) {
  // Each point starts at a different place on the spiral.
  vec2 two_gaussians_1540259130 = box_muller_1540259130(ix, 55.1);

  highp float calculated_angle = angle_parameter_1540259130 + two_gaussians_1540259130.x * randomize_angle_1540259130;
  float k = 1. / tan(calculated_angle);
  if (k > 100000.) {
    k = 0.;
  }

  // The length of the segment to be traversed.
  float arc_length =  sqrt((1. + k*k)/k) * (max_r_1540259130 - a);
  float period = arc_length / speed_0;

  // Every point needs to start at a different place along the curve.
  float stagger_time = ix_to_random_1540259130(ix, 3.);

  // How long does a circuit take? Add some random noise.
  float time_period = period * exp(box_muller_1540259130(ix, 0.031).x / 6.);

  // Adjust u_time from the clock to our current spot.
  float varying_time = time_0 + stagger_time * time_period;

  // Adjust that time by raising to a power to set the speed along the curve.
  // Not sure if this is the soundest way to parametrize.
  float relative_time = pow(1. - mod(varying_time, time_period)/time_period, acceleration);

  // Calculate the radius at this time point.
  float radius = max_r_1540259130 * relative_time + a;

  // The angle implied by that radius.
  float theta  = 1./k * log(radius / a);

  /* A different way to calculate radius from the theta. Not used
  float max_theta = 1. / k * log(max_r / a);
  float theta2 = max_theta * relative_time;
  vec2 pos_theta_style = vec2(a * exp(k * theta2), theta2);
  radius = pos_theta_style.x;
  theta = pos_theta_style.y;
  */

  // If multiple spirals, the theta needs to be rotated for which spiral we're in.
  // Choose it based on a new random seed.
  float which_spiral = floor(ix_to_random_1540259130(ix, 13.13) * n_spirals_1540259130);
  float which_spiral_adjust = which_spiral / n_spirals_1540259130 * tau_0;
  theta = theta + which_spiral_adjust;

  // Add some gaussian jitter to the polar coordinates.
  vec2 polar_jitter = box_muller_1540259130(ix, 24.);

  highp float radius_adjust = 1. + polar_jitter.x * randomize_radius_1540259130;
  highp float theta_adjust = polar_jitter.y * randomize_rotation_max_radians_1540259130;

  vec2 shear_adjust = box_muller_1540259130(ix, 59.1) * shear;

  mat3 shear_mat = mat3(
    1., shear_adjust.x, 0.,
    shear_adjust.y, 1., 0.,
    0., 0., 1.);
  // into euclidean space.
  vec3 pos_spiral = vec3(
   cos(theta + theta_adjust)*(radius * radius_adjust + hole),
   sin(theta + theta_adjust)*(radius * radius_adjust + hole),
   0.
  );
  mat3 adjust_to_viewport =
         mat3(
            1./aspect_ratio_1540259130, 0., 0.,
            0., 1., 0.,
            0., 0., 1.);

  pos_spiral = pos_spiral * shear_mat * 
               adjust_to_viewport;
  return pos_spiral.xy;
}

#define FLOAT_MAX  1.70141184e38
#define FLOAT_MIN  1.17549435e-38

lowp vec4 encode_float_1604150559(highp float v) {
  highp float av = abs(v);

  //Handle special cases
  if(av < FLOAT_MIN) {
    return vec4(0.0, 0.0, 0.0, 0.0);
  } else if(v > FLOAT_MAX) {
    return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;
  } else if(v < -FLOAT_MAX) {
    return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;
  }

  highp vec4 c = vec4(0,0,0,0);

  //Compute exponent and mantissa
  highp float e = floor(log2(av));
  highp float m = av * pow(2.0, -e) - 1.0;
  
  //Unpack mantissa
  c[1] = floor(128.0 * m);
  m -= c[1] / 128.0;
  c[2] = floor(32768.0 * m);
  m -= c[2] / 32768.0;
  c[3] = floor(8388608.0 * m);
  
  //Unpack exponent
  highp float ebias = e + 127.0;
  c[0] = floor(ebias / 2.0);
  ebias -= c[0] * 2.0;
  c[1] += floor(ebias) * 128.0; 

  //Unpack sign bit
  c[0] += 128.0 * step(0.0, -v);

  //Scale back to range
  return c / 255.0;
}

#ifndef PI
#define PI 3.141592653589793
#endif

float sineInOut_0(float t) {
  return -0.5 * (cos(PI * t) - 1.0);
}

#ifndef PI
#define PI 3.141592653589793
#endif

vec2 bezier_interpolate(vec2 p1, vec2 p2, float frac, float ix) {
  // Interpolates between two points on a Bezier curve around a jittered middle.
  // Makes animations look cooler.
    vec2 midpoint = box_muller(ix, 3.) * .05 *
         dot(p2 - p1, p2 - p1)
         + p2 / 2. + p1 / 2.;

      return mix(
        mix(p2, midpoint, frac),
        mix(midpoint, p1, frac),
      frac);
}

float sineInOut(float t) {
  return -0.5 * (cos(PI * t) - 1.0);
}

const vec4 decoder = vec4(1./256./256./256., 1. / 256. / 256., 1. / 256., 1.);

float RGBAtoFloat(in vec4 floater) {
  // Scale values up by 256.
  return dot(floater, decoder);
}

float texture_float_lookup(in vec2 domain,
                           in vec2 range,
                           in float transform,
                           in float attr,
                           in float texture_position) {
  if (transform == 4.0) {
    // Literal transforms aren't looked up, just returned as is.
    return attr;
  }
  float inrange = domainify(domain, transform, attr, 1.);
  if (texture_position > 0.5) {
    float y_pos = texture_position / 32. - 0.5 / 32.;
    vec4 encoded = texture2D(u_one_d_aesthetic_map, vec2(y_pos, inrange));
    return encoded.a;
    return RGBAtoFloat(encoded); // unreachable.
  } else {
    return mix(range.x, range.y, inrange);
  }
}

vec2 calculate_position(in vec2 position, in float x_scale_type,
                        in vec2 x_domain, in vec2 x_range, in float y_scale_type,
                        in vec2 y_domain, in vec2 y_range, in mat3 window_scale,
                        in mat3 zoom, in float x_map_position,
                        in float y_map_position
                        ) {
    float x;
    float y;

    if (x_scale_type < 4.0) {
      float x_ = linscale(u_color_domain, a_color);
      x = texture_float_lookup(x_domain, x_range,
        x_scale_type,
        position.x, 0. // ymap position 0 means never use a texture lookup.
        );
    } else {
      x = position.x;
    }

    if (y_scale_type < 4.0) {
      y = texture_float_lookup(y_domain, y_range, y_scale_type,
        position.y, 0. // ymap position 0 means never use a texture lookup.
        );
    } else {
      y = position.y;
    }
    vec3 pos2d = vec3(x, y, 1.0) * window_scale * zoom * pixelspace_to_glspace;
    return pos2d.xy;
}

float cubicInOut(float t) {
  return t < 0.5
    ? 4.0 * t * t * t
    : 1. - 4.0 * pow(1. - t, 3.0);
}

vec4 ixToRGBA(in float ix)  {
  float min = fract(ix / 256.);
  float mid = fract((ix - min) / 256.);
  float high = fract((ix - min - mid * 256.) / (256.) / 256.);
  return vec4(min, mid, high, 1.);
}

vec2 circle_jitter(in float ix, in float aspect_ratio, in float time,
                   in float radius, in float speed) {
  vec2 two_gaussians = box_muller(ix, 12.);

  float stagger_time = two_gaussians.y * tau;

  // How long does a circuit take?

  float units_per_period = radius * tau;
  float units_per_second = speed;
  float seconds_per_period = units_per_period / units_per_second;
  float time_period = seconds_per_period;
  if (time_period > 1e4) {
    return vec2(0., 0.);
  }

  // Adjust time from the clock to our current spot.
  float varying_time = time + stagger_time * time_period;
  // Where are we from 0 to 1 relative to the time period

  float relative_time = 1. - mod(varying_time, time_period) / time_period;

  float theta = relative_time * tau;
  // Problem--should it lie on a disk, or on a circle?
  float r_mult = 1.;//(sqrt(ix_to_random(ix, 7.)));

  return vec2(cos(theta) * r_mult, aspect_ratio * sin(theta) * r_mult) *
         radius;
}

vec2 calculate_jitter(
  in float jitter_type,
  in float ix, // distinguishing index
  in vec2 jitter_radius_domain,
  in vec2 jitter_radius_range,
  in float jitter_radius_transform,
  in float jitter_radius,
  in float jitter_radius_map_position,
  in bool jitter_radius_is_constant,
  in vec2 jitter_speed_domain,
  in vec2 jitter_speed_range,
  in float jitter_speed_transform,
  in float jitter_speed,
  in float jitter_speed_map_position,
  in bool jitter_speed_is_constant
) {

  // Jitter is calculated based on speed, so requires two full maps in.
  if (jitter_type == 0.) {
    // No jitter
    return vec2(0., 0.);
  }

  if (jitter_type == 5.) {
    // Temporal jitter--should be broken out into a separate channel/channels.
    float time_period = 60.;
    float share = 1./4.;
    float offset = ix_to_random(ix, 12.);
    float fractional = fract((offset * time_period + u_time)/time_period);
    if (fractional > share) {
      return vec2(0., 0.);
    }
    float size = 0.5 * (1. - cos(2. * 3.1415926 * min(fractional/share, 1. - fractional/share)));
    size = clamp(size, 0., 1.);
    return vec2(size, 0.);
  }
  float jitter_r;  
  if (jitter_radius_is_constant) {
    jitter_r = jitter_radius;
  } else {
    jitter_r = texture_float_lookup(
    jitter_radius_domain,
    jitter_radius_range,
    jitter_radius_transform,
    jitter_radius,
    0.);
  }
  if (jitter_type == 3.) {
    float r = box_muller(ix, 1.).r * jitter_r;
    r = r * point_size_adjust;
    float theta = ix_to_random(ix, 15.) * tau;
    return vec2(cos(theta) * r, sin(theta) * r * u_width / u_height);
  }

  if (jitter_type == 2.) {
    // uniform in the circle.
    float theta = ix_to_random(ix, 15.) * tau;
    float r = jitter_r * sqrt(ix_to_random(ix, 115.));
    r = r * point_size_adjust;
    return vec2(cos(theta) * r, sin(theta) * r * u_width / u_height);
  }

  /* Jittering that includes motion) */

  float p_jitter_speed =
      texture_float_lookup(jitter_speed_domain,
                          jitter_speed_range,
                          jitter_speed_transform, jitter_speed,
                          jitter_speed_map_position);

  if (jitter_type == 1.) {
    return logarithmic_spiral_jitter_1540259130(
                ix,
                0.005 * jitter_r,                     // a
                1.3302036,                       // angle parameter
                0.005,                                 // angle random
                jitter_r,                             // max radius
                0.03,                                 // random_rotation
                0.06,                                 // random radius
                0.003 * point_size_adjust * jitter_r, // donut.
                .5 * p_jitter_speed * jitter_r / point_size_adjust, // speed
                u_time,                                           // time
                0.8,                                              // acceleration
                2.0,                                              // n_spirals
                .09, //shear
                u_width/u_height         // shear
            );
  }

  if (jitter_type == 4.) {
    // circle
    return circle_jitter(ix, u_width/u_height, u_time, jitter_r, p_jitter_speed);
  }
}

void run_color_fill(in float ease) {
  float alpha = min(u_alpha, 1.0);
  if (u_only_color >= -1.5) {
    if (u_only_color > -.5 && a_color != u_only_color) {
      gl_Position = discard_me;
      return;
    } else {
      // -1 is a special value meaning 'plot everything'.
      fill = vec4(0., 0., 0., 1. / 255.);
      gl_PointSize = 1.;
    }
  } else {
    if (a_color_is_constant) {
      fill = vec4(u_color_constant.rgb, alpha);
    } else {
      float color_pos = (u_color_map_position * -1. - 1.) / 32. + 0.5 / 32.;
      float overflow_behavior = 1.; // means--clamp
      float fractional_color;
      if (u_wrap_colors_after.y > 0.) {
        fractional_color = fract(a_color / u_wrap_colors_after.y);
      } else {
        fractional_color = domainify(u_color_domain, u_color_transform, a_color, overflow_behavior);
      }
      fill = texture2D(u_color_aesthetic_map , vec2(color_pos, fractional_color));
      fill = vec4(fill.rgb, alpha);
    }
    if (ease < 1.) {
      vec4 last_fill;
      if (a_last_color_is_constant) {
        last_fill = vec4(u_last_color_constant.rgb, alpha);
      } else {
        float color_pos = (u_last_color_map_position * -1. - 1.) / 32. + 0.5 / 32.;
        float overflow_behavior = 1.; // means--clamp
        float last_fractional;
        if (u_wrap_colors_after.x > 0.) {
          last_fractional = fract(a_last_color / u_wrap_colors_after.x);
        } else {
          last_fractional = domainify(u_last_color_domain, u_last_color_transform, a_last_color, overflow_behavior);
        }
        last_fill = texture2D(u_color_aesthetic_map , vec2(color_pos, last_fractional));
        last_fill = vec4(last_fill.rgb, alpha);
        // last_fill = vec4(0.8, 0.1, 0.1, 1.0);
      }
      // RGB blending is bad--maybe use https://www.shadertoy.com/view/lsdGzN
      // instead?
      fill = mix(last_fill, fill, ease);
    }
  }
}

vec2 calc_and_interpolate_positions(
  inout vec2 old_position,
  in float u_last_x_transform,
  in vec2 u_last_x_domain,
  in vec2 u_last_x_range,
  in float u_last_y_transform,
  in vec2 u_last_y_domain,
  in vec2 u_last_y_range,
  in mat3 u_last_window_scale,
  in mat3 u_zoom,
  in float u_last_x_map_position,
  in float u_last_y_map_position,
  inout vec2 position,
  in float u_x_transform,
  in vec2 u_x_domain,
  in vec2 u_x_range,
  in float u_y_transform,
  in vec2 u_y_domain,
  in vec2 u_y_range,
  in mat3 u_window_scale,
  in float u_x_map_position,
  in float u_y_map_position,
  in float interpolation,
  in float u_grid_mode, 
  in float ix) {

  old_position = calculate_position(old_position, u_last_x_transform,
    u_last_x_domain, u_last_x_range,
    u_last_y_transform, u_last_y_domain, u_last_y_range,
    u_last_window_scale,
    u_zoom, u_last_x_map_position,      
    u_last_y_map_position);
    
  bool plot_actual_position = u_grid_mode < .5;

  if (plot_actual_position) {
    position = calculate_position(position, 
      u_x_transform,
      u_x_domain, u_x_range,
      u_y_transform, u_y_domain, 
      u_y_range, u_window_scale, u_zoom, 
      u_x_map_position, u_y_map_position);
    float xpos = clamp((1. + position.x) / 2., 0., 1.);
    float randy = ix_to_random(ix, 13.76);
    float delay = xpos + randy * .1;
    delay = delay * 3.;

    float frac = interpolate(
      u_update_time,
      delay,
      u_transition_duration + delay
    );

    frac = sineInOut_0(frac);

    if (frac <= 0.) {
      position = old_position;
    } else if (frac < 1.) {
      frac = fract(frac);
      position = bezier_interpolate(position, old_position, frac, ix);
    }
  } else {
    position.x = -1. + 2. * linscale(u_x_domain, position.x);
    //position.y = -1.0;
    vec2 jitterspec = vec2(
      (ix_to_random(ix, 3.) * a_jitter_radius ) * 2.,
      (ix_to_random(ix, 1.5) * a_jitter_speed ) * 2.
    );
    position = position + jitterspec;
  }
  return position;
}

void main() {
  float debug_mode = 0.;
  float ix = buffer_0;
  float ix_in_tile = buffer_1;
  if (ix > u_maxix) {
    // throw away points that are too low.
    gl_Position = discard_me;
    return;
  }

  if (debug_mode > 1.5) {
    // Debug mode.
    gl_PointSize = 2.;
    gl_Position = vec4(box_muller(ix, 2.).xy * .33, 0., 1.);
    return;
  }

 // Autogenerated below this point

    if (u_x_buffer_num > -0.5) {
      a_x = get_buffer(u_x_buffer_num);
      a_x_is_constant = false;
    } else {
      a_x = u_x_constant;
      a_x_is_constant = true;
    }

    if (u_last_x_buffer_num > -0.5) {
      a_last_x = get_buffer(u_last_x_buffer_num);
      a_last_x_is_constant = false;
    } else {
      a_last_x = u_last_x_constant;
      a_last_x_is_constant = true;
    }

    if (u_y_buffer_num > -0.5) {
      a_y = get_buffer(u_y_buffer_num);
      a_y_is_constant = false;
    } else {
      a_y = u_y_constant;
      a_y_is_constant = true;
    }

    if (u_last_y_buffer_num > -0.5) {
      a_last_y = get_buffer(u_last_y_buffer_num);
      a_last_y_is_constant = false;
    } else {
      a_last_y = u_last_y_constant;
      a_last_y_is_constant = true;
    }

    if (u_jitter_radius_buffer_num > -0.5) {
      a_jitter_radius = get_buffer(u_jitter_radius_buffer_num);
      a_jitter_radius_is_constant = false;
    } else {
      a_jitter_radius = u_jitter_radius_constant;
      a_jitter_radius_is_constant = true;
    }

    if (u_last_jitter_radius_buffer_num > -0.5) {
      a_last_jitter_radius = get_buffer(u_last_jitter_radius_buffer_num);
      a_last_jitter_radius_is_constant = false;
    } else {
      a_last_jitter_radius = u_last_jitter_radius_constant;
      a_last_jitter_radius_is_constant = true;
    }

    if (u_jitter_speed_buffer_num > -0.5) {
      a_jitter_speed = get_buffer(u_jitter_speed_buffer_num);
      a_jitter_speed_is_constant = false;
    } else {
      a_jitter_speed = u_jitter_speed_constant;
      a_jitter_speed_is_constant = true;
    }

    if (u_last_jitter_speed_buffer_num > -0.5) {
      a_last_jitter_speed = get_buffer(u_last_jitter_speed_buffer_num);
      a_last_jitter_speed_is_constant = false;
    } else {
      a_last_jitter_speed = u_last_jitter_speed_constant;
      a_last_jitter_speed_is_constant = true;
    }

    if (u_size_buffer_num > -0.5) {
      a_size = get_buffer(u_size_buffer_num);
      a_size_is_constant = false;
    } else {
      a_size = u_size_constant;
      a_size_is_constant = true;
    }

    if (u_last_size_buffer_num > -0.5) {
      a_last_size = get_buffer(u_last_size_buffer_num);
      a_last_size_is_constant = false;
    } else {
      a_last_size = u_last_size_constant;
      a_last_size_is_constant = true;
    }

    if (u_filter_buffer_num > -0.5) {
      a_filter = get_buffer(u_filter_buffer_num);
      a_filter_is_constant = false;
    } else {
      a_filter = u_filter_constant;
      a_filter_is_constant = true;
    }

    if (u_last_filter_buffer_num > -0.5) {
      a_last_filter = get_buffer(u_last_filter_buffer_num);
      a_last_filter_is_constant = false;
    } else {
      a_last_filter = u_last_filter_constant;
      a_last_filter_is_constant = true;
    }

    if (u_filter2_buffer_num > -0.5) {
      a_filter2 = get_buffer(u_filter2_buffer_num);
      a_filter2_is_constant = false;
    } else {
      a_filter2 = u_filter2_constant;
      a_filter2_is_constant = true;
    }

    if (u_last_filter2_buffer_num > -0.5) {
      a_last_filter2 = get_buffer(u_last_filter2_buffer_num);
      a_last_filter2_is_constant = false;
    } else {
      a_last_filter2 = u_last_filter2_constant;
      a_last_filter2_is_constant = true;
    }

    if (u_x0_buffer_num > -0.5) {
      a_x0 = get_buffer(u_x0_buffer_num);
      a_x0_is_constant = false;
    } else {
      a_x0 = u_x0_constant;
      a_x0_is_constant = true;
    }

    if (u_last_x0_buffer_num > -0.5) {
      a_last_x0 = get_buffer(u_last_x0_buffer_num);
      a_last_x0_is_constant = false;
    } else {
      a_last_x0 = u_last_x0_constant;
      a_last_x0_is_constant = true;
    }

    if (u_y0_buffer_num > -0.5) {
      a_y0 = get_buffer(u_y0_buffer_num);
      a_y0_is_constant = false;
    } else {
      a_y0 = u_y0_constant;
      a_y0_is_constant = true;
    }

    if (u_last_y0_buffer_num > -0.5) {
      a_last_y0 = get_buffer(u_last_y0_buffer_num);
      a_last_y0_is_constant = false;
    } else {
      a_last_y0 = u_last_y0_constant;
      a_last_y0_is_constant = true;
    }

    if (u_foreground_buffer_num > -0.5) {
      a_foreground = get_buffer(u_foreground_buffer_num);
      a_foreground_is_constant = false;
    } else {
      a_foreground = u_foreground_constant;
      a_foreground_is_constant = true;
    }

    if (u_last_foreground_buffer_num > -0.5) {
      a_last_foreground = get_buffer(u_last_foreground_buffer_num);
      a_last_foreground_is_constant = false;
    } else {
      a_last_foreground = u_last_foreground_constant;
      a_last_foreground_is_constant = true;
    }

//  END AUTOGENERATED. DO NOT EDIT ABOVE. 
// ------------------------------------------------    
  gl_PointSize = 1.;

  if (u_color_buffer_num > -0.5) {
    a_color = get_buffer(u_color_buffer_num);
    a_color_is_constant = false;
  } else {
    a_color = ix;
    a_color_is_constant = true;
  }

  if (u_last_color_buffer_num > -0.5) {
    a_last_color = get_buffer(u_last_color_buffer_num);
    a_last_color_is_constant = false;
  } else {
    a_last_color = ix;
    a_last_color_is_constant = true;
  }

  pixelspace_to_glspace = mat3(
      2. / u_width, 0., -1.,
      0., - 2. / u_height, 1.,
      0., 0., 1.
  );

  float interpolation =
    interpolate(u_update_time, 0., u_transition_duration);
    
  float ease = interpolation;

  // I set this sometimes.

  vec2 position = vec2(a_x, a_y);
  vec2 old_position = vec2(a_last_x, a_last_y);

  position = calc_and_interpolate_positions(
    old_position,
    u_last_x_transform,
    u_last_x_domain, u_last_x_range,
    u_last_y_transform,
    u_last_y_domain, u_last_y_range,
    u_last_window_scale,
    u_zoom,
    u_last_x_map_position,
    u_last_y_map_position,
    position,
    u_x_transform,
    u_x_domain, u_x_range,
    u_y_transform,
    u_y_domain, u_y_range,
    u_window_scale,
    u_x_map_position,
    u_y_map_position,
    interpolation,
    u_grid_mode,
    ix
  );

  if (u_x0_buffer_num > 0.) {
    vec2 position0 = vec2(a_x0, a_y0);
    vec2 old_position0 = vec2(a_last_x0, a_last_y0);

    position0 = calc_and_interpolate_positions(
      old_position0,
      u_last_x0_transform,
      u_last_x0_domain, u_last_x0_range,
      u_last_y0_transform,
      u_last_y0_domain, u_last_y0_range,
      u_last_window_scale,
      u_zoom,
      u_last_x0_map_position,
      u_last_y0_map_position,
      position0,
      u_x0_transform,
      u_x0_domain, u_x0_range,
      u_y0_transform,
      u_y0_domain, u_y0_range,
      u_window_scale,
      u_x0_map_position,
      u_y0_map_position,
      interpolation,
      u_grid_mode,
      ix
    );

    if (u_position_interpolation_mode > 0.) {
      float rand2 = ix_to_random(ix, 11.76);

      // If it's a continuous loop, just choose a random point along that loop.
      float rand_offset = fract(u_update_time/u_transition_duration / 10. + rand2);
      position = mix(position0, position, rand_offset);
    }
  }

  bool plot_actual_position = u_grid_mode < .5;

  if (u_position_interpolation_mode > 0.) {
    float rand2 = ix_to_random(ix, 11.76);

    // If it's a continuous loop, just choose a random point along that loop.
    float rand_offset = fract(u_update_time/u_transition_duration + rand2);
    
  }

/*  position = vec2(
    ix_to_random(ix, .1),
    ix_to_random(ix, .2)
  );*/
  /* FILTERING */

  float filter_status = choose_and_run_filter(
    u_filter_numeric,
    a_filter,
    u_filter_map_position,
    a_filter_is_constant
  );

  float last_filter_status = choose_and_run_filter(
    u_last_filter_numeric,
    a_last_filter,
    u_last_filter_map_position,
    a_last_filter_is_constant
  );

  float filter2_status = choose_and_run_filter(
    u_filter2_numeric,
    a_filter2,
    u_filter2_map_position,
    a_filter2_is_constant
  );

  float last_filter2_status = choose_and_run_filter(
    u_last_filter2_numeric,
    a_last_filter2,
    u_last_filter2_map_position,
    a_last_filter2_is_constant
  );

  float foreground_status = choose_and_run_filter(
    u_foreground_numeric,
    a_foreground,
    u_foreground_map_position,
    a_foreground_is_constant
  );

  float last_foreground_status = choose_and_run_filter(
    u_last_foreground_numeric,
    a_last_foreground,
    u_last_foreground_map_position,
    a_last_foreground_is_constant
  );
  float fg_ease = mix(last_foreground_status, foreground_status, ease);
  if (ease < ix_to_random(ix, 1.)) {
    foreground_status = last_foreground_status;
  }

  /*if (a_foreground_is_constant) {
    foreground_status = 1.;
  }*/

  bool was_filtered = last_filter2_status < .5 || last_filter_status < .5;
  bool will_be_filtered = filter2_status < .5 || filter_status < .5;

  bool overall_filter_status = will_be_filtered;

  if (ease < ix_to_random(ix, 1.)) {
    overall_filter_status = was_filtered;
  }

  if (overall_filter_status == true) {
    gl_Position = discard_me;
    return;
  }

  float size_multiplier = texture_float_lookup(
    u_size_domain,
    u_size_range,
    u_size_transform, a_size,
    u_size_map_position);

  float last_size_multiplier = texture_float_lookup(
    u_last_size_domain, u_last_size_range, u_last_size_transform, a_last_size,
    u_last_size_map_position);

  size_multiplier = u_base_size * 
     mix(last_size_multiplier, size_multiplier, ease);
  
  float depth_size_adjust = (1.0 - ix / (u_maxix));

  point_size_adjust = exp(log(u_k) * u_zoom_balance) ;// * depth_size_adjust;
//  point_size_adjust = exp(log(u_k) * u_zoom_balance);
  gl_PointSize = point_size_adjust * size_multiplier;

  if (gl_PointSize <= 5.1) {
    // It's ugly on new macs when it jumps straight from one to two for a bunch of points at once.
    float size_fuzz = exp(ix_to_random(ix, 3.1) * .5 - .25);
    gl_PointSize *= size_fuzz;
  }

  if (gl_PointSize <= 0.01) {
    gl_Position = discard_me;
    return;
  }
  vec2 jitter = vec2(0., 0.);

  if (plot_actual_position && (u_jitter > 0. || u_last_jitter > 0.)) {
    /* JITTER */
    jitter = vec2(ix_to_random(ix, 2. + u_time), ix_to_random(ix, 3. + u_time)) * .01;
    float jitter_radius_fraction;
      jitter = calculate_jitter(
        u_jitter, ix,
        u_jitter_radius_domain,        u_jitter_radius_range,
        u_jitter_radius_transform,        a_jitter_radius,
        u_jitter_radius_map_position,        a_jitter_radius_is_constant,
        u_jitter_speed_domain,
        u_jitter_speed_range,
        u_jitter_speed_transform, a_jitter_speed,
        u_jitter_speed_map_position, a_jitter_speed_is_constant
      );
    vec2 last_jitter;
    if (ease < 1.) {
      last_jitter = calculate_jitter(
        u_last_jitter, ix,
        u_last_jitter_radius_domain,       
        u_last_jitter_radius_range,
        u_last_jitter_radius_transform,        
        a_last_jitter_radius,
        u_last_jitter_radius_map_position,
        a_last_jitter_radius_is_constant,
        u_last_jitter_speed_domain,
        u_last_jitter_speed_range,
        u_last_jitter_speed_transform,
        a_last_jitter_speed,
        u_last_jitter_speed_map_position,
        a_last_jitter_speed_is_constant
      );
      jitter = mix(last_jitter, jitter, ease);
    }
    if (u_jitter == 5.) {
      // temporal jitter: rescale the point from the first dimension
      gl_PointSize *= jitter.x;
      jitter = vec2(0., 0.);
      if (gl_PointSize < 0.05) {
        gl_Position = discard_me;
        return;
      }
    }
    gl_Position = vec4(position + jitter, 0., 1.);
  } else {
    gl_Position = vec4(position + jitter, 0., 1.);
  }  
  if (u_color_picker_mode == 1.) {
    // Add one so the first element is distinguishable.
    fill = encode_float_1604150559(ix + 1.);
  } else if (u_color_picker_mode == 2.) {
    fill = encode_float_1604150559(u_tile_id + 1.);
  } else if (u_color_picker_mode == 3.) {
    fill = encode_float_1604150559(ix_in_tile + 1.);
  } else {
    run_color_fill(ease);
  }

  // Are we in a mode where we need to plot foreground and background?
  if (u_foreground_number > -1.) {
    // In that case, throw away points from the other half of the set.
    if (u_foreground_number != foreground_status) {
      gl_Position = discard_me;
      return;
    }
    if (u_foreground_number == 1.) {
      gl_PointSize *= u_foreground_size;
      fill = vec4(fill.rgb, min(1., fill.a * u_foreground_alpha));
    }
    // If we're in background mode, got to change the points a bit.
    if (u_foreground_number == 0.) { 
      gl_PointSize *= u_background_size;
      // Should the color piker run?
      if (u_color_picker_mode >= 1.) {
        if (u_background_mouseover == 1.) {
          // pass--keep the colors as are.
        } else {
          gl_Position = discard_me;
          return;
        }
      } else {
       float alpha = min(u_alpha * u_background_rgba.a, 1.);
        if (alpha < 1./255.) {
          // Very light alphas must be quantized. Only show an appropriate sample.
          float seed = ix_to_random(ix, 38.6);
          if (alpha * 255. < seed) {
            gl_Position = discard_me;
            return;
          } else {
            alpha = 1. / 255.;
          }
        }
        fill = vec4(u_background_rgba.rgb, alpha);
      }
    }
  }
    
  point_size = gl_PointSize;

/*  if (u_use_glyphset > 0. && point_size > 5.0) {
    float random_letter = floor(64. * ix_to_random(ix, 1.3));
    letter_pos = vec2(
      // start at a number between 0 and 7.
      mod(random_letter, 8.) / 8.,
      floor(random_letter / 8.) / 8.
    );
    gl_PointSize *= 3.0;
  }*/
}
`,ET=`#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
#endif

precision mediump float;
#define GLSLIFY 1

varying vec4 fill;
varying vec2 letter_pos;
varying float point_size;

uniform float u_only_color;
uniform float u_color_picker_mode;
//uniform float u_use_glyphset;
//uniform sampler2D u_glyphset;

float delta = 0.0, alpha = 1.0;

bool out_of_circle(in vec2 coord) {
  vec2 cxy = 2.0 * coord - 1.0;
  float r_sq = dot(cxy, cxy);
  if (r_sq > 1.03) {return true;}
  return false;
}

bool out_of_hollow_circle(in vec2 coord) {
  vec2 cxy = 2.0 * coord - 1.0;
  float r_sq = dot(cxy, cxy);
  if (r_sq > 1.01) {return true;}
  float distance_from_edge = (1.0 - r_sq) * point_size;
  if (distance_from_edge > 4.0) {return true;}
  return false;
}

bool out_of_triangle(in vec2 coord) {
  if (coord.y > (2. * abs(coord.x - .5))) {
    return false;
  }
  return true;
}

void main() {
  if (u_only_color >= -1.5) {
    gl_FragColor = vec4(0., 0., 0., 1./255.);
    return;
  }

  float alpha = fill.a;
//  if (u_use_glyphset == 0. || point_size < 5.0) {
    if (out_of_circle(gl_PointCoord)) {
      discard;
      return;
    }
    vec2 cxy = 2.0 * gl_PointCoord - 1.0;
    float r = dot(cxy, cxy);
    #ifdef GL_OES_standard_derivatives
      delta = fwidth(r);
      alpha *= (1.0 - smoothstep(1.0 - delta, 1.0 + delta, r));
    #endif
/*  } else {
    vec2 coords = letter_pos + gl_PointCoord/8.;
//    vec2 coords = vec2(.2, .2);
    vec4 sprite = texture2D(u_glyphset, coords);
    alpha *= (sprite.a);  
//    fill = vec4(1.0, 1.0, 1.0, alpha);  
    if (alpha <= 0.03) discard;
  }*/
  // Pre-blend the alpha channel.
  if (u_color_picker_mode >= 1.) {
    // no alpha when color picking; we use all four channels for that.
    gl_FragColor = fill;
  } else {
    gl_FragColor = vec4(fill.rgb * alpha, alpha);
  }

}
`;function W0(n){return n.op!==void 0}function r1(n){return n.lambda!==void 0}function Xh(n){return n.constant!==void 0}function TT(n){return n!==null&&n.url!==void 0}function IT(n){return n!==null&&n.labels!==void 0}var Q_={},OT={get exports(){return Q_},set exports(n){Q_=n}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(n,t){(function(){var e,r="4.17.21",s=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",c="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",d=500,p="__lodash_placeholder__",w=1,I=2,C=4,V=1,Wt=2,Qt=1,Rt=2,oe=4,Zt=8,st=16,zt=32,ue=64,ve=128,an=256,at=512,Y=30,rt="...",Bt=800,Dt=16,F=1,ft=2,H=3,yt=1/0,Lt=9007199254740991,Kt=17976931348623157e292,ee=NaN,de=4294967295,Oe=de-1,ye=de>>>1,Ze=[["ary",ve],["bind",Qt],["bindKey",Rt],["curry",Zt],["curryRight",st],["flip",at],["partial",zt],["partialRight",ue],["rearg",an]],on="[object Arguments]",En="[object Array]",Dn="[object AsyncFunction]",hn="[object Boolean]",Fn="[object Date]",ir="[object DOMException]",Kn="[object Error]",Yr="[object Function]",rf="[object GeneratorFunction]",Rr="[object Map]",ws="[object Number]",gu="[object Null]",oi="[object Object]",yr="[object Promise]",yu="[object Proxy]",kr="[object RegExp]",Ir="[object Set]",Ei="[object String]",b="[object Symbol]",vu="[object Undefined]",xs="[object WeakMap]",ol="[object WeakSet]",ua="[object ArrayBuffer]",lr="[object DataView]",ca="[object Float32Array]",Ti="[object Float64Array]",la="[object Int8Array]",lo="[object Int16Array]",ho="[object Int32Array]",_o="[object Uint8Array]",hr="[object Uint8ClampedArray]",Pr="[object Uint16Array]",ji="[object Uint32Array]",fl=/\b__p \+= '';/g,bu=/\b(__p \+=) '' \+/g,ul=/(__e\(.*?\)|\b__t\)) \+\n'';/g,sf=/&(?:amp|lt|gt|quot|#39);/g,Ss=/[&<>"']/g,wu=RegExp(sf.source),Ii=RegExp(Ss.source),cl=/<%-([\s\S]+?)%>/g,ll=/<%([\s\S]+?)%>/g,vr=/<%=([\s\S]+?)%>/g,hl=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,dl=/^\w*$/,fi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,af=/[\\^$.*+?()[\]{}|]/g,_l=RegExp(af.source),of=/^\s+/,pl=/\s/,ml=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Wi=/\{\n\/\* \[wrapped with (.+)\] \*/,xu=/,? & /,Cn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,gl=/[()=,{}\[\]\/\s]/,yl=/\\(\\)?/g,vl=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Yi=/\w*$/,bl=/^[-+]0x[0-9a-f]+$/i,wl=/^0b[01]+$/i,xl=/^\[object .+?Constructor\]$/,Sl=/^0o[0-7]+$/i,Al=/^(?:0|[1-9]\d*)$/,El=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,As=/($^)/,Tl=/['\n\r\u2028\u2029\\]/g,Hi="\\ud800-\\udfff",ff="\\u0300-\\u036f",Il="\\ufe20-\\ufe2f",po="\\u20d0-\\u20ff",uf=ff+Il+po,Su="\\u2700-\\u27bf",Au="a-z\\xdf-\\xf6\\xf8-\\xff",Ol="\\xac\\xb1\\xd7\\xf7",Eu="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Bl="\\u2000-\\u206f",Ml=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Tu="A-Z\\xc0-\\xd6\\xd8-\\xde",Iu="\\ufe0e\\ufe0f",Ou=Ol+Eu+Bl+Ml,cf="[']",mo="["+Hi+"]",lf="["+Ou+"]",go="["+uf+"]",Bu="\\d+",Oi="["+Su+"]",Es="["+Au+"]",hf="[^"+Hi+Ou+Bu+Su+Au+Tu+"]",ha="\\ud83c[\\udffb-\\udfff]",Mu="(?:"+go+"|"+ha+")",Lu="[^"+Hi+"]",df="(?:\\ud83c[\\udde6-\\uddff]){2}",_f="[\\ud800-\\udbff][\\udc00-\\udfff]",Jn="["+Tu+"]",br="\\u200d",da="(?:"+Es+"|"+hf+")",Ll="(?:"+Jn+"|"+hf+")",yo="(?:"+cf+"(?:d|ll|m|re|s|t|ve))?",pf="(?:"+cf+"(?:D|LL|M|RE|S|T|VE))?",mf=Mu+"?",Ru="["+Iu+"]?",vo="(?:"+br+"(?:"+[Lu,df,_f].join("|")+")"+Ru+mf+")*",_a="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gf="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",bo=Ru+mf+vo,Rl="(?:"+[Oi,df,_f].join("|")+")"+bo,Nu="(?:"+[Lu+go+"?",go,df,_f,mo].join("|")+")",yf=RegExp(cf,"g"),Du=RegExp(go,"g"),ui=RegExp(ha+"(?="+ha+")|"+Nu+bo,"g"),pa=RegExp([Jn+"?"+Es+"+"+yo+"(?="+[lf,Jn,"$"].join("|")+")",Ll+"+"+pf+"(?="+[lf,Jn+da,"$"].join("|")+")",Jn+"?"+da+"+"+yo,Jn+"+"+pf,gf,_a,Bu,Rl].join("|"),"g"),Xi=RegExp("["+br+Hi+uf+Iu+"]"),Fu=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Nl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ma=-1,yn={};yn[ca]=yn[Ti]=yn[la]=yn[lo]=yn[ho]=yn[_o]=yn[hr]=yn[Pr]=yn[ji]=!0,yn[on]=yn[En]=yn[ua]=yn[hn]=yn[lr]=yn[Fn]=yn[Kn]=yn[Yr]=yn[Rr]=yn[ws]=yn[oi]=yn[kr]=yn[Ir]=yn[Ei]=yn[xs]=!1;var vn={};vn[on]=vn[En]=vn[ua]=vn[lr]=vn[hn]=vn[Fn]=vn[ca]=vn[Ti]=vn[la]=vn[lo]=vn[ho]=vn[Rr]=vn[ws]=vn[oi]=vn[kr]=vn[Ir]=vn[Ei]=vn[b]=vn[_o]=vn[hr]=vn[Pr]=vn[ji]=!0,vn[Kn]=vn[Yr]=vn[xs]=!1;var vf={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},Dl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},B={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},G={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},it=parseFloat,ie=parseInt,Ke=typeof ls=="object"&&ls&&ls.Object===Object&&ls,_n=typeof self=="object"&&self&&self.Object===Object&&self,De=Ke||_n||Function("return this")(),We=t&&!t.nodeType&&t,dn=We&&!0&&n&&!n.nodeType&&n,Or=dn&&dn.exports===We,dr=Or&&Ke.process,sr=function(){try{var W=dn&&dn.require&&dn.require("util").types;return W||dr&&dr.binding&&dr.binding("util")}catch{}}(),wo=sr&&sr.isArrayBuffer,zr=sr&&sr.isDate,bf=sr&&sr.isMap,ld=sr&&sr.isRegExp,xo=sr&&sr.isSet,hd=sr&&sr.isTypedArray;function ar(W,gt,ut){switch(ut.length){case 0:return W.call(gt);case 1:return W.call(gt,ut[0]);case 2:return W.call(gt,ut[0],ut[1]);case 3:return W.call(gt,ut[0],ut[1],ut[2])}return W.apply(gt,ut)}function dd(W,gt,ut,se){for(var Be=-1,fn=W==null?0:W.length;++Be<fn;){var Qn=W[Be];gt(se,Qn,ut(Qn),W)}return se}function _r(W,gt){for(var ut=-1,se=W==null?0:W.length;++ut<se&&gt(W[ut],ut,W)!==!1;);return W}function _d(W,gt){for(var ut=W==null?0:W.length;ut--&&gt(W[ut],ut,W)!==!1;);return W}function Ts(W,gt){for(var ut=-1,se=W==null?0:W.length;++ut<se;)if(!gt(W[ut],ut,W))return!1;return!0}function Bi(W,gt){for(var ut=-1,se=W==null?0:W.length,Be=0,fn=[];++ut<se;){var Qn=W[ut];gt(Qn,ut,W)&&(fn[Be++]=Qn)}return fn}function Cu(W,gt){var ut=W==null?0:W.length;return!!ut&&Zi(W,gt,0)>-1}function Fl(W,gt,ut){for(var se=-1,Be=W==null?0:W.length;++se<Be;)if(ut(gt,W[se]))return!0;return!1}function kn(W,gt){for(var ut=-1,se=W==null?0:W.length,Be=Array(se);++ut<se;)Be[ut]=gt(W[ut],ut,W);return Be}function qi(W,gt){for(var ut=-1,se=gt.length,Be=W.length;++ut<se;)W[Be+ut]=gt[ut];return W}function Cl(W,gt,ut,se){var Be=-1,fn=W==null?0:W.length;for(se&&fn&&(ut=W[++Be]);++Be<fn;)ut=gt(ut,W[Be],Be,W);return ut}function Kp(W,gt,ut,se){var Be=W==null?0:W.length;for(se&&Be&&(ut=W[--Be]);Be--;)ut=gt(ut,W[Be],Be,W);return ut}function ku(W,gt){for(var ut=-1,se=W==null?0:W.length;++ut<se;)if(gt(W[ut],ut,W))return!0;return!1}var Bn=ya("length");function pd(W){return W.split("")}function Jp(W){return W.match(Cn)||[]}function ci(W,gt,ut){var se;return ut(W,function(Be,fn,Qn){if(gt(Be,fn,Qn))return se=fn,!1}),se}function So(W,gt,ut,se){for(var Be=W.length,fn=ut+(se?1:-1);se?fn--:++fn<Be;)if(gt(W[fn],fn,W))return fn;return-1}function Zi(W,gt,ut){return gt===gt?To(W,gt,ut):So(W,Pu,ut)}function ga(W,gt,ut,se){for(var Be=ut-1,fn=W.length;++Be<fn;)if(se(W[Be],gt))return Be;return-1}function Pu(W){return W!==W}function wf(W,gt){var ut=W==null?0:W.length;return ut?zu(W,gt)/ut:ee}function ya(W){return function(gt){return gt==null?e:gt[W]}}function Ao(W){return function(gt){return W==null?e:W[gt]}}function kl(W,gt,ut,se,Be){return Be(W,function(fn,Qn,pn){ut=se?(se=!1,fn):gt(ut,fn,Qn,pn)}),ut}function Pl(W,gt){var ut=W.length;for(W.sort(gt);ut--;)W[ut]=W[ut].value;return W}function zu(W,gt){for(var ut,se=-1,Be=W.length;++se<Be;){var fn=gt(W[se]);fn!==e&&(ut=ut===e?fn:ut+fn)}return ut}function zl(W,gt){for(var ut=-1,se=Array(W);++ut<W;)se[ut]=gt(ut);return se}function Qp(W,gt){return kn(gt,function(ut){return[ut,W[ut]]})}function md(W){return W&&W.slice(0,bd(W)+1).replace(of,"")}function Ur(W){return function(gt){return W(gt)}}function xf(W,gt){return kn(gt,function(ut){return W[ut]})}function Is(W,gt){return W.has(gt)}function Uu(W,gt){for(var ut=-1,se=W.length;++ut<se&&Zi(gt,W[ut],0)>-1;);return ut}function Gu(W,gt){for(var ut=W.length;ut--&&Zi(gt,W[ut],0)>-1;);return ut}function Eo(W,gt){for(var ut=W.length,se=0;ut--;)W[ut]===gt&&++se;return se}var Ul=Ao(vf),Gl=Ao(Dl);function $l(W){return"\\"+G[W]}function Vl(W,gt){return W==null?e:W[gt]}function va(W){return Xi.test(W)}function gd(W){return Fu.test(W)}function yd(W){for(var gt,ut=[];!(gt=W.next()).done;)ut.push(gt.value);return ut}function $u(W){var gt=-1,ut=Array(W.size);return W.forEach(function(se,Be){ut[++gt]=[Be,se]}),ut}function jl(W,gt){return function(ut){return W(gt(ut))}}function Ki(W,gt){for(var ut=-1,se=W.length,Be=0,fn=[];++ut<se;){var Qn=W[ut];(Qn===gt||Qn===p)&&(W[ut]=p,fn[Be++]=ut)}return fn}function Sf(W){var gt=-1,ut=Array(W.size);return W.forEach(function(se){ut[++gt]=se}),ut}function vd(W){var gt=-1,ut=Array(W.size);return W.forEach(function(se){ut[++gt]=[se,se]}),ut}function To(W,gt,ut){for(var se=ut-1,Be=W.length;++se<Be;)if(W[se]===gt)return se;return-1}function Wl(W,gt,ut){for(var se=ut+1;se--;)if(W[se]===gt)return se;return se}function Os(W){return va(W)?em(W):Bn(W)}function Br(W){return va(W)?Yl(W):pd(W)}function bd(W){for(var gt=W.length;gt--&&pl.test(W.charAt(gt)););return gt}var tm=Ao(B);function em(W){for(var gt=ui.lastIndex=0;ui.test(W);)++gt;return gt}function Yl(W){return W.match(ui)||[]}function nm(W){return W.match(pa)||[]}var rm=function W(gt){gt=gt==null?De:Io.defaults(De.Object(),gt,Io.pick(De,Nl));var ut=gt.Array,se=gt.Date,Be=gt.Error,fn=gt.Function,Qn=gt.Math,pn=gt.Object,Hl=gt.RegExp,im=gt.String,Hr=gt.TypeError,Vu=ut.prototype,sm=fn.prototype,Oo=pn.prototype,ju=gt["__core-js_shared__"],Af=sm.toString,un=Oo.hasOwnProperty,am=0,Ef=function(){var i=/[^.]+$/.exec(ju&&ju.keys&&ju.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Mr=Oo.toString,Bo=Af.call(pn),wd=De._,xd=Hl("^"+Af.call(un).replace(af,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Tf=Or?gt.Buffer:e,Ji=gt.Symbol,If=gt.Uint8Array,Xl=Tf?Tf.allocUnsafe:e,Wu=jl(pn.getPrototypeOf,pn),ba=pn.create,tr=Oo.propertyIsEnumerable,Of=Vu.splice,ql=Ji?Ji.isConcatSpreadable:e,li=Ji?Ji.iterator:e,Bs=Ji?Ji.toStringTag:e,Bf=function(){try{var i=M(pn,"defineProperty");return i({},"",{}),i}catch{}}(),om=gt.clearTimeout!==De.clearTimeout&&gt.clearTimeout,fm=se&&se.now!==De.Date.now&&se.now,um=gt.setTimeout!==De.setTimeout&&gt.setTimeout,Yu=Qn.ceil,Mo=Qn.floor,Hu=pn.getOwnPropertySymbols,cm=Tf?Tf.isBuffer:e,Zl=gt.isFinite,Sd=Vu.join,lm=jl(pn.keys,pn),$n=Qn.max,wr=Qn.min,Ms=se.now,Xu=gt.parseInt,Kl=Qn.random,Ad=Vu.reverse,qu=M(gt,"DataView"),Lo=M(gt,"Map"),Zu=M(gt,"Promise"),wa=M(gt,"Set"),Ro=M(gt,"WeakMap"),No=M(pn,"create"),Mf=Ro&&new Ro,xr={},Ed=sn(qu),hm=sn(Lo),Qi=sn(Zu),Jl=sn(wa),xa=sn(Ro),Sa=Ji?Ji.prototype:e,Do=Sa?Sa.valueOf:e,Ql=Sa?Sa.toString:e;function y(i){if(Zn(i)&&!ze(i)&&!(i instanceof tn)){if(i instanceof Xr)return i;if(un.call(i,"__wrapped__"))return jn(i)}return new Xr(i)}var Aa=function(){function i(){}return function(a){if(!Hn(a))return{};if(ba)return ba(a);i.prototype=a;var u=new i;return i.prototype=e,u}}();function Lf(){}function Xr(i,a){this.__wrapped__=i,this.__actions__=[],this.__chain__=!!a,this.__index__=0,this.__values__=e}y.templateSettings={escape:cl,evaluate:ll,interpolate:vr,variable:"",imports:{_:y}},y.prototype=Lf.prototype,y.prototype.constructor=y,Xr.prototype=Aa(Lf.prototype),Xr.prototype.constructor=Xr;function tn(i){this.__wrapped__=i,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=de,this.__views__=[]}function dm(){var i=new tn(this.__wrapped__);return i.__actions__=Ar(this.__actions__),i.__dir__=this.__dir__,i.__filtered__=this.__filtered__,i.__iteratees__=Ar(this.__iteratees__),i.__takeCount__=this.__takeCount__,i.__views__=Ar(this.__views__),i}function _m(){if(this.__filtered__){var i=new tn(this);i.__dir__=-1,i.__filtered__=!0}else i=this.clone(),i.__dir__*=-1;return i}function pm(){var i=this.__wrapped__.value(),a=this.__dir__,u=ze(i),h=a<0,m=u?i.length:0,x=bt(0,m,this.__views__),N=x.start,k=x.end,Z=k-N,At=h?k:N-1,Tt=this.__iteratees__,Ft=Tt.length,ne=0,pe=wr(Z,this.__takeCount__);if(!u||!h&&m==Z&&pe==Z)return Gf(i,this.__actions__);var xe=[];t:for(;Z--&&ne<pe;){At+=a;for(var Je=-1,Se=i[At];++Je<Ft;){var rn=Tt[Je],cn=rn.iteratee,vi=rn.type,Vr=cn(Se);if(vi==ft)Se=Vr;else if(!Vr){if(vi==F)continue t;break t}}xe[ne++]=Se}return xe}tn.prototype=Aa(Lf.prototype),tn.prototype.constructor=tn;function Ea(i){var a=-1,u=i==null?0:i.length;for(this.clear();++a<u;){var h=i[a];this.set(h[0],h[1])}}function mm(){this.__data__=No?No(null):{},this.size=0}function Td(i){var a=this.has(i)&&delete this.__data__[i];return this.size-=a?1:0,a}function Id(i){var a=this.__data__;if(No){var u=a[i];return u===l?e:u}return un.call(a,i)?a[i]:e}function gm(i){var a=this.__data__;return No?a[i]!==e:un.call(a,i)}function ym(i,a){var u=this.__data__;return this.size+=this.has(i)?0:1,u[i]=No&&a===e?l:a,this}Ea.prototype.clear=mm,Ea.prototype.delete=Td,Ea.prototype.get=Id,Ea.prototype.has=gm,Ea.prototype.set=ym;function hi(i){var a=-1,u=i==null?0:i.length;for(this.clear();++a<u;){var h=i[a];this.set(h[0],h[1])}}function Ku(){this.__data__=[],this.size=0}function vm(i){var a=this.__data__,u=Ls(a,i);if(u<0)return!1;var h=a.length-1;return u==h?a.pop():Of.call(a,u,1),--this.size,!0}function bm(i){var a=this.__data__,u=Ls(a,i);return u<0?e:a[u][1]}function wm(i){return Ls(this.__data__,i)>-1}function xm(i,a){var u=this.__data__,h=Ls(u,i);return h<0?(++this.size,u.push([i,a])):u[h][1]=a,this}hi.prototype.clear=Ku,hi.prototype.delete=vm,hi.prototype.get=bm,hi.prototype.has=wm,hi.prototype.set=xm;function ts(i){var a=-1,u=i==null?0:i.length;for(this.clear();++a<u;){var h=i[a];this.set(h[0],h[1])}}function Od(){this.size=0,this.__data__={hash:new Ea,map:new(Lo||hi),string:new Ea}}function Sm(i){var a=_(this,i).delete(i);return this.size-=a?1:0,a}function Am(i){return _(this,i).get(i)}function Em(i){return _(this,i).has(i)}function Tm(i,a){var u=_(this,i),h=u.size;return u.set(i,a),this.size+=u.size==h?0:1,this}ts.prototype.clear=Od,ts.prototype.delete=Sm,ts.prototype.get=Am,ts.prototype.has=Em,ts.prototype.set=Tm;function Ta(i){var a=-1,u=i==null?0:i.length;for(this.__data__=new ts;++a<u;)this.add(i[a])}function Fo(i){return this.__data__.set(i,l),this}function Im(i){return this.__data__.has(i)}Ta.prototype.add=Ta.prototype.push=Fo,Ta.prototype.has=Im;function di(i){var a=this.__data__=new hi(i);this.size=a.size}function Bd(){this.__data__=new hi,this.size=0}function Ju(i){var a=this.__data__,u=a.delete(i);return this.size=a.size,u}function Md(i){return this.__data__.get(i)}function th(i){return this.__data__.has(i)}function Om(i,a){var u=this.__data__;if(u instanceof hi){var h=u.__data__;if(!Lo||h.length<s-1)return h.push([i,a]),this.size=++u.size,this;u=this.__data__=new ts(h)}return u.set(i,a),this.size=u.size,this}di.prototype.clear=Bd,di.prototype.delete=Ju,di.prototype.get=Md,di.prototype.has=th,di.prototype.set=Om;function eh(i,a){var u=ze(i),h=!u&&Zf(i),m=!u&&!h&&Ho(i),x=!u&&!h&&!m&&gc(i),N=u||h||m||x,k=N?zl(i.length,im):[],Z=k.length;for(var At in i)(a||un.call(i,At))&&!(N&&(At=="length"||m&&(At=="offset"||At=="parent")||x&&(At=="buffer"||At=="byteLength"||At=="byteOffset")||z(At,Z)))&&k.push(At);return k}function Ld(i){var a=i.length;return a?i[sc(0,a-1)]:e}function Bm(i,a){return xn(Ar(i),Ia(a,0,i.length))}function Mm(i){return xn(Ar(i))}function nh(i,a,u){(u!==e&&!as(i[a],u)||u===e&&!(a in i))&&Nr(i,a,u)}function Rf(i,a,u){var h=i[a];(!(un.call(i,a)&&as(h,u))||u===e&&!(a in i))&&Nr(i,a,u)}function Ls(i,a){for(var u=i.length;u--;)if(as(i[u][0],a))return u;return-1}function Lm(i,a,u,h){return Mi(i,function(m,x,N){a(h,m,u(m),N)}),h}function Nf(i,a){return i&&Li(a,Tr(a),i)}function Rm(i,a){return i&&Li(a,Qr(a),i)}function Nr(i,a,u){a=="__proto__"&&Bf?Bf(i,a,{configurable:!0,enumerable:!0,value:u,writable:!0}):i[a]=u}function Rs(i,a){for(var u=-1,h=a.length,m=ut(h),x=i==null;++u<h;)m[u]=x?e:Ym(i,a[u]);return m}function Ia(i,a,u){return i===i&&(u!==e&&(i=i<=u?i:u),a!==e&&(i=i>=a?i:a)),i}function pr(i,a,u,h,m,x){var N,k=a&w,Z=a&I,At=a&C;if(u&&(N=m?u(i,h,m,x):u(i)),N!==e)return N;if(!Hn(i))return i;var Tt=ze(i);if(Tt){if(N=Mt(i),!k)return Ar(i,N)}else{var Ft=et(i),ne=Ft==Yr||Ft==rf;if(Ho(i))return Vf(i,k);if(Ft==oi||Ft==on||ne&&!m){if(N=Z||ne?{}:Ot(i),!k)return Z?Cm(i,Rm(N,i)):Fm(i,Nf(N,i))}else{if(!vn[Ft])return m?i:{};N=Ct(i,Ft,k)}}x||(x=new di);var pe=x.get(i);if(pe)return pe;x.set(i,N),Ay(i)?i.forEach(function(Se){N.add(pr(Se,a,u,Se,i,x))}):xy(i)&&i.forEach(function(Se,rn){N.set(rn,pr(Se,a,u,rn,i,x))});var xe=At?Z?_c:dc:Z?Qr:Tr,Je=Tt?e:xe(i);return _r(Je||i,function(Se,rn){Je&&(rn=Se,Se=i[rn]),Rf(N,rn,pr(Se,a,u,rn,i,x))}),N}function Rd(i){var a=Tr(i);return function(u){return Oa(u,i,a)}}function Oa(i,a,u){var h=u.length;if(i==null)return!h;for(i=pn(i);h--;){var m=u[h],x=a[m],N=i[m];if(N===e&&!(m in i)||!x(N))return!1}return!0}function Qu(i,a,u){if(typeof i!="function")throw new Hr(f);return fe(function(){i.apply(e,u)},a)}function Ba(i,a,u,h){var m=-1,x=Cu,N=!0,k=i.length,Z=[],At=a.length;if(!k)return Z;u&&(a=kn(a,Ur(u))),h?(x=Fl,N=!1):a.length>=s&&(x=Is,N=!1,a=new Ta(a));t:for(;++m<k;){var Tt=i[m],Ft=u==null?Tt:u(Tt);if(Tt=h||Tt!==0?Tt:0,N&&Ft===Ft){for(var ne=At;ne--;)if(a[ne]===Ft)continue t;Z.push(Tt)}else x(a,Ft,h)||Z.push(Tt)}return Z}var Mi=yh(qr),tc=yh(Df,!0);function rh(i,a){var u=!0;return Mi(i,function(h,m,x){return u=!!a(h,m,x),u}),u}function Ma(i,a,u){for(var h=-1,m=i.length;++h<m;){var x=i[h],N=a(x);if(N!=null&&(k===e?N===N&&!yi(N):u(N,k)))var k=N,Z=x}return Z}function Nd(i,a,u,h){var m=i.length;for(u=He(u),u<0&&(u=-u>m?0:m+u),h=h===e||h>m?m:He(h),h<0&&(h+=m),h=u>h?0:Ty(h);u<h;)i[u++]=a;return i}function ih(i,a){var u=[];return Mi(i,function(h,m,x){a(h,m,x)&&u.push(h)}),u}function or(i,a,u,h,m){var x=-1,N=i.length;for(u||(u=Et),m||(m=[]);++x<N;){var k=i[x];a>0&&u(k)?a>1?or(k,a-1,u,h,m):qi(m,k):h||(m[m.length]=k)}return m}var ec=vh(),sh=vh(!0);function qr(i,a){return i&&ec(i,a,Tr)}function Df(i,a){return i&&sh(i,a,Tr)}function Ff(i,a){return Bi(a,function(u){return ja(i[u])})}function Ns(i,a){a=_i(a,i);for(var u=0,h=a.length;i!=null&&u<h;)i=i[mn(a[u++])];return u&&u==h?i:e}function ah(i,a,u){var h=a(i);return ze(i)?h:qi(h,u(i))}function Sr(i){return i==null?i===e?vu:gu:Bs&&Bs in pn(i)?tt(i):Pt(i)}function Cf(i,a){return i>a}function Dd(i,a){return i!=null&&un.call(i,a)}function Fd(i,a){return i!=null&&a in pn(i)}function oh(i,a,u){return i>=wr(a,u)&&i<$n(a,u)}function kf(i,a,u){for(var h=u?Fl:Cu,m=i[0].length,x=i.length,N=x,k=ut(x),Z=1/0,At=[];N--;){var Tt=i[N];N&&a&&(Tt=kn(Tt,Ur(a))),Z=wr(Tt.length,Z),k[N]=!u&&(a||m>=120&&Tt.length>=120)?new Ta(N&&Tt):e}Tt=i[0];var Ft=-1,ne=k[0];t:for(;++Ft<m&&At.length<Z;){var pe=Tt[Ft],xe=a?a(pe):pe;if(pe=u||pe!==0?pe:0,!(ne?Is(ne,xe):h(At,xe,u))){for(N=x;--N;){var Je=k[N];if(!(Je?Is(Je,xe):h(i[N],xe,u)))continue t}ne&&ne.push(xe),At.push(pe)}}return At}function Cd(i,a,u,h){return qr(i,function(m,x,N){a(h,u(m),x,N)}),h}function La(i,a,u){a=_i(a,i),i=ge(i,a);var h=i==null?i:i[mn(L(a))];return h==null?e:ar(h,i,u)}function fh(i){return Zn(i)&&Sr(i)==on}function kd(i){return Zn(i)&&Sr(i)==ua}function uh(i){return Zn(i)&&Sr(i)==Fn}function Co(i,a,u,h,m){return i===a?!0:i==null||a==null||!Zn(i)&&!Zn(a)?i!==i&&a!==a:Pd(i,a,u,h,Co,m)}function Pd(i,a,u,h,m,x){var N=ze(i),k=ze(a),Z=N?En:et(i),At=k?En:et(a);Z=Z==on?oi:Z,At=At==on?oi:At;var Tt=Z==oi,Ft=At==oi,ne=Z==At;if(ne&&Ho(i)){if(!Ho(a))return!1;N=!0,Tt=!1}if(ne&&!Tt)return x||(x=new di),N||gc(i)?qd(i,a,u,h,m,x):Um(i,a,Z,u,h,m,x);if(!(u&V)){var pe=Tt&&un.call(i,"__wrapped__"),xe=Ft&&un.call(a,"__wrapped__");if(pe||xe){var Je=pe?i.value():i,Se=xe?a.value():a;return x||(x=new di),m(Je,Se,u,h,x)}}return ne?(x||(x=new di),Gm(i,a,u,h,m,x)):!1}function ch(i){return Zn(i)&&et(i)==Rr}function Pf(i,a,u,h){var m=u.length,x=m,N=!h;if(i==null)return!x;for(i=pn(i);m--;){var k=u[m];if(N&&k[2]?k[1]!==i[k[0]]:!(k[0]in i))return!1}for(;++m<x;){k=u[m];var Z=k[0],At=i[Z],Tt=k[1];if(N&&k[2]){if(At===e&&!(Z in i))return!1}else{var Ft=new di;if(h)var ne=h(At,Tt,Z,i,a,Ft);if(!(ne===e?Co(Tt,At,V|Wt,h,Ft):ne))return!1}}return!0}function ko(i){if(!Hn(i)||Vt(i))return!1;var a=ja(i)?xd:xl;return a.test(sn(i))}function zd(i){return Zn(i)&&Sr(i)==kr}function nc(i){return Zn(i)&&et(i)==Ir}function es(i){return Zn(i)&&r_(i.length)&&!!yn[Sr(i)]}function Po(i){return typeof i=="function"?i:i==null?ti:typeof i=="object"?ze(i)?Cs(i[0],i[1]):Fs(i):ky(i)}function ns(i){if(!re(i))return lm(i);var a=[];for(var u in pn(i))un.call(i,u)&&u!="constructor"&&a.push(u);return a}function zf(i){if(!Hn(i))return St(i);var a=re(i),u=[];for(var h in i)h=="constructor"&&(a||!un.call(i,h))||u.push(h);return u}function Ra(i,a){return i<a}function Ds(i,a){var u=-1,h=Jr(i)?ut(i.length):[];return Mi(i,function(m,x,N){h[++u]=a(m,x,N)}),h}function Fs(i){var a=v(i);return a.length==1&&a[0][2]?ht(a[0][0],a[0][1]):function(u){return u===i||Pf(u,i,a)}}function Cs(i,a){return xt(i)&&dt(a)?ht(mn(i),a):function(u){var h=Ym(u,i);return h===e&&h===a?Hm(u,i):Co(a,h,V|Wt)}}function Na(i,a,u,h,m){i!==a&&ec(a,function(x,N){if(m||(m=new di),Hn(x))rc(i,a,N,u,Na,h,m);else{var k=h?h(Gt(i,N),x,N+"",i,a,m):e;k===e&&(k=x),nh(i,N,k)}},Qr)}function rc(i,a,u,h,m,x,N){var k=Gt(i,u),Z=Gt(a,u),At=N.get(Z);if(At){nh(i,u,At);return}var Tt=x?x(k,Z,u+"",i,a,N):e,Ft=Tt===e;if(Ft){var ne=ze(Z),pe=!ne&&Ho(Z),xe=!ne&&!pe&&gc(Z);Tt=Z,ne||pe||xe?ze(k)?Tt=k:nr(k)?Tt=Ar(k):pe?(Ft=!1,Tt=Vf(Z,!0)):xe?(Ft=!1,Tt=Wo(Z,!0)):Tt=[]:Eh(Z)||Zf(Z)?(Tt=k,Zf(k)?Tt=Iy(k):(!Hn(k)||ja(k))&&(Tt=Ot(Z))):Ft=!1}Ft&&(N.set(Z,Tt),m(Tt,Z,h,x,N),N.delete(Z)),nh(i,u,Tt)}function zo(i,a){var u=i.length;if(u)return a+=a<0?u:0,z(a,u)?i[a]:e}function ic(i,a,u){a.length?a=kn(a,function(x){return ze(x)?function(N){return Ns(N,x.length===1?x[0]:x)}:x}):a=[ti];var h=-1;a=kn(a,Ur(be()));var m=Ds(i,function(x,N,k){var Z=kn(a,function(At){return At(x)});return{criteria:Z,index:++h,value:x}});return Pl(m,function(x,N){return Hf(x,N,u)})}function lh(i,a){return Da(i,a,function(u,h){return Hm(i,h)})}function Da(i,a,u){for(var h=-1,m=a.length,x={};++h<m;){var N=a[h],k=Ns(i,N);u(k,N)&&Uf(x,_i(N,i),k)}return x}function Uo(i){return function(a){return Ns(a,i)}}function hh(i,a,u,h){var m=h?ga:Zi,x=-1,N=a.length,k=i;for(i===a&&(a=Ar(a)),u&&(k=kn(i,Ur(u)));++x<N;)for(var Z=0,At=a[x],Tt=u?u(At):At;(Z=m(k,Tt,Z,h))>-1;)k!==i&&Of.call(k,Z,1),Of.call(i,Z,1);return i}function Ud(i,a){for(var u=i?a.length:0,h=u-1;u--;){var m=a[u];if(u==h||m!==x){var x=m;z(m)?Of.call(i,m,1):ph(i,m)}}return i}function sc(i,a){return i+Mo(Kl()*(a-i+1))}function Gd(i,a,u,h){for(var m=-1,x=$n(Yu((a-i)/(u||1)),0),N=ut(x);x--;)N[h?x:++m]=i,i+=u;return N}function ac(i,a){var u="";if(!i||a<1||a>Lt)return u;do a%2&&(u+=i),a=Mo(a/2),a&&(i+=i);while(a);return u}function Ye(i,a){return me(Ut(i,a,ti),i+"")}function Go(i){return Ld(yc(i))}function dh(i,a){var u=yc(i);return xn(u,Ia(a,0,u.length))}function Uf(i,a,u,h){if(!Hn(i))return i;a=_i(a,i);for(var m=-1,x=a.length,N=x-1,k=i;k!=null&&++m<x;){var Z=mn(a[m]),At=u;if(Z==="__proto__"||Z==="constructor"||Z==="prototype")return i;if(m!=N){var Tt=k[Z];At=h?h(Tt,Z,k):e,At===e&&(At=Hn(Tt)?Tt:z(a[m+1])?[]:{})}Rf(k,Z,At),k=k[Z]}return i}var $d=Mf?function(i,a){return Mf.set(i,a),i}:ti,Vd=Bf?function(i,a){return Bf(i,"toString",{configurable:!0,enumerable:!1,value:qm(a),writable:!0})}:ti;function Nm(i){return xn(yc(i))}function Zr(i,a,u){var h=-1,m=i.length;a<0&&(a=-a>m?0:m+a),u=u>m?m:u,u<0&&(u+=m),m=a>u?0:u-a>>>0,a>>>=0;for(var x=ut(m);++h<m;)x[h]=i[h+a];return x}function Dm(i,a){var u;return Mi(i,function(h,m,x){return u=a(h,m,x),!u}),!!u}function oc(i,a,u){var h=0,m=i==null?h:i.length;if(typeof a=="number"&&a===a&&m<=ye){for(;h<m;){var x=h+m>>>1,N=i[x];N!==null&&!yi(N)&&(u?N<=a:N<a)?h=x+1:m=x}return m}return _h(i,a,ti,u)}function _h(i,a,u,h){var m=0,x=i==null?0:i.length;if(x===0)return 0;a=u(a);for(var N=a!==a,k=a===null,Z=yi(a),At=a===e;m<x;){var Tt=Mo((m+x)/2),Ft=u(i[Tt]),ne=Ft!==e,pe=Ft===null,xe=Ft===Ft,Je=yi(Ft);if(N)var Se=h||xe;else At?Se=xe&&(h||ne):k?Se=xe&&ne&&(h||!pe):Z?Se=xe&&ne&&!pe&&(h||!Je):pe||Je?Se=!1:Se=h?Ft<=a:Ft<a;Se?m=Tt+1:x=Tt}return wr(x,Oe)}function jd(i,a){for(var u=-1,h=i.length,m=0,x=[];++u<h;){var N=i[u],k=a?a(N):N;if(!u||!as(k,Z)){var Z=k;x[m++]=N===0?0:N}}return x}function Wd(i){return typeof i=="number"?i:yi(i)?ee:+i}function Gr(i){if(typeof i=="string")return i;if(ze(i))return kn(i,Gr)+"";if(yi(i))return Ql?Ql.call(i):"";var a=i+"";return a=="0"&&1/i==-yt?"-0":a}function ks(i,a,u){var h=-1,m=Cu,x=i.length,N=!0,k=[],Z=k;if(u)N=!1,m=Fl;else if(x>=s){var At=a?null:Pm(i);if(At)return Sf(At);N=!1,m=Is,Z=new Ta}else Z=a?[]:k;t:for(;++h<x;){var Tt=i[h],Ft=a?a(Tt):Tt;if(Tt=u||Tt!==0?Tt:0,N&&Ft===Ft){for(var ne=Z.length;ne--;)if(Z[ne]===Ft)continue t;a&&Z.push(Ft),k.push(Tt)}else m(Z,Ft,u)||(Z!==k&&Z.push(Ft),k.push(Tt))}return k}function ph(i,a){return a=_i(a,i),i=ge(i,a),i==null||delete i[mn(L(a))]}function fc(i,a,u,h){return Uf(i,a,u(Ns(i,a)),h)}function Fa(i,a,u,h){for(var m=i.length,x=h?m:-1;(h?x--:++x<m)&&a(i[x],x,i););return u?Zr(i,h?0:x,h?x+1:m):Zr(i,h?x+1:0,h?m:x)}function Gf(i,a){var u=i;return u instanceof tn&&(u=u.value()),Cl(a,function(h,m){return m.func.apply(m.thisArg,qi([h],m.args))},u)}function $o(i,a,u){var h=i.length;if(h<2)return h?ks(i[0]):[];for(var m=-1,x=ut(h);++m<h;)for(var N=i[m],k=-1;++k<h;)k!=m&&(x[m]=Ba(x[m]||N,i[k],a,u));return ks(or(x,1),a,u)}function uc(i,a,u){for(var h=-1,m=i.length,x=a.length,N={};++h<m;){var k=h<x?a[h]:e;u(N,i[h],k)}return N}function Vo(i){return nr(i)?i:[]}function jo(i){return typeof i=="function"?i:ti}function _i(i,a){return ze(i)?i:xt(i,a)?[i]:Me(Sn(i))}var mh=Ye;function pi(i,a,u){var h=i.length;return u=u===e?h:u,!a&&u>=h?i:Zr(i,a,u)}var $f=om||function(i){return De.clearTimeout(i)};function Vf(i,a){if(a)return i.slice();var u=i.length,h=Xl?Xl(u):new i.constructor(u);return i.copy(h),h}function Ca(i){var a=new i.constructor(i.byteLength);return new If(a).set(new If(i)),a}function jf(i,a){var u=a?Ca(i.buffer):i.buffer;return new i.constructor(u,i.byteOffset,i.byteLength)}function Wf(i){var a=new i.constructor(i.source,Yi.exec(i));return a.lastIndex=i.lastIndex,a}function Yf(i){return Do?pn(Do.call(i)):{}}function Wo(i,a){var u=a?Ca(i.buffer):i.buffer;return new i.constructor(u,i.byteOffset,i.length)}function cc(i,a){if(i!==a){var u=i!==e,h=i===null,m=i===i,x=yi(i),N=a!==e,k=a===null,Z=a===a,At=yi(a);if(!k&&!At&&!x&&i>a||x&&N&&Z&&!k&&!At||h&&N&&Z||!u&&Z||!m)return 1;if(!h&&!x&&!At&&i<a||At&&u&&m&&!h&&!x||k&&u&&m||!N&&m||!Z)return-1}return 0}function Hf(i,a,u){for(var h=-1,m=i.criteria,x=a.criteria,N=m.length,k=u.length;++h<N;){var Z=cc(m[h],x[h]);if(Z){if(h>=k)return Z;var At=u[h];return Z*(At=="desc"?-1:1)}}return i.index-a.index}function Ps(i,a,u,h){for(var m=-1,x=i.length,N=u.length,k=-1,Z=a.length,At=$n(x-N,0),Tt=ut(Z+At),Ft=!h;++k<Z;)Tt[k]=a[k];for(;++m<N;)(Ft||m<x)&&(Tt[u[m]]=i[m]);for(;At--;)Tt[k++]=i[m++];return Tt}function gh(i,a,u,h){for(var m=-1,x=i.length,N=-1,k=u.length,Z=-1,At=a.length,Tt=$n(x-k,0),Ft=ut(Tt+At),ne=!h;++m<Tt;)Ft[m]=i[m];for(var pe=m;++Z<At;)Ft[pe+Z]=a[Z];for(;++N<k;)(ne||m<x)&&(Ft[pe+u[N]]=i[m++]);return Ft}function Ar(i,a){var u=-1,h=i.length;for(a||(a=ut(h));++u<h;)a[u]=i[u];return a}function Li(i,a,u,h){var m=!u;u||(u={});for(var x=-1,N=a.length;++x<N;){var k=a[x],Z=h?h(u[k],i[k],k,u,i):e;Z===e&&(Z=i[k]),m?Nr(u,k,Z):Rf(u,k,Z)}return u}function Fm(i,a){return Li(i,lt(i),a)}function Cm(i,a){return Li(i,K(i),a)}function mi(i,a){return function(u,h){var m=ze(u)?dd:Lm,x=a?a():{};return m(u,i,be(h,2),x)}}function ka(i){return Ye(function(a,u){var h=-1,m=u.length,x=m>1?u[m-1]:e,N=m>2?u[2]:e;for(x=i.length>3&&typeof x=="function"?(m--,x):e,N&&J(u[0],u[1],N)&&(x=m<3?e:x,m=1),a=pn(a);++h<m;){var k=u[h];k&&i(a,k,h,x)}return a})}function yh(i,a){return function(u,h){if(u==null)return u;if(!Jr(u))return i(u,h);for(var m=u.length,x=a?m:-1,N=pn(u);(a?x--:++x<m)&&h(N[x],x,N)!==!1;);return u}}function vh(i){return function(a,u,h){for(var m=-1,x=pn(a),N=h(a),k=N.length;k--;){var Z=N[i?k:++m];if(u(x[Z],Z,x)===!1)break}return a}}function km(i,a,u){var h=a&Qt,m=Dr(i);function x(){var N=this&&this!==De&&this instanceof x?m:i;return N.apply(h?u:this,arguments)}return x}function bh(i){return function(a){a=Sn(a);var u=va(a)?Br(a):e,h=u?u[0]:a.charAt(0),m=u?pi(u,1).join(""):a.slice(1);return h[i]()+m}}function Yo(i){return function(a){return Cl(Fy(Dy(a).replace(yf,"")),i,"")}}function Dr(i){return function(){var a=arguments;switch(a.length){case 0:return new i;case 1:return new i(a[0]);case 2:return new i(a[0],a[1]);case 3:return new i(a[0],a[1],a[2]);case 4:return new i(a[0],a[1],a[2],a[3]);case 5:return new i(a[0],a[1],a[2],a[3],a[4]);case 6:return new i(a[0],a[1],a[2],a[3],a[4],a[5]);case 7:return new i(a[0],a[1],a[2],a[3],a[4],a[5],a[6])}var u=Aa(i.prototype),h=i.apply(u,a);return Hn(h)?h:u}}function Yd(i,a,u){var h=Dr(i);function m(){for(var x=arguments.length,N=ut(x),k=x,Z=Ua(m);k--;)N[k]=arguments[k];var At=x<3&&N[0]!==Z&&N[x-1]!==Z?[]:Ki(N,Z);if(x-=At.length,x<u)return wh(i,a,Xf,m.placeholder,e,N,At,e,e,u-x);var Tt=this&&this!==De&&this instanceof m?h:i;return ar(Tt,this,N)}return m}function Pa(i){return function(a,u,h){var m=pn(a);if(!Jr(a)){var x=be(u,3);a=Tr(a),u=function(k){return x(m[k],k,m)}}var N=i(a,u,h);return N>-1?m[x?a[N]:N]:e}}function rs(i){return Ri(function(a){var u=a.length,h=u,m=Xr.prototype.thru;for(i&&a.reverse();h--;){var x=a[h];if(typeof x!="function")throw new Hr(f);if(m&&!N&&pc(x)=="wrapper")var N=new Xr([],!0)}for(h=N?h:u;++h<u;){x=a[h];var k=pc(x),Z=k=="wrapper"?Ah(x):e;Z&&pt(Z[0])&&Z[1]==(ve|Zt|zt|an)&&!Z[4].length&&Z[9]==1?N=N[pc(Z[0])].apply(N,Z[3]):N=x.length==1&&pt(x)?N[k]():N.thru(x)}return function(){var At=arguments,Tt=At[0];if(N&&At.length==1&&ze(Tt))return N.plant(Tt).value();for(var Ft=0,ne=u?a[Ft].apply(this,At):Tt;++Ft<u;)ne=a[Ft].call(this,ne);return ne}})}function Xf(i,a,u,h,m,x,N,k,Z,At){var Tt=a&ve,Ft=a&Qt,ne=a&Rt,pe=a&(Zt|st),xe=a&at,Je=ne?e:Dr(i);function Se(){for(var rn=arguments.length,cn=ut(rn),vi=rn;vi--;)cn[vi]=arguments[vi];if(pe)var Vr=Ua(Se),bi=Eo(cn,Vr);if(h&&(cn=Ps(cn,h,m,pe)),x&&(cn=gh(cn,x,N,pe)),rn-=bi,pe&&rn<At){var rr=Ki(cn,Vr);return wh(i,a,Xf,Se.placeholder,u,cn,rr,k,Z,At-rn)}var os=Ft?u:this,Ya=ne?os[i]:i;return rn=cn.length,k?cn=_e(cn,k):xe&&rn>1&&cn.reverse(),Tt&&Z<rn&&(cn.length=Z),this&&this!==De&&this instanceof Se&&(Ya=Je||Dr(Ya)),Ya.apply(os,cn)}return Se}function lc(i,a){return function(u,h){return Cd(u,i,a(h),{})}}function za(i,a){return function(u,h){var m;if(u===e&&h===e)return a;if(u!==e&&(m=u),h!==e){if(m===e)return h;typeof u=="string"||typeof h=="string"?(u=Gr(u),h=Gr(h)):(u=Wd(u),h=Wd(h)),m=i(u,h)}return m}}function hc(i){return Ri(function(a){return a=kn(a,Ur(be())),Ye(function(u){var h=this;return i(a,function(m){return ar(m,h,u)})})})}function Pn(i,a){a=a===e?" ":Gr(a);var u=a.length;if(u<2)return u?ac(a,i):a;var h=ac(a,Yu(i/Os(a)));return va(a)?pi(Br(h),0,i).join(""):h.slice(0,i)}function zs(i,a,u,h){var m=a&Qt,x=Dr(i);function N(){for(var k=-1,Z=arguments.length,At=-1,Tt=h.length,Ft=ut(Tt+Z),ne=this&&this!==De&&this instanceof N?x:i;++At<Tt;)Ft[At]=h[At];for(;Z--;)Ft[At++]=arguments[++k];return ar(ne,m?u:this,Ft)}return N}function zn(i){return function(a,u,h){return h&&typeof h!="number"&&J(a,u,h)&&(u=h=e),a=Wa(a),u===e?(u=a,a=0):u=Wa(u),h=h===e?a<u?1:-1:Wa(h),Gd(a,u,h,i)}}function mr(i){return function(a,u){return typeof a=="string"&&typeof u=="string"||(a=Di(a),u=Di(u)),i(a,u)}}function wh(i,a,u,h,m,x,N,k,Z,At){var Tt=a&Zt,Ft=Tt?N:e,ne=Tt?e:N,pe=Tt?x:e,xe=Tt?e:x;a|=Tt?zt:ue,a&=~(Tt?ue:zt),a&oe||(a&=~(Qt|Rt));var Je=[i,a,m,pe,Ft,xe,ne,k,Z,At],Se=u.apply(e,Je);return pt(i)&&jt(Se,Je),Se.placeholder=h,Ee(Se,i,a)}function xh(i){var a=Qn[i];return function(u,h){if(u=Di(u),h=h==null?0:wr(He(h),292),h&&Zl(u)){var m=(Sn(u)+"e").split("e"),x=a(m[0]+"e"+(+m[1]+h));return m=(Sn(x)+"e").split("e"),+(m[0]+"e"+(+m[1]-h))}return a(u)}}var Pm=wa&&1/Sf(new wa([,-0]))[1]==yt?function(i){return new wa(i)}:Jm;function Hd(i){return function(a){var u=et(a);return u==Rr?$u(a):u==Ir?vd(a):Qp(a,i(a))}}function is(i,a,u,h,m,x,N,k){var Z=a&Rt;if(!Z&&typeof i!="function")throw new Hr(f);var At=h?h.length:0;if(At||(a&=~(zt|ue),h=m=e),N=N===e?N:$n(He(N),0),k=k===e?k:He(k),At-=m?m.length:0,a&ue){var Tt=h,Ft=m;h=m=e}var ne=Z?e:Ah(i),pe=[i,a,u,h,m,Tt,Ft,x,N,k];if(ne&&kt(pe,ne),i=pe[0],a=pe[1],u=pe[2],h=pe[3],m=pe[4],k=pe[9]=pe[9]===e?Z?0:i.length:$n(pe[9]-At,0),!k&&a&(Zt|st)&&(a&=~(Zt|st)),!a||a==Qt)var xe=km(i,a,u);else a==Zt||a==st?xe=Yd(i,a,k):(a==zt||a==(Qt|zt))&&!m.length?xe=zs(i,a,u,h):xe=Xf.apply(e,pe);var Je=ne?$d:jt;return Ee(Je(xe,pe),i,a)}function Sh(i,a,u,h){return i===e||as(i,Oo[u])&&!un.call(h,u)?a:i}function Xd(i,a,u,h,m,x){return Hn(i)&&Hn(a)&&(x.set(a,i),Na(i,a,e,Xd,x),x.delete(a)),i}function zm(i){return Eh(i)?e:i}function qd(i,a,u,h,m,x){var N=u&V,k=i.length,Z=a.length;if(k!=Z&&!(N&&Z>k))return!1;var At=x.get(i),Tt=x.get(a);if(At&&Tt)return At==a&&Tt==i;var Ft=-1,ne=!0,pe=u&Wt?new Ta:e;for(x.set(i,a),x.set(a,i);++Ft<k;){var xe=i[Ft],Je=a[Ft];if(h)var Se=N?h(Je,xe,Ft,a,i,x):h(xe,Je,Ft,i,a,x);if(Se!==e){if(Se)continue;ne=!1;break}if(pe){if(!ku(a,function(rn,cn){if(!Is(pe,cn)&&(xe===rn||m(xe,rn,u,h,x)))return pe.push(cn)})){ne=!1;break}}else if(!(xe===Je||m(xe,Je,u,h,x))){ne=!1;break}}return x.delete(i),x.delete(a),ne}function Um(i,a,u,h,m,x,N){switch(u){case lr:if(i.byteLength!=a.byteLength||i.byteOffset!=a.byteOffset)return!1;i=i.buffer,a=a.buffer;case ua:return!(i.byteLength!=a.byteLength||!x(new If(i),new If(a)));case hn:case Fn:case ws:return as(+i,+a);case Kn:return i.name==a.name&&i.message==a.message;case kr:case Ei:return i==a+"";case Rr:var k=$u;case Ir:var Z=h&V;if(k||(k=Sf),i.size!=a.size&&!Z)return!1;var At=N.get(i);if(At)return At==a;h|=Wt,N.set(i,a);var Tt=qd(k(i),k(a),h,m,x,N);return N.delete(i),Tt;case b:if(Do)return Do.call(i)==Do.call(a)}return!1}function Gm(i,a,u,h,m,x){var N=u&V,k=dc(i),Z=k.length,At=dc(a),Tt=At.length;if(Z!=Tt&&!N)return!1;for(var Ft=Z;Ft--;){var ne=k[Ft];if(!(N?ne in a:un.call(a,ne)))return!1}var pe=x.get(i),xe=x.get(a);if(pe&&xe)return pe==a&&xe==i;var Je=!0;x.set(i,a),x.set(a,i);for(var Se=N;++Ft<Z;){ne=k[Ft];var rn=i[ne],cn=a[ne];if(h)var vi=N?h(cn,rn,ne,a,i,x):h(rn,cn,ne,i,a,x);if(!(vi===e?rn===cn||m(rn,cn,u,h,x):vi)){Je=!1;break}Se||(Se=ne=="constructor")}if(Je&&!Se){var Vr=i.constructor,bi=a.constructor;Vr!=bi&&"constructor"in i&&"constructor"in a&&!(typeof Vr=="function"&&Vr instanceof Vr&&typeof bi=="function"&&bi instanceof bi)&&(Je=!1)}return x.delete(i),x.delete(a),Je}function Ri(i){return me(Ut(i,e,T),i+"")}function dc(i){return ah(i,Tr,lt)}function _c(i){return ah(i,Qr,K)}var Ah=Mf?function(i){return Mf.get(i)}:Jm;function pc(i){for(var a=i.name+"",u=xr[a],h=un.call(xr,a)?u.length:0;h--;){var m=u[h],x=m.func;if(x==null||x==i)return m.name}return a}function Ua(i){var a=un.call(y,"placeholder")?y:i;return a.placeholder}function be(){var i=y.iteratee||Zm;return i=i===Zm?Po:i,arguments.length?i(arguments[0],arguments[1]):i}function _(i,a){var u=i.__data__;return Yt(a)?u[typeof a=="string"?"string":"hash"]:u.map}function v(i){for(var a=Tr(i),u=a.length;u--;){var h=a[u],m=i[h];a[u]=[h,m,dt(m)]}return a}function M(i,a){var u=Vl(i,a);return ko(u)?u:e}function tt(i){var a=un.call(i,Bs),u=i[Bs];try{i[Bs]=e;var h=!0}catch{}var m=Mr.call(i);return h&&(a?i[Bs]=u:delete i[Bs]),m}var lt=Hu?function(i){return i==null?[]:(i=pn(i),Bi(Hu(i),function(a){return tr.call(i,a)}))}:Qm,K=Hu?function(i){for(var a=[];i;)qi(a,lt(i)),i=Wu(i);return a}:Qm,et=Sr;(qu&&et(new qu(new ArrayBuffer(1)))!=lr||Lo&&et(new Lo)!=Rr||Zu&&et(Zu.resolve())!=yr||wa&&et(new wa)!=Ir||Ro&&et(new Ro)!=xs)&&(et=function(i){var a=Sr(i),u=a==oi?i.constructor:e,h=u?sn(u):"";if(h)switch(h){case Ed:return lr;case hm:return Rr;case Qi:return yr;case Jl:return Ir;case xa:return xs}return a});function bt(i,a,u){for(var h=-1,m=u.length;++h<m;){var x=u[h],N=x.size;switch(x.type){case"drop":i+=N;break;case"dropRight":a-=N;break;case"take":a=wr(a,i+N);break;case"takeRight":i=$n(i,a-N);break}}return{start:i,end:a}}function vt(i){var a=i.match(Wi);return a?a[1].split(xu):[]}function It(i,a,u){a=_i(a,i);for(var h=-1,m=a.length,x=!1;++h<m;){var N=mn(a[h]);if(!(x=i!=null&&u(i,N)))break;i=i[N]}return x||++h!=m?x:(m=i==null?0:i.length,!!m&&r_(m)&&z(N,m)&&(ze(i)||Zf(i)))}function Mt(i){var a=i.length,u=new i.constructor(a);return a&&typeof i[0]=="string"&&un.call(i,"index")&&(u.index=i.index,u.input=i.input),u}function Ot(i){return typeof i.constructor=="function"&&!re(i)?Aa(Wu(i)):{}}function Ct(i,a,u){var h=i.constructor;switch(a){case ua:return Ca(i);case hn:case Fn:return new h(+i);case lr:return jf(i,u);case ca:case Ti:case la:case lo:case ho:case _o:case hr:case Pr:case ji:return Wo(i,u);case Rr:return new h;case ws:case Ei:return new h(i);case kr:return Wf(i);case Ir:return new h;case b:return Yf(i)}}function wt(i,a){var u=a.length;if(!u)return i;var h=u-1;return a[h]=(u>1?"& ":"")+a[h],a=a.join(u>2?", ":" "),i.replace(ml,`{
/* [wrapped with `+a+`] */
`)}function Et(i){return ze(i)||Zf(i)||!!(ql&&i&&i[ql])}function z(i,a){var u=typeof i;return a=a??Lt,!!a&&(u=="number"||u!="symbol"&&Al.test(i))&&i>-1&&i%1==0&&i<a}function J(i,a,u){if(!Hn(u))return!1;var h=typeof a;return(h=="number"?Jr(u)&&z(a,u.length):h=="string"&&a in u)?as(u[a],i):!1}function xt(i,a){if(ze(i))return!1;var u=typeof i;return u=="number"||u=="symbol"||u=="boolean"||i==null||yi(i)?!0:dl.test(i)||!hl.test(i)||a!=null&&i in pn(a)}function Yt(i){var a=typeof i;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?i!=="__proto__":i===null}function pt(i){var a=pc(i),u=y[a];if(typeof u!="function"||!(a in tn.prototype))return!1;if(i===u)return!0;var h=Ah(u);return!!h&&i===h[0]}function Vt(i){return!!Ef&&Ef in i}var $t=ju?ja:t0;function re(i){var a=i&&i.constructor,u=typeof a=="function"&&a.prototype||Oo;return i===u}function dt(i){return i===i&&!Hn(i)}function ht(i,a){return function(u){return u==null?!1:u[i]===a&&(a!==e||i in pn(u))}}function qt(i){var a=e_(i,function(h){return u.size===d&&u.clear(),h}),u=a.cache;return a}function kt(i,a){var u=i[1],h=a[1],m=u|h,x=m<(Qt|Rt|ve),N=h==ve&&u==Zt||h==ve&&u==an&&i[7].length<=a[8]||h==(ve|an)&&a[7].length<=a[8]&&u==Zt;if(!(x||N))return i;h&Qt&&(i[2]=a[2],m|=u&Qt?0:oe);var k=a[3];if(k){var Z=i[3];i[3]=Z?Ps(Z,k,a[4]):k,i[4]=Z?Ki(i[3],p):a[4]}return k=a[5],k&&(Z=i[5],i[5]=Z?gh(Z,k,a[6]):k,i[6]=Z?Ki(i[5],p):a[6]),k=a[7],k&&(i[7]=k),h&ve&&(i[8]=i[8]==null?a[8]:wr(i[8],a[8])),i[9]==null&&(i[9]=a[9]),i[0]=a[0],i[1]=m,i}function St(i){var a=[];if(i!=null)for(var u in pn(i))a.push(u);return a}function Pt(i){return Mr.call(i)}function Ut(i,a,u){return a=$n(a===e?i.length-1:a,0),function(){for(var h=arguments,m=-1,x=$n(h.length-a,0),N=ut(x);++m<x;)N[m]=h[a+m];m=-1;for(var k=ut(a+1);++m<a;)k[m]=h[m];return k[a]=u(N),ar(i,this,k)}}function ge(i,a){return a.length<2?i:Ns(i,Zr(a,0,-1))}function _e(i,a){for(var u=i.length,h=wr(a.length,u),m=Ar(i);h--;){var x=a[h];i[h]=z(x,u)?m[x]:e}return i}function Gt(i,a){if(!(a==="constructor"&&typeof i[a]=="function")&&a!="__proto__")return i[a]}var jt=Tn($d),fe=um||function(i,a){return De.setTimeout(i,a)},me=Tn(Vd);function Ee(i,a,u){var h=a+"";return me(i,wt(h,Vn(vt(h),u)))}function Tn(i){var a=0,u=0;return function(){var h=Ms(),m=Dt-(h-u);if(u=h,m>0){if(++a>=Bt)return arguments[0]}else a=0;return i.apply(e,arguments)}}function xn(i,a){var u=-1,h=i.length,m=h-1;for(a=a===e?h:a;++u<a;){var x=sc(u,m),N=i[x];i[x]=i[u],i[u]=N}return i.length=a,i}var Me=qt(function(i){var a=[];return i.charCodeAt(0)===46&&a.push(""),i.replace(fi,function(u,h,m,x){a.push(m?x.replace(yl,"$1"):h||u)}),a});function mn(i){if(typeof i=="string"||yi(i))return i;var a=i+"";return a=="0"&&1/i==-yt?"-0":a}function sn(i){if(i!=null){try{return Af.call(i)}catch{}try{return i+""}catch{}}return""}function Vn(i,a){return _r(Ze,function(u){var h="_."+u[0];a&u[1]&&!Cu(i,h)&&i.push(h)}),i.sort()}function jn(i){if(i instanceof tn)return i.clone();var a=new Xr(i.__wrapped__,i.__chain__);return a.__actions__=Ar(i.__actions__),a.__index__=i.__index__,a.__values__=i.__values__,a}function Yn(i,a,u){(u?J(i,a,u):a===e)?a=1:a=$n(He(a),0);var h=i==null?0:i.length;if(!h||a<1)return[];for(var m=0,x=0,N=ut(Yu(h/a));m<h;)N[x++]=Zr(i,m,m+=a);return N}function er(i){for(var a=-1,u=i==null?0:i.length,h=0,m=[];++a<u;){var x=i[a];x&&(m[h++]=x)}return m}function fr(){var i=arguments.length;if(!i)return[];for(var a=ut(i-1),u=arguments[0],h=i;h--;)a[h-1]=arguments[h];return qi(ze(u)?Ar(u):[u],or(a,1))}var Un=Ye(function(i,a){return nr(i)?Ba(i,or(a,1,nr,!0)):[]}),we=Ye(function(i,a){var u=L(a);return nr(u)&&(u=e),nr(i)?Ba(i,or(a,1,nr,!0),be(u,2)):[]}),ur=Ye(function(i,a){var u=L(a);return nr(u)&&(u=e),nr(i)?Ba(i,or(a,1,nr,!0),e,u):[]});function en(i,a,u){var h=i==null?0:i.length;return h?(a=u||a===e?1:He(a),Zr(i,a<0?0:a,h)):[]}function ce(i,a,u){var h=i==null?0:i.length;return h?(a=u||a===e?1:He(a),a=h-a,Zr(i,0,a<0?0:a)):[]}function Le(i,a){return i&&i.length?Fa(i,be(a,3),!0,!0):[]}function Ve(i,a){return i&&i.length?Fa(i,be(a,3),!0):[]}function Gn(i,a,u,h){var m=i==null?0:i.length;return m?(u&&typeof u!="number"&&J(i,a,u)&&(u=0,h=m),Nd(i,a,u,h)):[]}function gi(i,a,u){var h=i==null?0:i.length;if(!h)return-1;var m=u==null?0:He(u);return m<0&&(m=$n(h+m,0)),So(i,be(a,3),m)}function Us(i,a,u){var h=i==null?0:i.length;if(!h)return-1;var m=h-1;return u!==e&&(m=He(u),m=u<0?$n(h+m,0):wr(m,h-1)),So(i,be(a,3),m,!0)}function T(i){var a=i==null?0:i.length;return a?or(i,1):[]}function nt(i){var a=i==null?0:i.length;return a?or(i,yt):[]}function q(i,a){var u=i==null?0:i.length;return u?(a=a===e?1:He(a),or(i,a)):[]}function Xt(i){for(var a=-1,u=i==null?0:i.length,h={};++a<u;){var m=i[a];h[m[0]]=m[1]}return h}function Ae(i){return i&&i.length?i[0]:e}function S(i,a,u){var h=i==null?0:i.length;if(!h)return-1;var m=u==null?0:He(u);return m<0&&(m=$n(h+m,0)),Zi(i,a,m)}function g(i){var a=i==null?0:i.length;return a?Zr(i,0,-1):[]}var R=Ye(function(i){var a=kn(i,Vo);return a.length&&a[0]===i[0]?kf(a):[]}),U=Ye(function(i){var a=L(i),u=kn(i,Vo);return a===L(u)?a=e:u.pop(),u.length&&u[0]===i[0]?kf(u,be(a,2)):[]}),$=Ye(function(i){var a=L(i),u=kn(i,Vo);return a=typeof a=="function"?a:e,a&&u.pop(),u.length&&u[0]===i[0]?kf(u,e,a):[]});function D(i,a){return i==null?"":Sd.call(i,a)}function L(i){var a=i==null?0:i.length;return a?i[a-1]:e}function P(i,a,u){var h=i==null?0:i.length;if(!h)return-1;var m=h;return u!==e&&(m=He(u),m=m<0?$n(h+m,0):wr(m,h-1)),a===a?Wl(i,a,m):So(i,Pu,m,!0)}function A(i,a){return i&&i.length?zo(i,He(a)):e}var O=Ye(E);function E(i,a){return i&&i.length&&a&&a.length?hh(i,a):i}function X(i,a,u){return i&&i.length&&a&&a.length?hh(i,a,be(u,2)):i}function j(i,a,u){return i&&i.length&&a&&a.length?hh(i,a,e,u):i}var ct=Ri(function(i,a){var u=i==null?0:i.length,h=Rs(i,a);return Ud(i,kn(a,function(m){return z(m,u)?+m:m}).sort(cc)),h});function _t(i,a){var u=[];if(!(i&&i.length))return u;var h=-1,m=[],x=i.length;for(a=be(a,3);++h<x;){var N=i[h];a(N,h,i)&&(u.push(N),m.push(h))}return Ud(i,m),u}function Nt(i){return i==null?i:Ad.call(i)}function he(i,a,u){var h=i==null?0:i.length;return h?(u&&typeof u!="number"&&J(i,a,u)?(a=0,u=h):(a=a==null?0:He(a),u=u===e?h:He(u)),Zr(i,a,u)):[]}function ae(i,a){return oc(i,a)}function Ht(i,a,u){return _h(i,a,be(u,2))}function mt(i,a){var u=i==null?0:i.length;if(u){var h=oc(i,a);if(h<u&&as(i[h],a))return h}return-1}function ot(i,a){return oc(i,a,!0)}function te(i,a,u){return _h(i,a,be(u,2),!0)}function Jt(i,a){var u=i==null?0:i.length;if(u){var h=oc(i,a,!0)-1;if(as(i[h],a))return h}return-1}function le(i){return i&&i.length?jd(i):[]}function nn(i,a){return i&&i.length?jd(i,be(a,2)):[]}function cr(i){var a=i==null?0:i.length;return a?Zr(i,1,a):[]}function Ga(i,a,u){return i&&i.length?(a=u||a===e?1:He(a),Zr(i,0,a<0?0:a)):[]}function ss(i,a,u){var h=i==null?0:i.length;return h?(a=u||a===e?1:He(a),a=h-a,Zr(i,a<0?0:a,h)):[]}function Ni(i,a){return i&&i.length?Fa(i,be(a,3),!1,!0):[]}function Gs(i,a){return i&&i.length?Fa(i,be(a,3)):[]}var $a=Ye(function(i){return ks(or(i,1,nr,!0))}),Zd=Ye(function(i){var a=L(i);return nr(a)&&(a=e),ks(or(i,1,nr,!0),be(a,2))}),$r=Ye(function(i){var a=L(i);return a=typeof a=="function"?a:e,ks(or(i,1,nr,!0),e,a)});function Va(i){return i&&i.length?ks(i):[]}function Kr(i,a){return i&&i.length?ks(i,be(a,2)):[]}function Kd(i,a){return a=typeof a=="function"?a:e,i&&i.length?ks(i,e,a):[]}function Er(i){if(!(i&&i.length))return[];var a=0;return i=Bi(i,function(u){if(nr(u))return a=$n(u.length,a),!0}),zl(a,function(u){return kn(i,ya(u))})}function qf(i,a){if(!(i&&i.length))return[];var u=Er(i);return a==null?u:kn(u,function(h){return ar(a,e,h)})}var mc=Ye(function(i,a){return nr(i)?Ba(i,a):[]}),Xx=Ye(function(i){return $o(Bi(i,nr))}),qx=Ye(function(i){var a=L(i);return nr(a)&&(a=e),$o(Bi(i,nr),be(a,2))}),Zx=Ye(function(i){var a=L(i);return a=typeof a=="function"?a:e,$o(Bi(i,nr),e,a)}),Kx=Ye(Er);function Jx(i,a){return uc(i||[],a||[],Rf)}function Qx(i,a){return uc(i||[],a||[],Uf)}var t3=Ye(function(i){var a=i.length,u=a>1?i[a-1]:e;return u=typeof u=="function"?(i.pop(),u):e,qf(i,u)});function ly(i){var a=y(i);return a.__chain__=!0,a}function e3(i,a){return a(i),i}function Jd(i,a){return a(i)}var n3=Ri(function(i){var a=i.length,u=a?i[0]:0,h=this.__wrapped__,m=function(x){return Rs(x,i)};return a>1||this.__actions__.length||!(h instanceof tn)||!z(u)?this.thru(m):(h=h.slice(u,+u+(a?1:0)),h.__actions__.push({func:Jd,args:[m],thisArg:e}),new Xr(h,this.__chain__).thru(function(x){return a&&!x.length&&x.push(e),x}))});function r3(){return ly(this)}function i3(){return new Xr(this.value(),this.__chain__)}function s3(){this.__values__===e&&(this.__values__=Ey(this.value()));var i=this.__index__>=this.__values__.length,a=i?e:this.__values__[this.__index__++];return{done:i,value:a}}function a3(){return this}function o3(i){for(var a,u=this;u instanceof Lf;){var h=jn(u);h.__index__=0,h.__values__=e,a?m.__wrapped__=h:a=h;var m=h;u=u.__wrapped__}return m.__wrapped__=i,a}function f3(){var i=this.__wrapped__;if(i instanceof tn){var a=i;return this.__actions__.length&&(a=new tn(this)),a=a.reverse(),a.__actions__.push({func:Jd,args:[Nt],thisArg:e}),new Xr(a,this.__chain__)}return this.thru(Nt)}function u3(){return Gf(this.__wrapped__,this.__actions__)}var c3=mi(function(i,a,u){un.call(i,u)?++i[u]:Nr(i,u,1)});function l3(i,a,u){var h=ze(i)?Ts:rh;return u&&J(i,a,u)&&(a=e),h(i,be(a,3))}function h3(i,a){var u=ze(i)?Bi:ih;return u(i,be(a,3))}var d3=Pa(gi),_3=Pa(Us);function p3(i,a){return or(Qd(i,a),1)}function m3(i,a){return or(Qd(i,a),yt)}function g3(i,a,u){return u=u===e?1:He(u),or(Qd(i,a),u)}function hy(i,a){var u=ze(i)?_r:Mi;return u(i,be(a,3))}function dy(i,a){var u=ze(i)?_d:tc;return u(i,be(a,3))}var y3=mi(function(i,a,u){un.call(i,u)?i[u].push(a):Nr(i,u,[a])});function v3(i,a,u,h){i=Jr(i)?i:yc(i),u=u&&!h?He(u):0;var m=i.length;return u<0&&(u=$n(m+u,0)),i_(i)?u<=m&&i.indexOf(a,u)>-1:!!m&&Zi(i,a,u)>-1}var b3=Ye(function(i,a,u){var h=-1,m=typeof a=="function",x=Jr(i)?ut(i.length):[];return Mi(i,function(N){x[++h]=m?ar(a,N,u):La(N,a,u)}),x}),w3=mi(function(i,a,u){Nr(i,u,a)});function Qd(i,a){var u=ze(i)?kn:Ds;return u(i,be(a,3))}function x3(i,a,u,h){return i==null?[]:(ze(a)||(a=a==null?[]:[a]),u=h?e:u,ze(u)||(u=u==null?[]:[u]),ic(i,a,u))}var S3=mi(function(i,a,u){i[u?0:1].push(a)},function(){return[[],[]]});function A3(i,a,u){var h=ze(i)?Cl:kl,m=arguments.length<3;return h(i,be(a,4),u,m,Mi)}function E3(i,a,u){var h=ze(i)?Kp:kl,m=arguments.length<3;return h(i,be(a,4),u,m,tc)}function T3(i,a){var u=ze(i)?Bi:ih;return u(i,n_(be(a,3)))}function I3(i){var a=ze(i)?Ld:Go;return a(i)}function O3(i,a,u){(u?J(i,a,u):a===e)?a=1:a=He(a);var h=ze(i)?Bm:dh;return h(i,a)}function B3(i){var a=ze(i)?Mm:Nm;return a(i)}function M3(i){if(i==null)return 0;if(Jr(i))return i_(i)?Os(i):i.length;var a=et(i);return a==Rr||a==Ir?i.size:ns(i).length}function L3(i,a,u){var h=ze(i)?ku:Dm;return u&&J(i,a,u)&&(a=e),h(i,be(a,3))}var R3=Ye(function(i,a){if(i==null)return[];var u=a.length;return u>1&&J(i,a[0],a[1])?a=[]:u>2&&J(a[0],a[1],a[2])&&(a=[a[0]]),ic(i,or(a,1),[])}),t_=fm||function(){return De.Date.now()};function N3(i,a){if(typeof a!="function")throw new Hr(f);return i=He(i),function(){if(--i<1)return a.apply(this,arguments)}}function _y(i,a,u){return a=u?e:a,a=i&&a==null?i.length:a,is(i,ve,e,e,e,e,a)}function py(i,a){var u;if(typeof a!="function")throw new Hr(f);return i=He(i),function(){return--i>0&&(u=a.apply(this,arguments)),i<=1&&(a=e),u}}var $m=Ye(function(i,a,u){var h=Qt;if(u.length){var m=Ki(u,Ua($m));h|=zt}return is(i,h,a,u,m)}),my=Ye(function(i,a,u){var h=Qt|Rt;if(u.length){var m=Ki(u,Ua(my));h|=zt}return is(a,h,i,u,m)});function gy(i,a,u){a=u?e:a;var h=is(i,Zt,e,e,e,e,e,a);return h.placeholder=gy.placeholder,h}function yy(i,a,u){a=u?e:a;var h=is(i,st,e,e,e,e,e,a);return h.placeholder=yy.placeholder,h}function vy(i,a,u){var h,m,x,N,k,Z,At=0,Tt=!1,Ft=!1,ne=!0;if(typeof i!="function")throw new Hr(f);a=Di(a)||0,Hn(u)&&(Tt=!!u.leading,Ft="maxWait"in u,x=Ft?$n(Di(u.maxWait)||0,a):x,ne="trailing"in u?!!u.trailing:ne);function pe(rr){var os=h,Ya=m;return h=m=e,At=rr,N=i.apply(Ya,os),N}function xe(rr){return At=rr,k=fe(rn,a),Tt?pe(rr):N}function Je(rr){var os=rr-Z,Ya=rr-At,Py=a-os;return Ft?wr(Py,x-Ya):Py}function Se(rr){var os=rr-Z,Ya=rr-At;return Z===e||os>=a||os<0||Ft&&Ya>=x}function rn(){var rr=t_();if(Se(rr))return cn(rr);k=fe(rn,Je(rr))}function cn(rr){return k=e,ne&&h?pe(rr):(h=m=e,N)}function vi(){k!==e&&$f(k),At=0,h=Z=m=k=e}function Vr(){return k===e?N:cn(t_())}function bi(){var rr=t_(),os=Se(rr);if(h=arguments,m=this,Z=rr,os){if(k===e)return xe(Z);if(Ft)return $f(k),k=fe(rn,a),pe(Z)}return k===e&&(k=fe(rn,a)),N}return bi.cancel=vi,bi.flush=Vr,bi}var D3=Ye(function(i,a){return Qu(i,1,a)}),F3=Ye(function(i,a,u){return Qu(i,Di(a)||0,u)});function C3(i){return is(i,at)}function e_(i,a){if(typeof i!="function"||a!=null&&typeof a!="function")throw new Hr(f);var u=function(){var h=arguments,m=a?a.apply(this,h):h[0],x=u.cache;if(x.has(m))return x.get(m);var N=i.apply(this,h);return u.cache=x.set(m,N)||x,N};return u.cache=new(e_.Cache||ts),u}e_.Cache=ts;function n_(i){if(typeof i!="function")throw new Hr(f);return function(){var a=arguments;switch(a.length){case 0:return!i.call(this);case 1:return!i.call(this,a[0]);case 2:return!i.call(this,a[0],a[1]);case 3:return!i.call(this,a[0],a[1],a[2])}return!i.apply(this,a)}}function k3(i){return py(2,i)}var P3=mh(function(i,a){a=a.length==1&&ze(a[0])?kn(a[0],Ur(be())):kn(or(a,1),Ur(be()));var u=a.length;return Ye(function(h){for(var m=-1,x=wr(h.length,u);++m<x;)h[m]=a[m].call(this,h[m]);return ar(i,this,h)})}),Vm=Ye(function(i,a){var u=Ki(a,Ua(Vm));return is(i,zt,e,a,u)}),by=Ye(function(i,a){var u=Ki(a,Ua(by));return is(i,ue,e,a,u)}),z3=Ri(function(i,a){return is(i,an,e,e,e,a)});function U3(i,a){if(typeof i!="function")throw new Hr(f);return a=a===e?a:He(a),Ye(i,a)}function G3(i,a){if(typeof i!="function")throw new Hr(f);return a=a==null?0:$n(He(a),0),Ye(function(u){var h=u[a],m=pi(u,0,a);return h&&qi(m,h),ar(i,this,m)})}function $3(i,a,u){var h=!0,m=!0;if(typeof i!="function")throw new Hr(f);return Hn(u)&&(h="leading"in u?!!u.leading:h,m="trailing"in u?!!u.trailing:m),vy(i,a,{leading:h,maxWait:a,trailing:m})}function V3(i){return _y(i,1)}function j3(i,a){return Vm(jo(a),i)}function W3(){if(!arguments.length)return[];var i=arguments[0];return ze(i)?i:[i]}function Y3(i){return pr(i,C)}function H3(i,a){return a=typeof a=="function"?a:e,pr(i,C,a)}function X3(i){return pr(i,w|C)}function q3(i,a){return a=typeof a=="function"?a:e,pr(i,w|C,a)}function Z3(i,a){return a==null||Oa(i,a,Tr(a))}function as(i,a){return i===a||i!==i&&a!==a}var K3=mr(Cf),J3=mr(function(i,a){return i>=a}),Zf=fh(function(){return arguments}())?fh:function(i){return Zn(i)&&un.call(i,"callee")&&!tr.call(i,"callee")},ze=ut.isArray,Q3=wo?Ur(wo):kd;function Jr(i){return i!=null&&r_(i.length)&&!ja(i)}function nr(i){return Zn(i)&&Jr(i)}function tS(i){return i===!0||i===!1||Zn(i)&&Sr(i)==hn}var Ho=cm||t0,eS=zr?Ur(zr):uh;function nS(i){return Zn(i)&&i.nodeType===1&&!Eh(i)}function rS(i){if(i==null)return!0;if(Jr(i)&&(ze(i)||typeof i=="string"||typeof i.splice=="function"||Ho(i)||gc(i)||Zf(i)))return!i.length;var a=et(i);if(a==Rr||a==Ir)return!i.size;if(re(i))return!ns(i).length;for(var u in i)if(un.call(i,u))return!1;return!0}function iS(i,a){return Co(i,a)}function sS(i,a,u){u=typeof u=="function"?u:e;var h=u?u(i,a):e;return h===e?Co(i,a,e,u):!!h}function jm(i){if(!Zn(i))return!1;var a=Sr(i);return a==Kn||a==ir||typeof i.message=="string"&&typeof i.name=="string"&&!Eh(i)}function aS(i){return typeof i=="number"&&Zl(i)}function ja(i){if(!Hn(i))return!1;var a=Sr(i);return a==Yr||a==rf||a==Dn||a==yu}function wy(i){return typeof i=="number"&&i==He(i)}function r_(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=Lt}function Hn(i){var a=typeof i;return i!=null&&(a=="object"||a=="function")}function Zn(i){return i!=null&&typeof i=="object"}var xy=bf?Ur(bf):ch;function oS(i,a){return i===a||Pf(i,a,v(a))}function fS(i,a,u){return u=typeof u=="function"?u:e,Pf(i,a,v(a),u)}function uS(i){return Sy(i)&&i!=+i}function cS(i){if($t(i))throw new Be(o);return ko(i)}function lS(i){return i===null}function hS(i){return i==null}function Sy(i){return typeof i=="number"||Zn(i)&&Sr(i)==ws}function Eh(i){if(!Zn(i)||Sr(i)!=oi)return!1;var a=Wu(i);if(a===null)return!0;var u=un.call(a,"constructor")&&a.constructor;return typeof u=="function"&&u instanceof u&&Af.call(u)==Bo}var Wm=ld?Ur(ld):zd;function dS(i){return wy(i)&&i>=-Lt&&i<=Lt}var Ay=xo?Ur(xo):nc;function i_(i){return typeof i=="string"||!ze(i)&&Zn(i)&&Sr(i)==Ei}function yi(i){return typeof i=="symbol"||Zn(i)&&Sr(i)==b}var gc=hd?Ur(hd):es;function _S(i){return i===e}function pS(i){return Zn(i)&&et(i)==xs}function mS(i){return Zn(i)&&Sr(i)==ol}var gS=mr(Ra),yS=mr(function(i,a){return i<=a});function Ey(i){if(!i)return[];if(Jr(i))return i_(i)?Br(i):Ar(i);if(li&&i[li])return yd(i[li]());var a=et(i),u=a==Rr?$u:a==Ir?Sf:yc;return u(i)}function Wa(i){if(!i)return i===0?i:0;if(i=Di(i),i===yt||i===-yt){var a=i<0?-1:1;return a*Kt}return i===i?i:0}function He(i){var a=Wa(i),u=a%1;return a===a?u?a-u:a:0}function Ty(i){return i?Ia(He(i),0,de):0}function Di(i){if(typeof i=="number")return i;if(yi(i))return ee;if(Hn(i)){var a=typeof i.valueOf=="function"?i.valueOf():i;i=Hn(a)?a+"":a}if(typeof i!="string")return i===0?i:+i;i=md(i);var u=wl.test(i);return u||Sl.test(i)?ie(i.slice(2),u?2:8):bl.test(i)?ee:+i}function Iy(i){return Li(i,Qr(i))}function vS(i){return i?Ia(He(i),-Lt,Lt):i===0?i:0}function Sn(i){return i==null?"":Gr(i)}var bS=ka(function(i,a){if(re(a)||Jr(a)){Li(a,Tr(a),i);return}for(var u in a)un.call(a,u)&&Rf(i,u,a[u])}),Oy=ka(function(i,a){Li(a,Qr(a),i)}),s_=ka(function(i,a,u,h){Li(a,Qr(a),i,h)}),wS=ka(function(i,a,u,h){Li(a,Tr(a),i,h)}),xS=Ri(Rs);function SS(i,a){var u=Aa(i);return a==null?u:Nf(u,a)}var AS=Ye(function(i,a){i=pn(i);var u=-1,h=a.length,m=h>2?a[2]:e;for(m&&J(a[0],a[1],m)&&(h=1);++u<h;)for(var x=a[u],N=Qr(x),k=-1,Z=N.length;++k<Z;){var At=N[k],Tt=i[At];(Tt===e||as(Tt,Oo[At])&&!un.call(i,At))&&(i[At]=x[At])}return i}),ES=Ye(function(i){return i.push(e,Xd),ar(By,e,i)});function TS(i,a){return ci(i,be(a,3),qr)}function IS(i,a){return ci(i,be(a,3),Df)}function OS(i,a){return i==null?i:ec(i,be(a,3),Qr)}function BS(i,a){return i==null?i:sh(i,be(a,3),Qr)}function MS(i,a){return i&&qr(i,be(a,3))}function LS(i,a){return i&&Df(i,be(a,3))}function RS(i){return i==null?[]:Ff(i,Tr(i))}function NS(i){return i==null?[]:Ff(i,Qr(i))}function Ym(i,a,u){var h=i==null?e:Ns(i,a);return h===e?u:h}function DS(i,a){return i!=null&&It(i,a,Dd)}function Hm(i,a){return i!=null&&It(i,a,Fd)}var FS=lc(function(i,a,u){a!=null&&typeof a.toString!="function"&&(a=Mr.call(a)),i[a]=u},qm(ti)),CS=lc(function(i,a,u){a!=null&&typeof a.toString!="function"&&(a=Mr.call(a)),un.call(i,a)?i[a].push(u):i[a]=[u]},be),kS=Ye(La);function Tr(i){return Jr(i)?eh(i):ns(i)}function Qr(i){return Jr(i)?eh(i,!0):zf(i)}function PS(i,a){var u={};return a=be(a,3),qr(i,function(h,m,x){Nr(u,a(h,m,x),h)}),u}function zS(i,a){var u={};return a=be(a,3),qr(i,function(h,m,x){Nr(u,m,a(h,m,x))}),u}var US=ka(function(i,a,u){Na(i,a,u)}),By=ka(function(i,a,u,h){Na(i,a,u,h)}),GS=Ri(function(i,a){var u={};if(i==null)return u;var h=!1;a=kn(a,function(x){return x=_i(x,i),h||(h=x.length>1),x}),Li(i,_c(i),u),h&&(u=pr(u,w|I|C,zm));for(var m=a.length;m--;)ph(u,a[m]);return u});function $S(i,a){return My(i,n_(be(a)))}var VS=Ri(function(i,a){return i==null?{}:lh(i,a)});function My(i,a){if(i==null)return{};var u=kn(_c(i),function(h){return[h]});return a=be(a),Da(i,u,function(h,m){return a(h,m[0])})}function jS(i,a,u){a=_i(a,i);var h=-1,m=a.length;for(m||(m=1,i=e);++h<m;){var x=i==null?e:i[mn(a[h])];x===e&&(h=m,x=u),i=ja(x)?x.call(i):x}return i}function WS(i,a,u){return i==null?i:Uf(i,a,u)}function YS(i,a,u,h){return h=typeof h=="function"?h:e,i==null?i:Uf(i,a,u,h)}var Ly=Hd(Tr),Ry=Hd(Qr);function HS(i,a,u){var h=ze(i),m=h||Ho(i)||gc(i);if(a=be(a,4),u==null){var x=i&&i.constructor;m?u=h?new x:[]:Hn(i)?u=ja(x)?Aa(Wu(i)):{}:u={}}return(m?_r:qr)(i,function(N,k,Z){return a(u,N,k,Z)}),u}function XS(i,a){return i==null?!0:ph(i,a)}function qS(i,a,u){return i==null?i:fc(i,a,jo(u))}function ZS(i,a,u,h){return h=typeof h=="function"?h:e,i==null?i:fc(i,a,jo(u),h)}function yc(i){return i==null?[]:xf(i,Tr(i))}function KS(i){return i==null?[]:xf(i,Qr(i))}function JS(i,a,u){return u===e&&(u=a,a=e),u!==e&&(u=Di(u),u=u===u?u:0),a!==e&&(a=Di(a),a=a===a?a:0),Ia(Di(i),a,u)}function QS(i,a,u){return a=Wa(a),u===e?(u=a,a=0):u=Wa(u),i=Di(i),oh(i,a,u)}function tA(i,a,u){if(u&&typeof u!="boolean"&&J(i,a,u)&&(a=u=e),u===e&&(typeof a=="boolean"?(u=a,a=e):typeof i=="boolean"&&(u=i,i=e)),i===e&&a===e?(i=0,a=1):(i=Wa(i),a===e?(a=i,i=0):a=Wa(a)),i>a){var h=i;i=a,a=h}if(u||i%1||a%1){var m=Kl();return wr(i+m*(a-i+it("1e-"+((m+"").length-1))),a)}return sc(i,a)}var eA=Yo(function(i,a,u){return a=a.toLowerCase(),i+(u?Ny(a):a)});function Ny(i){return Xm(Sn(i).toLowerCase())}function Dy(i){return i=Sn(i),i&&i.replace(El,Ul).replace(Du,"")}function nA(i,a,u){i=Sn(i),a=Gr(a);var h=i.length;u=u===e?h:Ia(He(u),0,h);var m=u;return u-=a.length,u>=0&&i.slice(u,m)==a}function rA(i){return i=Sn(i),i&&Ii.test(i)?i.replace(Ss,Gl):i}function iA(i){return i=Sn(i),i&&_l.test(i)?i.replace(af,"\\$&"):i}var sA=Yo(function(i,a,u){return i+(u?"-":"")+a.toLowerCase()}),aA=Yo(function(i,a,u){return i+(u?" ":"")+a.toLowerCase()}),oA=bh("toLowerCase");function fA(i,a,u){i=Sn(i),a=He(a);var h=a?Os(i):0;if(!a||h>=a)return i;var m=(a-h)/2;return Pn(Mo(m),u)+i+Pn(Yu(m),u)}function uA(i,a,u){i=Sn(i),a=He(a);var h=a?Os(i):0;return a&&h<a?i+Pn(a-h,u):i}function cA(i,a,u){i=Sn(i),a=He(a);var h=a?Os(i):0;return a&&h<a?Pn(a-h,u)+i:i}function lA(i,a,u){return u||a==null?a=0:a&&(a=+a),Xu(Sn(i).replace(of,""),a||0)}function hA(i,a,u){return(u?J(i,a,u):a===e)?a=1:a=He(a),ac(Sn(i),a)}function dA(){var i=arguments,a=Sn(i[0]);return i.length<3?a:a.replace(i[1],i[2])}var _A=Yo(function(i,a,u){return i+(u?"_":"")+a.toLowerCase()});function pA(i,a,u){return u&&typeof u!="number"&&J(i,a,u)&&(a=u=e),u=u===e?de:u>>>0,u?(i=Sn(i),i&&(typeof a=="string"||a!=null&&!Wm(a))&&(a=Gr(a),!a&&va(i))?pi(Br(i),0,u):i.split(a,u)):[]}var mA=Yo(function(i,a,u){return i+(u?" ":"")+Xm(a)});function gA(i,a,u){return i=Sn(i),u=u==null?0:Ia(He(u),0,i.length),a=Gr(a),i.slice(u,u+a.length)==a}function yA(i,a,u){var h=y.templateSettings;u&&J(i,a,u)&&(a=e),i=Sn(i),a=s_({},a,h,Sh);var m=s_({},a.imports,h.imports,Sh),x=Tr(m),N=xf(m,x),k,Z,At=0,Tt=a.interpolate||As,Ft="__p += '",ne=Hl((a.escape||As).source+"|"+Tt.source+"|"+(Tt===vr?vl:As).source+"|"+(a.evaluate||As).source+"|$","g"),pe="//# sourceURL="+(un.call(a,"sourceURL")?(a.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ma+"]")+`
`;i.replace(ne,function(Se,rn,cn,vi,Vr,bi){return cn||(cn=vi),Ft+=i.slice(At,bi).replace(Tl,$l),rn&&(k=!0,Ft+=`' +
__e(`+rn+`) +
'`),Vr&&(Z=!0,Ft+=`';
`+Vr+`;
__p += '`),cn&&(Ft+=`' +
((__t = (`+cn+`)) == null ? '' : __t) +
'`),At=bi+Se.length,Se}),Ft+=`';
`;var xe=un.call(a,"variable")&&a.variable;if(!xe)Ft=`with (obj) {
`+Ft+`
}
`;else if(gl.test(xe))throw new Be(c);Ft=(Z?Ft.replace(fl,""):Ft).replace(bu,"$1").replace(ul,"$1;"),Ft="function("+(xe||"obj")+`) {
`+(xe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(k?", __e = _.escape":"")+(Z?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Ft+`return __p
}`;var Je=Cy(function(){return fn(x,pe+"return "+Ft).apply(e,N)});if(Je.source=Ft,jm(Je))throw Je;return Je}function vA(i){return Sn(i).toLowerCase()}function bA(i){return Sn(i).toUpperCase()}function wA(i,a,u){if(i=Sn(i),i&&(u||a===e))return md(i);if(!i||!(a=Gr(a)))return i;var h=Br(i),m=Br(a),x=Uu(h,m),N=Gu(h,m)+1;return pi(h,x,N).join("")}function xA(i,a,u){if(i=Sn(i),i&&(u||a===e))return i.slice(0,bd(i)+1);if(!i||!(a=Gr(a)))return i;var h=Br(i),m=Gu(h,Br(a))+1;return pi(h,0,m).join("")}function SA(i,a,u){if(i=Sn(i),i&&(u||a===e))return i.replace(of,"");if(!i||!(a=Gr(a)))return i;var h=Br(i),m=Uu(h,Br(a));return pi(h,m).join("")}function AA(i,a){var u=Y,h=rt;if(Hn(a)){var m="separator"in a?a.separator:m;u="length"in a?He(a.length):u,h="omission"in a?Gr(a.omission):h}i=Sn(i);var x=i.length;if(va(i)){var N=Br(i);x=N.length}if(u>=x)return i;var k=u-Os(h);if(k<1)return h;var Z=N?pi(N,0,k).join(""):i.slice(0,k);if(m===e)return Z+h;if(N&&(k+=Z.length-k),Wm(m)){if(i.slice(k).search(m)){var At,Tt=Z;for(m.global||(m=Hl(m.source,Sn(Yi.exec(m))+"g")),m.lastIndex=0;At=m.exec(Tt);)var Ft=At.index;Z=Z.slice(0,Ft===e?k:Ft)}}else if(i.indexOf(Gr(m),k)!=k){var ne=Z.lastIndexOf(m);ne>-1&&(Z=Z.slice(0,ne))}return Z+h}function EA(i){return i=Sn(i),i&&wu.test(i)?i.replace(sf,tm):i}var TA=Yo(function(i,a,u){return i+(u?" ":"")+a.toUpperCase()}),Xm=bh("toUpperCase");function Fy(i,a,u){return i=Sn(i),a=u?e:a,a===e?gd(i)?nm(i):Jp(i):i.match(a)||[]}var Cy=Ye(function(i,a){try{return ar(i,e,a)}catch(u){return jm(u)?u:new Be(u)}}),IA=Ri(function(i,a){return _r(a,function(u){u=mn(u),Nr(i,u,$m(i[u],i))}),i});function OA(i){var a=i==null?0:i.length,u=be();return i=a?kn(i,function(h){if(typeof h[1]!="function")throw new Hr(f);return[u(h[0]),h[1]]}):[],Ye(function(h){for(var m=-1;++m<a;){var x=i[m];if(ar(x[0],this,h))return ar(x[1],this,h)}})}function BA(i){return Rd(pr(i,w))}function qm(i){return function(){return i}}function MA(i,a){return i==null||i!==i?a:i}var LA=rs(),RA=rs(!0);function ti(i){return i}function Zm(i){return Po(typeof i=="function"?i:pr(i,w))}function NA(i){return Fs(pr(i,w))}function DA(i,a){return Cs(i,pr(a,w))}var FA=Ye(function(i,a){return function(u){return La(u,i,a)}}),CA=Ye(function(i,a){return function(u){return La(i,u,a)}});function Km(i,a,u){var h=Tr(a),m=Ff(a,h);u==null&&!(Hn(a)&&(m.length||!h.length))&&(u=a,a=i,i=this,m=Ff(a,Tr(a)));var x=!(Hn(u)&&"chain"in u)||!!u.chain,N=ja(i);return _r(m,function(k){var Z=a[k];i[k]=Z,N&&(i.prototype[k]=function(){var At=this.__chain__;if(x||At){var Tt=i(this.__wrapped__),Ft=Tt.__actions__=Ar(this.__actions__);return Ft.push({func:Z,args:arguments,thisArg:i}),Tt.__chain__=At,Tt}return Z.apply(i,qi([this.value()],arguments))})}),i}function kA(){return De._===this&&(De._=wd),this}function Jm(){}function PA(i){return i=He(i),Ye(function(a){return zo(a,i)})}var zA=hc(kn),UA=hc(Ts),GA=hc(ku);function ky(i){return xt(i)?ya(mn(i)):Uo(i)}function $A(i){return function(a){return i==null?e:Ns(i,a)}}var VA=zn(),jA=zn(!0);function Qm(){return[]}function t0(){return!1}function WA(){return{}}function YA(){return""}function HA(){return!0}function XA(i,a){if(i=He(i),i<1||i>Lt)return[];var u=de,h=wr(i,de);a=be(a),i-=de;for(var m=zl(h,a);++u<i;)a(u);return m}function qA(i){return ze(i)?kn(i,mn):yi(i)?[i]:Ar(Me(Sn(i)))}function ZA(i){var a=++am;return Sn(i)+a}var KA=za(function(i,a){return i+a},0),JA=xh("ceil"),QA=za(function(i,a){return i/a},1),t6=xh("floor");function e6(i){return i&&i.length?Ma(i,ti,Cf):e}function n6(i,a){return i&&i.length?Ma(i,be(a,2),Cf):e}function r6(i){return wf(i,ti)}function i6(i,a){return wf(i,be(a,2))}function s6(i){return i&&i.length?Ma(i,ti,Ra):e}function a6(i,a){return i&&i.length?Ma(i,be(a,2),Ra):e}var o6=za(function(i,a){return i*a},1),f6=xh("round"),u6=za(function(i,a){return i-a},0);function c6(i){return i&&i.length?zu(i,ti):0}function l6(i,a){return i&&i.length?zu(i,be(a,2)):0}return y.after=N3,y.ary=_y,y.assign=bS,y.assignIn=Oy,y.assignInWith=s_,y.assignWith=wS,y.at=xS,y.before=py,y.bind=$m,y.bindAll=IA,y.bindKey=my,y.castArray=W3,y.chain=ly,y.chunk=Yn,y.compact=er,y.concat=fr,y.cond=OA,y.conforms=BA,y.constant=qm,y.countBy=c3,y.create=SS,y.curry=gy,y.curryRight=yy,y.debounce=vy,y.defaults=AS,y.defaultsDeep=ES,y.defer=D3,y.delay=F3,y.difference=Un,y.differenceBy=we,y.differenceWith=ur,y.drop=en,y.dropRight=ce,y.dropRightWhile=Le,y.dropWhile=Ve,y.fill=Gn,y.filter=h3,y.flatMap=p3,y.flatMapDeep=m3,y.flatMapDepth=g3,y.flatten=T,y.flattenDeep=nt,y.flattenDepth=q,y.flip=C3,y.flow=LA,y.flowRight=RA,y.fromPairs=Xt,y.functions=RS,y.functionsIn=NS,y.groupBy=y3,y.initial=g,y.intersection=R,y.intersectionBy=U,y.intersectionWith=$,y.invert=FS,y.invertBy=CS,y.invokeMap=b3,y.iteratee=Zm,y.keyBy=w3,y.keys=Tr,y.keysIn=Qr,y.map=Qd,y.mapKeys=PS,y.mapValues=zS,y.matches=NA,y.matchesProperty=DA,y.memoize=e_,y.merge=US,y.mergeWith=By,y.method=FA,y.methodOf=CA,y.mixin=Km,y.negate=n_,y.nthArg=PA,y.omit=GS,y.omitBy=$S,y.once=k3,y.orderBy=x3,y.over=zA,y.overArgs=P3,y.overEvery=UA,y.overSome=GA,y.partial=Vm,y.partialRight=by,y.partition=S3,y.pick=VS,y.pickBy=My,y.property=ky,y.propertyOf=$A,y.pull=O,y.pullAll=E,y.pullAllBy=X,y.pullAllWith=j,y.pullAt=ct,y.range=VA,y.rangeRight=jA,y.rearg=z3,y.reject=T3,y.remove=_t,y.rest=U3,y.reverse=Nt,y.sampleSize=O3,y.set=WS,y.setWith=YS,y.shuffle=B3,y.slice=he,y.sortBy=R3,y.sortedUniq=le,y.sortedUniqBy=nn,y.split=pA,y.spread=G3,y.tail=cr,y.take=Ga,y.takeRight=ss,y.takeRightWhile=Ni,y.takeWhile=Gs,y.tap=e3,y.throttle=$3,y.thru=Jd,y.toArray=Ey,y.toPairs=Ly,y.toPairsIn=Ry,y.toPath=qA,y.toPlainObject=Iy,y.transform=HS,y.unary=V3,y.union=$a,y.unionBy=Zd,y.unionWith=$r,y.uniq=Va,y.uniqBy=Kr,y.uniqWith=Kd,y.unset=XS,y.unzip=Er,y.unzipWith=qf,y.update=qS,y.updateWith=ZS,y.values=yc,y.valuesIn=KS,y.without=mc,y.words=Fy,y.wrap=j3,y.xor=Xx,y.xorBy=qx,y.xorWith=Zx,y.zip=Kx,y.zipObject=Jx,y.zipObjectDeep=Qx,y.zipWith=t3,y.entries=Ly,y.entriesIn=Ry,y.extend=Oy,y.extendWith=s_,Km(y,y),y.add=KA,y.attempt=Cy,y.camelCase=eA,y.capitalize=Ny,y.ceil=JA,y.clamp=JS,y.clone=Y3,y.cloneDeep=X3,y.cloneDeepWith=q3,y.cloneWith=H3,y.conformsTo=Z3,y.deburr=Dy,y.defaultTo=MA,y.divide=QA,y.endsWith=nA,y.eq=as,y.escape=rA,y.escapeRegExp=iA,y.every=l3,y.find=d3,y.findIndex=gi,y.findKey=TS,y.findLast=_3,y.findLastIndex=Us,y.findLastKey=IS,y.floor=t6,y.forEach=hy,y.forEachRight=dy,y.forIn=OS,y.forInRight=BS,y.forOwn=MS,y.forOwnRight=LS,y.get=Ym,y.gt=K3,y.gte=J3,y.has=DS,y.hasIn=Hm,y.head=Ae,y.identity=ti,y.includes=v3,y.indexOf=S,y.inRange=QS,y.invoke=kS,y.isArguments=Zf,y.isArray=ze,y.isArrayBuffer=Q3,y.isArrayLike=Jr,y.isArrayLikeObject=nr,y.isBoolean=tS,y.isBuffer=Ho,y.isDate=eS,y.isElement=nS,y.isEmpty=rS,y.isEqual=iS,y.isEqualWith=sS,y.isError=jm,y.isFinite=aS,y.isFunction=ja,y.isInteger=wy,y.isLength=r_,y.isMap=xy,y.isMatch=oS,y.isMatchWith=fS,y.isNaN=uS,y.isNative=cS,y.isNil=hS,y.isNull=lS,y.isNumber=Sy,y.isObject=Hn,y.isObjectLike=Zn,y.isPlainObject=Eh,y.isRegExp=Wm,y.isSafeInteger=dS,y.isSet=Ay,y.isString=i_,y.isSymbol=yi,y.isTypedArray=gc,y.isUndefined=_S,y.isWeakMap=pS,y.isWeakSet=mS,y.join=D,y.kebabCase=sA,y.last=L,y.lastIndexOf=P,y.lowerCase=aA,y.lowerFirst=oA,y.lt=gS,y.lte=yS,y.max=e6,y.maxBy=n6,y.mean=r6,y.meanBy=i6,y.min=s6,y.minBy=a6,y.stubArray=Qm,y.stubFalse=t0,y.stubObject=WA,y.stubString=YA,y.stubTrue=HA,y.multiply=o6,y.nth=A,y.noConflict=kA,y.noop=Jm,y.now=t_,y.pad=fA,y.padEnd=uA,y.padStart=cA,y.parseInt=lA,y.random=tA,y.reduce=A3,y.reduceRight=E3,y.repeat=hA,y.replace=dA,y.result=jS,y.round=f6,y.runInContext=W,y.sample=I3,y.size=M3,y.snakeCase=_A,y.some=L3,y.sortedIndex=ae,y.sortedIndexBy=Ht,y.sortedIndexOf=mt,y.sortedLastIndex=ot,y.sortedLastIndexBy=te,y.sortedLastIndexOf=Jt,y.startCase=mA,y.startsWith=gA,y.subtract=u6,y.sum=c6,y.sumBy=l6,y.template=yA,y.times=XA,y.toFinite=Wa,y.toInteger=He,y.toLength=Ty,y.toLower=vA,y.toNumber=Di,y.toSafeInteger=vS,y.toString=Sn,y.toUpper=bA,y.trim=wA,y.trimEnd=xA,y.trimStart=SA,y.truncate=AA,y.unescape=EA,y.uniqueId=ZA,y.upperCase=TA,y.upperFirst=Xm,y.each=hy,y.eachRight=dy,y.first=Ae,Km(y,function(){var i={};return qr(y,function(a,u){un.call(y.prototype,u)||(i[u]=a)}),i}(),{chain:!1}),y.VERSION=r,_r(["bind","bindKey","curry","curryRight","partial","partialRight"],function(i){y[i].placeholder=y}),_r(["drop","take"],function(i,a){tn.prototype[i]=function(u){u=u===e?1:$n(He(u),0);var h=this.__filtered__&&!a?new tn(this):this.clone();return h.__filtered__?h.__takeCount__=wr(u,h.__takeCount__):h.__views__.push({size:wr(u,de),type:i+(h.__dir__<0?"Right":"")}),h},tn.prototype[i+"Right"]=function(u){return this.reverse()[i](u).reverse()}}),_r(["filter","map","takeWhile"],function(i,a){var u=a+1,h=u==F||u==H;tn.prototype[i]=function(m){var x=this.clone();return x.__iteratees__.push({iteratee:be(m,3),type:u}),x.__filtered__=x.__filtered__||h,x}}),_r(["head","last"],function(i,a){var u="take"+(a?"Right":"");tn.prototype[i]=function(){return this[u](1).value()[0]}}),_r(["initial","tail"],function(i,a){var u="drop"+(a?"":"Right");tn.prototype[i]=function(){return this.__filtered__?new tn(this):this[u](1)}}),tn.prototype.compact=function(){return this.filter(ti)},tn.prototype.find=function(i){return this.filter(i).head()},tn.prototype.findLast=function(i){return this.reverse().find(i)},tn.prototype.invokeMap=Ye(function(i,a){return typeof i=="function"?new tn(this):this.map(function(u){return La(u,i,a)})}),tn.prototype.reject=function(i){return this.filter(n_(be(i)))},tn.prototype.slice=function(i,a){i=He(i);var u=this;return u.__filtered__&&(i>0||a<0)?new tn(u):(i<0?u=u.takeRight(-i):i&&(u=u.drop(i)),a!==e&&(a=He(a),u=a<0?u.dropRight(-a):u.take(a-i)),u)},tn.prototype.takeRightWhile=function(i){return this.reverse().takeWhile(i).reverse()},tn.prototype.toArray=function(){return this.take(de)},qr(tn.prototype,function(i,a){var u=/^(?:filter|find|map|reject)|While$/.test(a),h=/^(?:head|last)$/.test(a),m=y[h?"take"+(a=="last"?"Right":""):a],x=h||/^find/.test(a);m&&(y.prototype[a]=function(){var N=this.__wrapped__,k=h?[1]:arguments,Z=N instanceof tn,At=k[0],Tt=Z||ze(N),Ft=function(rn){var cn=m.apply(y,qi([rn],k));return h&&ne?cn[0]:cn};Tt&&u&&typeof At=="function"&&At.length!=1&&(Z=Tt=!1);var ne=this.__chain__,pe=!!this.__actions__.length,xe=x&&!ne,Je=Z&&!pe;if(!x&&Tt){N=Je?N:new tn(this);var Se=i.apply(N,k);return Se.__actions__.push({func:Jd,args:[Ft],thisArg:e}),new Xr(Se,ne)}return xe&&Je?i.apply(this,k):(Se=this.thru(Ft),xe?h?Se.value()[0]:Se.value():Se)})}),_r(["pop","push","shift","sort","splice","unshift"],function(i){var a=Vu[i],u=/^(?:push|sort|unshift)$/.test(i)?"tap":"thru",h=/^(?:pop|shift)$/.test(i);y.prototype[i]=function(){var m=arguments;if(h&&!this.__chain__){var x=this.value();return a.apply(ze(x)?x:[],m)}return this[u](function(N){return a.apply(ze(N)?N:[],m)})}}),qr(tn.prototype,function(i,a){var u=y[a];if(u){var h=u.name+"";un.call(xr,h)||(xr[h]=[]),xr[h].push({name:a,func:u})}}),xr[Xf(e,Rt).name]=[{name:"wrapper",func:e}],tn.prototype.clone=dm,tn.prototype.reverse=_m,tn.prototype.value=pm,y.prototype.at=n3,y.prototype.chain=r3,y.prototype.commit=i3,y.prototype.next=s3,y.prototype.plant=o3,y.prototype.reverse=f3,y.prototype.toJSON=y.prototype.valueOf=y.prototype.value=u3,y.prototype.first=y.prototype.head,li&&(y.prototype[li]=a3),y},Io=rm();dn?((dn.exports=Io)._=Io,We._=Io):De._=Io}).call(ls)})(OT,Q_);const Lv={sqrt:pT,log:Zb,linear:J_,literal:Xb};class Cp{constructor(t,e,r,s){if(this._transform="linear",this.field=null,this._texture_buffer=null,this.partner=null,this._textures={},this.current_encoding=null,this.aesthetic_map=s,this.aesthetic_map===void 0)throw new Error("Aesthetic map is undefined");this.scatterplot=t,this.regl=e,this._range=[0,1],this.dataset=r,this.id=Math.random().toString()}apply(t){return this.scale===void 0?this.default_constant:this.scale(this.value_for(t))}get transform(){return this._transform?this._transform:this.default_transform}set transform(t){this._transform=t}get scale(){if(this._scale)return this._scale;if(this.is_dictionary())throw new Error("Dictionary scales only supported for colors");const t=Lv[this.transform]();return t.domain(this.domain).range(this.range),this._scale=t}get column(){var t,e;if(this.field===null)throw new Error("Can't retrieve column for aesthetic without a field");if((e=(t=this.dataset)==null?void 0:t.root_tile)!=null&&e.record_batch){const r=this.dataset.root_tile.record_batch.getChild(this.field);if(r==null)throw new Error("Can't find column "+this.field);return r}throw new Error("Table is null")}get default_domain(){var t;if(this.field==null)return[1,1];if(!this.scatterplot._root._schema)return[1,1];const{column:e}=this;return e?((t=e.type)==null?void 0:t.dictionary)!==void 0?[0,this.aesthetic_map.texture_size]:(this.dataset.domain(this.field),this.dataset.domain(this.field)):[1,1]}default_data(){const t=this.toGLType(this.default_constant);return Array(this.aesthetic_map.texture_size).fill(t)}get webGLDomain(){return this.is_dictionary()?[0,4096]:this.domain}get domain(){return this._domain===void 0&&(this._domain=this.default_domain),this._domain||this.default_domain}get range(){return this._range||this.default_range}value_for(t){return this.field&&t[this.field]?t[this.field]:null}get map_position(){return this.use_map_on_regl===0?0:this.aesthetic_map.get_position(this.id)}get texture_buffer(){return this._texture_buffer?this._texture_buffer:(this._texture_buffer=new Float32Array(this.aesthetic_map.texture_size),this._texture_buffer.set(this.default_data()),this._texture_buffer)}post_to_regl_buffer(){this.aesthetic_map.set_one_d(this.id,this.texture_buffer)}convert_string_encoding(t){return{field:t,domain:this.default_domain,range:this.default_range}}complete_domain(t){return t.domain=t.domain||this.default_domain,t}reset_to_defaults(){this._domain=this.default_domain,this._range=[0,1],this._transform=void 0,this._constant=this.default_constant,this.field=null,this.current_encoding=null,this._scale=void 0}update(t){var e;if(t===void 0){console.warn("Should never be calling update with undefined.");return}if(t===null||t==="null"){this.current_encoding=null,this.reset_to_defaults();return}if(this._scale=void 0,typeof t=="string"&&(t=this.convert_string_encoding(t)),Q_.isNumber(t)){const r={constant:t};this.current_encoding=r;return}if(Object.keys(t).length===0){console.warn("Resetting parameters with an empty object is deprecated: use 'null'"),this.reset_to_defaults();return}if(this.current_encoding=t,!Xh(t)&&(this.field=t.field,!W0(t))){if(r1(t)){const{lambda:r,field:s}=t;r&&(this.apply_function_for_textures(s,this.domain,r),this.post_to_regl_buffer());return}t.domain===void 0&&(t.domain=this.default_domain),t.range&&(this._domain=t.domain,this._range=t.range),this._transform=(e=t.transform)!=null?e:void 0}}encode_for_textures(t){const{texture_size:e}=this.aesthetic_map,r=Array(e),s=Lv[this.transform]().range(t).domain([0,e-1]);for(let o=0;o<e;o+=1)r[o]=s(o)}arrow_column(){if(this.field===null)throw new Error("Can't retrieve column for aesthetic without a field");const t=this.dataset.root_tile.record_batch.getChild(this.field);if(t===null)throw new Error(`No column ${this.field} on arrow table for aesthetic`);return t}is_dictionary(){var t,e;return this.field===null||this.field===void 0?!1:((e=(t=this.arrow_column())==null?void 0:t.type)==null?void 0:e.dictionary)!==void 0}get constant(){return this.current_encoding!==null&&Xh(this.current_encoding)?this.toGLType(this.current_encoding.constant):this.toGLType(this.default_constant)}get use_map_on_regl(){return this.is_dictionary()?1:0}materialize_function(t){const e=typeof t=="string"?CT(f1(t)):t;return this._func=e,e}apply_function_for_textures(t,e,r){var s;const{texture_size:o}=this.aesthetic_map,f=this.materialize_function(r);let c=ou(o);if(t===void 0||this.dataset.root_tile.record_batch===void 0){t===void 0&&console.warn("SETTING EMPTY FIELD"),this.dataset.root_tile.record_batch===void 0&&console.warn("SETTING EMPTY TABLE"),this.texture_buffer.set(ou(o).map(p=>1));return}const{column:l}=this;if(!l)throw new Error(`Column ${t} does not exist on table.`);if((s=l==null?void 0:l.type)!=null&&s.dictionary){c.fill("");const p=l.data[0].dictionary.toArray();for(const[w,I]of p.entries())c[w]=I}else c=c.map(p=>this.scale(p));const d=c.map(p=>f(p));this.texture_buffer.set(d)}}class Ag extends Cp{constructor(t,e,r,s){super(t,e,r,s),this.current_encoding=null}toGLType(t){return t}static get_default_domain(){return[0,1]}get default_domain(){return[0,1]}}class BT extends Ag{constructor(){super(...arguments),this._constant=1,this.default_constant=1,this.default_transform="sqrt"}static get default_constant(){return 1.5}get default_range(){return[0,1]}}class i1 extends Ag{constructor(t,e,r,s){super(t,e,r,s),this.default_range=[-1,1],this.default_constant=0,this.default_transform="literal",this._constant=0,this._transform="literal"}get range(){return this._range?this._range:this.dataset.extent&&this.field&&this.dataset.extent[this.field]?this.dataset.extent[this.field]:this.default_range}static get default_constant(){return 0}}class s1 extends i1{constructor(){super(...arguments),this.field="x"}}class MT extends s1{}class a1 extends i1{constructor(){super(...arguments),this.field="y"}}class LT extends a1{}class o1 extends Cp{constructor(t,e,r,s){super(t,e,r,s)}toGLType(t){return t?1:0}update(t){super.update(t),this.current_encoding!==null&&Object.keys(this.current_encoding).length===0&&(this.current_encoding=null)}ops_to_array(){const t=this.current_encoding;return t===null?[0,0,0]:t===void 0?[0,0,0]:W0(t)?t.op==="within"?[4,t.a,t.b]:t.op==="between"?[4,(t.b-t.a)/2,(t.b+t.a)/2]:[[null,"lt","gt","eq"].indexOf(t.op),t.a,0]:[0,0,0]}apply(t){const e=this.current_encoding;if(e==null)return!0;if(W0(e))return this.apply_op(t,e);if(Xh(e))return e.constant===0?(console.warn("Deprecated: pass `true` or `false` to boolean fields, not numbers"),!1):e.constant===1?(console.warn("Deprecated: pass `true` or `false` to boolean fields, not numbers"),!0):e.constant;if(r1(e)){if(this._func===void 0)throw new Error("_func should have been bound"+JSON.stringify(this.current_encoding));const r=this.value_for(t);return r===null?!1:!!this._func(r)}return!0}apply_op(t,e){const{op:r,a:s}=e,o=this.value_for(t);if(o===null)return!1;if(r==="eq")return o==s;if(r==="gt")return o>s;if(r==="lt")return o<s;if(r==="within")return Math.abs(o-e.b)<s;if(r==="between"){const f=(e.a+e.b)/2,c=Math.abs(e.a-e.b)/2;return Math.abs(o-f)<c}return!1}get default_domain(){return[0,1]}}class RT extends o1{constructor(){super(...arguments),this.current_encoding=null,this._constant=!0,this.default_constant=!0,this.default_range=[0,1],this.default_transform="literal"}get active(){return!(this.current_encoding===null||Xh(this.current_encoding))}}class Rv extends o1{constructor(){super(...arguments),this.current_encoding=null,this._constant=!0,this.default_constant=!0,this.default_transform="literal",this.default_range=[0,1]}}class NT extends Ag{constructor(){super(...arguments),this.default_transform="linear",this.default_range=[0,1],this.default_constant=.5,this._constant=0}}function DT(n){return n==="spiral"?1:n==="uniform"?2:n==="normal"?3:n==="circle"?4:n==="time"?5:0}class FT extends Cp{constructor(){super(...arguments),this._constant=0,this.jitter_int_formatted=0,this.default_transform="linear",this._method="None"}toGLType(t){return t}get default_constant(){return 0}get default_range(){return[0,1]}get method(){var t,e;return(e=(t=this.current_encoding)==null?void 0:t.method)!=null?e:"None"}set method(t){this._method=t}get jitter_int_format(){return DT(this.method)}}function f1(n){let[t,e]=n.split("=>").map(s=>s.trim());if(e===void 0)throw new Error(`Couldn't parse ${n} into a function`);e.slice(0,1)!=="{"&&e.slice(0,6)!=="return"&&(e=`return ${e}`);const r=`${t} => ${e}`;return{field:t,lambda:r}}function CT(n){if(typeof n.lambda=="function")throw"Must pass a string to lambda, not a function.";const{lambda:t,field:e}=n;if(e===void 0)throw"Must pass a field to lambda.";const r=f1(t).lambda,[s,o]=r.split("=>",2).map(c=>c.trim());return new Function(s,o)}function qe(n){for(var t=n.length/6|0,e=new Array(t),r=0;r<t;)e[r]="#"+n.slice(r*6,++r*6);return e}const kT=qe("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),PT=qe("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),zT=qe("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),UT=qe("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),GT=qe("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),$T=qe("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),VT=qe("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),jT=qe("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),WT=qe("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),YT=qe("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),Rn=n=>_8(n[n.length-1]);var u1=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(qe);const HT=Rn(u1);var c1=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(qe);const XT=Rn(c1);var l1=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(qe);const qT=Rn(l1);var h1=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(qe);const ZT=Rn(h1);var d1=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(qe);const KT=Rn(d1);var _1=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(qe);const JT=Rn(_1);var p1=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(qe);const QT=Rn(p1);var m1=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(qe);const tI=Rn(m1);var g1=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(qe);const eI=Rn(g1);var y1=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(qe);const nI=Rn(y1);var v1=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(qe);const rI=Rn(v1);var b1=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(qe);const iI=Rn(b1);var w1=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(qe);const sI=Rn(w1);var x1=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(qe);const aI=Rn(x1);var S1=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(qe);const oI=Rn(S1);var A1=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(qe);const fI=Rn(A1);var E1=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(qe);const uI=Rn(E1);var T1=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(qe);const cI=Rn(T1);var I1=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(qe);const lI=Rn(I1);var O1=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(qe);const hI=Rn(O1);var B1=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(qe);const dI=Rn(B1);var M1=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(qe);const _I=Rn(M1);var L1=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(qe);const pI=Rn(L1);var R1=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(qe);const mI=Rn(R1);var N1=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(qe);const gI=Rn(N1);var D1=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(qe);const yI=Rn(D1);var F1=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(qe);const vI=Rn(F1);function bI(n){return n=Math.max(0,Math.min(1,n)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-n*(35.34-n*(2381.73-n*(6402.7-n*(7024.72-n*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+n*(170.73+n*(52.82-n*(131.46-n*(176.58-n*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+n*(442.36-n*(2482.43-n*(6167.24-n*(6614.94-n*2475.67)))))))+")"}const wI=_g(ra(300,.5,0),ra(-240,.5,1));var xI=_g(ra(-100,.75,.35),ra(80,1.5,.8)),SI=_g(ra(260,.75,.35),ra(80,1.5,.8)),p_=ra();function AI(n){(n<0||n>1)&&(n-=Math.floor(n));var t=Math.abs(n-.5);return p_.h=360*n-100,p_.s=1.5-1.5*t,p_.l=.8-.9*t,p_+""}var m_=ro(),EI=Math.PI/3,TI=Math.PI*2/3;function II(n){var t;return n=(.5-n)*Math.PI,m_.r=255*(t=Math.sin(n))*t,m_.g=255*(t=Math.sin(n+EI))*t,m_.b=255*(t=Math.sin(n+TI))*t,m_+""}function OI(n){return n=Math.max(0,Math.min(1,n)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+n*(1172.33-n*(10793.56-n*(33300.12-n*(38394.49-n*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+n*(557.33+n*(1225.33-n*(3574.96-n*(1073.77+n*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+n*(3211.1-n*(15327.97-n*(27814-n*(22569.18-n*6838.66)))))))+")"}function kp(n){var t=n.length;return function(e){return n[Math.max(0,Math.min(t-1,Math.floor(e*t)))]}}const BI=kp(qe("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var MI=kp(qe("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),LI=kp(qe("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),RI=kp(qe("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));const Eg=Object.freeze(Object.defineProperty({__proto__:null,interpolateBlues:_I,interpolateBrBG:HT,interpolateBuGn:nI,interpolateBuPu:rI,interpolateCividis:bI,interpolateCool:SI,interpolateCubehelixDefault:wI,interpolateGnBu:iI,interpolateGreens:pI,interpolateGreys:mI,interpolateInferno:LI,interpolateMagma:MI,interpolateOrRd:sI,interpolateOranges:vI,interpolatePRGn:XT,interpolatePiYG:qT,interpolatePlasma:RI,interpolatePuBu:oI,interpolatePuBuGn:aI,interpolatePuOr:ZT,interpolatePuRd:fI,interpolatePurples:gI,interpolateRainbow:AI,interpolateRdBu:KT,interpolateRdGy:JT,interpolateRdPu:uI,interpolateRdYlBu:QT,interpolateRdYlGn:tI,interpolateReds:yI,interpolateSinebow:II,interpolateSpectral:eI,interpolateTurbo:OI,interpolateViridis:BI,interpolateWarm:xI,interpolateYlGn:lI,interpolateYlGnBu:cI,interpolateYlOrBr:hI,interpolateYlOrRd:dI,schemeAccent:PT,schemeBlues:M1,schemeBrBG:u1,schemeBuGn:y1,schemeBuPu:v1,schemeCategory10:kT,schemeDark2:zT,schemeGnBu:b1,schemeGreens:L1,schemeGreys:R1,schemeOrRd:w1,schemeOranges:F1,schemePRGn:c1,schemePaired:UT,schemePastel1:GT,schemePastel2:$T,schemePiYG:l1,schemePuBu:S1,schemePuBuGn:x1,schemePuOr:h1,schemePuRd:A1,schemePurples:N1,schemeRdBu:d1,schemeRdGy:_1,schemeRdPu:E1,schemeRdYlBu:p1,schemeRdYlGn:m1,schemeReds:D1,schemeSet1:VT,schemeSet2:jT,schemeSet3:WT,schemeSpectral:g1,schemeTableau10:YT,schemeYlGn:I1,schemeYlGnBu:T1,schemeYlOrBr:O1,schemeYlOrRd:B1},Symbol.toStringTag,{value:"Module"})),NI=1664525,DI=1013904223,Nv=1/4294967296;function FI(n=Math.random()){let t=(0<=n&&n<1?n/Nv:Math.abs(n))|0;return()=>(t=NI*t+DI|0,Nv*(t>>>0))}const cu=4096;function CI(n){const t=new Uint8Array(4*cu);return ou(cu).forEach(e=>{const r=ro(n(e/cu));t.set([r.r,r.g,r.b,255],e*4)}),t}const Xs={white:new Uint8Array(4*cu).fill(255)},tp={};function ep(n){const t=n.map(s=>{const o=ro(s);return[o.r,o.g,o.b,255]}),e=new Uint8Array(cu*4),r=Math.floor(cu/n.length);for(let s=0;s<n.length;s++)for(let o=0;o<r&&s*r+o<cu;o++)e.set(t[s],(s*r+o)*4);return e}for(const n of["schemeAccent","schemeCategory10","schemeDark2","schemePaired","schemePastel1","schemePastel2","schemeSet1","schemeSet2","schemeSet3","schemeTableau10"]){const t=Eg[n],e=n.replace("scheme","").toLowerCase();Xs[e]=ep(t),tp[e]=t}for(const n of["interpolateBlues","interpolateBrBG","interpolateBuGn","interpolateBuPu","interpolateCividis","interpolateCool","interpolateCubehelixDefault","interpolateGnBu","interpolateGreens","interpolateGreys","interpolateInferno","interpolateMagma","interpolateOrRd","interpolateOranges","interpolatePRGn","interpolatePiYG","interpolatePlasma","interpolatePuBu","interpolatePuBuGn","interpolatePuOr","interpolatePuRd","interpolatePurples","interpolateRainbow","interpolateRdBu","interpolateRdGy","interpolateRdPu","interpolateRdYlBu","interpolateRdYlGn","interpolateReds","interpolateSinebow","interpolateSpectral","interpolateTurbo","interpolateViridis","interpolateWarm","interpolateYlGn","interpolateYlGnBu","interpolateYlOrBr","interpolateYlOrRd"]){const t=n.replace("interpolate","").toLowerCase(),e=Eg[n];if(Xs[t]=CI(e),t==="rainbow"){const r=i5(FI(1));Xs.shufbow=r(Xs[t])}}function kI(){const n=["#E69F00","#CC79A7","#56B4E9","#009E73","#0072B2","#D55E00","#F0E442"];Xs.okabe=ep(n),tp.okabe=n}kI();class PI extends Cp{constructor(){super(...arguments),this._constant="#CC5500",this.texture_type="uint8",this.default_constant="#CC5500",this.default_transform="linear",this.current_encoding=null}get default_range(){return[0,1]}default_data(){return Xs.viridis}get use_map_on_regl(){return 1}get colorscheme_size(){return this.is_dictionary()?this.scale.range().length:-1}get scale(){if(this._scale)return this._scale;const t=this.range;function e(r){return r==="ylorrd"?"YlOrRd":r.charAt(0).toUpperCase()+r.slice(1)}if(this.is_dictionary()){const r=G0().domain(this.domain);if(typeof t=="string"&&tp[t]){const s=this.column.data[0].dictionary;if(s===null)throw new Error("Dictionary is null");const o=s.toArray();return this._scale=G0().range(tp[t]).domain(o)}else return this._scale=r.range(this.range)}if(typeof t=="string"){const r=Eg["interpolate"+e(t)];if(r!==void 0)return this.transform==="sqrt"?this._scale=e1(r).exponent(.5).domain(this.domain):this.transform==="log"?this._scale=t1(r).domain(this.domain):this._scale=Qb(r).domain(this.domain)}}get texture_buffer(){return this._texture_buffer?this._texture_buffer:(this._texture_buffer=new Uint8Array(this.aesthetic_map.texture_size*4),this._texture_buffer.set(this.default_data()),this._texture_buffer)}post_to_regl_buffer(){this.aesthetic_map.set_color(this.id,this.texture_buffer)}update(t){super.update(t),this.current_encoding=t,t===null&&(t={constant:this.default_constant}),Xh(t)||(t.range&&typeof t.range[0]=="string"?(this.encode_for_textures(t.range),this.post_to_regl_buffer()):t.range&&this.post_to_regl_buffer())}toGLType(t){const{r:e,g:r,b:s}=ro(t);return[e/255,r/255,s/255]}encode_for_textures(t){if(Array.isArray(t)){const e=t.join("/");if(Xs[e]){this.texture_buffer.set(Xs[e]);return}else{let r;if(!this.is_dictionary())r=ep(t);else{const s=this.column.data[0].dictionary.toArray(),o=Object.fromEntries(s.map((c,l)=>[c,l])),f=[];for(let c=0;c<this.domain.length;c++){const l=this.domain[c],d=t[c];o[l]!==void 0&&(f[o[l]]=d)}for(let c=0;c<s.length;c++)f[c]===void 0&&(f[c]="gray");r=ep(f)}this.texture_buffer.set(r);return}}if(Xs[t]){this.texture_buffer.set(Xs[t]);return}if(t.length===this.aesthetic_map.texture_size*4)throw new Error("SETTING FULL RANGE IS DEPRECATED");console.error(`request range of ${t} for color ${this.field} unknown`)}}const o0={size:BT,jitter_speed:NT,jitter_radius:FT,color:PI,filter:Rv,filter2:Rv,x:s1,y:a1,x0:MT,y0:LT,foreground:RT};class zI{constructor(t,e,r,s,o){if(this.needs_transitions=!1,s===void 0)throw new Error("Aesthetic map is undefined.");this.scatterplot=t,this.regl=e,this.dataset=r,this.aesthetic_map=s,this.states=[new o(this.scatterplot,this.regl,this.dataset,this.aesthetic_map),new o(this.scatterplot,this.regl,this.dataset,this.aesthetic_map)]}get current(){return this.states[0]}get last(){return this.states[1]}update(t){JSON.stringify(t)===JSON.stringify(this.states[0].current_encoding)||t===void 0?(this.needs_transitions&&this.states[1].update(this.states[0].current_encoding),this.needs_transitions=!1):(this.states.reverse(),this.states[0].update(t),this.needs_transitions=!0)}}class UI{constructor(t,e,r){return this.encoding={},this.scatterplot=t,this.store={},this.regl=e,this.tileSet=r,this.position_interpolation=!1,this.aesthetic_map=new GI(this.regl),this}dim(t){if(this.store[t])return this.store[t];if(!o0[t])throw new Error(`Unknown aesthetic ${t}`);const e=o0[t],r=this.scatterplot,s=this.regl,o=this.aesthetic_map,f=new zI(r,s,this.tileSet,o,e);return this.store[t]=f,f}*[Symbol.iterator](){for(const[t,e]of Object.entries(this.store))yield[t,e]}interpret_position(t){if(t){t.x0||t.position0?this.position_interpolation=!0:(t.x||t.position)&&(this.position_interpolation=!1);for(const e of["position","position0"]){const r=e.replace("position","");if(t[e]){if(t[e]==="literal")t[`x${r}`]={field:"x",transform:"literal"},t[`y${r}`]={field:"y",transform:"literal"};else{const s=t[e];t[`x${r}`]={field:`${s}.x`,transform:"literal"},t[`y${r}`]={field:`${s}.y`,transform:"literal"}}delete t[e]}}}delete t.position,delete t.position0}apply_encoding(t){if(t===void 0&&(t={}),t.filter1!==void 0)throw new Error('filter1 is not supported; just say "filter"');const e=t.color&&t.color.domain?t.color.domain:void 0;e&&e.length==2&&Math.abs(e[1]-e[0]-4096)<2&&(console.warn(`Resetting color encoding from -2047 to 0. The old behavior of requiring negative numbers 
          for dictionary schemes is deprecated. If you're actually trying to encode real numbers here, not a dictionary, change to [-4100, 4100] 
          until a future update.
        `),t.color.domain=[0,4096]),this.interpret_position(t);for(const r of Object.keys(o0))this.dim(r).update(t[r])}}class GI{constructor(t,e=4096){this.id_locs={},this.offsets={},this.texture_size=e,this.texture_widths=32,this.regl=t,this._one_d_position=1,this._color_position=-1}get_position(t){return this.offsets[t]||0}set_one_d(t,e){let r;const{offsets:s}=this;s[t]?r=s[t]:(r=this._one_d_position++,s[t]=r),this.one_d_texture.subimage({data:e,width:1,height:this.texture_size},r,0)}set_color(t,e){let r;const{offsets:s}=this;s[t]?r=s[t]:(r=this._color_position--,s[t]=r),this.color_texture.subimage({data:e,width:1,height:this.texture_size},-r-1,0)}get one_d_texture(){if(this._one_d_texture)return this._one_d_texture;const t=this.regl.hasExtension("OES_texture_float")?"float":this.regl.hasExtension("OES_texture_half_float")?"half float":"uint8",e=t==="uint8"?"rgba":"alpha",r={width:this.texture_widths,height:this.texture_size,type:t,format:e};return this._one_d_texture=this.regl.texture(r),this._one_d_texture}get color_texture(){return this._color_texture?this._color_texture:(this._color_texture=this.regl.texture({width:this.texture_widths,height:this.texture_size,type:"uint8",format:"rgba"}),this._color_texture)}}function Ne(n,t,e,r){function s(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function c(p){try{d(r.next(p))}catch(w){f(w)}}function l(p){try{d(r.throw(p))}catch(w){f(w)}}function d(p){p.done?o(p.value):s(p.value).then(c,l)}d((r=r.apply(n,t||[])).next())})}function Dv(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xe(n){return this instanceof Xe?(this.v=n,this):new Xe(n)}function ea(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(n,t||[]),s,o=[];return s={},f("next"),f("throw"),f("return"),s[Symbol.asyncIterator]=function(){return this},s;function f(I){r[I]&&(s[I]=function(C){return new Promise(function(V,Wt){o.push([I,C,V,Wt])>1||c(I,C)})})}function c(I,C){try{l(r[I](C))}catch(V){w(o[0][3],V)}}function l(I){I.value instanceof Xe?Promise.resolve(I.value.v).then(d,p):w(o[0][2],I)}function d(I){c("next",I)}function p(I){c("throw",I)}function w(I,C){I(C),o.shift(),o.length&&c(o[0][0],o[0][1])}}function I_(n){var t,e;return t={},r("next"),r("throw",function(s){throw s}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(s,o){t[s]=n[s]?function(f){return(e=!e)?{value:Xe(n[s](f)),done:!1}:o?o(f):f}:o}}function Rc(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof Dv=="function"?Dv(n):n[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(o){e[o]=n[o]&&function(f){return new Promise(function(c,l){f=n[o](f),s(c,l,f.done,f.value)})}}function s(o,f,c,l){Promise.resolve(l).then(function(d){o({value:d,done:c})},f)}}const $I=new TextDecoder("utf-8"),Y0=n=>$I.decode(n),VI=new TextEncoder,Pp=n=>VI.encode(n),jI=n=>typeof n=="number",WI=n=>typeof n=="boolean",jr=n=>typeof n=="function",ps=n=>n!=null&&Object(n)===n,qh=n=>ps(n)&&jr(n.then),zp=n=>ps(n)&&jr(n[Symbol.iterator]),Tg=n=>ps(n)&&jr(n[Symbol.asyncIterator]),H0=n=>ps(n)&&ps(n.schema),C1=n=>ps(n)&&"done"in n&&"value"in n,k1=n=>ps(n)&&jr(n.stat)&&jI(n.fd),P1=n=>ps(n)&&Ig(n.body),z1=n=>"_getDOMStream"in n&&"_getNodeStream"in n,Ig=n=>ps(n)&&jr(n.cancel)&&jr(n.getReader)&&!z1(n),U1=n=>ps(n)&&jr(n.read)&&jr(n.pipe)&&WI(n.readable)&&!z1(n),YI=n=>ps(n)&&jr(n.clear)&&jr(n.bytes)&&jr(n.position)&&jr(n.setPosition)&&jr(n.capacity)&&jr(n.getBufferIdentifier)&&jr(n.createLong),Og=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function HI(n){const t=n[0]?[n[0]]:[];let e,r,s,o;for(let f,c,l=0,d=0,p=n.length;++l<p;){if(f=t[d],c=n[l],!f||!c||f.buffer!==c.buffer||c.byteOffset<f.byteOffset){c&&(t[++d]=c);continue}if({byteOffset:e,byteLength:s}=f,{byteOffset:r,byteLength:o}=c,e+s<r||r+o<e){c&&(t[++d]=c);continue}t[d]=new Uint8Array(f.buffer,e,r-e+o)}return t}function np(n,t,e=0,r=t.byteLength){const s=n.byteLength,o=new Uint8Array(n.buffer,n.byteOffset,s),f=new Uint8Array(t.buffer,t.byteOffset,Math.min(r,s));return o.set(f,e),n}function ia(n,t){const e=HI(n),r=e.reduce((p,w)=>p+w.byteLength,0);let s,o,f,c=0,l=-1;const d=Math.min(t||Number.POSITIVE_INFINITY,r);for(const p=e.length;++l<p;){if(s=e[l],o=s.subarray(0,Math.min(s.length,d-c)),d<=c+o.length){o.length<s.length?e[l]=s.subarray(o.length):o.length===s.length&&l++,f?np(f,o,c):f=o;break}np(f||(f=new Uint8Array(d)),o,c),c+=o.length}return[f||new Uint8Array(0),e.slice(l),r-(f?f.byteLength:0)]}function Ln(n,t){let e=C1(t)?t.value:t;return e instanceof n?n===Uint8Array?new n(e.buffer,e.byteOffset,e.byteLength):e:e?(typeof e=="string"&&(e=Pp(e)),e instanceof ArrayBuffer?new n(e):e instanceof Og?new n(e):YI(e)?Ln(n,e.bytes()):ArrayBuffer.isView(e)?e.byteLength<=0?new n(0):new n(e.buffer,e.byteOffset,e.byteLength/n.BYTES_PER_ELEMENT):n.from(e)):new n(0)}const Oh=n=>Ln(Int32Array,n),bn=n=>Ln(Uint8Array,n),X0=n=>(n.next(),n);function*XI(n,t){const e=function*(s){yield s},r=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof Og?e(t):zp(t)?t:e(t);return yield*X0(function*(s){let o=null;do o=s.next(yield Ln(n,o));while(!o.done)}(r[Symbol.iterator]())),new n}const qI=n=>XI(Uint8Array,n);function G1(n,t){return ea(this,arguments,function*(){if(qh(t))return yield Xe(yield Xe(yield*I_(Rc(G1(n,yield Xe(t))))));const r=function(f){return ea(this,arguments,function*(){yield yield Xe(yield Xe(f))})},s=function(f){return ea(this,arguments,function*(){yield Xe(yield*I_(Rc(X0(function*(c){let l=null;do l=c.next(yield l==null?void 0:l.value);while(!l.done)}(f[Symbol.iterator]())))))})},o=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof Og?r(t):zp(t)?s(t):Tg(t)?t:r(t);return yield Xe(yield*I_(Rc(X0(function(f){return ea(this,arguments,function*(){let c=null;do c=yield Xe(f.next(yield yield Xe(Ln(n,c))));while(!c.done)})}(o[Symbol.asyncIterator]()))))),yield Xe(new n)})}const ZI=n=>G1(Uint8Array,n);function KI(n,t){let e=0;const r=n.length;if(r!==t.length)return!1;if(r>0)do if(n[e]!==t[e])return!1;while(++e<r);return!0}const Ci={fromIterable(n){return g_(JI(n))},fromAsyncIterable(n){return g_(QI(n))},fromDOMStream(n){return g_(t2(n))},fromNodeStream(n){return g_(n2(n))},toDOMStream(n,t){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(n,t){throw new Error('"toNodeStream" not available in this environment')}},g_=n=>(n.next(),n);function*JI(n){let t,e=!1,r=[],s,o,f,c=0;function l(){return o==="peek"?ia(r,f)[0]:([s,r,c]=ia(r,f),s)}({cmd:o,size:f}=yield null);const d=qI(n)[Symbol.iterator]();try{do if({done:t,value:s}=Number.isNaN(f-c)?d.next():d.next(f-c),!t&&s.byteLength>0&&(r.push(s),c+=s.byteLength),t||f<=c)do({cmd:o,size:f}=yield l());while(f<c);while(!t)}catch(p){(e=!0)&&typeof d.throw=="function"&&d.throw(p)}finally{e===!1&&typeof d.return=="function"&&d.return(null)}return null}function QI(n){return ea(this,arguments,function*(){let e,r=!1,s=[],o,f,c,l=0;function d(){return f==="peek"?ia(s,c)[0]:([o,s,l]=ia(s,c),o)}({cmd:f,size:c}=yield yield Xe(null));const p=ZI(n)[Symbol.asyncIterator]();try{do if({done:e,value:o}=Number.isNaN(c-l)?yield Xe(p.next()):yield Xe(p.next(c-l)),!e&&o.byteLength>0&&(s.push(o),l+=o.byteLength),e||c<=l)do({cmd:f,size:c}=yield yield Xe(d()));while(c<l);while(!e)}catch(w){(r=!0)&&typeof p.throw=="function"&&(yield Xe(p.throw(w)))}finally{r===!1&&typeof p.return=="function"&&(yield Xe(p.return(new Uint8Array(0))))}return yield Xe(null)})}function t2(n){return ea(this,arguments,function*(){let e=!1,r=!1,s=[],o,f,c,l=0;function d(){return f==="peek"?ia(s,c)[0]:([o,s,l]=ia(s,c),o)}({cmd:f,size:c}=yield yield Xe(null));const p=new e2(n);try{do if({done:e,value:o}=Number.isNaN(c-l)?yield Xe(p.read()):yield Xe(p.read(c-l)),!e&&o.byteLength>0&&(s.push(bn(o)),l+=o.byteLength),e||c<=l)do({cmd:f,size:c}=yield yield Xe(d()));while(c<l);while(!e)}catch(w){(r=!0)&&(yield Xe(p.cancel(w)))}finally{r===!1?yield Xe(p.cancel()):n.locked&&p.releaseLock()}return yield Xe(null)})}class e2{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return Ne(this,void 0,void 0,function*(){const{reader:e,source:r}=this;e&&(yield e.cancel(t).catch(()=>{})),r&&r.locked&&this.releaseLock()})}read(t){return Ne(this,void 0,void 0,function*(){if(t===0)return{done:this.reader==null,value:new Uint8Array(0)};const e=yield this.reader.read();return!e.done&&(e.value=bn(e)),e})}}const f0=(n,t)=>{const e=s=>r([t,s]);let r;return[t,e,new Promise(s=>(r=s)&&n.once(t,e))]};function n2(n){return ea(this,arguments,function*(){const e=[];let r="error",s=!1,o=null,f,c,l=0,d=[],p;function w(){return f==="peek"?ia(d,c)[0]:([p,d,l]=ia(d,c),p)}if({cmd:f,size:c}=yield yield Xe(null),n.isTTY)return yield yield Xe(new Uint8Array(0)),yield Xe(null);try{e[0]=f0(n,"end"),e[1]=f0(n,"error");do{if(e[2]=f0(n,"readable"),[r,o]=yield Xe(Promise.race(e.map(C=>C[2]))),r==="error")break;if((s=r==="end")||(Number.isFinite(c-l)?(p=bn(n.read(c-l)),p.byteLength<c-l&&(p=bn(n.read()))):p=bn(n.read()),p.byteLength>0&&(d.push(p),l+=p.byteLength)),s||c<=l)do({cmd:f,size:c}=yield yield Xe(w()));while(c<l)}while(!s)}finally{yield Xe(I(e,r==="error"?o:null))}return yield Xe(null);function I(C,V){return p=d=null,new Promise((Wt,Qt)=>{for(const[Rt,oe]of C)n.off(Rt,oe);try{const Rt=n.destroy;Rt&&Rt.call(n,V),V=void 0}catch(Rt){V=Rt||V}finally{V!=null?Qt(V):Wt()}})}})}var Ui;(function(n){n[n.V1=0]="V1",n[n.V2=1]="V2",n[n.V3=2]="V3",n[n.V4=3]="V4",n[n.V5=4]="V5"})(Ui||(Ui={}));var ms;(function(n){n[n.Sparse=0]="Sparse",n[n.Dense=1]="Dense"})(ms||(ms={}));var Cr;(function(n){n[n.HALF=0]="HALF",n[n.SINGLE=1]="SINGLE",n[n.DOUBLE=2]="DOUBLE"})(Cr||(Cr={}));var sa;(function(n){n[n.DAY=0]="DAY",n[n.MILLISECOND=1]="MILLISECOND"})(sa||(sa={}));var wn;(function(n){n[n.SECOND=0]="SECOND",n[n.MILLISECOND=1]="MILLISECOND",n[n.MICROSECOND=2]="MICROSECOND",n[n.NANOSECOND=3]="NANOSECOND"})(wn||(wn={}));var Jo;(function(n){n[n.YEAR_MONTH=0]="YEAR_MONTH",n[n.DAY_TIME=1]="DAY_TIME",n[n.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(Jo||(Jo={}));var Mn;(function(n){n[n.NONE=0]="NONE",n[n.Schema=1]="Schema",n[n.DictionaryBatch=2]="DictionaryBatch",n[n.RecordBatch=3]="RecordBatch",n[n.Tensor=4]="Tensor",n[n.SparseTensor=5]="SparseTensor"})(Mn||(Mn={}));var Q;(function(n){n[n.NONE=0]="NONE",n[n.Null=1]="Null",n[n.Int=2]="Int",n[n.Float=3]="Float",n[n.Binary=4]="Binary",n[n.Utf8=5]="Utf8",n[n.Bool=6]="Bool",n[n.Decimal=7]="Decimal",n[n.Date=8]="Date",n[n.Time=9]="Time",n[n.Timestamp=10]="Timestamp",n[n.Interval=11]="Interval",n[n.List=12]="List",n[n.Struct=13]="Struct",n[n.Union=14]="Union",n[n.FixedSizeBinary=15]="FixedSizeBinary",n[n.FixedSizeList=16]="FixedSizeList",n[n.Map=17]="Map",n[n.Dictionary=-1]="Dictionary",n[n.Int8=-2]="Int8",n[n.Int16=-3]="Int16",n[n.Int32=-4]="Int32",n[n.Int64=-5]="Int64",n[n.Uint8=-6]="Uint8",n[n.Uint16=-7]="Uint16",n[n.Uint32=-8]="Uint32",n[n.Uint64=-9]="Uint64",n[n.Float16=-10]="Float16",n[n.Float32=-11]="Float32",n[n.Float64=-12]="Float64",n[n.DateDay=-13]="DateDay",n[n.DateMillisecond=-14]="DateMillisecond",n[n.TimestampSecond=-15]="TimestampSecond",n[n.TimestampMillisecond=-16]="TimestampMillisecond",n[n.TimestampMicrosecond=-17]="TimestampMicrosecond",n[n.TimestampNanosecond=-18]="TimestampNanosecond",n[n.TimeSecond=-19]="TimeSecond",n[n.TimeMillisecond=-20]="TimeMillisecond",n[n.TimeMicrosecond=-21]="TimeMicrosecond",n[n.TimeNanosecond=-22]="TimeNanosecond",n[n.DenseUnion=-23]="DenseUnion",n[n.SparseUnion=-24]="SparseUnion",n[n.IntervalDayTime=-25]="IntervalDayTime",n[n.IntervalYearMonth=-26]="IntervalYearMonth"})(Q||(Q={}));var Za;(function(n){n[n.OFFSET=0]="OFFSET",n[n.DATA=1]="DATA",n[n.VALIDITY=2]="VALIDITY",n[n.TYPE=3]="TYPE"})(Za||(Za={}));const r2=void 0;function pu(n){if(n===null)return"null";if(n===r2)return"undefined";switch(typeof n){case"number":return`${n}`;case"bigint":return`${n}`;case"string":return`"${n}"`}return typeof n[Symbol.toPrimitive]=="function"?n[Symbol.toPrimitive]("string"):ArrayBuffer.isView(n)?n instanceof BigInt64Array||n instanceof BigUint64Array?`[${[...n].map(t=>pu(t))}]`:`[${n}]`:ArrayBuffer.isView(n)?`[${n}]`:JSON.stringify(n,(t,e)=>typeof e=="bigint"?`${e}`:e)}const i2=Symbol.for("isArrowBigNum");function bs(n,...t){return t.length===0?Object.setPrototypeOf(Ln(this.TypedArray,n),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(n,...t),this.constructor.prototype)}bs.prototype[i2]=!0;bs.prototype.toJSON=function(){return`"${Kh(this)}"`};bs.prototype.valueOf=function(){return $1(this)};bs.prototype.toString=function(){return Kh(this)};bs.prototype[Symbol.toPrimitive]=function(n="default"){switch(n){case"number":return $1(this);case"string":return Kh(this);case"default":return s2(this)}return Kh(this)};function Nc(...n){return bs.apply(this,n)}function Dc(...n){return bs.apply(this,n)}function Zh(...n){return bs.apply(this,n)}Object.setPrototypeOf(Nc.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(Dc.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(Zh.prototype,Object.create(Uint32Array.prototype));Object.assign(Nc.prototype,bs.prototype,{constructor:Nc,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(Dc.prototype,bs.prototype,{constructor:Dc,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(Zh.prototype,bs.prototype,{constructor:Zh,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});function $1(n){const{buffer:t,byteOffset:e,length:r,signed:s}=n,o=new BigUint64Array(t,e,r),f=s&&o.at(-1)&BigInt(1)<<BigInt(63);let c=BigInt(f?1:0),l=BigInt(0);if(f){for(const d of o)c+=~d*(BigInt(1)<<BigInt(32)*l++);c*=BigInt(-1)}else for(const d of o)c+=d*(BigInt(1)<<BigInt(32)*l++);return c}const Kh=n=>{if(n.byteLength===8)return`${new n.BigIntArray(n.buffer,n.byteOffset,1)[0]}`;if(!n.signed)return u0(n);let t=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2);if(new Int16Array([t.at(-1)])[0]>=0)return u0(n);t=t.slice();let r=1;for(let o=0;o<t.length;o++){const f=t[o],c=~f+r;t[o]=c,r&=f===0?1:0}return`-${u0(t)}`},s2=n=>n.byteLength===8?new n.BigIntArray(n.buffer,n.byteOffset,1)[0]:Kh(n);function u0(n){let t="";const e=new Uint32Array(2);let r=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2);const s=new Uint32Array((r=new Uint16Array(r).reverse()).buffer);let o=-1;const f=r.length-1;do{for(e[0]=r[o=0];o<f;)r[o++]=e[1]=e[0]/10,e[0]=(e[0]-e[1]*10<<16)+r[o];r[o]=e[1]=e[0]/10,e[0]=e[0]-e[1]*10,t=`${e[0]}${t}`}while(s[0]||s[1]||s[2]||s[3]);return t??"0"}class Bg{static new(t,e){switch(e){case!0:return new Nc(t);case!1:return new Dc(t)}switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new Nc(t)}return t.byteLength===16?new Zh(t):new Dc(t)}static signed(t){return new Nc(t)}static unsigned(t){return new Dc(t)}static decimal(t){return new Zh(t)}constructor(t,e){return Bg.new(t,e)}}function gs(n){if(typeof n=="bigint"&&(n<Number.MIN_SAFE_INTEGER||n>Number.MAX_SAFE_INTEGER))throw new TypeError(`${n} is not safe to convert to a number.`);return Number(n)}var V1,j1,W1,Y1,H1,X1,q1,Z1,K1,J1,Q1,tw,ew,nw,rw,iw,sw,aw,ow;class Re{static isNull(t){return(t==null?void 0:t.typeId)===Q.Null}static isInt(t){return(t==null?void 0:t.typeId)===Q.Int}static isFloat(t){return(t==null?void 0:t.typeId)===Q.Float}static isBinary(t){return(t==null?void 0:t.typeId)===Q.Binary}static isUtf8(t){return(t==null?void 0:t.typeId)===Q.Utf8}static isBool(t){return(t==null?void 0:t.typeId)===Q.Bool}static isDecimal(t){return(t==null?void 0:t.typeId)===Q.Decimal}static isDate(t){return(t==null?void 0:t.typeId)===Q.Date}static isTime(t){return(t==null?void 0:t.typeId)===Q.Time}static isTimestamp(t){return(t==null?void 0:t.typeId)===Q.Timestamp}static isInterval(t){return(t==null?void 0:t.typeId)===Q.Interval}static isList(t){return(t==null?void 0:t.typeId)===Q.List}static isStruct(t){return(t==null?void 0:t.typeId)===Q.Struct}static isUnion(t){return(t==null?void 0:t.typeId)===Q.Union}static isFixedSizeBinary(t){return(t==null?void 0:t.typeId)===Q.FixedSizeBinary}static isFixedSizeList(t){return(t==null?void 0:t.typeId)===Q.FixedSizeList}static isMap(t){return(t==null?void 0:t.typeId)===Q.Map}static isDictionary(t){return(t==null?void 0:t.typeId)===Q.Dictionary}static isDenseUnion(t){return Re.isUnion(t)&&t.mode===ms.Dense}static isSparseUnion(t){return Re.isUnion(t)&&t.mode===ms.Sparse}get typeId(){return Q.NONE}}V1=Symbol.toStringTag;Re[V1]=(n=>(n.children=null,n.ArrayType=Array,n[Symbol.toStringTag]="DataType"))(Re.prototype);let so=class extends Re{toString(){return"Null"}get typeId(){return Q.Null}};j1=Symbol.toStringTag;so[j1]=(n=>n[Symbol.toStringTag]="Null")(so.prototype);class Wr extends Re{constructor(t,e){super(),this.isSigned=t,this.bitWidth=e}get typeId(){return Q.Int}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}W1=Symbol.toStringTag;Wr[W1]=(n=>(n.isSigned=null,n.bitWidth=null,n[Symbol.toStringTag]="Int"))(Wr.prototype);class Mg extends Wr{constructor(){super(!0,8)}get ArrayType(){return Int8Array}}class Lg extends Wr{constructor(){super(!0,16)}get ArrayType(){return Int16Array}}class Qo extends Wr{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}let Up=class extends Wr{constructor(){super(!0,64)}get ArrayType(){return BigInt64Array}};class Rg extends Wr{constructor(){super(!1,8)}get ArrayType(){return Uint8Array}}class fw extends Wr{constructor(){super(!1,16)}get ArrayType(){return Uint16Array}}class uw extends Wr{constructor(){super(!1,32)}get ArrayType(){return Uint32Array}}let cw=class extends Wr{constructor(){super(!1,64)}get ArrayType(){return BigUint64Array}};Object.defineProperty(Mg.prototype,"ArrayType",{value:Int8Array});Object.defineProperty(Lg.prototype,"ArrayType",{value:Int16Array});Object.defineProperty(Qo.prototype,"ArrayType",{value:Int32Array});Object.defineProperty(Up.prototype,"ArrayType",{value:BigInt64Array});Object.defineProperty(Rg.prototype,"ArrayType",{value:Uint8Array});Object.defineProperty(fw.prototype,"ArrayType",{value:Uint16Array});Object.defineProperty(uw.prototype,"ArrayType",{value:Uint32Array});Object.defineProperty(cw.prototype,"ArrayType",{value:BigUint64Array});class mu extends Re{constructor(t){super(),this.precision=t}get typeId(){return Q.Float}get ArrayType(){switch(this.precision){case Cr.HALF:return Uint16Array;case Cr.SINGLE:return Float32Array;case Cr.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}Y1=Symbol.toStringTag;mu[Y1]=(n=>(n.precision=null,n[Symbol.toStringTag]="Float"))(mu.prototype);class Ng extends mu{constructor(){super(Cr.SINGLE)}}class Dg extends mu{constructor(){super(Cr.DOUBLE)}}Object.defineProperty(Ng.prototype,"ArrayType",{value:Float32Array});Object.defineProperty(Dg.prototype,"ArrayType",{value:Float64Array});let rp=class extends Re{constructor(){super()}get typeId(){return Q.Binary}toString(){return"Binary"}};H1=Symbol.toStringTag;rp[H1]=(n=>(n.ArrayType=Uint8Array,n[Symbol.toStringTag]="Binary"))(rp.prototype);let Wc=class extends Re{constructor(){super()}get typeId(){return Q.Utf8}toString(){return"Utf8"}};X1=Symbol.toStringTag;Wc[X1]=(n=>(n.ArrayType=Uint8Array,n[Symbol.toStringTag]="Utf8"))(Wc.prototype);let Yc=class extends Re{constructor(){super()}get typeId(){return Q.Bool}toString(){return"Bool"}};q1=Symbol.toStringTag;Yc[q1]=(n=>(n.ArrayType=Uint8Array,n[Symbol.toStringTag]="Bool"))(Yc.prototype);let ip=class extends Re{constructor(t,e,r=128){super(),this.scale=t,this.precision=e,this.bitWidth=r}get typeId(){return Q.Decimal}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}};Z1=Symbol.toStringTag;ip[Z1]=(n=>(n.scale=null,n.precision=null,n.ArrayType=Uint32Array,n[Symbol.toStringTag]="Decimal"))(ip.prototype);class Jh extends Re{constructor(t){super(),this.unit=t}get typeId(){return Q.Date}toString(){return`Date${(this.unit+1)*32}<${sa[this.unit]}>`}}K1=Symbol.toStringTag;Jh[K1]=(n=>(n.unit=null,n.ArrayType=Int32Array,n[Symbol.toStringTag]="Date"))(Jh.prototype);class a2 extends Jh{constructor(){super(sa.MILLISECOND)}}class Qh extends Re{constructor(t,e){super(),this.unit=t,this.bitWidth=e}get typeId(){return Q.Time}toString(){return`Time${this.bitWidth}<${wn[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}J1=Symbol.toStringTag;Qh[J1]=(n=>(n.unit=null,n.bitWidth=null,n[Symbol.toStringTag]="Time"))(Qh.prototype);class sp extends Re{constructor(t,e){super(),this.unit=t,this.timezone=e}get typeId(){return Q.Timestamp}toString(){return`Timestamp<${wn[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}Q1=Symbol.toStringTag;sp[Q1]=(n=>(n.unit=null,n.timezone=null,n.ArrayType=Int32Array,n[Symbol.toStringTag]="Timestamp"))(sp.prototype);class ap extends Re{constructor(t){super(),this.unit=t}get typeId(){return Q.Interval}toString(){return`Interval<${Jo[this.unit]}>`}}tw=Symbol.toStringTag;ap[tw]=(n=>(n.unit=null,n.ArrayType=Int32Array,n[Symbol.toStringTag]="Interval"))(ap.prototype);let Hc=class extends Re{constructor(t){super(),this.children=[t]}get typeId(){return Q.List}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}};ew=Symbol.toStringTag;Hc[ew]=(n=>(n.children=null,n[Symbol.toStringTag]="List"))(Hc.prototype);class Lr extends Re{constructor(t){super(),this.children=t}get typeId(){return Q.Struct}toString(){return`Struct<{${this.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}}nw=Symbol.toStringTag;Lr[nw]=(n=>(n.children=null,n[Symbol.toStringTag]="Struct"))(Lr.prototype);class td extends Re{constructor(t,e,r){super(),this.mode=t,this.children=r,this.typeIds=e=Int32Array.from(e),this.typeIdToChildIndex=e.reduce((s,o,f)=>(s[o]=f)&&s||s,Object.create(null))}get typeId(){return Q.Union}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(t=>`${t.type}`).join(" | ")}>`}}rw=Symbol.toStringTag;td[rw]=(n=>(n.mode=null,n.typeIds=null,n.children=null,n.typeIdToChildIndex=null,n.ArrayType=Int8Array,n[Symbol.toStringTag]="Union"))(td.prototype);let op=class extends Re{constructor(t){super(),this.byteWidth=t}get typeId(){return Q.FixedSizeBinary}toString(){return`FixedSizeBinary[${this.byteWidth}]`}};iw=Symbol.toStringTag;op[iw]=(n=>(n.byteWidth=null,n.ArrayType=Uint8Array,n[Symbol.toStringTag]="FixedSizeBinary"))(op.prototype);let ed=class extends Re{constructor(t,e){super(),this.listSize=t,this.children=[e]}get typeId(){return Q.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}};sw=Symbol.toStringTag;ed[sw]=(n=>(n.children=null,n.listSize=null,n[Symbol.toStringTag]="FixedSizeList"))(ed.prototype);class nd extends Re{constructor(t,e=!1){super(),this.children=[t],this.keysSorted=e}get typeId(){return Q.Map}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}}aw=Symbol.toStringTag;nd[aw]=(n=>(n.children=null,n.keysSorted=null,n[Symbol.toStringTag]="Map_"))(nd.prototype);const o2=(n=>()=>++n)(-1);class aa extends Re{constructor(t,e,r,s){super(),this.indices=e,this.dictionary=t,this.isOrdered=s||!1,this.id=r==null?o2():gs(r)}get typeId(){return Q.Dictionary}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}ow=Symbol.toStringTag;aa[ow]=(n=>(n.id=null,n.indices=null,n.isOrdered=null,n.dictionary=null,n[Symbol.toStringTag]="Dictionary"))(aa.prototype);function Ws(n){const t=n;switch(n.typeId){case Q.Decimal:return n.bitWidth/32;case Q.Timestamp:return 2;case Q.Date:return 1+t.unit;case Q.Interval:return 1+t.unit;case Q.FixedSizeList:return t.listSize;case Q.FixedSizeBinary:return t.byteWidth;default:return 1}}class ln{visitMany(t,...e){return t.map((r,s)=>this.visit(r,...e.map(o=>o[s])))}visit(...t){return this.getVisitFn(t[0],!1).apply(this,t)}getVisitFn(t,e=!0){return f2(this,t,e)}getVisitFnByTypeId(t,e=!0){return wc(this,t,e)}visitNull(t,...e){return null}visitBool(t,...e){return null}visitInt(t,...e){return null}visitFloat(t,...e){return null}visitUtf8(t,...e){return null}visitBinary(t,...e){return null}visitFixedSizeBinary(t,...e){return null}visitDate(t,...e){return null}visitTimestamp(t,...e){return null}visitTime(t,...e){return null}visitDecimal(t,...e){return null}visitList(t,...e){return null}visitStruct(t,...e){return null}visitUnion(t,...e){return null}visitDictionary(t,...e){return null}visitInterval(t,...e){return null}visitFixedSizeList(t,...e){return null}visitMap(t,...e){return null}}function f2(n,t,e=!0){return typeof t=="number"?wc(n,t,e):typeof t=="string"&&t in Q?wc(n,Q[t],e):t&&t instanceof Re?wc(n,Fv(t),e):t!=null&&t.type&&t.type instanceof Re?wc(n,Fv(t.type),e):wc(n,Q.NONE,e)}function wc(n,t,e=!0){let r=null;switch(t){case Q.Null:r=n.visitNull;break;case Q.Bool:r=n.visitBool;break;case Q.Int:r=n.visitInt;break;case Q.Int8:r=n.visitInt8||n.visitInt;break;case Q.Int16:r=n.visitInt16||n.visitInt;break;case Q.Int32:r=n.visitInt32||n.visitInt;break;case Q.Int64:r=n.visitInt64||n.visitInt;break;case Q.Uint8:r=n.visitUint8||n.visitInt;break;case Q.Uint16:r=n.visitUint16||n.visitInt;break;case Q.Uint32:r=n.visitUint32||n.visitInt;break;case Q.Uint64:r=n.visitUint64||n.visitInt;break;case Q.Float:r=n.visitFloat;break;case Q.Float16:r=n.visitFloat16||n.visitFloat;break;case Q.Float32:r=n.visitFloat32||n.visitFloat;break;case Q.Float64:r=n.visitFloat64||n.visitFloat;break;case Q.Utf8:r=n.visitUtf8;break;case Q.Binary:r=n.visitBinary;break;case Q.FixedSizeBinary:r=n.visitFixedSizeBinary;break;case Q.Date:r=n.visitDate;break;case Q.DateDay:r=n.visitDateDay||n.visitDate;break;case Q.DateMillisecond:r=n.visitDateMillisecond||n.visitDate;break;case Q.Timestamp:r=n.visitTimestamp;break;case Q.TimestampSecond:r=n.visitTimestampSecond||n.visitTimestamp;break;case Q.TimestampMillisecond:r=n.visitTimestampMillisecond||n.visitTimestamp;break;case Q.TimestampMicrosecond:r=n.visitTimestampMicrosecond||n.visitTimestamp;break;case Q.TimestampNanosecond:r=n.visitTimestampNanosecond||n.visitTimestamp;break;case Q.Time:r=n.visitTime;break;case Q.TimeSecond:r=n.visitTimeSecond||n.visitTime;break;case Q.TimeMillisecond:r=n.visitTimeMillisecond||n.visitTime;break;case Q.TimeMicrosecond:r=n.visitTimeMicrosecond||n.visitTime;break;case Q.TimeNanosecond:r=n.visitTimeNanosecond||n.visitTime;break;case Q.Decimal:r=n.visitDecimal;break;case Q.List:r=n.visitList;break;case Q.Struct:r=n.visitStruct;break;case Q.Union:r=n.visitUnion;break;case Q.DenseUnion:r=n.visitDenseUnion||n.visitUnion;break;case Q.SparseUnion:r=n.visitSparseUnion||n.visitUnion;break;case Q.Dictionary:r=n.visitDictionary;break;case Q.Interval:r=n.visitInterval;break;case Q.IntervalDayTime:r=n.visitIntervalDayTime||n.visitInterval;break;case Q.IntervalYearMonth:r=n.visitIntervalYearMonth||n.visitInterval;break;case Q.FixedSizeList:r=n.visitFixedSizeList;break;case Q.Map:r=n.visitMap;break}if(typeof r=="function")return r;if(!e)return()=>null;throw new Error(`Unrecognized type '${Q[t]}'`)}function Fv(n){switch(n.typeId){case Q.Null:return Q.Null;case Q.Int:{const{bitWidth:t,isSigned:e}=n;switch(t){case 8:return e?Q.Int8:Q.Uint8;case 16:return e?Q.Int16:Q.Uint16;case 32:return e?Q.Int32:Q.Uint32;case 64:return e?Q.Int64:Q.Uint64}return Q.Int}case Q.Float:switch(n.precision){case Cr.HALF:return Q.Float16;case Cr.SINGLE:return Q.Float32;case Cr.DOUBLE:return Q.Float64}return Q.Float;case Q.Binary:return Q.Binary;case Q.Utf8:return Q.Utf8;case Q.Bool:return Q.Bool;case Q.Decimal:return Q.Decimal;case Q.Time:switch(n.unit){case wn.SECOND:return Q.TimeSecond;case wn.MILLISECOND:return Q.TimeMillisecond;case wn.MICROSECOND:return Q.TimeMicrosecond;case wn.NANOSECOND:return Q.TimeNanosecond}return Q.Time;case Q.Timestamp:switch(n.unit){case wn.SECOND:return Q.TimestampSecond;case wn.MILLISECOND:return Q.TimestampMillisecond;case wn.MICROSECOND:return Q.TimestampMicrosecond;case wn.NANOSECOND:return Q.TimestampNanosecond}return Q.Timestamp;case Q.Date:switch(n.unit){case sa.DAY:return Q.DateDay;case sa.MILLISECOND:return Q.DateMillisecond}return Q.Date;case Q.Interval:switch(n.unit){case Jo.DAY_TIME:return Q.IntervalDayTime;case Jo.YEAR_MONTH:return Q.IntervalYearMonth}return Q.Interval;case Q.Map:return Q.Map;case Q.List:return Q.List;case Q.Struct:return Q.Struct;case Q.Union:switch(n.mode){case ms.Dense:return Q.DenseUnion;case ms.Sparse:return Q.SparseUnion}return Q.Union;case Q.FixedSizeBinary:return Q.FixedSizeBinary;case Q.FixedSizeList:return Q.FixedSizeList;case Q.Dictionary:return Q.Dictionary}throw new Error(`Unrecognized type '${Q[n.typeId]}'`)}ln.prototype.visitInt8=null;ln.prototype.visitInt16=null;ln.prototype.visitInt32=null;ln.prototype.visitInt64=null;ln.prototype.visitUint8=null;ln.prototype.visitUint16=null;ln.prototype.visitUint32=null;ln.prototype.visitUint64=null;ln.prototype.visitFloat16=null;ln.prototype.visitFloat32=null;ln.prototype.visitFloat64=null;ln.prototype.visitDateDay=null;ln.prototype.visitDateMillisecond=null;ln.prototype.visitTimestampSecond=null;ln.prototype.visitTimestampMillisecond=null;ln.prototype.visitTimestampMicrosecond=null;ln.prototype.visitTimestampNanosecond=null;ln.prototype.visitTimeSecond=null;ln.prototype.visitTimeMillisecond=null;ln.prototype.visitTimeMicrosecond=null;ln.prototype.visitTimeNanosecond=null;ln.prototype.visitDenseUnion=null;ln.prototype.visitSparseUnion=null;ln.prototype.visitIntervalDayTime=null;ln.prototype.visitIntervalYearMonth=null;const lw=new Float64Array(1),vc=new Uint32Array(lw.buffer);function hw(n){const t=(n&31744)>>10,e=(n&1023)/1024,r=Math.pow(-1,(n&32768)>>15);switch(t){case 31:return r*(e?Number.NaN:1/0);case 0:return r*(e?6103515625e-14*e:0)}return r*Math.pow(2,t-15)*(1+e)}function dw(n){if(n!==n)return 32256;lw[0]=n;const t=(vc[1]&2147483648)>>16&65535;let e=vc[1]&2146435072,r=0;return e>=1089470464?vc[0]>0?e=31744:(e=(e&2080374784)>>16,r=(vc[1]&1048575)>>10):e<=1056964608?(r=1048576+(vc[1]&1048575),r=1048576+(r<<(e>>20)-998)>>21,e=0):(e=e-1056964608>>10,r=(vc[1]&1048575)+512>>10),t|e|r&65535}class Ue extends ln{}function je(n){return(t,e,r)=>{if(t.setValid(e,r!=null))return n(t,e,r)}}const u2=(n,t,e)=>{n[t]=Math.trunc(e/864e5)},Fg=(n,t,e)=>{n[t]=Math.trunc(e%4294967296),n[t+1]=Math.trunc(e/4294967296)},c2=(n,t,e)=>{n[t]=Math.trunc(e*1e3%4294967296),n[t+1]=Math.trunc(e*1e3/4294967296)},l2=(n,t,e)=>{n[t]=Math.trunc(e*1e6%4294967296),n[t+1]=Math.trunc(e*1e6/4294967296)},_w=(n,t,e,r)=>{if(e+1<t.length){const{[e]:s,[e+1]:o}=t;n.set(r.subarray(0,o-s),s)}},h2=({offset:n,values:t},e,r)=>{const s=n+e;r?t[s>>3]|=1<<s%8:t[s>>3]&=~(1<<s%8)},fo=({values:n},t,e)=>{n[t]=e},Cg=({values:n},t,e)=>{n[t]=e},pw=({values:n},t,e)=>{n[t]=dw(e)},d2=(n,t,e)=>{switch(n.type.precision){case Cr.HALF:return pw(n,t,e);case Cr.SINGLE:case Cr.DOUBLE:return Cg(n,t,e)}},kg=({values:n},t,e)=>{u2(n,t,e.valueOf())},Pg=({values:n},t,e)=>{Fg(n,t*2,e.valueOf())},mw=({stride:n,values:t},e,r)=>{t.set(r.subarray(0,n),n*e)},_2=({values:n,valueOffsets:t},e,r)=>_w(n,t,e,r),p2=({values:n,valueOffsets:t},e,r)=>{_w(n,t,e,Pp(r))},gw=(n,t,e)=>{n.type.unit===sa.DAY?kg(n,t,e):Pg(n,t,e)},zg=({values:n},t,e)=>Fg(n,t*2,e/1e3),Ug=({values:n},t,e)=>Fg(n,t*2,e),Gg=({values:n},t,e)=>c2(n,t*2,e),$g=({values:n},t,e)=>l2(n,t*2,e),yw=(n,t,e)=>{switch(n.type.unit){case wn.SECOND:return zg(n,t,e);case wn.MILLISECOND:return Ug(n,t,e);case wn.MICROSECOND:return Gg(n,t,e);case wn.NANOSECOND:return $g(n,t,e)}},Vg=({values:n},t,e)=>{n[t]=e},jg=({values:n},t,e)=>{n[t]=e},Wg=({values:n},t,e)=>{n[t]=e},Yg=({values:n},t,e)=>{n[t]=e},vw=(n,t,e)=>{switch(n.type.unit){case wn.SECOND:return Vg(n,t,e);case wn.MILLISECOND:return jg(n,t,e);case wn.MICROSECOND:return Wg(n,t,e);case wn.NANOSECOND:return Yg(n,t,e)}},bw=({values:n,stride:t},e,r)=>{n.set(r.subarray(0,t),t*e)},m2=(n,t,e)=>{const r=n.children[0],s=n.valueOffsets,o=Vi.getVisitFn(r);if(Array.isArray(e))for(let f=-1,c=s[t],l=s[t+1];c<l;)o(r,c++,e[++f]);else for(let f=-1,c=s[t],l=s[t+1];c<l;)o(r,c++,e.get(++f))},g2=(n,t,e)=>{const r=n.children[0],{valueOffsets:s}=n,o=Vi.getVisitFn(r);let{[t]:f,[t+1]:c}=s;const l=e instanceof Map?e.entries():Object.entries(e);for(const d of l)if(o(r,f,d),++f>=c)break},y2=(n,t)=>(e,r,s,o)=>r&&e(r,n,t[o]),v2=(n,t)=>(e,r,s,o)=>r&&e(r,n,t.get(o)),b2=(n,t)=>(e,r,s,o)=>r&&e(r,n,t.get(s.name)),w2=(n,t)=>(e,r,s,o)=>r&&e(r,n,t[s.name]),x2=(n,t,e)=>{const r=n.type.children.map(o=>Vi.getVisitFn(o.type)),s=e instanceof Map?b2(t,e):e instanceof Ie?v2(t,e):Array.isArray(e)?y2(t,e):w2(t,e);n.type.children.forEach((o,f)=>s(r[f],n.children[f],o,f))},S2=(n,t,e)=>{n.type.mode===ms.Dense?ww(n,t,e):xw(n,t,e)},ww=(n,t,e)=>{const r=n.type.typeIdToChildIndex[n.typeIds[t]],s=n.children[r];Vi.visit(s,n.valueOffsets[t],e)},xw=(n,t,e)=>{const r=n.type.typeIdToChildIndex[n.typeIds[t]],s=n.children[r];Vi.visit(s,t,e)},A2=(n,t,e)=>{var r;(r=n.dictionary)===null||r===void 0||r.set(n.values[t],e)},Sw=(n,t,e)=>{n.type.unit===Jo.DAY_TIME?Hg(n,t,e):Xg(n,t,e)},Hg=({values:n},t,e)=>{n.set(e.subarray(0,2),2*t)},Xg=({values:n},t,e)=>{n[t]=e[0]*12+e[1]%12},E2=(n,t,e)=>{const{stride:r}=n,s=n.children[0],o=Vi.getVisitFn(s);if(Array.isArray(e))for(let f=-1,c=t*r;++f<r;)o(s,c+f,e[f]);else for(let f=-1,c=t*r;++f<r;)o(s,c+f,e.get(f))};Ue.prototype.visitBool=je(h2);Ue.prototype.visitInt=je(fo);Ue.prototype.visitInt8=je(fo);Ue.prototype.visitInt16=je(fo);Ue.prototype.visitInt32=je(fo);Ue.prototype.visitInt64=je(fo);Ue.prototype.visitUint8=je(fo);Ue.prototype.visitUint16=je(fo);Ue.prototype.visitUint32=je(fo);Ue.prototype.visitUint64=je(fo);Ue.prototype.visitFloat=je(d2);Ue.prototype.visitFloat16=je(pw);Ue.prototype.visitFloat32=je(Cg);Ue.prototype.visitFloat64=je(Cg);Ue.prototype.visitUtf8=je(p2);Ue.prototype.visitBinary=je(_2);Ue.prototype.visitFixedSizeBinary=je(mw);Ue.prototype.visitDate=je(gw);Ue.prototype.visitDateDay=je(kg);Ue.prototype.visitDateMillisecond=je(Pg);Ue.prototype.visitTimestamp=je(yw);Ue.prototype.visitTimestampSecond=je(zg);Ue.prototype.visitTimestampMillisecond=je(Ug);Ue.prototype.visitTimestampMicrosecond=je(Gg);Ue.prototype.visitTimestampNanosecond=je($g);Ue.prototype.visitTime=je(vw);Ue.prototype.visitTimeSecond=je(Vg);Ue.prototype.visitTimeMillisecond=je(jg);Ue.prototype.visitTimeMicrosecond=je(Wg);Ue.prototype.visitTimeNanosecond=je(Yg);Ue.prototype.visitDecimal=je(bw);Ue.prototype.visitList=je(m2);Ue.prototype.visitStruct=je(x2);Ue.prototype.visitUnion=je(S2);Ue.prototype.visitDenseUnion=je(ww);Ue.prototype.visitSparseUnion=je(xw);Ue.prototype.visitDictionary=je(A2);Ue.prototype.visitInterval=je(Sw);Ue.prototype.visitIntervalDayTime=je(Hg);Ue.prototype.visitIntervalYearMonth=je(Xg);Ue.prototype.visitFixedSizeList=je(E2);Ue.prototype.visitMap=je(g2);const Vi=new Ue,fs=Symbol.for("parent"),Fc=Symbol.for("rowIndex");class qg{constructor(t,e){return this[fs]=t,this[Fc]=e,new Proxy(this,new I2)}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[Fc],e=this[fs],r=e.type.children,s={};for(let o=-1,f=r.length;++o<f;)s[r[o].name]=ii.visit(e.children[o],t);return s}toString(){return`{${[...this].map(([t,e])=>`${pu(t)}: ${pu(e)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new T2(this[fs],this[Fc])}}class T2{constructor(t,e){this.childIndex=0,this.children=t.children,this.rowIndex=e,this.childFields=t.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const t=this.childIndex;return t<this.numChildren?(this.childIndex=t+1,{done:!1,value:[this.childFields[t].name,ii.visit(this.children[t],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(qg.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[fs]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Fc]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class I2{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[fs].type.children.map(e=>e.name)}has(t,e){return t[fs].type.children.findIndex(r=>r.name===e)!==-1}getOwnPropertyDescriptor(t,e){if(t[fs].type.children.findIndex(r=>r.name===e)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const r=t[fs].type.children.findIndex(s=>s.name===e);if(r!==-1){const s=ii.visit(t[fs].children[r],t[Fc]);return Reflect.set(t,e,s),s}}set(t,e,r){const s=t[fs].type.children.findIndex(o=>o.name===e);return s!==-1?(Vi.visit(t[fs].children[s],t[Fc],r),Reflect.set(t,e,r)):Reflect.has(t,e)||typeof e=="symbol"?Reflect.set(t,e,r):!1}}class Fe extends ln{}function Ge(n){return(t,e)=>t.getValid(e)?n(t,e):null}const O2=(n,t)=>864e5*n[t],Zg=(n,t)=>4294967296*n[t+1]+(n[t]>>>0),B2=(n,t)=>4294967296*(n[t+1]/1e3)+(n[t]>>>0)/1e3,M2=(n,t)=>4294967296*(n[t+1]/1e6)+(n[t]>>>0)/1e6,Aw=n=>new Date(n),L2=(n,t)=>Aw(O2(n,t)),R2=(n,t)=>Aw(Zg(n,t)),N2=(n,t)=>null,Ew=(n,t,e)=>{if(e+1>=t.length)return null;const r=t[e],s=t[e+1];return n.subarray(r,s)},D2=({offset:n,values:t},e)=>{const r=n+e;return(t[r>>3]&1<<r%8)!==0},Tw=({values:n},t)=>L2(n,t),Iw=({values:n},t)=>R2(n,t*2),tf=({stride:n,values:t},e)=>t[n*e],F2=({stride:n,values:t},e)=>hw(t[n*e]),Ow=({values:n},t)=>n[t],C2=({stride:n,values:t},e)=>t.subarray(n*e,n*(e+1)),k2=({values:n,valueOffsets:t},e)=>Ew(n,t,e),P2=({values:n,valueOffsets:t},e)=>{const r=Ew(n,t,e);return r!==null?Y0(r):null},z2=({values:n},t)=>n[t],U2=({type:n,values:t},e)=>n.precision!==Cr.HALF?t[e]:hw(t[e]),G2=(n,t)=>n.type.unit===sa.DAY?Tw(n,t):Iw(n,t),Bw=({values:n},t)=>1e3*Zg(n,t*2),Mw=({values:n},t)=>Zg(n,t*2),Lw=({values:n},t)=>B2(n,t*2),Rw=({values:n},t)=>M2(n,t*2),$2=(n,t)=>{switch(n.type.unit){case wn.SECOND:return Bw(n,t);case wn.MILLISECOND:return Mw(n,t);case wn.MICROSECOND:return Lw(n,t);case wn.NANOSECOND:return Rw(n,t)}},Nw=({values:n},t)=>n[t],Dw=({values:n},t)=>n[t],Fw=({values:n},t)=>n[t],Cw=({values:n},t)=>n[t],V2=(n,t)=>{switch(n.type.unit){case wn.SECOND:return Nw(n,t);case wn.MILLISECOND:return Dw(n,t);case wn.MICROSECOND:return Fw(n,t);case wn.NANOSECOND:return Cw(n,t)}},j2=({values:n,stride:t},e)=>Bg.decimal(n.subarray(t*e,t*(e+1))),W2=(n,t)=>{const{valueOffsets:e,stride:r,children:s}=n,{[t*r]:o,[t*r+1]:f}=e,l=s[0].slice(o,f-o);return new Ie([l])},Y2=(n,t)=>{const{valueOffsets:e,children:r}=n,{[t]:s,[t+1]:o}=e,f=r[0];return new Gp(f.slice(s,o-s))},H2=(n,t)=>new qg(n,t),X2=(n,t)=>n.type.mode===ms.Dense?kw(n,t):Pw(n,t),kw=(n,t)=>{const e=n.type.typeIdToChildIndex[n.typeIds[t]],r=n.children[e];return ii.visit(r,n.valueOffsets[t])},Pw=(n,t)=>{const e=n.type.typeIdToChildIndex[n.typeIds[t]],r=n.children[e];return ii.visit(r,t)},q2=(n,t)=>{var e;return(e=n.dictionary)===null||e===void 0?void 0:e.get(n.values[t])},Z2=(n,t)=>n.type.unit===Jo.DAY_TIME?zw(n,t):Uw(n,t),zw=({values:n},t)=>n.subarray(2*t,2*(t+1)),Uw=({values:n},t)=>{const e=n[t],r=new Int32Array(2);return r[0]=Math.trunc(e/12),r[1]=Math.trunc(e%12),r},K2=(n,t)=>{const{stride:e,children:r}=n,o=r[0].slice(t*e,e);return new Ie([o])};Fe.prototype.visitNull=Ge(N2);Fe.prototype.visitBool=Ge(D2);Fe.prototype.visitInt=Ge(z2);Fe.prototype.visitInt8=Ge(tf);Fe.prototype.visitInt16=Ge(tf);Fe.prototype.visitInt32=Ge(tf);Fe.prototype.visitInt64=Ge(Ow);Fe.prototype.visitUint8=Ge(tf);Fe.prototype.visitUint16=Ge(tf);Fe.prototype.visitUint32=Ge(tf);Fe.prototype.visitUint64=Ge(Ow);Fe.prototype.visitFloat=Ge(U2);Fe.prototype.visitFloat16=Ge(F2);Fe.prototype.visitFloat32=Ge(tf);Fe.prototype.visitFloat64=Ge(tf);Fe.prototype.visitUtf8=Ge(P2);Fe.prototype.visitBinary=Ge(k2);Fe.prototype.visitFixedSizeBinary=Ge(C2);Fe.prototype.visitDate=Ge(G2);Fe.prototype.visitDateDay=Ge(Tw);Fe.prototype.visitDateMillisecond=Ge(Iw);Fe.prototype.visitTimestamp=Ge($2);Fe.prototype.visitTimestampSecond=Ge(Bw);Fe.prototype.visitTimestampMillisecond=Ge(Mw);Fe.prototype.visitTimestampMicrosecond=Ge(Lw);Fe.prototype.visitTimestampNanosecond=Ge(Rw);Fe.prototype.visitTime=Ge(V2);Fe.prototype.visitTimeSecond=Ge(Nw);Fe.prototype.visitTimeMillisecond=Ge(Dw);Fe.prototype.visitTimeMicrosecond=Ge(Fw);Fe.prototype.visitTimeNanosecond=Ge(Cw);Fe.prototype.visitDecimal=Ge(j2);Fe.prototype.visitList=Ge(W2);Fe.prototype.visitStruct=Ge(H2);Fe.prototype.visitUnion=Ge(X2);Fe.prototype.visitDenseUnion=Ge(kw);Fe.prototype.visitSparseUnion=Ge(Pw);Fe.prototype.visitDictionary=Ge(q2);Fe.prototype.visitInterval=Ge(Z2);Fe.prototype.visitIntervalDayTime=Ge(zw);Fe.prototype.visitIntervalYearMonth=Ge(Uw);Fe.prototype.visitFixedSizeList=Ge(K2);Fe.prototype.visitMap=Ge(Y2);const ii=new Fe,ds=Symbol.for("keys"),Cc=Symbol.for("vals");class Gp{constructor(t){return this[ds]=new Ie([t.children[0]]).memoize(),this[Cc]=t.children[1],new Proxy(this,new Q2)}[Symbol.iterator](){return new J2(this[ds],this[Cc])}get size(){return this[ds].length}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[ds],e=this[Cc],r={};for(let s=-1,o=t.length;++s<o;)r[t.get(s)]=ii.visit(e,s);return r}toString(){return`{${[...this].map(([t,e])=>`${pu(t)}: ${pu(e)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class J2{constructor(t,e){this.keys=t,this.vals=e,this.keyIndex=0,this.numKeys=t.length}[Symbol.iterator](){return this}next(){const t=this.keyIndex;return t===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(t),ii.visit(this.vals,t)]})}}class Q2{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[ds].toArray().map(String)}has(t,e){return t[ds].includes(e)}getOwnPropertyDescriptor(t,e){if(t[ds].indexOf(e)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const r=t[ds].indexOf(e);if(r!==-1){const s=ii.visit(Reflect.get(t,Cc),r);return Reflect.set(t,e,s),s}}set(t,e,r){const s=t[ds].indexOf(e);return s!==-1?(Vi.visit(Reflect.get(t,Cc),s,r),Reflect.set(t,e,r)):Reflect.has(t,e)?Reflect.set(t,e,r):!1}}Object.defineProperties(Gp.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[ds]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Cc]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let Cv;function Gw(n,t,e,r){const{length:s=0}=n;let o=typeof t!="number"?0:t,f=typeof e!="number"?s:e;return o<0&&(o=(o%s+s)%s),f<0&&(f=(f%s+s)%s),f<o&&(Cv=o,o=f,f=Cv),f>s&&(f=s),r?r(n,o,f):[o,f]}const kv=n=>n!==n;function rl(n){if(typeof n!=="object"||n===null)return kv(n)?kv:e=>e===n;if(n instanceof Date){const e=n.valueOf();return r=>r instanceof Date?r.valueOf()===e:!1}return ArrayBuffer.isView(n)?e=>e?KI(n,e):!1:n instanceof Map?eO(n):Array.isArray(n)?tO(n):n instanceof Ie?nO(n):rO(n,!0)}function tO(n){const t=[];for(let e=-1,r=n.length;++e<r;)t[e]=rl(n[e]);return $p(t)}function eO(n){let t=-1;const e=[];for(const r of n.values())e[++t]=rl(r);return $p(e)}function nO(n){const t=[];for(let e=-1,r=n.length;++e<r;)t[e]=rl(n.get(e));return $p(t)}function rO(n,t=!1){const e=Object.keys(n);if(!t&&e.length===0)return()=>!1;const r=[];for(let s=-1,o=e.length;++s<o;)r[s]=rl(n[e[s]]);return $p(r,e)}function $p(n,t){return e=>{if(!e||typeof e!="object")return!1;switch(e.constructor){case Array:return iO(n,e);case Map:return Pv(n,e,e.keys());case Gp:case qg:case Object:case void 0:return Pv(n,e,t||Object.keys(e))}return e instanceof Ie?sO(n,e):!1}}function iO(n,t){const e=n.length;if(t.length!==e)return!1;for(let r=-1;++r<e;)if(!n[r](t[r]))return!1;return!0}function sO(n,t){const e=n.length;if(t.length!==e)return!1;for(let r=-1;++r<e;)if(!n[r](t.get(r)))return!1;return!0}function Pv(n,t,e){const r=e[Symbol.iterator](),s=t instanceof Map?t.keys():Object.keys(t)[Symbol.iterator](),o=t instanceof Map?t.values():Object.values(t)[Symbol.iterator]();let f=0;const c=n.length;let l=o.next(),d=r.next(),p=s.next();for(;f<c&&!d.done&&!p.done&&!l.done&&!(d.value!==p.value||!n[f](l.value));++f,d=r.next(),p=s.next(),l=o.next());return f===c&&d.done&&p.done&&l.done?!0:(r.return&&r.return(),s.return&&s.return(),o.return&&o.return(),!1)}function $w(n,t,e,r){return(e&1<<r)!==0}function aO(n,t,e,r){return(e&1<<r)>>r}function oO(n,t,e){const r=e.byteLength+7&-8;if(n>0||e.byteLength<r){const s=new Uint8Array(r);return s.set(n%8===0?e.subarray(n>>3):q0(new Kg(e,n,t,null,$w)).subarray(0,r)),s}return e}function q0(n){const t=[];let e=0,r=0,s=0;for(const f of n)f&&(s|=1<<r),++r===8&&(t[e++]=s,s=r=0);(e===0||r>0)&&(t[e++]=s);const o=new Uint8Array(t.length+7&-8);return o.set(t),o}class Kg{constructor(t,e,r,s,o){this.bytes=t,this.length=r,this.context=s,this.get=o,this.bit=e%8,this.byteIndex=e>>3,this.byte=t[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function Z0(n,t,e){if(e-t<=0)return 0;if(e-t<8){let o=0;for(const f of new Kg(n,t,e-t,n,aO))o+=f;return o}const r=e>>3<<3,s=t+(t%8===0?0:8-t%8);return Z0(n,t,s)+Z0(n,r,e)+fO(n,s>>3,r-s>>3)}function fO(n,t,e){let r=0,s=Math.trunc(t);const o=new DataView(n.buffer,n.byteOffset,n.byteLength),f=e===void 0?n.byteLength:s+e;for(;f-s>=4;)r+=c0(o.getUint32(s)),s+=4;for(;f-s>=2;)r+=c0(o.getUint16(s)),s+=2;for(;f-s>=1;)r+=c0(o.getUint8(s)),s+=1;return r}function c0(n){let t=Math.trunc(n);return t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),(t+(t>>>4)&252645135)*16843009>>>24}const uO=-1;class On{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get byteLength(){let t=0;const{valueOffsets:e,values:r,nullBitmap:s,typeIds:o}=this;return e&&(t+=e.byteLength),r&&(t+=r.byteLength),s&&(t+=s.byteLength),o&&(t+=o.byteLength),this.children.reduce((f,c)=>f+c.byteLength,t)}get nullCount(){let t=this._nullCount,e;return t<=uO&&(e=this.nullBitmap)&&(this._nullCount=t=this.length-Z0(e,this.offset,this.offset+this.length)),t}constructor(t,e,r,s,o,f=[],c){this.type=t,this.children=f,this.dictionary=c,this.offset=Math.floor(Math.max(e||0,0)),this.length=Math.floor(Math.max(r||0,0)),this._nullCount=Math.floor(Math.max(s||0,-1));let l;o instanceof On?(this.stride=o.stride,this.values=o.values,this.typeIds=o.typeIds,this.nullBitmap=o.nullBitmap,this.valueOffsets=o.valueOffsets):(this.stride=Ws(t),o&&((l=o[0])&&(this.valueOffsets=l),(l=o[1])&&(this.values=l),(l=o[2])&&(this.nullBitmap=l),(l=o[3])&&(this.typeIds=l))),this.nullable=this._nullCount!==0&&this.nullBitmap&&this.nullBitmap.byteLength>0}getValid(t){if(this.nullable&&this.nullCount>0){const e=this.offset+t;return(this.nullBitmap[e>>3]&1<<e%8)!==0}return!0}setValid(t,e){if(!this.nullable)return e;if(!this.nullBitmap||this.nullBitmap.byteLength<=t>>3){const{nullBitmap:l}=this._changeLengthAndBackfillNullBitmap(this.length);Object.assign(this,{nullBitmap:l,_nullCount:0})}const{nullBitmap:r,offset:s}=this,o=s+t>>3,f=(s+t)%8,c=r[o]>>f&1;return e?c===0&&(r[o]|=1<<f,this._nullCount=this.nullCount+1):c===1&&(r[o]&=~(1<<f),this._nullCount=this.nullCount-1),e}clone(t=this.type,e=this.offset,r=this.length,s=this._nullCount,o=this,f=this.children){return new On(t,e,r,s,o,f,this.dictionary)}slice(t,e){const{stride:r,typeId:s,children:o}=this,f=+(this._nullCount===0)-1,c=s===16?r:1,l=this._sliceBuffers(t,e,r,s);return this.clone(this.type,this.offset+t,e,f,l,o.length===0||this.valueOffsets?o:this._sliceChildren(o,c*t,c*e))}_changeLengthAndBackfillNullBitmap(t){if(this.typeId===Q.Null)return this.clone(this.type,0,t,0);const{length:e,nullCount:r}=this,s=new Uint8Array((t+63&-64)>>3).fill(255,0,e>>3);s[e>>3]=(1<<e-(e&-8))-1,r>0&&s.set(oO(this.offset,e,this.nullBitmap),0);const o=this.buffers;return o[Za.VALIDITY]=s,this.clone(this.type,0,t,r+(t-e),o)}_sliceBuffers(t,e,r,s){let o;const{buffers:f}=this;return(o=f[Za.TYPE])&&(f[Za.TYPE]=o.subarray(t,t+e)),(o=f[Za.OFFSET])&&(f[Za.OFFSET]=o.subarray(t,t+e+1))||(o=f[Za.DATA])&&(f[Za.DATA]=s===6?o:o.subarray(r*t,r*(t+e))),f}_sliceChildren(t,e,r){return t.map(s=>s.slice(e,r))}}On.prototype.children=Object.freeze([]);class zh extends ln{visit(t){return this.getVisitFn(t.type).call(this,t)}visitNull(t){const{["type"]:e,["offset"]:r=0,["length"]:s=0}=t;return new On(e,r,s,0)}visitBool(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.nullBitmap),o=Ln(e.ArrayType,t.data),{["length"]:f=o.length>>3,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,s])}visitInt(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.nullBitmap),o=Ln(e.ArrayType,t.data),{["length"]:f=o.length,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,s])}visitFloat(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.nullBitmap),o=Ln(e.ArrayType,t.data),{["length"]:f=o.length,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,s])}visitUtf8(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.data),o=bn(t.nullBitmap),f=Oh(t.valueOffsets),{["length"]:c=f.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new On(e,r,c,l,[f,s,o])}visitBinary(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.data),o=bn(t.nullBitmap),f=Oh(t.valueOffsets),{["length"]:c=f.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new On(e,r,c,l,[f,s,o])}visitFixedSizeBinary(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.nullBitmap),o=Ln(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,s])}visitDate(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.nullBitmap),o=Ln(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,s])}visitTimestamp(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.nullBitmap),o=Ln(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,s])}visitTime(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.nullBitmap),o=Ln(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,s])}visitDecimal(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.nullBitmap),o=Ln(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,s])}visitList(t){const{["type"]:e,["offset"]:r=0,["child"]:s}=t,o=bn(t.nullBitmap),f=Oh(t.valueOffsets),{["length"]:c=f.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new On(e,r,c,l,[f,void 0,o],[s])}visitStruct(t){const{["type"]:e,["offset"]:r=0,["children"]:s=[]}=t,o=bn(t.nullBitmap),{length:f=s.reduce((l,{length:d})=>Math.max(l,d),0),nullCount:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,void 0,o],s)}visitUnion(t){const{["type"]:e,["offset"]:r=0,["children"]:s=[]}=t,o=bn(t.nullBitmap),f=Ln(e.ArrayType,t.typeIds),{["length"]:c=f.length,["nullCount"]:l=t.nullBitmap?-1:0}=t;if(Re.isSparseUnion(e))return new On(e,r,c,l,[void 0,void 0,o,f],s);const d=Oh(t.valueOffsets);return new On(e,r,c,l,[d,void 0,o,f],s)}visitDictionary(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.nullBitmap),o=Ln(e.indices.ArrayType,t.data),{["dictionary"]:f=new Ie([new zh().visit({type:e.dictionary})])}=t,{["length"]:c=o.length,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new On(e,r,c,l,[void 0,o,s],[],f)}visitInterval(t){const{["type"]:e,["offset"]:r=0}=t,s=bn(t.nullBitmap),o=Ln(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,s])}visitFixedSizeList(t){const{["type"]:e,["offset"]:r=0,["child"]:s=new zh().visit({type:e.valueType})}=t,o=bn(t.nullBitmap),{["length"]:f=s.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,void 0,o],[s])}visitMap(t){const{["type"]:e,["offset"]:r=0,["child"]:s=new zh().visit({type:e.childType})}=t,o=bn(t.nullBitmap),f=Oh(t.valueOffsets),{["length"]:c=f.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new On(e,r,c,l,[f,void 0,o],[s])}}function Te(n){return new zh().visit(n)}class zv{constructor(t=0,e){this.numChunks=t,this.getChunkIterator=e,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const t=this.chunkIterator.next();if(!t.done)return t;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function Vw(n){return n.reduce((t,e)=>t+e.nullCount,0)}function jw(n){return n.reduce((t,e,r)=>(t[r+1]=t[r]+e.length,t),new Uint32Array(n.length+1))}function Ww(n,t,e,r){const s=[];for(let o=-1,f=n.length;++o<f;){const c=n[o],l=t[o],{length:d}=c;if(l>=r)break;if(e>=l+d)continue;if(l>=e&&l+d<=r){s.push(c);continue}const p=Math.max(0,e-l),w=Math.min(r-l,d);s.push(c.slice(p,w-p))}return s.length===0&&s.push(n[0].slice(0,0)),s}function Jg(n,t,e,r){let s=0,o=0,f=t.length-1;do{if(s>=f-1)return e<t[f]?r(n,s,e-t[s]):null;o=s+Math.trunc((f-s)*.5),e<t[o]?f=o:s=o}while(s<f)}function Qg(n,t){return n.getValid(t)}function kc(n){function t(e,r,s){return n(e[r],s)}return function(e){const r=this.data;return Jg(r,this._offsets,e,t)}}function Yw(n){let t;function e(r,s,o){return n(r[s],o,t)}return function(r,s){const o=this.data;t=s;const f=Jg(o,this._offsets,r,e);return t=void 0,f}}function Hw(n){let t;function e(r,s,o){let f=o,c=0,l=0;for(let d=s-1,p=r.length;++d<p;){const w=r[d];if(~(c=n(w,t,f)))return l+c;f=0,l+=w.length}return-1}return function(r,s){t=r;const o=this.data,f=typeof s!="number"?e(o,0,0):Jg(o,this._offsets,s,e);return t=void 0,f}}class Ce extends ln{}function cO(n,t){return t===null&&n.length>0?0:-1}function lO(n,t){const{nullBitmap:e}=n;if(!e||n.nullCount<=0)return-1;let r=0;for(const s of new Kg(e,n.offset+(t||0),n.length,e,$w)){if(!s)return r;++r}return-1}function Qe(n,t,e){if(t===void 0)return-1;if(t===null)return lO(n,e);const r=ii.getVisitFn(n),s=rl(t);for(let o=(e||0)-1,f=n.length;++o<f;)if(s(r(n,o)))return o;return-1}function Xw(n,t,e){const r=ii.getVisitFn(n),s=rl(t);for(let o=(e||0)-1,f=n.length;++o<f;)if(s(r(n,o)))return o;return-1}Ce.prototype.visitNull=cO;Ce.prototype.visitBool=Qe;Ce.prototype.visitInt=Qe;Ce.prototype.visitInt8=Qe;Ce.prototype.visitInt16=Qe;Ce.prototype.visitInt32=Qe;Ce.prototype.visitInt64=Qe;Ce.prototype.visitUint8=Qe;Ce.prototype.visitUint16=Qe;Ce.prototype.visitUint32=Qe;Ce.prototype.visitUint64=Qe;Ce.prototype.visitFloat=Qe;Ce.prototype.visitFloat16=Qe;Ce.prototype.visitFloat32=Qe;Ce.prototype.visitFloat64=Qe;Ce.prototype.visitUtf8=Qe;Ce.prototype.visitBinary=Qe;Ce.prototype.visitFixedSizeBinary=Qe;Ce.prototype.visitDate=Qe;Ce.prototype.visitDateDay=Qe;Ce.prototype.visitDateMillisecond=Qe;Ce.prototype.visitTimestamp=Qe;Ce.prototype.visitTimestampSecond=Qe;Ce.prototype.visitTimestampMillisecond=Qe;Ce.prototype.visitTimestampMicrosecond=Qe;Ce.prototype.visitTimestampNanosecond=Qe;Ce.prototype.visitTime=Qe;Ce.prototype.visitTimeSecond=Qe;Ce.prototype.visitTimeMillisecond=Qe;Ce.prototype.visitTimeMicrosecond=Qe;Ce.prototype.visitTimeNanosecond=Qe;Ce.prototype.visitDecimal=Qe;Ce.prototype.visitList=Qe;Ce.prototype.visitStruct=Qe;Ce.prototype.visitUnion=Qe;Ce.prototype.visitDenseUnion=Xw;Ce.prototype.visitSparseUnion=Xw;Ce.prototype.visitDictionary=Qe;Ce.prototype.visitInterval=Qe;Ce.prototype.visitIntervalDayTime=Qe;Ce.prototype.visitIntervalYearMonth=Qe;Ce.prototype.visitFixedSizeList=Qe;Ce.prototype.visitMap=Qe;const fp=new Ce;class ke extends ln{}function $e(n){const{type:t}=n;if(n.nullCount===0&&n.stride===1&&(t.typeId===Q.Timestamp||t instanceof Wr&&t.bitWidth!==64||t instanceof Qh&&t.bitWidth!==64||t instanceof mu&&t.precision!==Cr.HALF))return new zv(n.data.length,r=>{const s=n.data[r];return s.values.subarray(0,s.length)[Symbol.iterator]()});let e=0;return new zv(n.data.length,r=>{const o=n.data[r].length,f=n.slice(e,e+o);return e+=o,new hO(f)})}class hO{constructor(t){this.vector=t,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}ke.prototype.visitNull=$e;ke.prototype.visitBool=$e;ke.prototype.visitInt=$e;ke.prototype.visitInt8=$e;ke.prototype.visitInt16=$e;ke.prototype.visitInt32=$e;ke.prototype.visitInt64=$e;ke.prototype.visitUint8=$e;ke.prototype.visitUint16=$e;ke.prototype.visitUint32=$e;ke.prototype.visitUint64=$e;ke.prototype.visitFloat=$e;ke.prototype.visitFloat16=$e;ke.prototype.visitFloat32=$e;ke.prototype.visitFloat64=$e;ke.prototype.visitUtf8=$e;ke.prototype.visitBinary=$e;ke.prototype.visitFixedSizeBinary=$e;ke.prototype.visitDate=$e;ke.prototype.visitDateDay=$e;ke.prototype.visitDateMillisecond=$e;ke.prototype.visitTimestamp=$e;ke.prototype.visitTimestampSecond=$e;ke.prototype.visitTimestampMillisecond=$e;ke.prototype.visitTimestampMicrosecond=$e;ke.prototype.visitTimestampNanosecond=$e;ke.prototype.visitTime=$e;ke.prototype.visitTimeSecond=$e;ke.prototype.visitTimeMillisecond=$e;ke.prototype.visitTimeMicrosecond=$e;ke.prototype.visitTimeNanosecond=$e;ke.prototype.visitDecimal=$e;ke.prototype.visitList=$e;ke.prototype.visitStruct=$e;ke.prototype.visitUnion=$e;ke.prototype.visitDenseUnion=$e;ke.prototype.visitSparseUnion=$e;ke.prototype.visitDictionary=$e;ke.prototype.visitInterval=$e;ke.prototype.visitIntervalDayTime=$e;ke.prototype.visitIntervalYearMonth=$e;ke.prototype.visitFixedSizeList=$e;ke.prototype.visitMap=$e;const ty=new ke,dO=(n,t)=>n+t;class ef extends ln{visitNull(t,e){return 0}visitInt(t,e){return t.type.bitWidth/8}visitFloat(t,e){return t.type.ArrayType.BYTES_PER_ELEMENT}visitBool(t,e){return 1/8}visitDecimal(t,e){return t.type.bitWidth/8}visitDate(t,e){return(t.type.unit+1)*4}visitTime(t,e){return t.type.bitWidth/8}visitTimestamp(t,e){return t.type.unit===wn.SECOND?4:8}visitInterval(t,e){return(t.type.unit+1)*4}visitStruct(t,e){return t.children.reduce((r,s)=>r+oa.visit(s,e),0)}visitFixedSizeBinary(t,e){return t.type.byteWidth}visitMap(t,e){return 8+t.children.reduce((r,s)=>r+oa.visit(s,e),0)}visitDictionary(t,e){var r;return t.type.indices.bitWidth/8+(((r=t.dictionary)===null||r===void 0?void 0:r.getByteLength(t.values[e]))||0)}}const _O=({valueOffsets:n},t)=>8+(n[t+1]-n[t]),pO=({valueOffsets:n},t)=>8+(n[t+1]-n[t]),mO=({valueOffsets:n,stride:t,children:e},r)=>{const s=e[0],{[r*t]:o}=n,{[r*t+1]:f}=n,c=oa.getVisitFn(s.type),l=s.slice(o,f-o);let d=8;for(let p=-1,w=f-o;++p<w;)d+=c(l,p);return d},gO=({stride:n,children:t},e)=>{const r=t[0],s=r.slice(e*n,n),o=oa.getVisitFn(r.type);let f=0;for(let c=-1,l=s.length;++c<l;)f+=o(s,c);return f},yO=(n,t)=>n.type.mode===ms.Dense?qw(n,t):Zw(n,t),qw=({type:n,children:t,typeIds:e,valueOffsets:r},s)=>{const o=n.typeIdToChildIndex[e[s]];return 8+oa.visit(t[o],r[s])},Zw=({children:n},t)=>4+oa.visitMany(n,n.map(()=>t)).reduce(dO,0);ef.prototype.visitUtf8=_O;ef.prototype.visitBinary=pO;ef.prototype.visitList=mO;ef.prototype.visitFixedSizeList=gO;ef.prototype.visitUnion=yO;ef.prototype.visitDenseUnion=qw;ef.prototype.visitSparseUnion=Zw;const oa=new ef;var Kw;const Jw={},Qw={};class Ie{constructor(t){var e,r,s;const o=t[0]instanceof Ie?t.flatMap(c=>c.data):t;if(o.length===0||o.some(c=>!(c instanceof On)))throw new TypeError("Vector constructor expects an Array of Data instances.");const f=(e=o[0])===null||e===void 0?void 0:e.type;switch(o.length){case 0:this._offsets=[0];break;case 1:{const{get:c,set:l,indexOf:d,byteLength:p}=Jw[f.typeId],w=o[0];this.isValid=I=>Qg(w,I),this.get=I=>c(w,I),this.set=(I,C)=>l(w,I,C),this.indexOf=I=>d(w,I),this.getByteLength=I=>p(w,I),this._offsets=[0,w.length];break}default:Object.setPrototypeOf(this,Qw[f.typeId]),this._offsets=jw(o);break}this.data=o,this.type=f,this.stride=Ws(f),this.numChildren=(s=(r=f.children)===null||r===void 0?void 0:r.length)!==null&&s!==void 0?s:0,this.length=this._offsets.at(-1)}get byteLength(){return this._byteLength===-1&&(this._byteLength=this.data.reduce((t,e)=>t+e.byteLength,0)),this._byteLength}get nullCount(){return this._nullCount===-1&&(this._nullCount=Vw(this.data)),this._nullCount}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${Q[this.type.typeId]}Vector`}isValid(t){return!1}get(t){return null}set(t,e){}indexOf(t,e){return-1}includes(t,e){return this.indexOf(t,e)>0}getByteLength(t){return 0}[Symbol.iterator](){return ty.visit(this)}concat(...t){return new Ie(this.data.concat(t.flatMap(e=>e.data).flat(Number.POSITIVE_INFINITY)))}slice(t,e){return new Ie(Gw(this,t,e,({data:r,_offsets:s},o,f)=>Ww(r,s,o,f)))}toJSON(){return[...this]}toArray(){const{type:t,data:e,length:r,stride:s,ArrayType:o}=this;switch(t.typeId){case Q.Int:case Q.Float:case Q.Decimal:case Q.Time:case Q.Timestamp:switch(e.length){case 0:return new o;case 1:return e[0].values.subarray(0,r*s);default:return e.reduce((f,{values:c,length:l})=>(f.array.set(c.subarray(0,l*s),f.offset),f.offset+=l*s,f),{array:new o(r*s),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(t){var e;return this.getChildAt((e=this.type.children)===null||e===void 0?void 0:e.findIndex(r=>r.name===t))}getChildAt(t){return t>-1&&t<this.numChildren?new Ie(this.data.map(({children:e})=>e[t])):null}get isMemoized(){return Re.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(Re.isDictionary(this.type)){const t=new up(this.data[0].dictionary),e=this.data.map(r=>{const s=r.clone();return s.dictionary=t,s});return new Ie(e)}return new up(this)}unmemoize(){if(Re.isDictionary(this.type)&&this.isMemoized){const t=this.data[0].dictionary.unmemoize(),e=this.data.map(r=>{const s=r.clone();return s.dictionary=t,s});return new Ie(e)}return this}}Kw=Symbol.toStringTag;Ie[Kw]=(n=>{n.type=Re.prototype,n.data=[],n.length=0,n.stride=1,n.numChildren=0,n._nullCount=-1,n._byteLength=-1,n._offsets=new Uint32Array([0]),n[Symbol.isConcatSpreadable]=!0;const t=Object.keys(Q).map(e=>Q[e]).filter(e=>typeof e=="number"&&e!==Q.NONE);for(const e of t){const r=ii.getVisitFnByTypeId(e),s=Vi.getVisitFnByTypeId(e),o=fp.getVisitFnByTypeId(e),f=oa.getVisitFnByTypeId(e);Jw[e]={get:r,set:s,indexOf:o,byteLength:f},Qw[e]=Object.create(n,{isValid:{value:kc(Qg)},get:{value:kc(ii.getVisitFnByTypeId(e))},set:{value:Yw(Vi.getVisitFnByTypeId(e))},indexOf:{value:Hw(fp.getVisitFnByTypeId(e))},getByteLength:{value:kc(oa.getVisitFnByTypeId(e))}})}return"Vector"})(Ie.prototype);class up extends Ie{constructor(t){super(t.data);const e=this.get,r=this.set,s=this.slice,o=new Array(this.length);Object.defineProperty(this,"get",{value(f){const c=o[f];if(c!==void 0)return c;const l=e.call(this,f);return o[f]=l,l}}),Object.defineProperty(this,"set",{value(f,c){r.call(this,f,c),o[f]=c}}),Object.defineProperty(this,"slice",{value:(f,c)=>new up(s.call(this,f,c))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new Ie(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}function tu(n){if(n){if(n instanceof On)return new Ie([n]);if(n instanceof Ie)return new Ie(n.data);if(n.type instanceof Re)return new Ie([Te(n)]);if(Array.isArray(n))return new Ie(n.flatMap(t=>vO(t)));if(ArrayBuffer.isView(n)){n instanceof DataView&&(n=new Uint8Array(n.buffer));const t={offset:0,length:n.length,nullCount:0,data:n};if(n instanceof Int8Array)return new Ie([Te(Object.assign(Object.assign({},t),{type:new Mg}))]);if(n instanceof Int16Array)return new Ie([Te(Object.assign(Object.assign({},t),{type:new Lg}))]);if(n instanceof Int32Array)return new Ie([Te(Object.assign(Object.assign({},t),{type:new Qo}))]);if(n instanceof BigInt64Array)return new Ie([Te(Object.assign(Object.assign({},t),{type:new Up}))]);if(n instanceof Uint8Array||n instanceof Uint8ClampedArray)return new Ie([Te(Object.assign(Object.assign({},t),{type:new Rg}))]);if(n instanceof Uint16Array)return new Ie([Te(Object.assign(Object.assign({},t),{type:new fw}))]);if(n instanceof Uint32Array)return new Ie([Te(Object.assign(Object.assign({},t),{type:new uw}))]);if(n instanceof BigUint64Array)return new Ie([Te(Object.assign(Object.assign({},t),{type:new cw}))]);if(n instanceof Float32Array)return new Ie([Te(Object.assign(Object.assign({},t),{type:new Ng}))]);if(n instanceof Float64Array)return new Ie([Te(Object.assign(Object.assign({},t),{type:new Dg}))]);throw new Error("Unrecognized input")}}throw new Error("Unrecognized input")}function vO(n){return n instanceof On?[n]:n instanceof Ie?n.data:tu(n).data}function bO(n){if(!n||n.length<=0)return function(s){return!0};let t="";const e=n.filter(r=>r===r);return e.length>0&&(t=`
    switch (x) {${e.map(r=>`
        case ${wO(r)}:`).join("")}
            return false;
    }`),n.length!==e.length&&(t=`if (x !== x) return false;
${t}`),new Function("x",`${t}
return true;`)}function wO(n){return typeof n!="bigint"?pu(n):`${pu(n)}n`}const l0=(n,t)=>(Math.ceil(n)*t+63&-64||64)/t,xO=(n,t=0)=>n.length>=t?n.subarray(0,t):np(new n.constructor(t),n,0);class Vp{constructor(t,e=1){this.buffer=t,this.stride=e,this.BYTES_PER_ELEMENT=t.BYTES_PER_ELEMENT,this.ArrayType=t.constructor,this._resize(this.length=Math.ceil(t.length/e))}get byteLength(){return Math.ceil(this.length*this.stride)*this.BYTES_PER_ELEMENT}get reservedLength(){return this.buffer.length/this.stride}get reservedByteLength(){return this.buffer.byteLength}set(t,e){return this}append(t){return this.set(this.length,t)}reserve(t){if(t>0){this.length+=t;const e=this.stride,r=this.length*e,s=this.buffer.length;r>=s&&this._resize(s===0?l0(r*1,this.BYTES_PER_ELEMENT):l0(r*2,this.BYTES_PER_ELEMENT))}return this}flush(t=this.length){t=l0(t*this.stride,this.BYTES_PER_ELEMENT);const e=xO(this.buffer,t);return this.clear(),e}clear(){return this.length=0,this._resize(0),this}_resize(t){return this.buffer=np(new this.ArrayType(t),this.buffer)}}Vp.prototype.offset=0;class sd extends Vp{last(){return this.get(this.length-1)}get(t){return this.buffer[t]}set(t,e){return this.reserve(t-this.length+1),this.buffer[t*this.stride]=e,this}}class tx extends sd{constructor(t=new Uint8Array(0)){super(t,1/8),this.numValid=0}get numInvalid(){return this.length-this.numValid}get(t){return this.buffer[t>>3]>>t%8&1}set(t,e){const{buffer:r}=this.reserve(t-this.length+1),s=t>>3,o=t%8,f=r[s]>>o&1;return e?f===0&&(r[s]|=1<<o,++this.numValid):f===1&&(r[s]&=~(1<<o),--this.numValid),this}clear(){return this.numValid=0,super.clear()}}class ex extends sd{constructor(t=new Int32Array(1)){super(t,1)}append(t){return this.set(this.length-1,t)}set(t,e){const r=this.length-1,s=this.reserve(t-r+1).buffer;return r<t++&&s.fill(s[r],r,t),s[t]=s[t-1]+e,this}flush(t=this.length-1){return t>this.length&&this.set(t-1,0),super.flush(t+1)}}let si=class{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t){throw new Error('"throughDOM" not available in this environment')}constructor({type:t,nullValues:e}){this.length=0,this.finished=!1,this.type=t,this.children=[],this.nullValues=e,this.stride=Ws(t),this._nulls=new tx,e&&e.length>0&&(this._isValid=bO(e))}toVector(){return new Ie([this.flush()])}get ArrayType(){return this.type.ArrayType}get nullCount(){return this._nulls.numInvalid}get numChildren(){return this.children.length}get byteLength(){let t=0;const{_offsets:e,_values:r,_nulls:s,_typeIds:o,children:f}=this;return e&&(t+=e.byteLength),r&&(t+=r.byteLength),s&&(t+=s.byteLength),o&&(t+=o.byteLength),f.reduce((c,l)=>c+l.byteLength,t)}get reservedLength(){return this._nulls.reservedLength}get reservedByteLength(){let t=0;return this._offsets&&(t+=this._offsets.reservedByteLength),this._values&&(t+=this._values.reservedByteLength),this._nulls&&(t+=this._nulls.reservedByteLength),this._typeIds&&(t+=this._typeIds.reservedByteLength),this.children.reduce((e,r)=>e+r.reservedByteLength,t)}get valueOffsets(){return this._offsets?this._offsets.buffer:null}get values(){return this._values?this._values.buffer:null}get nullBitmap(){return this._nulls?this._nulls.buffer:null}get typeIds(){return this._typeIds?this._typeIds.buffer:null}append(t){return this.set(this.length,t)}isValid(t){return this._isValid(t)}set(t,e){return this.setValid(t,this.isValid(e))&&this.setValue(t,e),this}setValue(t,e){this._setValue(this,t,e)}setValid(t,e){return this.length=this._nulls.set(t,+e).length,e}addChild(t,e=`${this.numChildren}`){throw new Error(`Cannot append children to non-nested type "${this.type}"`)}getChildAt(t){return this.children[t]||null}flush(){let t,e,r,s;const{type:o,length:f,nullCount:c,_typeIds:l,_offsets:d,_values:p,_nulls:w}=this;(e=l==null?void 0:l.flush(f))?s=d==null?void 0:d.flush(f):(s=d==null?void 0:d.flush(f))?t=p==null?void 0:p.flush(d.last()):t=p==null?void 0:p.flush(f),c>0&&(r=w==null?void 0:w.flush(f));const I=this.children.map(C=>C.flush());return this.clear(),Te({type:o,length:f,nullCount:c,children:I,child:I[0],data:t,typeIds:e,nullBitmap:r,valueOffsets:s})}finish(){this.finished=!0;for(const t of this.children)t.finish();return this}clear(){var t,e,r,s;this.length=0,(t=this._nulls)===null||t===void 0||t.clear(),(e=this._values)===null||e===void 0||e.clear(),(r=this._offsets)===null||r===void 0||r.clear(),(s=this._typeIds)===null||s===void 0||s.clear();for(const o of this.children)o.clear();return this}};si.prototype.length=1;si.prototype.stride=1;si.prototype.children=null;si.prototype.finished=!1;si.prototype.nullValues=null;si.prototype._isValid=()=>!0;class nf extends si{constructor(t){super(t),this._values=new sd(new this.ArrayType(0),this.stride)}setValue(t,e){const r=this._values;return r.reserve(t-r.length+1),super.setValue(t,e)}}class jp extends si{constructor(t){super(t),this._pendingLength=0,this._offsets=new ex}setValue(t,e){const r=this._pending||(this._pending=new Map),s=r.get(t);s&&(this._pendingLength-=s.length),this._pendingLength+=e instanceof Gp?e[ds].length:e.length,r.set(t,e)}setValid(t,e){return super.setValid(t,e)?!0:((this._pending||(this._pending=new Map)).set(t,void 0),!1)}clear(){return this._pendingLength=0,this._pending=void 0,super.clear()}flush(){return this._flush(),super.flush()}finish(){return this._flush(),super.finish()}_flush(){const t=this._pending,e=this._pendingLength;return this._pendingLength=0,this._pending=void 0,t&&t.size>0&&this._flushPending(t,e),this}}class K0{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,e,r,s){return t.prep(8,24),t.writeInt64(BigInt(s??0)),t.pad(4),t.writeInt32(r),t.writeInt64(BigInt(e??0)),t.offset()}}const h0=2,qs=4,Ja=4,Nn=4,qo=new Int32Array(2),Uv=new Float32Array(qo.buffer),Gv=new Float64Array(qo.buffer),y_=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var J0;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(J0||(J0={}));let Xc=class nx{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new nx(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return qo[0]=this.readInt32(t),Uv[0]}readFloat64(t){return qo[y_?0:1]=this.readInt32(t),qo[y_?1:0]=this.readInt32(t+4),Gv[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){Uv[0]=e,this.writeInt32(t,qo[0])}writeFloat64(t,e){Gv[0]=e,this.writeInt32(t,qo[y_?0:1]),this.writeInt32(t+4,qo[y_?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+qs+Ja)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<Ja;e++)t+=String.fromCharCode(this.readInt8(this.position_+qs+e));return t}__offset(t,e){const r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const r=this.readInt32(t);t+=qs;const s=this.bytes_.subarray(t,t+r);return e===J0.UTF8_BYTES?s:this.text_decoder_.decode(s)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+qs}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=Ja)throw new Error("FlatBuffers: file identifier must be length "+Ja);for(let e=0;e<Ja;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+qs+e))return!1;return!0}createScalarList(t,e){const r=[];for(let s=0;s<e;++s){const o=t(s);o!==null&&r.push(o)}return r}createObjList(t,e){const r=[];for(let s=0;s<e;++s){const o=t(s);o!==null&&r.push(o.unpack())}return r}},rx=class ix{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let e;t?e=t:e=1024,this.bb=Xc.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const r=~(this.bb.capacity()-this.space+e)+1&t-1;for(;this.space<r+t+e;){const s=this.bb.capacity();this.bb=ix.growByteBuffer(this.bb),this.space+=this.bb.capacity()-s}this.pad(r)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,r){(this.force_defaults||e!=r)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,r){(this.force_defaults||e!=r)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,r){(this.force_defaults||e!=r)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,r){(this.force_defaults||e!==r)&&(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,r){(this.force_defaults||e!=r)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,r){e!=r&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(e&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const r=e<<1,s=Xc.allocate(r);return s.setPosition(r-e),s.bytes().set(t.bytes(),r-e),s}addOffset(t){this.prep(qs,0),this.writeInt32(this.offset()-t+qs)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&this.vtable[e]==0;e--);const r=e+1;for(;e>=0;e--)this.addInt16(this.vtable[e]!=0?t-this.vtable[e]:0);const s=2;this.addInt16(t-this.object_start);const o=(r+s)*h0;this.addInt16(o);let f=0;const c=this.space;t:for(e=0;e<this.vtables.length;e++){const l=this.bb.capacity()-this.vtables[e];if(o==this.bb.readInt16(l)){for(let d=h0;d<o;d+=h0)if(this.bb.readInt16(c+d)!=this.bb.readInt16(l+d))continue t;f=this.vtables[e];break}}return f?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,f-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,r){const s=r?Nn:0;if(e){const o=e;if(this.prep(this.minalign,qs+Ja+s),o.length!=Ja)throw new TypeError("FlatBuffers: file identifier must be length "+Ja);for(let f=Ja-1;f>=0;f--)this.writeInt8(o.charCodeAt(f))}this.prep(this.minalign,qs+s),this.addOffset(t),s&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const r=this.bb.capacity()-t,s=r-this.bb.readInt32(r);if(!(e<this.bb.readInt16(s)&&this.bb.readInt16(s+e)!=0))throw new TypeError("FlatBuffers: field "+e+" must be set")}startVector(t,e,r){this.notNested(),this.vector_num_elems=e,this.prep(qs,t*e),this.prep(r,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(t==null)return 0;let e;t instanceof Uint8Array?e=t:e=this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);for(let r=0,s=this.space,o=this.bb.bytes();r<e.length;r++)o[s++]=e[r];return this.endVector()}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let r=0;r<t.length;++r){const s=t[r];if(s!==null)e.push(this.createObjectOffset(s));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}};class gr{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsKeyValue(t,e){return(e||new gr).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,e){return t.setPosition(t.position()+Nn),(e||new gr).__init(t.readInt32(t.position())+t.position(),t)}key(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}value(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,e){t.addFieldOffset(0,e,0)}static addValue(t,e){t.addFieldOffset(1,e,0)}static endKeyValue(t){return t.endObject()}static createKeyValue(t,e,r){return gr.startKeyValue(t),gr.addKey(t,e),gr.addValue(t,r),gr.endKeyValue(t)}}var qc;(function(n){n[n.V1=0]="V1",n[n.V2=1]="V2",n[n.V3=2]="V3",n[n.V4=3]="V4",n[n.V5=4]="V5"})(qc||(qc={}));var Zc;(function(n){n[n.Little=0]="Little",n[n.Big=1]="Big"})(Zc||(Zc={}));var cp;(function(n){n[n.DenseArray=0]="DenseArray"})(cp||(cp={}));class xi{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInt(t,e){return(e||new xi).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,e){return t.setPosition(t.position()+Nn),(e||new xi).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startInt(t){t.startObject(2)}static addBitWidth(t,e){t.addFieldInt32(0,e,0)}static addIsSigned(t,e){t.addFieldInt8(1,+e,0)}static endInt(t){return t.endObject()}static createInt(t,e,r){return xi.startInt(t),xi.addBitWidth(t,e),xi.addIsSigned(t,r),xi.endInt(t)}}class Qa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryEncoding(t,e){return(e||new Qa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,e){return t.setPosition(t.position()+Nn),(e||new Qa).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}indexType(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new xi).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isOrdered(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}dictionaryKind(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):cp.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addIndexType(t,e){t.addFieldOffset(1,e,0)}static addIsOrdered(t,e){t.addFieldInt8(2,+e,0)}static addDictionaryKind(t,e){t.addFieldInt16(3,e,cp.DenseArray)}static endDictionaryEncoding(t){return t.endObject()}}class eu{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBinary(t,e){return(e||new eu).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,e){return t.setPosition(t.position()+Nn),(e||new eu).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){return t.endObject()}static createBinary(t){return eu.startBinary(t),eu.endBinary(t)}}class nu{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBool(t,e){return(e||new nu).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,e){return t.setPosition(t.position()+Nn),(e||new nu).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){return t.endObject()}static createBool(t){return nu.startBool(t),nu.endBool(t)}}var lp;(function(n){n[n.DAY=0]="DAY",n[n.MILLISECOND=1]="MILLISECOND"})(lp||(lp={}));let O_=class xc{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDate(t,e){return(e||new xc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,e){return t.setPosition(t.position()+Nn),(e||new xc).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):lp.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,lp.MILLISECOND)}static endDate(t){return t.endObject()}static createDate(t,e){return xc.startDate(t),xc.addUnit(t,e),xc.endDate(t)}};class ni{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDecimal(t,e){return(e||new ni).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,e){return t.setPosition(t.position()+Nn),(e||new ni).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,e){t.addFieldInt32(0,e,0)}static addScale(t,e){t.addFieldInt32(1,e,0)}static addBitWidth(t,e){t.addFieldInt32(2,e,128)}static endDecimal(t){return t.endObject()}static createDecimal(t,e,r,s){return ni.startDecimal(t),ni.addPrecision(t,e),ni.addScale(t,r),ni.addBitWidth(t,s),ni.endDecimal(t)}}var Kc;(function(n){n[n.SECOND=0]="SECOND",n[n.MILLISECOND=1]="MILLISECOND",n[n.MICROSECOND=2]="MICROSECOND",n[n.NANOSECOND=3]="NANOSECOND"})(Kc||(Kc={}));class Zs{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeBinary(t,e){return(e||new Zs).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,e){return t.setPosition(t.position()+Nn),(e||new Zs).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeBinary(t){return t.endObject()}static createFixedSizeBinary(t,e){return Zs.startFixedSizeBinary(t),Zs.addByteWidth(t,e),Zs.endFixedSizeBinary(t)}}class Ks{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeList(t,e){return(e||new Ks).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,e){return t.setPosition(t.position()+Nn),(e||new Ks).__init(t.readInt32(t.position())+t.position(),t)}listSize(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeList(t){return t.endObject()}static createFixedSizeList(t,e){return Ks.startFixedSizeList(t),Ks.addListSize(t,e),Ks.endFixedSizeList(t)}}var hp;(function(n){n[n.HALF=0]="HALF",n[n.SINGLE=1]="SINGLE",n[n.DOUBLE=2]="DOUBLE"})(hp||(hp={}));class Js{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFloatingPoint(t,e){return(e||new Js).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,e){return t.setPosition(t.position()+Nn),(e||new Js).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):hp.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,e){t.addFieldInt16(0,e,hp.HALF)}static endFloatingPoint(t){return t.endObject()}static createFloatingPoint(t,e){return Js.startFloatingPoint(t),Js.addPrecision(t,e),Js.endFloatingPoint(t)}}var dp;(function(n){n[n.YEAR_MONTH=0]="YEAR_MONTH",n[n.DAY_TIME=1]="DAY_TIME",n[n.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(dp||(dp={}));class Qs{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInterval(t,e){return(e||new Qs).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,e){return t.setPosition(t.position()+Nn),(e||new Qs).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):dp.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,dp.YEAR_MONTH)}static endInterval(t){return t.endObject()}static createInterval(t,e){return Qs.startInterval(t),Qs.addUnit(t,e),Qs.endInterval(t)}}class ru{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsList(t,e){return(e||new ru).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,e){return t.setPosition(t.position()+Nn),(e||new ru).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){return t.endObject()}static createList(t){return ru.startList(t),ru.endList(t)}}let B_=class Sc{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMap(t,e){return(e||new Sc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,e){return t.setPosition(t.position()+Nn),(e||new Sc).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){const t=this.bb.__offset(this.bb_pos,4);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startMap(t){t.startObject(1)}static addKeysSorted(t,e){t.addFieldInt8(0,+e,0)}static endMap(t){return t.endObject()}static createMap(t,e){return Sc.startMap(t),Sc.addKeysSorted(t,e),Sc.endMap(t)}};class iu{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsNull(t,e){return(e||new iu).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,e){return t.setPosition(t.position()+Nn),(e||new iu).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){return t.endObject()}static createNull(t){return iu.startNull(t),iu.endNull(t)}}class su{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsStruct_(t,e){return(e||new su).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,e){return t.setPosition(t.position()+Nn),(e||new su).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){return t.endObject()}static createStruct_(t){return su.startStruct_(t),su.endStruct_(t)}}class ki{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTime(t,e){return(e||new ki).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,e){return t.setPosition(t.position()+Nn),(e||new ki).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Kc.MILLISECOND}bitWidth(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,Kc.MILLISECOND)}static addBitWidth(t,e){t.addFieldInt32(1,e,32)}static endTime(t){return t.endObject()}static createTime(t,e,r){return ki.startTime(t),ki.addUnit(t,e),ki.addBitWidth(t,r),ki.endTime(t)}}class Pi{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTimestamp(t,e){return(e||new Pi).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,e){return t.setPosition(t.position()+Nn),(e||new Pi).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Kc.SECOND}timezone(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,Kc.SECOND)}static addTimezone(t,e){t.addFieldOffset(1,e,0)}static endTimestamp(t){return t.endObject()}static createTimestamp(t,e,r){return Pi.startTimestamp(t),Pi.addUnit(t,e),Pi.addTimezone(t,r),Pi.endTimestamp(t)}}var _p;(function(n){n[n.Sparse=0]="Sparse",n[n.Dense=1]="Dense"})(_p||(_p={}));class ri{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUnion(t,e){return(e||new ri).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,e){return t.setPosition(t.position()+Nn),(e||new ri).__init(t.readInt32(t.position())+t.position(),t)}mode(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):_p.Sparse}typeIds(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+t*4):0}typeIdsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,e){t.addFieldInt16(0,e,_p.Sparse)}static addTypeIds(t,e){t.addFieldOffset(1,e,0)}static createTypeIdsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()}static startTypeIdsVector(t,e){t.startVector(4,e,4)}static endUnion(t){return t.endObject()}static createUnion(t,e,r){return ri.startUnion(t),ri.addMode(t,e),ri.addTypeIds(t,r),ri.endUnion(t)}}class au{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUtf8(t,e){return(e||new au).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,e){return t.setPosition(t.position()+Nn),(e||new au).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){return t.endObject()}static createUtf8(t){return au.startUtf8(t),au.endUtf8(t)}}var Xn;(function(n){n[n.NONE=0]="NONE",n[n.Null=1]="Null",n[n.Int=2]="Int",n[n.FloatingPoint=3]="FloatingPoint",n[n.Binary=4]="Binary",n[n.Utf8=5]="Utf8",n[n.Bool=6]="Bool",n[n.Decimal=7]="Decimal",n[n.Date=8]="Date",n[n.Time=9]="Time",n[n.Timestamp=10]="Timestamp",n[n.Interval=11]="Interval",n[n.List=12]="List",n[n.Struct_=13]="Struct_",n[n.Union=14]="Union",n[n.FixedSizeBinary=15]="FixedSizeBinary",n[n.FixedSizeList=16]="FixedSizeList",n[n.Map=17]="Map",n[n.Duration=18]="Duration",n[n.LargeBinary=19]="LargeBinary",n[n.LargeUtf8=20]="LargeUtf8",n[n.LargeList=21]="LargeList",n[n.RunEndEncoded=22]="RunEndEncoded"})(Xn||(Xn={}));let Fi=class M_{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsField(t,e){return(e||new M_).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,e){return t.setPosition(t.position()+Nn),(e||new M_).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}nullable(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}typeType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):Xn.NONE}type(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__union(t,this.bb_pos+e):null}dictionary(t){const e=this.bb.__offset(this.bb_pos,12);return e?(t||new Qa).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}children(t,e){const r=this.bb.__offset(this.bb_pos,14);return r?(e||new M_).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const r=this.bb.__offset(this.bb_pos,16);return r?(e||new gr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,e){t.addFieldOffset(0,e,0)}static addNullable(t,e){t.addFieldInt8(1,+e,0)}static addTypeType(t,e){t.addFieldInt8(2,e,Xn.NONE)}static addType(t,e){t.addFieldOffset(3,e,0)}static addDictionary(t,e){t.addFieldOffset(4,e,0)}static addChildren(t,e){t.addFieldOffset(5,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(6,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endField(t){return t.endObject()}},Vs=class Xa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSchema(t,e){return(e||new Xa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,e){return t.setPosition(t.position()+Nn),(e||new Xa).__init(t.readInt32(t.position())+t.position(),t)}endianness(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Zc.Little}fields(t,e){const r=this.bb.__offset(this.bb_pos,6);return r?(e||new Fi).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}fieldsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const r=this.bb.__offset(this.bb_pos,8);return r?(e||new gr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb.__vector(this.bb_pos+e)+t*8):BigInt(0)}featuresLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,e){t.addFieldInt16(0,e,Zc.Little)}static addFields(t,e){t.addFieldOffset(1,e,0)}static createFieldsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startFieldsVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(2,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static addFeatures(t,e){t.addFieldOffset(3,e,0)}static createFeaturesVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}static startFeaturesVector(t,e){t.startVector(8,e,8)}static endSchema(t){return t.endObject()}static finishSchemaBuffer(t,e){t.finish(e)}static finishSizePrefixedSchemaBuffer(t,e){t.finish(e,void 0,!0)}static createSchema(t,e,r,s,o){return Xa.startSchema(t),Xa.addEndianness(t,e),Xa.addFields(t,r),Xa.addCustomMetadata(t,s),Xa.addFeatures(t,o),Xa.endSchema(t)}};class wi{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFooter(t,e){return(e||new wi).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,e){return t.setPosition(t.position()+Nn),(e||new wi).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):qc.V1}schema(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new Vs).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}dictionaries(t,e){const r=this.bb.__offset(this.bb_pos,8);return r?(e||new K0).__init(this.bb.__vector(this.bb_pos+r)+t*24,this.bb):null}dictionariesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,e){const r=this.bb.__offset(this.bb_pos,10);return r?(e||new K0).__init(this.bb.__vector(this.bb_pos+r)+t*24,this.bb):null}recordBatchesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const r=this.bb.__offset(this.bb_pos,12);return r?(e||new gr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,qc.V1)}static addSchema(t,e){t.addFieldOffset(1,e,0)}static addDictionaries(t,e){t.addFieldOffset(2,e,0)}static startDictionariesVector(t,e){t.startVector(24,e,8)}static addRecordBatches(t,e){t.addFieldOffset(3,e,0)}static startRecordBatchesVector(t,e){t.startVector(24,e,8)}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endFooter(t){return t.endObject()}static finishFooterBuffer(t,e){t.finish(e)}static finishSizePrefixedFooterBuffer(t,e){t.finish(e,void 0,!0)}}class An{constructor(t=[],e,r){this.fields=t||[],this.metadata=e||new Map,r||(r=Q0(t)),this.dictionaries=r}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(t=>t.name)}toString(){return`Schema<{ ${this.fields.map((t,e)=>`${e}: ${t}`).join(", ")} }>`}select(t){const e=new Set(t),r=this.fields.filter(s=>e.has(s.name));return new An(r,this.metadata)}selectAt(t){const e=t.map(r=>this.fields[r]).filter(Boolean);return new An(e,this.metadata)}assign(...t){const e=t[0]instanceof An?t[0]:Array.isArray(t[0])?new An(t[0]):new An(t),r=[...this.fields],s=v_(v_(new Map,this.metadata),e.metadata),o=e.fields.filter(c=>{const l=r.findIndex(d=>d.name===c.name);return~l?(r[l]=c.clone({metadata:v_(v_(new Map,r[l].metadata),c.metadata)}))&&!1:!0}),f=Q0(o,new Map);return new An([...r,...o],s,new Map([...this.dictionaries,...f]))}}An.prototype.fields=null;An.prototype.metadata=null;An.prototype.dictionaries=null;class gn{static new(...t){let[e,r,s,o]=t;return t[0]&&typeof t[0]=="object"&&({name:e}=t[0],r===void 0&&(r=t[0].type),s===void 0&&(s=t[0].nullable),o===void 0&&(o=t[0].metadata)),new gn(`${e}`,r,s,o)}constructor(t,e,r=!1,s){this.name=t,this.type=e,this.nullable=r,this.metadata=s||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...t){let[e,r,s,o]=t;return!t[0]||typeof t[0]!="object"?[e=this.name,r=this.type,s=this.nullable,o=this.metadata]=t:{name:e=this.name,type:r=this.type,nullable:s=this.nullable,metadata:o=this.metadata}=t[0],gn.new(e,r,s,o)}}gn.prototype.type=null;gn.prototype.name=null;gn.prototype.nullable=null;gn.prototype.metadata=null;function v_(n,t){return new Map([...n||new Map,...t||new Map])}function Q0(n,t=new Map){for(let e=-1,r=n.length;++e<r;){const o=n[e].type;if(Re.isDictionary(o)){if(!t.has(o.id))t.set(o.id,o.dictionary);else if(t.get(o.id)!==o.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}o.children&&o.children.length>0&&Q0(o.children,t)}return t}var SO=rx,AO=Xc;class ey{static decode(t){t=new AO(bn(t));const e=wi.getRootAsFooter(t),r=An.decode(e.schema());return new EO(r,e)}static encode(t){const e=new SO,r=An.encode(e,t.schema);wi.startRecordBatchesVector(e,t.numRecordBatches);for(const f of[...t.recordBatches()].slice().reverse())Jc.encode(e,f);const s=e.endVector();wi.startDictionariesVector(e,t.numDictionaries);for(const f of[...t.dictionaryBatches()].slice().reverse())Jc.encode(e,f);const o=e.endVector();return wi.startFooter(e),wi.addSchema(e,r),wi.addVersion(e,Ui.V4),wi.addRecordBatches(e,s),wi.addDictionaries(e,o),wi.finishFooterBuffer(e,wi.endFooter(e)),e.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(t,e=Ui.V4,r,s){this.schema=t,this.version=e,r&&(this._recordBatches=r),s&&(this._dictionaryBatches=s)}*recordBatches(){for(let t,e=-1,r=this.numRecordBatches;++e<r;)(t=this.getRecordBatch(e))&&(yield t)}*dictionaryBatches(){for(let t,e=-1,r=this.numDictionaries;++e<r;)(t=this.getDictionaryBatch(e))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}}class EO extends ey{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(t,e){super(t,e.version()),this._footer=e}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){const e=this._footer.recordBatches(t);if(e)return Jc.decode(e)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){const e=this._footer.dictionaries(t);if(e)return Jc.decode(e)}return null}}class Jc{static decode(t){return new Jc(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,e){const{metaDataLength:r}=e,s=BigInt(e.offset),o=BigInt(e.bodyLength);return K0.createBlock(t,s,r,o)}constructor(t,e,r){this.metaDataLength=t,this.offset=gs(r),this.bodyLength=gs(e)}}const qn=Object.freeze({done:!0,value:void 0});class $v{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class sx{tee(){return this._getDOMStream().tee()}pipe(t,e){return this._getNodeStream().pipe(t,e)}pipeTo(t,e){return this._getDOMStream().pipeTo(t,e)}pipeThrough(t,e){return this._getDOMStream().pipeThrough(t,e)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class TO extends sx{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}get closed(){return this._closedPromise}cancel(t){return Ne(this,void 0,void 0,function*(){yield this.return(t)})}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){const{resolvers:t}=this;for(;t.length>0;)t.shift().resolve(qn);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return Ci.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return Ci.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return Ne(this,void 0,void 0,function*(){return yield this.abort(t),qn})}return(t){return Ne(this,void 0,void 0,function*(){return yield this.close(),qn})}read(t){return Ne(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return Ne(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((e,r)=>{this.resolvers.push({resolve:e,reject:r})}):Promise.resolve(qn)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class IO extends TO{write(t){if((t=bn(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?Y0(this.toUint8Array(!0)):this.toUint8Array(!1).then(Y0)}toUint8Array(t=!1){return t?ia(this._values)[0]:Ne(this,void 0,void 0,function*(){var e,r,s,o;const f=[];let c=0;try{for(var l=!0,d=Rc(this),p;p=yield d.next(),e=p.done,!e;l=!0){o=p.value,l=!1;const w=o;f.push(w),c+=w.byteLength}}catch(w){r={error:w}}finally{try{!l&&!e&&(s=d.return)&&(yield s.call(d))}finally{if(r)throw r.error}}return ia(f,c)[0]})}}class pp{constructor(t){t&&(this.source=new OO(Ci.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class Qc{constructor(t){t instanceof Qc?this.source=t.source:t instanceof IO?this.source=new Jf(Ci.fromAsyncIterable(t)):U1(t)?this.source=new Jf(Ci.fromNodeStream(t)):Ig(t)?this.source=new Jf(Ci.fromDOMStream(t)):P1(t)?this.source=new Jf(Ci.fromDOMStream(t.body)):zp(t)?this.source=new Jf(Ci.fromIterable(t)):qh(t)?this.source=new Jf(Ci.fromAsyncIterable(t)):Tg(t)&&(this.source=new Jf(Ci.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class OO{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,e="read"){return this.source.next({cmd:e,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||qn)}return(t){return Object.create(this.source.return&&this.source.return(t)||qn)}}class Jf{constructor(t){this.source=t,this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}cancel(t){return Ne(this,void 0,void 0,function*(){yield this.return(t)})}get closed(){return this._closedPromise}read(t){return Ne(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return Ne(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(t,e="read"){return Ne(this,void 0,void 0,function*(){return yield this.source.next({cmd:e,size:t})})}throw(t){return Ne(this,void 0,void 0,function*(){const e=this.source.throw&&(yield this.source.throw(t))||qn;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)})}return(t){return Ne(this,void 0,void 0,function*(){const e=this.source.return&&(yield this.source.return(t))||qn;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)})}}class Vv extends pp{constructor(t,e){super(),this.position=0,this.buffer=bn(t),this.size=e===void 0?this.buffer.byteLength:e}readInt32(t){const{buffer:e,byteOffset:r}=this.readAt(t,4);return new DataView(e,r).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){const{buffer:e,size:r,position:s}=this;return e&&s<r?(typeof t!="number"&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(r,s+Math.min(r-s,t)),e.subarray(s,this.position)):null}readAt(t,e){const r=this.buffer,s=Math.min(this.size,t+e);return r?r.subarray(t,s):new Uint8Array(e)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}}class mp extends Qc{constructor(t,e){super(),this.position=0,this._handle=t,typeof e=="number"?this.size=e:this._pending=Ne(this,void 0,void 0,function*(){this.size=(yield t.stat()).size,delete this._pending})}readInt32(t){return Ne(this,void 0,void 0,function*(){const{buffer:e,byteOffset:r}=yield this.readAt(t,4);return new DataView(e,r).getInt32(0,!0)})}seek(t){return Ne(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size})}read(t){return Ne(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:e,size:r,position:s}=this;if(e&&s<r){typeof t!="number"&&(t=Number.POSITIVE_INFINITY);let o=s,f=0,c=0;const l=Math.min(r,o+Math.min(r-o,t)),d=new Uint8Array(Math.max(0,(this.position=l)-o));for(;(o+=c)<l&&(f+=c)<d.byteLength;)({bytesRead:c}=yield e.read(d,f,d.byteLength-f,o));return d}return null})}readAt(t,e){return Ne(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:r,size:s}=this;if(r&&t+e<s){const o=Math.min(s,t+e),f=new Uint8Array(o-t);return(yield r.read(f,0,e,t)).buffer}return new Uint8Array(e)})}close(){return Ne(this,void 0,void 0,function*(){const t=this._handle;this._handle=null,t&&(yield t.close())})}throw(t){return Ne(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}return(t){return Ne(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}}const BO=65536;function Tc(n){return n<0&&(n=4294967295+n+1),`0x${n.toString(16)}`}const tl=8,ny=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class ax{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){const e=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),r=new Uint32Array([t.buffer[1]>>>16,t.buffer[1]&65535,t.buffer[0]>>>16,t.buffer[0]&65535]);let s=e[3]*r[3];this.buffer[0]=s&65535;let o=s>>>16;return s=e[2]*r[3],o+=s,s=e[3]*r[2]>>>0,o+=s,this.buffer[0]+=o<<16,this.buffer[1]=o>>>0<s?BO:0,this.buffer[1]+=o>>>16,this.buffer[1]+=e[1]*r[3]+e[2]*r[2]+e[3]*r[1],this.buffer[1]+=e[0]*r[3]+e[1]*r[2]+e[2]*r[1]+e[3]*r[0]<<16,this}_plus(t){const e=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],e<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=e}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${Tc(this.buffer[1])} ${Tc(this.buffer[0])}`}}class In extends ax{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,e=new Uint32Array(2)){return In.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return In.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const r=t.length,s=new In(e);for(let o=0;o<r;){const f=tl<r-o?tl:r-o,c=new In(new Uint32Array([Number.parseInt(t.slice(o,o+f),10),0])),l=new In(new Uint32Array([ny[f],0]));s.times(l),s.plus(c),o+=f}return s}static convertArray(t){const e=new Uint32Array(t.length*2);for(let r=-1,s=t.length;++r<s;)In.from(t[r],new Uint32Array(e.buffer,e.byteOffset+2*r*4,2));return e}static multiply(t,e){return new In(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new In(new Uint32Array(t.buffer)).plus(e)}}class ei extends ax{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){const e=this.buffer[1]<<0,r=t.buffer[1]<<0;return e<r||e===r&&this.buffer[0]<t.buffer[0]}static from(t,e=new Uint32Array(2)){return ei.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return ei.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const r=t.startsWith("-"),s=t.length,o=new ei(e);for(let f=r?1:0;f<s;){const c=tl<s-f?tl:s-f,l=new ei(new Uint32Array([Number.parseInt(t.slice(f,f+c),10),0])),d=new ei(new Uint32Array([ny[c],0]));o.times(d),o.plus(l),f+=c}return r?o.negate():o}static convertArray(t){const e=new Uint32Array(t.length*2);for(let r=-1,s=t.length;++r<s;)ei.from(t[r],new Uint32Array(e.buffer,e.byteOffset+2*r*4,2));return e}static multiply(t,e){return new ei(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new ei(new Uint32Array(t.buffer)).plus(e)}}class js{constructor(t){this.buffer=t}high(){return new ei(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new ei(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(t){const e=new In(new Uint32Array([this.buffer[3],0])),r=new In(new Uint32Array([this.buffer[2],0])),s=new In(new Uint32Array([this.buffer[1],0])),o=new In(new Uint32Array([this.buffer[0],0])),f=new In(new Uint32Array([t.buffer[3],0])),c=new In(new Uint32Array([t.buffer[2],0])),l=new In(new Uint32Array([t.buffer[1],0])),d=new In(new Uint32Array([t.buffer[0],0]));let p=In.multiply(o,d);this.buffer[0]=p.low();const w=new In(new Uint32Array([p.high(),0]));return p=In.multiply(s,d),w.plus(p),p=In.multiply(o,l),w.plus(p),this.buffer[1]=w.low(),this.buffer[3]=w.lessThan(p)?1:0,this.buffer[2]=w.high(),new In(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(In.multiply(r,d)).plus(In.multiply(s,l)).plus(In.multiply(o,c)),this.buffer[3]+=In.multiply(e,d).plus(In.multiply(r,l)).plus(In.multiply(s,c)).plus(In.multiply(o,f)).low(),this}plus(t){const e=new Uint32Array(4);return e[3]=this.buffer[3]+t.buffer[3]>>>0,e[2]=this.buffer[2]+t.buffer[2]>>>0,e[1]=this.buffer[1]+t.buffer[1]>>>0,e[0]=this.buffer[0]+t.buffer[0]>>>0,e[0]<this.buffer[0]>>>0&&++e[1],e[1]<this.buffer[1]>>>0&&++e[2],e[2]<this.buffer[2]>>>0&&++e[3],this.buffer[3]=e[3],this.buffer[2]=e[2],this.buffer[1]=e[1],this.buffer[0]=e[0],this}hex(){return`${Tc(this.buffer[3])} ${Tc(this.buffer[2])} ${Tc(this.buffer[1])} ${Tc(this.buffer[0])}`}static multiply(t,e){return new js(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new js(new Uint32Array(t.buffer)).plus(e)}static from(t,e=new Uint32Array(4)){return js.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(4)){return js.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(4)){const r=t.startsWith("-"),s=t.length,o=new js(e);for(let f=r?1:0;f<s;){const c=tl<s-f?tl:s-f,l=new js(new Uint32Array([Number.parseInt(t.slice(f,f+c),10),0,0,0])),d=new js(new Uint32Array([ny[c],0,0,0]));o.times(d),o.plus(l),f+=c}return r?o.negate():o}static convertArray(t){const e=new Uint32Array(t.length*4);for(let r=-1,s=t.length;++r<s;)js.from(t[r],new Uint32Array(e.buffer,e.byteOffset+4*4*r,4));return e}}class ox extends ln{constructor(t,e,r,s){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=e,this.buffers=r,this.dictionaries=s}visit(t){return super.visit(t instanceof gn?t.type:t)}visitNull(t,{length:e}=this.nextFieldNode()){return Te({type:t,length:e})}visitBool(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitInt(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitFloat(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitUtf8(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitDate(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitTimestamp(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitTime(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitDecimal(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitList(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),children:this.visitMany(t.children)})}visitUnion(t){return t.mode===ms.Sparse?this.visitSparseUnion(t):this.visitDenseUnion(t)}visitDenseUnion(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitFixedSizeList(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),child:this.visit(t.children[0])})}visitMap(t,{length:e,nullCount:r}=this.nextFieldNode()){return Te({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,e,r=this.nextBufferRange()){return e>0&&this.readData(t,r)||new Uint8Array(0)}readOffsets(t,e){return this.readData(t,e)}readTypeIds(t,e){return this.readData(t,e)}readData(t,{length:e,offset:r}=this.nextBufferRange()){return this.bytes.subarray(r,r+e)}readDictionary(t){return this.dictionaries.get(t.id)}}class MO extends ox{constructor(t,e,r,s){super(new Uint8Array(0),e,r,s),this.sources=t}readNullBitmap(t,e,{offset:r}=this.nextBufferRange()){return e<=0?new Uint8Array(0):q0(this.sources[r])}readOffsets(t,{offset:e}=this.nextBufferRange()){return Ln(Uint8Array,Ln(Int32Array,this.sources[e]))}readTypeIds(t,{offset:e}=this.nextBufferRange()){return Ln(Uint8Array,Ln(t.ArrayType,this.sources[e]))}readData(t,{offset:e}=this.nextBufferRange()){const{sources:r}=this;return Re.isTimestamp(t)||(Re.isInt(t)||Re.isTime(t))&&t.bitWidth===64||Re.isDate(t)&&t.unit===sa.MILLISECOND?Ln(Uint8Array,ei.convertArray(r[e])):Re.isDecimal(t)?Ln(Uint8Array,js.convertArray(r[e])):Re.isBinary(t)||Re.isFixedSizeBinary(t)?LO(r[e]):Re.isBool(t)?q0(r[e]):Re.isUtf8(t)?Pp(r[e].join("")):Ln(Uint8Array,Ln(t.ArrayType,r[e].map(s=>+s)))}}function LO(n){const t=n.join(""),e=new Uint8Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r>>1]=Number.parseInt(t.slice(r,r+2),16);return e}class fx extends jp{constructor(t){super(t),this._values=new Vp(new Uint8Array(0))}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,e){return super.setValue(t,bn(e))}_flushPending(t,e){const r=this._offsets,s=this._values.reserve(e).buffer;let o=0;for(const[f,c]of t)if(c===void 0)r.set(f,0);else{const l=c.length;s.set(c,o),r.set(f,l),o+=l}}}class RO extends si{constructor(t){super(t),this._values=new tx}setValue(t,e){this._values.set(t,+e)}}class Wp extends nf{}Wp.prototype._setValue=gw;class ux extends Wp{}ux.prototype._setValue=kg;class cx extends Wp{}cx.prototype._setValue=Pg;class lx extends nf{}lx.prototype._setValue=bw;class NO extends si{constructor({type:t,nullValues:e,dictionaryHashFunction:r}){super({type:new aa(t.dictionary,t.indices,t.id,t.isOrdered)}),this._nulls=null,this._dictionaryOffset=0,this._keysToIndices=Object.create(null),this.indices=gp({type:this.type.indices,nullValues:e}),this.dictionary=gp({type:this.type.dictionary,nullValues:null}),typeof r=="function"&&(this.valueToKey=r)}get values(){return this.indices.values}get nullCount(){return this.indices.nullCount}get nullBitmap(){return this.indices.nullBitmap}get byteLength(){return this.indices.byteLength+this.dictionary.byteLength}get reservedLength(){return this.indices.reservedLength+this.dictionary.reservedLength}get reservedByteLength(){return this.indices.reservedByteLength+this.dictionary.reservedByteLength}isValid(t){return this.indices.isValid(t)}setValid(t,e){const r=this.indices;return e=r.setValid(t,e),this.length=r.length,e}setValue(t,e){const r=this._keysToIndices,s=this.valueToKey(e);let o=r[s];return o===void 0&&(r[s]=o=this._dictionaryOffset+this.dictionary.append(e).length-1),this.indices.setValue(t,o)}flush(){const t=this.type,e=this._dictionary,r=this.dictionary.toVector(),s=this.indices.flush().clone(t);return s.dictionary=e?e.concat(r):r,this.finished||(this._dictionaryOffset+=r.length),this._dictionary=s.dictionary,this.clear(),s}finish(){return this.indices.finish(),this.dictionary.finish(),this._dictionaryOffset=0,this._keysToIndices=Object.create(null),super.finish()}clear(){return this.indices.clear(),this.dictionary.clear(),super.clear()}valueToKey(t){return typeof t=="string"?t:`${t}`}}class hx extends nf{}hx.prototype._setValue=mw;class DO extends si{setValue(t,e){const[r]=this.children,s=t*this.stride;for(let o=-1,f=e.length;++o<f;)r.set(s+o,e[o])}addChild(t,e="0"){if(this.numChildren>0)throw new Error("FixedSizeListBuilder can only have one child.");const r=this.children.push(t);return this.type=new ed(this.type.listSize,new gn(e,t.type,!0)),r}}class Yp extends nf{setValue(t,e){this._values.set(t,e)}}class FO extends Yp{setValue(t,e){super.setValue(t,dw(e))}}class CO extends Yp{}class kO extends Yp{}class Hp extends nf{}Hp.prototype._setValue=Sw;class dx extends Hp{}dx.prototype._setValue=Hg;class _x extends Hp{}_x.prototype._setValue=Xg;class uo extends nf{setValue(t,e){this._values.set(t,e)}}class PO extends uo{}class zO extends uo{}class UO extends uo{}class GO extends uo{}class $O extends uo{}class VO extends uo{}class jO extends uo{}class WO extends uo{}class YO extends jp{constructor(t){super(t),this._offsets=new ex}addChild(t,e="0"){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=t,this.type=new Hc(new gn(e,t.type,!0)),this.numChildren-1}_flushPending(t){const e=this._offsets,[r]=this.children;for(const[s,o]of t)if(typeof o>"u")e.set(s,0);else{const f=o,c=f.length,l=e.set(s,c).buffer[s];for(let d=-1;++d<c;)r.set(l+d,f[d])}}}class HO extends jp{set(t,e){return super.set(t,e)}setValue(t,e){const r=e instanceof Map?e:new Map(Object.entries(e)),s=this._pending||(this._pending=new Map),o=s.get(t);o&&(this._pendingLength-=o.size),this._pendingLength+=r.size,s.set(t,r)}addChild(t,e=`${this.numChildren}`){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=t,this.type=new nd(new gn(e,t.type,!0),this.type.keysSorted),this.numChildren-1}_flushPending(t){const e=this._offsets,[r]=this.children;for(const[s,o]of t)if(o===void 0)e.set(s,0);else{let{[s]:f,[s+1]:c}=e.set(s,o.size).buffer;for(const l of o.entries())if(r.set(f,l),++f>=c)break}}}class XO extends si{setValue(t,e){}setValid(t,e){return this.length=Math.max(t+1,this.length),e}}class qO extends si{setValue(t,e){const{children:r,type:s}=this;switch(Array.isArray(e)||e.constructor){case!0:return s.children.forEach((o,f)=>r[f].set(t,e[f]));case Map:return s.children.forEach((o,f)=>r[f].set(t,e.get(o.name)));default:return s.children.forEach((o,f)=>r[f].set(t,e[o.name]))}}setValid(t,e){return super.setValid(t,e)||this.children.forEach(r=>r.setValid(t,e)),e}addChild(t,e=`${this.numChildren}`){const r=this.children.push(t);return this.type=new Lr([...this.type.children,new gn(e,t.type,!0)]),r}}class il extends nf{}il.prototype._setValue=yw;class px extends il{}px.prototype._setValue=zg;class mx extends il{}mx.prototype._setValue=Ug;class gx extends il{}gx.prototype._setValue=Gg;class yx extends il{}yx.prototype._setValue=$g;class sl extends nf{}sl.prototype._setValue=vw;class vx extends sl{}vx.prototype._setValue=Vg;class bx extends sl{}bx.prototype._setValue=jg;class wx extends sl{}wx.prototype._setValue=Wg;class xx extends sl{}xx.prototype._setValue=Yg;class ry extends si{constructor(t){super(t),this._typeIds=new sd(new Int8Array(0),1),typeof t.valueToChildTypeId=="function"&&(this._valueToChildTypeId=t.valueToChildTypeId)}get typeIdToChildIndex(){return this.type.typeIdToChildIndex}append(t,e){return this.set(this.length,t,e)}set(t,e,r){return r===void 0&&(r=this._valueToChildTypeId(this,e,t)),this.setValid(t,this.isValid(e))&&this.setValue(t,e,r),this}setValue(t,e,r){this._typeIds.set(t,r);const s=this.type.typeIdToChildIndex[r],o=this.children[s];o==null||o.set(t,e)}addChild(t,e=`${this.children.length}`){const r=this.children.push(t),{type:{children:s,mode:o,typeIds:f}}=this,c=[...s,new gn(e,t.type)];return this.type=new td(o,[...f,r],c),r}_valueToChildTypeId(t,e,r){throw new Error("Cannot map UnionBuilder value to child typeId. Pass the `childTypeId` as the second argument to unionBuilder.append(), or supply a `valueToChildTypeId` function as part of the UnionBuilder constructor options.")}}class ZO extends ry{}class KO extends ry{constructor(t){super(t),this._offsets=new sd(new Int32Array(0))}setValue(t,e,r){const s=this._typeIds.set(t,r).buffer[t],o=this.getChildAt(this.type.typeIdToChildIndex[s]),f=this._offsets.set(t,o.length).buffer[t];o==null||o.set(f,e)}}class Sx extends jp{constructor(t){super(t),this._values=new Vp(new Uint8Array(0))}get byteLength(){let t=this._pendingLength+this.length*4;return this._offsets&&(t+=this._offsets.byteLength),this._values&&(t+=this._values.byteLength),this._nulls&&(t+=this._nulls.byteLength),t}setValue(t,e){return super.setValue(t,Pp(e))}_flushPending(t,e){}}Sx.prototype._flushPending=fx.prototype._flushPending;class JO extends ln{visitNull(){return XO}visitBool(){return RO}visitInt(){return uo}visitInt8(){return PO}visitInt16(){return zO}visitInt32(){return UO}visitInt64(){return GO}visitUint8(){return $O}visitUint16(){return VO}visitUint32(){return jO}visitUint64(){return WO}visitFloat(){return Yp}visitFloat16(){return FO}visitFloat32(){return CO}visitFloat64(){return kO}visitUtf8(){return Sx}visitBinary(){return fx}visitFixedSizeBinary(){return hx}visitDate(){return Wp}visitDateDay(){return ux}visitDateMillisecond(){return cx}visitTimestamp(){return il}visitTimestampSecond(){return px}visitTimestampMillisecond(){return mx}visitTimestampMicrosecond(){return gx}visitTimestampNanosecond(){return yx}visitTime(){return sl}visitTimeSecond(){return vx}visitTimeMillisecond(){return bx}visitTimeMicrosecond(){return wx}visitTimeNanosecond(){return xx}visitDecimal(){return lx}visitList(){return YO}visitStruct(){return qO}visitUnion(){return ry}visitDenseUnion(){return KO}visitSparseUnion(){return ZO}visitDictionary(){return NO}visitInterval(){return Hp}visitIntervalDayTime(){return dx}visitIntervalYearMonth(){return _x}visitFixedSizeList(){return DO}visitMap(){return HO}}const QO=new JO;class Pe extends ln{compareSchemas(t,e){return t===e||e instanceof t.constructor&&this.compareManyFields(t.fields,e.fields)}compareManyFields(t,e){return t===e||Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((r,s)=>this.compareFields(r,e[s]))}compareFields(t,e){return t===e||e instanceof t.constructor&&t.name===e.name&&t.nullable===e.nullable&&this.visit(t.type,e.type)}}function ai(n,t){return t instanceof n.constructor}function ad(n,t){return n===t||ai(n,t)}function co(n,t){return n===t||ai(n,t)&&n.bitWidth===t.bitWidth&&n.isSigned===t.isSigned}function Xp(n,t){return n===t||ai(n,t)&&n.precision===t.precision}function t7(n,t){return n===t||ai(n,t)&&n.byteWidth===t.byteWidth}function iy(n,t){return n===t||ai(n,t)&&n.unit===t.unit}function od(n,t){return n===t||ai(n,t)&&n.unit===t.unit&&n.timezone===t.timezone}function fd(n,t){return n===t||ai(n,t)&&n.unit===t.unit&&n.bitWidth===t.bitWidth}function e7(n,t){return n===t||ai(n,t)&&n.children.length===t.children.length&&ao.compareManyFields(n.children,t.children)}function n7(n,t){return n===t||ai(n,t)&&n.children.length===t.children.length&&ao.compareManyFields(n.children,t.children)}function sy(n,t){return n===t||ai(n,t)&&n.mode===t.mode&&n.typeIds.every((e,r)=>e===t.typeIds[r])&&ao.compareManyFields(n.children,t.children)}function r7(n,t){return n===t||ai(n,t)&&n.id===t.id&&n.isOrdered===t.isOrdered&&ao.visit(n.indices,t.indices)&&ao.visit(n.dictionary,t.dictionary)}function ay(n,t){return n===t||ai(n,t)&&n.unit===t.unit}function i7(n,t){return n===t||ai(n,t)&&n.listSize===t.listSize&&n.children.length===t.children.length&&ao.compareManyFields(n.children,t.children)}function s7(n,t){return n===t||ai(n,t)&&n.keysSorted===t.keysSorted&&n.children.length===t.children.length&&ao.compareManyFields(n.children,t.children)}Pe.prototype.visitNull=ad;Pe.prototype.visitBool=ad;Pe.prototype.visitInt=co;Pe.prototype.visitInt8=co;Pe.prototype.visitInt16=co;Pe.prototype.visitInt32=co;Pe.prototype.visitInt64=co;Pe.prototype.visitUint8=co;Pe.prototype.visitUint16=co;Pe.prototype.visitUint32=co;Pe.prototype.visitUint64=co;Pe.prototype.visitFloat=Xp;Pe.prototype.visitFloat16=Xp;Pe.prototype.visitFloat32=Xp;Pe.prototype.visitFloat64=Xp;Pe.prototype.visitUtf8=ad;Pe.prototype.visitBinary=ad;Pe.prototype.visitFixedSizeBinary=t7;Pe.prototype.visitDate=iy;Pe.prototype.visitDateDay=iy;Pe.prototype.visitDateMillisecond=iy;Pe.prototype.visitTimestamp=od;Pe.prototype.visitTimestampSecond=od;Pe.prototype.visitTimestampMillisecond=od;Pe.prototype.visitTimestampMicrosecond=od;Pe.prototype.visitTimestampNanosecond=od;Pe.prototype.visitTime=fd;Pe.prototype.visitTimeSecond=fd;Pe.prototype.visitTimeMillisecond=fd;Pe.prototype.visitTimeMicrosecond=fd;Pe.prototype.visitTimeNanosecond=fd;Pe.prototype.visitDecimal=ad;Pe.prototype.visitList=e7;Pe.prototype.visitStruct=n7;Pe.prototype.visitUnion=sy;Pe.prototype.visitDenseUnion=sy;Pe.prototype.visitSparseUnion=sy;Pe.prototype.visitDictionary=r7;Pe.prototype.visitInterval=ay;Pe.prototype.visitIntervalDayTime=ay;Pe.prototype.visitIntervalYearMonth=ay;Pe.prototype.visitFixedSizeList=i7;Pe.prototype.visitMap=s7;const ao=new Pe;function a7(n,t){return ao.compareSchemas(n,t)}function o7(n,t){return ao.visit(n,t)}function gp(n){const t=n.type,e=new(QO.getVisitFn(t)())(n);if(t.children&&t.children.length>0){const r=n.children||[],s={nullValues:n.nullValues},o=Array.isArray(r)?(f,c)=>r[c]||s:({name:f})=>r[f]||s;for(const[f,c]of t.children.entries()){const{type:l}=c,d=o(c,f);e.children.push(gp(Object.assign(Object.assign({},d),{type:l})))}}return e}function Ax(n,t){if(n instanceof On||n instanceof Ie||n.type instanceof Re||ArrayBuffer.isView(n))return tu(n);const e={type:t??L_(n),nullValues:[null]},r=[...f7(e)(n)],s=r.length===1?r[0]:r.reduce((o,f)=>o.concat(f));return Re.isDictionary(s.type)?s.memoize():s}function L_(n){if(n.length===0)return new so;let t=0,e=0,r=0,s=0,o=0,f=0,c=0,l=0;for(const d of n){if(d==null){++t;continue}switch(typeof d){case"bigint":++f;continue;case"boolean":++c;continue;case"number":++s;continue;case"string":++o;continue;case"object":Array.isArray(d)?++e:Object.prototype.toString.call(d)==="[object Date]"?++l:++r;continue}throw new TypeError("Unable to infer Vector type from input values, explicit type declaration expected.")}if(s+t===n.length)return new Dg;if(o+t===n.length)return new aa(new Wc,new Qo);if(f+t===n.length)return new Up;if(c+t===n.length)return new Yc;if(l+t===n.length)return new a2;if(e+t===n.length){const d=n,p=L_(d[d.findIndex(w=>w!=null)]);if(d.every(w=>w==null||o7(p,L_(w))))return new Hc(new gn("",p,!0))}else if(r+t===n.length){const d=new Map;for(const p of n)for(const w of Object.keys(p))!d.has(w)&&p[w]!=null&&d.set(w,new gn(w,L_([p[w]]),!0));return new Lr([...d.values()])}throw new TypeError("Unable to infer Vector type from input values, explicit type declaration expected.")}function f7(n){const{["queueingStrategy"]:t="count"}=n,{["highWaterMark"]:e=t!=="bytes"?Number.POSITIVE_INFINITY:Math.pow(2,14)}=n,r=t!=="bytes"?"length":"byteLength";return function*(s){let o=0;const f=gp(n);for(const c of s)f.append(c)[r]>=e&&++o&&(yield f.toVector());(f.finish().length>0||o===0)&&(yield f.toVector())}}function d0(n,t){return u7(n,t.map(e=>e.data.concat()))}function u7(n,t){const e=[...n.fields],r=[],s={numBatches:t.reduce((w,I)=>Math.max(w,I.length),0)};let o=0,f=0,c=-1;const l=t.length;let d,p=[];for(;s.numBatches-- >0;){for(f=Number.POSITIVE_INFINITY,c=-1;++c<l;)p[c]=d=t[c].shift(),f=Math.min(f,d?d.length:f);Number.isFinite(f)&&(p=c7(e,f,p,t,s),f>0&&(r[o++]=Te({type:new Lr(e),length:f,nullCount:0,children:p.slice()})))}return[n=n.assign(e),r.map(w=>new zi(n,w))]}function c7(n,t,e,r,s){var o;const f=(t+63&-64)>>3;for(let c=-1,l=r.length;++c<l;){const d=e[c],p=d==null?void 0:d.length;if(p>=t)p===t?e[c]=d:(e[c]=d.slice(0,t),s.numBatches=Math.max(s.numBatches,r[c].unshift(d.slice(t,p-t))));else{const w=n[c];n[c]=w.clone({nullable:!0}),e[c]=(o=d==null?void 0:d._changeLengthAndBackfillNullBitmap(t))!==null&&o!==void 0?o:Te({type:w.type,length:t,nullCount:t,nullBitmap:new Uint8Array(f)})}}return e}var Ex;class Si{constructor(...t){var e,r;if(t.length===0)return this.batches=[],this.schema=new An([]),this._offsets=[0],this;let s,o;t[0]instanceof An&&(s=t.shift()),t.at(-1)instanceof Uint32Array&&(o=t.pop());const f=l=>{if(l){if(l instanceof zi)return[l];if(l instanceof Si)return l.batches;if(l instanceof On){if(l.type instanceof Lr)return[new zi(new An(l.type.children),l)]}else{if(Array.isArray(l))return l.flatMap(d=>f(d));if(typeof l[Symbol.iterator]=="function")return[...l].flatMap(d=>f(d));if(typeof l=="object"){const d=Object.keys(l),p=d.map(C=>new Ie([l[C]])),w=new An(d.map((C,V)=>new gn(String(C),p[V].type))),[,I]=d0(w,p);return I.length===0?[new zi(l)]:I}}}return[]},c=t.flatMap(l=>f(l));if(s=(r=s??((e=c[0])===null||e===void 0?void 0:e.schema))!==null&&r!==void 0?r:new An([]),!(s instanceof An))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const l of c){if(!(l instanceof zi))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!a7(s,l.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=s,this.batches=c,this._offsets=o??jw(this.data)}get data(){return this.batches.map(({data:t})=>t)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((t,e)=>t+e.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=Vw(this.data)),this._nullCount}isValid(t){return!1}get(t){return null}set(t,e){}indexOf(t,e){return-1}getByteLength(t){return 0}[Symbol.iterator](){return this.batches.length>0?ty.visit(new Ie(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...t){const e=this.schema,r=this.data.concat(t.flatMap(({data:s})=>s));return new Si(e,r.map(s=>new zi(e,s)))}slice(t,e){const r=this.schema;[t,e]=Gw({length:this.numRows},t,e);const s=Ww(this.data,this._offsets,t,e);return new Si(r,s.map(o=>new zi(r,o)))}getChild(t){return this.getChildAt(this.schema.fields.findIndex(e=>e.name===t))}getChildAt(t){if(t>-1&&t<this.schema.fields.length){const e=this.data.map(r=>r.children[t]);if(e.length===0){const{type:r}=this.schema.fields[t],s=Te({type:r,length:0,nullCount:0});e.push(s._changeLengthAndBackfillNullBitmap(this.numRows))}return new Ie(e)}return null}setChild(t,e){var r;return this.setChildAt((r=this.schema.fields)===null||r===void 0?void 0:r.findIndex(s=>s.name===t),e)}setChildAt(t,e){let r=this.schema,s=[...this.batches];if(t>-1&&t<this.numCols){e||(e=new Ie([Te({type:new so,length:this.numRows})]));const o=r.fields.slice(),f=o[t].clone({type:e.type}),c=this.schema.fields.map((l,d)=>this.getChildAt(d));[o[t],c[t]]=[f,e],[r,s]=d0(r,c)}return new Si(r,s)}select(t){const e=this.schema.fields.reduce((r,s,o)=>r.set(s.name,o),new Map);return this.selectAt(t.map(r=>e.get(r)).filter(r=>r>-1))}selectAt(t){const e=this.schema.selectAt(t),r=this.batches.map(s=>s.selectAt(t));return new Si(e,r)}assign(t){const e=this.schema.fields,[r,s]=t.schema.fields.reduce((c,l,d)=>{const[p,w]=c,I=e.findIndex(C=>C.name===l.name);return~I?w[I]=d:p.push(d),c},[[],[]]),o=this.schema.assign(t.schema),f=[...e.map((c,l)=>[l,s[l]]).map(([c,l])=>l===void 0?this.getChildAt(c):t.getChildAt(l)),...r.map(c=>t.getChildAt(c))].filter(Boolean);return new Si(...d0(o,f))}}Ex=Symbol.toStringTag;Si[Ex]=(n=>(n.schema=null,n.batches=[],n._offsets=new Uint32Array([0]),n._nullCount=-1,n[Symbol.isConcatSpreadable]=!0,n.isValid=kc(Qg),n.get=kc(ii.getVisitFn(Q.Struct)),n.set=Yw(Vi.getVisitFn(Q.Struct)),n.indexOf=Hw(fp.getVisitFn(Q.Struct)),n.getByteLength=kc(oa.getVisitFn(Q.Struct)),"Table"))(Si.prototype);var Tx;let zi=class kh{constructor(...t){switch(t.length){case 2:{if([this.schema]=t,!(this.schema instanceof An))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=Te({nullCount:0,type:new Lr(this.schema.fields),children:this.schema.fields.map(e=>Te({type:e.type,nullCount:0}))})]=t,!(this.data instanceof On))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=jv(this.schema,this.data.children);break}case 1:{const[e]=t,{fields:r,children:s,length:o}=Object.keys(e).reduce((l,d,p)=>(l.children[p]=e[d],l.length=Math.max(l.length,e[d].length),l.fields[p]=gn.new({name:d,type:e[d].type,nullable:!0}),l),{length:0,fields:new Array,children:new Array}),f=new An(r),c=Te({type:new Lr(r),length:o,children:s,nullCount:0});[this.schema,this.data]=jv(f,c.children,o);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=Ix(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(t){return this.data.getValid(t)}get(t){return ii.visit(this.data,t)}set(t,e){return Vi.visit(this.data,t,e)}indexOf(t,e){return fp.visit(this.data,t,e)}getByteLength(t){return oa.visit(this.data,t)}[Symbol.iterator](){return ty.visit(new Ie([this.data]))}toArray(){return[...this]}concat(...t){return new Si(this.schema,[this,...t])}slice(t,e){const[r]=new Ie([this.data]).slice(t,e).data;return new kh(this.schema,r)}getChild(t){var e;return this.getChildAt((e=this.schema.fields)===null||e===void 0?void 0:e.findIndex(r=>r.name===t))}getChildAt(t){return t>-1&&t<this.schema.fields.length?new Ie([this.data.children[t]]):null}setChild(t,e){var r;return this.setChildAt((r=this.schema.fields)===null||r===void 0?void 0:r.findIndex(s=>s.name===t),e)}setChildAt(t,e){let r=this.schema,s=this.data;if(t>-1&&t<this.numCols){e||(e=new Ie([Te({type:new so,length:this.numRows})]));const o=r.fields.slice(),f=s.children.slice(),c=o[t].clone({type:e.type});[o[t],f[t]]=[c,e.data[0]],r=new An(o,new Map(this.schema.metadata)),s=Te({type:new Lr(o),children:f})}return new kh(r,s)}select(t){const e=this.schema.select(t),r=new Lr(e.fields),s=[];for(const o of t){const f=this.schema.fields.findIndex(c=>c.name===o);~f&&(s[f]=this.data.children[f])}return new kh(e,Te({type:r,length:this.numRows,children:s}))}selectAt(t){const e=this.schema.selectAt(t),r=t.map(o=>this.data.children[o]).filter(Boolean),s=Te({type:new Lr(e.fields),length:this.numRows,children:r});return new kh(e,s)}};Tx=Symbol.toStringTag;zi[Tx]=(n=>(n._nullCount=-1,n[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(zi.prototype);function jv(n,t,e=t.reduce((r,s)=>Math.max(r,s.length),0)){var r;const s=[...n.fields],o=[...t],f=(e+63&-64)>>3;for(const[c,l]of n.fields.entries()){const d=t[c];(!d||d.length!==e)&&(s[c]=l.clone({nullable:!0}),o[c]=(r=d==null?void 0:d._changeLengthAndBackfillNullBitmap(e))!==null&&r!==void 0?r:Te({type:l.type,length:e,nullCount:e,nullBitmap:new Uint8Array(f)}))}return[n.assign(s),Te({type:new Lr(s),length:e,children:o})]}function Ix(n,t,e=new Map){for(let r=-1,s=n.length;++r<s;){const f=n[r].type,c=t[r];if(Re.isDictionary(f)){if(!e.has(f.id))c.dictionary&&e.set(f.id,c.dictionary);else if(e.get(f.id)!==c.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}f.children&&f.children.length>0&&Ix(f.children,c.children,e)}return e}class Ox extends zi{constructor(t){const e=t.fields.map(s=>Te({type:s.type})),r=Te({type:new Lr(t.fields),nullCount:0,children:e});super(t,r)}}var yp;(function(n){n[n.BUFFER=0]="BUFFER"})(yp||(yp={}));var vp;(function(n){n[n.LZ4_FRAME=0]="LZ4_FRAME",n[n.ZSTD=1]="ZSTD"})(vp||(vp={}));class Zo{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBodyCompression(t,e){return(e||new Zo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,e){return t.setPosition(t.position()+Nn),(e||new Zo).__init(t.readInt32(t.position())+t.position(),t)}codec(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):vp.LZ4_FRAME}method(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):yp.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,e){t.addFieldInt8(0,e,vp.LZ4_FRAME)}static addMethod(t,e){t.addFieldInt8(1,e,yp.BUFFER)}static endBodyCompression(t){return t.endObject()}static createBodyCompression(t,e,r){return Zo.startBodyCompression(t),Zo.addCodec(t,e),Zo.addMethod(t,r),Zo.endBodyCompression(t)}}class Bx{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,e,r){return t.prep(8,16),t.writeInt64(BigInt(r??0)),t.writeInt64(BigInt(e??0)),t.offset()}}let Mx=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,e,r){return t.prep(8,16),t.writeInt64(BigInt(r??0)),t.writeInt64(BigInt(e??0)),t.offset()}},Ka=class tg{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRecordBatch(t,e){return(e||new tg).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,e){return t.setPosition(t.position()+Nn),(e||new tg).__init(t.readInt32(t.position())+t.position(),t)}length(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}nodes(t,e){const r=this.bb.__offset(this.bb_pos,6);return r?(e||new Mx).__init(this.bb.__vector(this.bb_pos+r)+t*16,this.bb):null}nodesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,e){const r=this.bb.__offset(this.bb_pos,8);return r?(e||new Bx).__init(this.bb.__vector(this.bb_pos+r)+t*16,this.bb):null}buffersLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){const e=this.bb.__offset(this.bb_pos,10);return e?(t||new Zo).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addNodes(t,e){t.addFieldOffset(1,e,0)}static startNodesVector(t,e){t.startVector(16,e,8)}static addBuffers(t,e){t.addFieldOffset(2,e,0)}static startBuffersVector(t,e){t.startVector(16,e,8)}static addCompression(t,e){t.addFieldOffset(3,e,0)}static endRecordBatch(t){return t.endObject()}},Ac=class eg{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryBatch(t,e){return(e||new eg).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,e){return t.setPosition(t.position()+Nn),(e||new eg).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}data(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new Ka).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isDelta(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startDictionaryBatch(t){t.startObject(3)}static addId(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addData(t,e){t.addFieldOffset(1,e,0)}static addIsDelta(t,e){t.addFieldInt8(2,+e,0)}static endDictionaryBatch(t){return t.endObject()}};var bp;(function(n){n[n.NONE=0]="NONE",n[n.Schema=1]="Schema",n[n.DictionaryBatch=2]="DictionaryBatch",n[n.RecordBatch=3]="RecordBatch",n[n.Tensor=4]="Tensor",n[n.SparseTensor=5]="SparseTensor"})(bp||(bp={}));let Xo=class $s{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMessage(t,e){return(e||new $s).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,e){return t.setPosition(t.position()+Nn),(e||new $s).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):qc.V1}headerType(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):bp.NONE}header(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__union(t,this.bb_pos+e):null}bodyLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}customMetadata(t,e){const r=this.bb.__offset(this.bb_pos,12);return r?(e||new gr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,qc.V1)}static addHeaderType(t,e){t.addFieldInt8(1,e,bp.NONE)}static addHeader(t,e){t.addFieldOffset(2,e,0)}static addBodyLength(t,e){t.addFieldInt64(3,e,BigInt("0"))}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endMessage(t){return t.endObject()}static finishMessageBuffer(t,e){t.finish(e)}static finishSizePrefixedMessageBuffer(t,e){t.finish(e,void 0,!0)}static createMessage(t,e,r,s,o,f){return $s.startMessage(t),$s.addVersion(t,e),$s.addHeaderType(t,r),$s.addHeader(t,s),$s.addBodyLength(t,o),$s.addCustomMetadata(t,f),$s.endMessage(t)}};class l7 extends ln{visit(t,e){return t==null||e==null?void 0:super.visit(t,e)}visitNull(t,e){return iu.startNull(e),iu.endNull(e)}visitInt(t,e){return xi.startInt(e),xi.addBitWidth(e,t.bitWidth),xi.addIsSigned(e,t.isSigned),xi.endInt(e)}visitFloat(t,e){return Js.startFloatingPoint(e),Js.addPrecision(e,t.precision),Js.endFloatingPoint(e)}visitBinary(t,e){return eu.startBinary(e),eu.endBinary(e)}visitBool(t,e){return nu.startBool(e),nu.endBool(e)}visitUtf8(t,e){return au.startUtf8(e),au.endUtf8(e)}visitDecimal(t,e){return ni.startDecimal(e),ni.addScale(e,t.scale),ni.addPrecision(e,t.precision),ni.addBitWidth(e,t.bitWidth),ni.endDecimal(e)}visitDate(t,e){return O_.startDate(e),O_.addUnit(e,t.unit),O_.endDate(e)}visitTime(t,e){return ki.startTime(e),ki.addUnit(e,t.unit),ki.addBitWidth(e,t.bitWidth),ki.endTime(e)}visitTimestamp(t,e){const r=t.timezone&&e.createString(t.timezone)||void 0;return Pi.startTimestamp(e),Pi.addUnit(e,t.unit),r!==void 0&&Pi.addTimezone(e,r),Pi.endTimestamp(e)}visitInterval(t,e){return Qs.startInterval(e),Qs.addUnit(e,t.unit),Qs.endInterval(e)}visitList(t,e){return ru.startList(e),ru.endList(e)}visitStruct(t,e){return su.startStruct_(e),su.endStruct_(e)}visitUnion(t,e){ri.startTypeIdsVector(e,t.typeIds.length);const r=ri.createTypeIdsVector(e,t.typeIds);return ri.startUnion(e),ri.addMode(e,t.mode),ri.addTypeIds(e,r),ri.endUnion(e)}visitDictionary(t,e){const r=this.visit(t.indices,e);return Qa.startDictionaryEncoding(e),Qa.addId(e,BigInt(t.id)),Qa.addIsOrdered(e,t.isOrdered),r!==void 0&&Qa.addIndexType(e,r),Qa.endDictionaryEncoding(e)}visitFixedSizeBinary(t,e){return Zs.startFixedSizeBinary(e),Zs.addByteWidth(e,t.byteWidth),Zs.endFixedSizeBinary(e)}visitFixedSizeList(t,e){return Ks.startFixedSizeList(e),Ks.addListSize(e,t.listSize),Ks.endFixedSizeList(e)}visitMap(t,e){return B_.startMap(e),B_.addKeysSorted(e,t.keysSorted),B_.endMap(e)}}const _0=new l7;function h7(n,t=new Map){return new An(_7(n,t),R_(n.customMetadata),t)}function Lx(n){return new ys(n.count,Rx(n.columns),Nx(n.columns))}function d7(n){return new oo(Lx(n.data),n.id,n.isDelta)}function _7(n,t){return(n.fields||[]).filter(Boolean).map(e=>gn.fromJSON(e,t))}function Wv(n,t){return(n.children||[]).filter(Boolean).map(e=>gn.fromJSON(e,t))}function Rx(n){return(n||[]).reduce((t,e)=>[...t,new al(e.count,p7(e.VALIDITY)),...Rx(e.children)],[])}function Nx(n,t=[]){for(let e=-1,r=(n||[]).length;++e<r;){const s=n[e];s.VALIDITY&&t.push(new eo(t.length,s.VALIDITY.length)),s.TYPE&&t.push(new eo(t.length,s.TYPE.length)),s.OFFSET&&t.push(new eo(t.length,s.OFFSET.length)),s.DATA&&t.push(new eo(t.length,s.DATA.length)),t=Nx(s.children,t)}return t}function p7(n){return(n||[]).reduce((t,e)=>t+ +(e===0),0)}function m7(n,t){let e,r,s,o,f,c;return!t||!(o=n.dictionary)?(f=Hv(n,Wv(n,t)),s=new gn(n.name,f,n.nullable,R_(n.customMetadata))):t.has(e=o.id)?(r=(r=o.indexType)?Yv(r):new Qo,c=new aa(t.get(e),r,e,o.isOrdered),s=new gn(n.name,c,n.nullable,R_(n.customMetadata))):(r=(r=o.indexType)?Yv(r):new Qo,t.set(e,f=Hv(n,Wv(n,t))),c=new aa(f,r,e,o.isOrdered),s=new gn(n.name,c,n.nullable,R_(n.customMetadata))),s||null}function R_(n){return new Map(Object.entries(n||{}))}function Yv(n){return new Wr(n.isSigned,n.bitWidth)}function Hv(n,t){const e=n.type.name;switch(e){case"NONE":return new so;case"null":return new so;case"binary":return new rp;case"utf8":return new Wc;case"bool":return new Yc;case"list":return new Hc((t||[])[0]);case"struct":return new Lr(t||[]);case"struct_":return new Lr(t||[])}switch(e){case"int":{const r=n.type;return new Wr(r.isSigned,r.bitWidth)}case"floatingpoint":{const r=n.type;return new mu(Cr[r.precision])}case"decimal":{const r=n.type;return new ip(r.scale,r.precision,r.bitWidth)}case"date":{const r=n.type;return new Jh(sa[r.unit])}case"time":{const r=n.type;return new Qh(wn[r.unit],r.bitWidth)}case"timestamp":{const r=n.type;return new sp(wn[r.unit],r.timezone)}case"interval":{const r=n.type;return new ap(Jo[r.unit])}case"union":{const r=n.type;return new td(ms[r.mode],r.typeIds||[],t||[])}case"fixedsizebinary":{const r=n.type;return new op(r.byteWidth)}case"fixedsizelist":{const r=n.type;return new ed(r.listSize,(t||[])[0])}case"map":{const r=n.type;return new nd((t||[])[0],r.keysSorted)}}throw new Error(`Unrecognized type: "${e}"`)}var g7=rx,y7=Xc;class _s{static fromJSON(t,e){const r=new _s(0,Ui.V4,e);return r._createHeader=v7(t,e),r}static decode(t){t=new y7(bn(t));const e=Xo.getRootAsMessage(t),r=e.bodyLength(),s=e.version(),o=e.headerType(),f=new _s(r,s,o);return f._createHeader=b7(e,o),f}static encode(t){const e=new g7;let r=-1;return t.isSchema()?r=An.encode(e,t.header()):t.isRecordBatch()?r=ys.encode(e,t.header()):t.isDictionaryBatch()&&(r=oo.encode(e,t.header())),Xo.startMessage(e),Xo.addVersion(e,Ui.V4),Xo.addHeader(e,r),Xo.addHeaderType(e,t.headerType),Xo.addBodyLength(e,BigInt(t.bodyLength)),Xo.finishMessageBuffer(e,Xo.endMessage(e)),e.asUint8Array()}static from(t,e=0){if(t instanceof An)return new _s(0,Ui.V4,Mn.Schema,t);if(t instanceof ys)return new _s(e,Ui.V4,Mn.RecordBatch,t);if(t instanceof oo)return new _s(e,Ui.V4,Mn.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===Mn.Schema}isRecordBatch(){return this.headerType===Mn.RecordBatch}isDictionaryBatch(){return this.headerType===Mn.DictionaryBatch}constructor(t,e,r,s){this._version=e,this._headerType=r,this.body=new Uint8Array(0),s&&(this._createHeader=()=>s),this._bodyLength=gs(t)}}class ys{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(t,e,r){this._nodes=e,this._buffers=r,this._length=gs(t)}}class oo{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(t,e,r=!1){this._data=t,this._isDelta=r,this._id=gs(e)}}class eo{constructor(t,e){this.offset=gs(t),this.length=gs(e)}}class al{constructor(t,e){this.length=gs(t),this.nullCount=gs(e)}}function v7(n,t){return()=>{switch(t){case Mn.Schema:return An.fromJSON(n);case Mn.RecordBatch:return ys.fromJSON(n);case Mn.DictionaryBatch:return oo.fromJSON(n)}throw new Error(`Unrecognized Message type: { name: ${Mn[t]}, type: ${t} }`)}}function b7(n,t){return()=>{switch(t){case Mn.Schema:return An.decode(n.header(new Vs));case Mn.RecordBatch:return ys.decode(n.header(new Ka),n.version());case Mn.DictionaryBatch:return oo.decode(n.header(new Ac),n.version())}throw new Error(`Unrecognized Message type: { name: ${Mn[t]}, type: ${t} }`)}}gn.encode=L7;gn.decode=B7;gn.fromJSON=m7;An.encode=M7;An.decode=w7;An.fromJSON=h7;ys.encode=R7;ys.decode=x7;ys.fromJSON=Lx;oo.encode=N7;oo.decode=S7;oo.fromJSON=d7;al.encode=D7;al.decode=E7;eo.encode=F7;eo.decode=A7;function w7(n,t=new Map){const e=O7(n,t);return new An(e,N_(n),t)}function x7(n,t=Ui.V4){if(n.compression()!==null)throw new Error("Record batch compression not implemented");return new ys(n.length(),T7(n),I7(n,t))}function S7(n,t=Ui.V4){return new oo(ys.decode(n.data(),t),n.id(),n.isDelta())}function A7(n){return new eo(n.offset(),n.length())}function E7(n){return new al(n.length(),n.nullCount())}function T7(n){const t=[];for(let e,r=-1,s=-1,o=n.nodesLength();++r<o;)(e=n.nodes(r))&&(t[++s]=al.decode(e));return t}function I7(n,t){const e=[];for(let r,s=-1,o=-1,f=n.buffersLength();++s<f;)(r=n.buffers(s))&&(t<Ui.V4&&(r.bb_pos+=8*(s+1)),e[++o]=eo.decode(r));return e}function O7(n,t){const e=[];for(let r,s=-1,o=-1,f=n.fieldsLength();++s<f;)(r=n.fields(s))&&(e[++o]=gn.decode(r,t));return e}function Xv(n,t){const e=[];for(let r,s=-1,o=-1,f=n.childrenLength();++s<f;)(r=n.children(s))&&(e[++o]=gn.decode(r,t));return e}function B7(n,t){let e,r,s,o,f,c;return!t||!(c=n.dictionary())?(s=Zv(n,Xv(n,t)),r=new gn(n.name(),s,n.nullable(),N_(n))):t.has(e=gs(c.id()))?(o=(o=c.indexType())?qv(o):new Qo,f=new aa(t.get(e),o,e,c.isOrdered()),r=new gn(n.name(),f,n.nullable(),N_(n))):(o=(o=c.indexType())?qv(o):new Qo,t.set(e,s=Zv(n,Xv(n,t))),f=new aa(s,o,e,c.isOrdered()),r=new gn(n.name(),f,n.nullable(),N_(n))),r||null}function N_(n){const t=new Map;if(n)for(let e,r,s=-1,o=Math.trunc(n.customMetadataLength());++s<o;)(e=n.customMetadata(s))&&(r=e.key())!=null&&t.set(r,e.value());return t}function qv(n){return new Wr(n.isSigned(),n.bitWidth())}function Zv(n,t){const e=n.typeType();switch(e){case Xn.NONE:return new so;case Xn.Null:return new so;case Xn.Binary:return new rp;case Xn.Utf8:return new Wc;case Xn.Bool:return new Yc;case Xn.List:return new Hc((t||[])[0]);case Xn.Struct_:return new Lr(t||[])}switch(e){case Xn.Int:{const r=n.type(new xi);return new Wr(r.isSigned(),r.bitWidth())}case Xn.FloatingPoint:{const r=n.type(new Js);return new mu(r.precision())}case Xn.Decimal:{const r=n.type(new ni);return new ip(r.scale(),r.precision(),r.bitWidth())}case Xn.Date:{const r=n.type(new O_);return new Jh(r.unit())}case Xn.Time:{const r=n.type(new ki);return new Qh(r.unit(),r.bitWidth())}case Xn.Timestamp:{const r=n.type(new Pi);return new sp(r.unit(),r.timezone())}case Xn.Interval:{const r=n.type(new Qs);return new ap(r.unit())}case Xn.Union:{const r=n.type(new ri);return new td(r.mode(),r.typeIdsArray()||[],t||[])}case Xn.FixedSizeBinary:{const r=n.type(new Zs);return new op(r.byteWidth())}case Xn.FixedSizeList:{const r=n.type(new Ks);return new ed(r.listSize(),(t||[])[0])}case Xn.Map:{const r=n.type(new B_);return new nd((t||[])[0],r.keysSorted())}}throw new Error(`Unrecognized type: "${Xn[e]}" (${e})`)}function M7(n,t){const e=t.fields.map(o=>gn.encode(n,o));Vs.startFieldsVector(n,e.length);const r=Vs.createFieldsVector(n,e),s=t.metadata&&t.metadata.size>0?Vs.createCustomMetadataVector(n,[...t.metadata].map(([o,f])=>{const c=n.createString(`${o}`),l=n.createString(`${f}`);return gr.startKeyValue(n),gr.addKey(n,c),gr.addValue(n,l),gr.endKeyValue(n)})):-1;return Vs.startSchema(n),Vs.addFields(n,r),Vs.addEndianness(n,C7?Zc.Little:Zc.Big),s!==-1&&Vs.addCustomMetadata(n,s),Vs.endSchema(n)}function L7(n,t){let e=-1,r=-1,s=-1;const o=t.type;let f=t.typeId;Re.isDictionary(o)?(f=o.dictionary.typeId,s=_0.visit(o,n),r=_0.visit(o.dictionary,n)):r=_0.visit(o,n);const c=(o.children||[]).map(p=>gn.encode(n,p)),l=Fi.createChildrenVector(n,c),d=t.metadata&&t.metadata.size>0?Fi.createCustomMetadataVector(n,[...t.metadata].map(([p,w])=>{const I=n.createString(`${p}`),C=n.createString(`${w}`);return gr.startKeyValue(n),gr.addKey(n,I),gr.addValue(n,C),gr.endKeyValue(n)})):-1;return t.name&&(e=n.createString(t.name)),Fi.startField(n),Fi.addType(n,r),Fi.addTypeType(n,f),Fi.addChildren(n,l),Fi.addNullable(n,!!t.nullable),e!==-1&&Fi.addName(n,e),s!==-1&&Fi.addDictionary(n,s),d!==-1&&Fi.addCustomMetadata(n,d),Fi.endField(n)}function R7(n,t){const e=t.nodes||[],r=t.buffers||[];Ka.startNodesVector(n,e.length);for(const f of e.slice().reverse())al.encode(n,f);const s=n.endVector();Ka.startBuffersVector(n,r.length);for(const f of r.slice().reverse())eo.encode(n,f);const o=n.endVector();return Ka.startRecordBatch(n),Ka.addLength(n,BigInt(t.length)),Ka.addNodes(n,s),Ka.addBuffers(n,o),Ka.endRecordBatch(n)}function N7(n,t){const e=ys.encode(n,t.data);return Ac.startDictionaryBatch(n),Ac.addId(n,BigInt(t.id)),Ac.addIsDelta(n,t.isDelta),Ac.addData(n,e),Ac.endDictionaryBatch(n)}function D7(n,t){return Mx.createFieldNode(n,BigInt(t.length),BigInt(t.nullCount))}function F7(n,t){return Bx.createBuffer(n,BigInt(t.offset),BigInt(t.length))}const C7=(()=>{const n=new ArrayBuffer(2);return new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256})(),oy=n=>`Expected ${Mn[n]} Message in stream, but was null or length 0.`,fy=n=>`Header pointer of flatbuffer-encoded ${Mn[n]} Message is null or length 0.`,Dx=(n,t)=>`Expected to read ${n} metadata bytes, but only read ${t}.`,Fx=(n,t)=>`Expected to read ${n} bytes for message body, but only read ${t}.`;class Cx{constructor(t){this.source=t instanceof pp?t:new pp(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done||t.value===-1&&(t=this.readMetadataLength()).done||(t=this.readMetadata(t.value)).done?qn:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let e;if((e=this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(oy(t));return e.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);const e=bn(this.source.read(t));if(e.byteLength<t)throw new Error(Fx(t,e.byteLength));return e.byteOffset%8===0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()}readSchema(t=!1){const e=Mn.Schema,r=this.readMessage(e),s=r==null?void 0:r.header();if(t&&!s)throw new Error(fy(e));return s}readMetadataLength(){const t=this.source.read(qp),e=t&&new Xc(t),r=(e==null?void 0:e.readInt32(0))||0;return{done:r===0,value:r}}readMetadata(t){const e=this.source.read(t);if(!e)return qn;if(e.byteLength<t)throw new Error(Dx(t,e.byteLength));return{done:!1,value:_s.decode(e)}}}class k7{constructor(t,e){this.source=t instanceof Qc?t:k1(t)?new mp(t,e):new Qc(t)}[Symbol.asyncIterator](){return this}next(){return Ne(this,void 0,void 0,function*(){let t;return(t=yield this.readMetadataLength()).done||t.value===-1&&(t=yield this.readMetadataLength()).done||(t=yield this.readMetadata(t.value)).done?qn:t})}throw(t){return Ne(this,void 0,void 0,function*(){return yield this.source.throw(t)})}return(t){return Ne(this,void 0,void 0,function*(){return yield this.source.return(t)})}readMessage(t){return Ne(this,void 0,void 0,function*(){let e;if((e=yield this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(oy(t));return e.value})}readMessageBody(t){return Ne(this,void 0,void 0,function*(){if(t<=0)return new Uint8Array(0);const e=bn(yield this.source.read(t));if(e.byteLength<t)throw new Error(Fx(t,e.byteLength));return e.byteOffset%8===0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()})}readSchema(t=!1){return Ne(this,void 0,void 0,function*(){const e=Mn.Schema,r=yield this.readMessage(e),s=r==null?void 0:r.header();if(t&&!s)throw new Error(fy(e));return s})}readMetadataLength(){return Ne(this,void 0,void 0,function*(){const t=yield this.source.read(qp),e=t&&new Xc(t),r=(e==null?void 0:e.readInt32(0))||0;return{done:r===0,value:r}})}readMetadata(t){return Ne(this,void 0,void 0,function*(){const e=yield this.source.read(t);if(!e)return qn;if(e.byteLength<t)throw new Error(Dx(t,e.byteLength));return{done:!1,value:_s.decode(e)}})}}class P7 extends Cx{constructor(t){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof $v?t:new $v(t)}next(){const{_json:t}=this;if(!this._schema)return this._schema=!0,{done:!1,value:_s.fromJSON(t.schema,Mn.Schema)};if(this._dictionaryIndex<t.dictionaries.length){const e=t.dictionaries[this._dictionaryIndex++];return this._body=e.data.columns,{done:!1,value:_s.fromJSON(e,Mn.DictionaryBatch)}}if(this._batchIndex<t.batches.length){const e=t.batches[this._batchIndex++];return this._body=e.columns,{done:!1,value:_s.fromJSON(e,Mn.RecordBatch)}}return this._body=[],qn}readMessageBody(t){return e(this._body);function e(r){return(r||[]).reduce((s,o)=>[...s,...o.VALIDITY&&[o.VALIDITY]||[],...o.TYPE&&[o.TYPE]||[],...o.OFFSET&&[o.OFFSET]||[],...o.DATA&&[o.DATA]||[],...e(o.children)],[])}}readMessage(t){let e;if((e=this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(oy(t));return e.value}readSchema(){const t=Mn.Schema,e=this.readMessage(t),r=e==null?void 0:e.header();if(!e||!r)throw new Error(fy(t));return r}}const qp=4,ng="ARROW1",wp=new Uint8Array(ng.length);for(let n=0;n<ng.length;n+=1)wp[n]=ng.codePointAt(n);function uy(n,t=0){for(let e=-1,r=wp.length;++e<r;)if(wp[e]!==n[t+e])return!1;return!0}const ud=wp.length,kx=ud+qp,z7=ud*2+qp;class no extends sx{constructor(t){super(),this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){const e=this._impl.open(t);return qh(e)?e.then(()=>this):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return Ci.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return Ci.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,e){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof no?t:H0(t)?V7(t):k1(t)?Y7(t):qh(t)?Ne(this,void 0,void 0,function*(){return yield no.from(yield t)}):P1(t)||Ig(t)||U1(t)||Tg(t)?W7(new Qc(t)):j7(new pp(t))}static readAll(t){return t instanceof no?t.isSync()?Kv(t):Jv(t):H0(t)||ArrayBuffer.isView(t)||zp(t)||C1(t)?Kv(t):Jv(t)}}class xp extends no{constructor(t){super(t),this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return ea(this,arguments,function*(){yield Xe(yield*I_(Rc(this[Symbol.iterator]())))})}}class Sp extends no{constructor(t){super(t),this._impl=t}readAll(){var t,e,r,s;return Ne(this,void 0,void 0,function*(){const o=new Array;try{for(var f=!0,c=Rc(this),l;l=yield c.next(),t=l.done,!t;f=!0){s=l.value,f=!1;const d=s;o.push(d)}}catch(d){e={error:d}}finally{try{!f&&!t&&(r=c.return)&&(yield r.call(c))}finally{if(e)throw e.error}}return o})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class Px extends xp{constructor(t){super(t),this._impl=t}}class U7 extends Sp{constructor(t){super(t),this._impl=t}}class zx{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,e){const r=this._loadVectors(t,e,this.schema.fields),s=Te({type:new Lr(this.schema.fields),length:t.length,children:r});return new zi(this.schema,s)}_loadDictionaryBatch(t,e){const{id:r,isDelta:s}=t,{dictionaries:o,schema:f}=this,c=o.get(r);if(s||!c){const l=f.dictionaries.get(r),d=this._loadVectors(t.data,e,[l]);return(c&&s?c.concat(new Ie(d)):new Ie(d)).memoize()}return c.memoize()}_loadVectors(t,e,r){return new ox(e,t.nodes,t.buffers,this.dictionaries).visitMany(r)}}class Ap extends zx{constructor(t,e){super(e),this._reader=H0(t)?new P7(this._handle=t):new Cx(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=Gx(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):qn}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):qn}next(){if(this.closed)return qn;let t;const{_reader:e}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;const r=t.header(),s=e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(r,s)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;const r=t.header(),s=e.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(r,s);this.dictionaries.set(r.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Ox(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}}class Ep extends zx{constructor(t,e){super(e),this._reader=new k7(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return Ne(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(t){return Ne(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=Gx(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(t){return Ne(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):qn})}return(t){return Ne(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):qn})}next(){return Ne(this,void 0,void 0,function*(){if(this.closed)return qn;let t;const{_reader:e}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;const r=t.header(),s=yield e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(r,s)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;const r=t.header(),s=yield e.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(r,s);this.dictionaries.set(r.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Ox(this.schema)}):yield this.return()})}_readNextMessageAndValidate(t){return Ne(this,void 0,void 0,function*(){return yield this._reader.readMessage(t)})}}class Ux extends Ap{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,e){super(t instanceof Vv?t:new Vv(t),e)}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const e of this._footer.dictionaryBatches())e&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var e;if(this.closed)return null;this._footer||this.open();const r=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(t);if(r&&this._handle.seek(r.offset)){const s=this._reader.readMessage(Mn.RecordBatch);if(s!=null&&s.isRecordBatch()){const o=s.header(),f=this._reader.readMessageBody(s.bodyLength);return this._loadRecordBatch(o,f)}}return null}_readDictionaryBatch(t){var e;const r=(e=this._footer)===null||e===void 0?void 0:e.getDictionaryBatch(t);if(r&&this._handle.seek(r.offset)){const s=this._reader.readMessage(Mn.DictionaryBatch);if(s!=null&&s.isDictionaryBatch()){const o=s.header(),f=this._reader.readMessageBody(s.bodyLength),c=this._loadDictionaryBatch(o,f);this.dictionaries.set(o.id,c)}}}_readFooter(){const{_handle:t}=this,e=t.size-kx,r=t.readInt32(e),s=t.readAt(e-r,r);return ey.decode(s)}_readNextMessageAndValidate(t){var e;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const r=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(this._recordBatchIndex);if(r&&this._handle.seek(r.offset))return this._reader.readMessage(t)}return null}}class G7 extends Ep{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,...e){const r=typeof e[0]!="number"?e.shift():void 0,s=e[0]instanceof Map?e.shift():void 0;super(t instanceof mp?t:new mp(t,r),s)}isFile(){return!0}isAsync(){return!0}open(t){const e=Object.create(null,{open:{get:()=>super.open}});return Ne(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const r of this._footer.dictionaryBatches())r&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield e.open.call(this,t)})}readRecordBatch(t){var e;return Ne(this,void 0,void 0,function*(){if(this.closed)return null;this._footer||(yield this.open());const r=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(t);if(r&&(yield this._handle.seek(r.offset))){const s=yield this._reader.readMessage(Mn.RecordBatch);if(s!=null&&s.isRecordBatch()){const o=s.header(),f=yield this._reader.readMessageBody(s.bodyLength);return this._loadRecordBatch(o,f)}}return null})}_readDictionaryBatch(t){var e;return Ne(this,void 0,void 0,function*(){const r=(e=this._footer)===null||e===void 0?void 0:e.getDictionaryBatch(t);if(r&&(yield this._handle.seek(r.offset))){const s=yield this._reader.readMessage(Mn.DictionaryBatch);if(s!=null&&s.isDictionaryBatch()){const o=s.header(),f=yield this._reader.readMessageBody(s.bodyLength),c=this._loadDictionaryBatch(o,f);this.dictionaries.set(o.id,c)}}})}_readFooter(){return Ne(this,void 0,void 0,function*(){const{_handle:t}=this;t._pending&&(yield t._pending);const e=t.size-kx,r=yield t.readInt32(e),s=yield t.readAt(e-r,r);return ey.decode(s)})}_readNextMessageAndValidate(t){return Ne(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const e=this._footer.getRecordBatch(this._recordBatchIndex);if(e&&(yield this._handle.seek(e.offset)))return yield this._reader.readMessage(t)}return null})}}class $7 extends Ap{constructor(t,e){super(t,e)}_loadVectors(t,e,r){return new MO(e,t.nodes,t.buffers,this.dictionaries).visitMany(r)}}function Gx(n,t){return t&&typeof t.autoDestroy=="boolean"?t.autoDestroy:n.autoDestroy}function*Kv(n){const t=no.from(n);try{if(!t.open({autoDestroy:!1}).closed)do yield t;while(!t.reset().open().closed)}finally{t.cancel()}}function Jv(n){return ea(this,arguments,function*(){const e=yield Xe(no.from(n));try{if(!(yield Xe(e.open({autoDestroy:!1}))).closed)do yield yield Xe(e);while(!(yield Xe(e.reset().open())).closed)}finally{yield Xe(e.cancel())}})}function V7(n){return new xp(new $7(n))}function j7(n){const t=n.peek(ud+7&-8);return t&&t.byteLength>=4?uy(t)?new Px(new Ux(n.read())):new xp(new Ap(n)):new xp(new Ap(function*(){}()))}function W7(n){return Ne(this,void 0,void 0,function*(){const t=yield n.peek(ud+7&-8);return t&&t.byteLength>=4?uy(t)?new Px(new Ux(yield n.read())):new Sp(new Ep(n)):new Sp(new Ep(function(){return ea(this,arguments,function*(){})}()))})}function Y7(n){return Ne(this,void 0,void 0,function*(){const{size:t}=yield n.stat(),e=new mp(n,t);return t>=z7&&uy(yield e.readAt(0,ud+7&-8))?new U7(new G7(e)):new Sp(new Ep(e))})}function el(n){const t=no.from(n);return qh(t)?t.then(e=>el(e)):t.isAsync()?t.readAll().then(e=>new Si(e)):new Si(t.readAll())}class H7 extends n1{constructor(t,e,r){super(t,e,r),this.buffer_size=1024*1024*64,this._use_scale_to_download_tiles=!0,this.fbos={},this.textures={};const s=this.canvas;if(this.canvas===void 0)throw new Error("No canvas found");this.regl=j0({optionalExtensions:["OES_standard_derivatives","OES_element_index_uint","OES_texture_float","OES_texture_half_float"],canvas:s}),this.tileSet=e,this.aes=new UI(r,this.regl,e),this.initialize_textures(),this._initializations=[this.tileSet.promise.then(()=>{this.remake_renderer(),this._webgl_scale_history=[this.default_webgl_scale,this.default_webgl_scale]})],this.initialize(),this._buffers=new Qv(this.regl,this.buffer_size)}get buffers(){return this._buffers=this._buffers||new Qv(this.regl,this.buffer_size),this._buffers}data(t){return t===void 0?this.tileSet:(this.tileSet=t,this)}get props(){this.allocate_aesthetic_buffers();const{prefs:t,aes_to_buffer_num:e,buffer_num_to_variable:r,variable_to_buffer_num:s}=this,{transform:o}=this.zoom,f=this.aes.dim("color"),[c,l]=[f.current,f.last],d=[l.colorscheme_size,c.colorscheme_size],p={aes:{encoding:this.aes.encoding},colors_as_grid:0,corners:this.zoom.current_corners(),zoom_balance:t.zoom_balance,transform:o,max_ix:this.max_ix,point_size:this.point_size,alpha:this.optimal_alpha,time:Date.now()-this.zoom._start,update_time:Date.now()-this.most_recent_restart,relative_time:(Date.now()-this.most_recent_restart)/t.duration,string_index:0,prefs:JSON.parse(JSON.stringify(t)),color_type:void 0,wrap_colors_after:d,start_time:this.most_recent_restart,webgl_scale:this._webgl_scale_history[0],last_webgl_scale:this._webgl_scale_history[1],use_scale_for_tiles:this._use_scale_to_download_tiles,grid_mode:0,buffer_num_to_variable:r,aes_to_buffer_num:e,variable_to_buffer_num:s,color_picker_mode:0,zoom_matrix:[[o.k,0,o.x],[0,o.k,o.y],[0,0,1]].flat()};return JSON.parse(JSON.stringify(p))}get default_webgl_scale(){return this._default_webgl_scale?this._default_webgl_scale:(this._default_webgl_scale=this.zoom.webgl_scale(),this._default_webgl_scale)}render_points(t){const e=[];let r=0;const s=this.aes.store.foreground.states[0].active||this.aes.store.foreground.states[1].active;for(const o of this.visible_tiles()){if(o._buffer_manager=o._buffer_manager||new X7(this.regl,o,this),!o._buffer_manager.ready(t.block_for_buffers))continue;const f={manager:o._buffer_manager,number:r++,foreground:s?1:-1,tile_id:o.numeric_id,sprites:this.sprites};if(Object.assign(f,t),e.push(f),s){const c={...f,foreground:0};e.push(c)}}e.sort((o,f)=>(3+o.foreground)*1e3-(3+f.foreground)*1e3+f.number-o.number),this._renderer(e)}tick(){const{prefs:t}=this,{regl:e,tileSet:r}=this,{props:s}=this;this.tick_num=this.tick_num||0,this.tick_num++,this._use_scale_to_download_tiles?r.download_most_needed_tiles(this.zoom.current_corners(),this.props.max_ix,5):r.download_most_needed_tiles(t.max_points,this.max_ix,5),e.clear({color:[.9,.9,.93,0],depth:1});const o=Date.now();async function f(c){for(;Date.now()-o<10&&c.length>0;){const l=c.shift();if(l!==void 0)try{await l()}catch(d){console.warn(d,l)}}}f(this.deferred_functions);try{this.render_all(s)}catch(c){throw console.warn("ERROR NOTED"),this.reglframe.cancel(),c}}single_blur_pass(t,e,r){const{regl:s}=this;e.use(()=>{s.clear({color:[0,0,0,0]}),s({frag:ST,uniforms:{iResolution:({viewportWidth:o,viewportHeight:f})=>[o,f],iChannel0:t,direction:r},vert:`
        precision mediump float;
        attribute vec2 position;
        varying vec2 uv;
        void main() {
          uv = 0.5 * (position + 1.0);
          gl_Position = vec4(position, 0, 1);
        }`,attributes:{position:[-4,-4,4,-4,0,4]},depth:{enable:!1},count:3})()})}blur(t,e,r=3){let s=r-1;for(;s>-1;)this.single_blur_pass(t,e,[2**s,0]),this.single_blur_pass(e,t,[0,2**s]),s-=1}render_all(t){const{regl:e}=this;this.fbos.points.use(()=>{e.clear({color:[0,0,0,0]}),this.render_points(t)}),e.clear({color:[0,0,0,0]}),this.fbos.lines.use(()=>e.clear({color:[0,0,0,0]})),this.scatterplot.trimap&&this.fbos.lines.use(()=>{this.scatterplot.trimap.zoom=this.zoom,this.scatterplot.trimap.tick("polygon")});for(const r of[this.fbos.lines,this.fbos.points])e({profile:!0,blend:{enable:!0,func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},frag:`
        precision mediump float;
        varying vec2 uv;
        uniform sampler2D tex;
        uniform float wRcp, hRcp;
        void main() {
          gl_FragColor = texture2D(tex, uv);
        }
      `,vert:`
        precision mediump float;
        attribute vec2 position;
        varying vec2 uv;
        void main() {
          uv = 0.5 * (position + 1.0);
          gl_Position = vec4(position, 0., 1.);
        }
      `,attributes:{position:this.fill_buffer},depth:{enable:!1},count:3,uniforms:{tex:()=>r,wRcp:({viewportWidth:s})=>1/s,hRcp:({viewportHeight:s})=>1/s}})()}initialize_textures(){const{regl:t}=this;this.fbos=this.fbos||{},this.textures=this.textures||{},this.textures.empty_texture=t.texture(ou(128).map(e=>ou(128).map(r=>[0,0,0]))),this.fbos.minicounter=t.framebuffer({width:512,height:512,depth:!1}),this.fbos.lines=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.points=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.ping=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.pong=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.contour=this.fbos.contour||t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.colorpicker=this.fbos.colorpicker||t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.dummy=this.fbos.dummy||t.framebuffer({width:1,height:1,depth:!1})}get_image_texture(t){const{regl:e}=this;if(this.textures=this.textures||{},this.textures[t])return this.textures[t];const r=new Image;return r.src=t,r.addEventListener("load",()=>{this.textures[t]=e.texture(r)}),this.textures[t]}n_visible(t=-1){let{width:e,height:r}=this;e=Math.floor(e),r=Math.floor(r),this.contour_vals===void 0&&(this.contour_vals=new Uint8Array(e*r*4));const{props:s}=this;s.only_color=t;let o;return this.fbos.contour.use(()=>{this.regl.clear({color:[0,0,0,0]}),this.render_points(s),this.regl.read(this.contour_vals),o=s5(this.contour_vals)}),o}get integer_buffer(){if(this._integer_buffer===void 0){const t=new Float32Array(65536);for(let e=0;e<2**16;e++)t[e]=e;this._integer_buffer=this.regl.buffer(t)}return this._integer_buffer}color_pick(t,e){if(e===0)return null;const r=this.color_pick_single(t,e,"tile_id");if(r==-1)return null;const s=this.color_pick_single(t,e,"ix_in_tile");if(s===-1)return null;for(const o of this.visible_tiles())if(o.numeric_id===r)return o.record_batch.get(s);return null}color_pick_single(t,e,r="tile_id"){const{props:s,height:o}=this;s.color_picker_mode=["ix","tile_id","ix_in_tile"].indexOf(r)+1;let f=[0,0,0,0];this.fbos.colorpicker.use(()=>{this.regl.clear({color:[0,0,0,0]}),this.render_points(s);try{f=this.regl.read({x:t,y:o-e,width:1,height:1})}catch{console.warn("Read bad data from",{x:t,y:e,height:o,attempted:o-e})}});const c=vT(...f)-1;return Math.round(c)}get fill_buffer(){if(!this._fill_buffer){const{regl:t}=this;this._fill_buffer=t.buffer({data:[-4,-4,4,-4,0,4]})}return this._fill_buffer}draw_contour_buffer(t,e){let{width:r,height:s}=this;r=Math.floor(r),s=Math.floor(s),this.contour_vals=this.contour_vals||new Uint8Array(4*r*s),this.contour_alpha_vals=this.contour_alpha_vals||new Uint16Array(r*s);const{props:o}=this;o.aes.encoding.color={field:t},o.only_color=e,this.fbos.contour.use(()=>{this.regl.clear({color:[0,0,0,0]}),this.render_points(o),this.regl.read(this.contour_vals)}),this.blur(this.fbos.contour,this.fbos.ping,3),this.fbos.contour.use(()=>{this.regl.read(this.contour_vals)});let f=0;for(;f<r*s*4;)this.contour_alpha_vals[f/4]=this.contour_vals[f+3]*255,f+=4;return this.contour_alpha_vals}remake_renderer(){const{regl:t}=this,e={depth:{enable:!1},stencil:{enable:!1},blend:{enable(r,{color_picker_mode:s}){return s<.5},func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},primitive:"points",frag:ET,vert:AT,count(r,s){return s.manager.count},attributes:{},uniforms:{u_update_time:t.prop("update_time"),u_transition_duration(r,s){return s.prefs.duration},u_only_color(r,s){return s.only_color!==void 0?s.only_color:-2},u_wrap_colors_after:(r,{wrap_colors_after:s})=>{if(s===void 0)throw new Error("wrap_colors_after is undefined");return s},u_use_glyphset:(r,{prefs:s})=>s.glyph_set?1:0,u_glyphset:(r,{prefs:s})=>s.glyph_set?this.get_image_texture(s.glyph_set):this.textures.empty_texture,u_color_picker_mode:t.prop("color_picker_mode"),u_position_interpolation_mode(){return this.aes.position_interpolation?1:0},u_grid_mode:(r,{grid_mode:s})=>s,u_colors_as_grid:t.prop("colors_as_grid"),u_tile_id:(r,s)=>s.tile_id,u_width:({viewportWidth:r})=>r,u_height:({viewportHeight:r})=>r,u_one_d_aesthetic_map:this.aes.aesthetic_map.one_d_texture,u_color_aesthetic_map:this.aes.aesthetic_map.color_texture,u_aspect_ratio:({viewportWidth:r,viewportHeight:s})=>r/s,u_zoom_balance:t.prop("zoom_balance"),u_base_size:(r,{point_size:s})=>s,u_maxix:(r,{max_ix:s})=>s,u_alpha:(r,{alpha:s})=>s,u_foreground_number:(r,{foreground:s})=>s,u_foreground_alpha:()=>this.render_props.foreground_opacity,u_background_rgba:()=>{const r=this.prefs.background_options.color,{r:s,g:o,b:f}=ro(r);return[s/255,o/255,f/255,this.prefs.background_options.opacity[0]]},u_background_mouseover:()=>this.prefs.background_options.mouseover?1:0,u_background_size:()=>this.render_props.background_size,u_foreground_size:()=>this.render_props.foreground_size,u_k:(r,s)=>s.transform.k,u_window_scale:t.prop("webgl_scale"),u_last_window_scale:t.prop("last_webgl_scale"),u_time:({time:r})=>r,u_filter_numeric(){return this.aes.dim("filter").current.ops_to_array()},u_last_filter_numeric(){return this.aes.dim("filter").last.ops_to_array()},u_filter2_numeric(){return this.aes.dim("filter2").current.ops_to_array()},u_last_filter2_numeric(){return this.aes.dim("filter2").last.ops_to_array()},u_foreground_numeric(){return this.aes.dim("foreground").current.ops_to_array()},u_last_foreground_numeric(){return this.aes.dim("foreground").last.ops_to_array()},u_jitter:()=>this.aes.dim("jitter_radius").current.jitter_int_format,u_last_jitter:()=>this.aes.dim("jitter_radius").last.jitter_int_format,u_zoom(r,s){return s.zoom_matrix}}};for(const r of ou(0,16))e.attributes[`buffer_${r}`]=(s,{manager:o,buffer_num_to_variable:f})=>o.regl_elements.get(f[r])||{constant:0};for(const r of["x","y","color","jitter_radius","x0","y0","jitter_speed","size","filter","filter2","foreground"])for(const s of["current","last"]){const o=s==="current"?"":"last_";e.uniforms[`u_${o}${r}_map_position`]=()=>this.aes.dim(r)[s].map_position,e.uniforms[`u_${o}${r}_buffer_num`]=(f,{aes_to_buffer_num:c})=>{const l=c[`${r}--${s}`];return l===void 0?-1:l},e.uniforms[`u_${o}${r}_domain`]=()=>this.aes.dim(r)[s].webGLDomain,e.uniforms[`u_${o}${r}_range`]=()=>this.aes.dim(r)[s].range,e.uniforms[`u_${o}${r}_transform`]=()=>{const f=this.aes.dim(r)[s].transform;if(f==="linear")return 1;if(f==="sqrt")return 2;if(f==="log")return 3;if(f==="literal")return 4;throw"Invalid transform"},e.uniforms[`u_${o}${r}_constant`]=()=>this.aes.dim(r)[s].constant}return this._renderer=t(e),this._renderer}allocate_aesthetic_buffers(){const t=[],e=["x","y","color","x0","y0","size","jitter_radius","jitter_speed","filter","filter2","foreground"];for(const c of e){const l=["current","last"];for(const d of l)try{this.aes.dim(c)[d].field&&t.push({aesthetic:c,time:d,field:this.aes.dim(c)[d].field})}catch(p){throw this.reglframe=void 0,p}}t.sort((c,l)=>c.time<l.time?-1:l.time<c.time?1:e.indexOf(c.aesthetic)-e.indexOf(l.aesthetic));const r={},s={ix:0,ix_in_tile:1};let o=1;for(const{aesthetic:c,time:l,field:d}of t){const p=`${c}--${l}`;if(s[d]!==void 0){r[p]=s[d];continue}if(o++<16){r[p]=o,s[d]=o;continue}else r[p]=r[`${c}--current`]}const f=[...Object.keys(s)];this.aes_to_buffer_num=r,this.variable_to_buffer_num=s,this.buffer_num_to_variable=f}get discard_share(){return 0}}class X7{constructor(t,e,r){this.tile=e,this.regl=t,this.renderer=r,this.regl_elements=new Map([["ix_in_tile",{offset:0,stride:4,buffer:r.integer_buffer,byte_size:4*2**16}]])}ready(){const{renderer:t}=this,e=new Set;for(const[r,s]of t.aes)for(const o of s.states)o.field&&e.add(o.field);for(const r of["ix","ix_in_tile",...e])if(!this.ready_or_not_here_it_comes(r).ready)return!1;return!0}ready_or_not_here_it_comes(t){const{renderer:e,regl_elements:r}=this,s=this.regl_elements.get(t);return s===null?{ready:!1,promise:null}:s===void 0?this.tile.ready?(r.set(t,null),{ready:!1,promise:new Promise(f=>{e.deferred_functions.push(async()=>{await this.create_regl_buffer(t),f()})})}):{ready:!1,promise:null}:{ready:!0,promise:Promise.resolve()}}release(t){let e;(e=this.regl_elements.get(t))&&this.renderer.buffers.free_block(e)}get count(){return this.tile.record_batch.numRows}async create_buffer_data(t){const{tile:e}=this;if(!e.ready)throw new Error("Tile table not present.");let r=e.record_batch.getChild(t);if(!r)if(e.dataset.transformations[t]!==void 0){if(await e.apply_transformation(t),r=e.record_batch.getChild(t),!r)throw new Error(`${t} was not created.`)}else{const o=e.record_batch.schema.fields.map(f=>f.name);throw new Error(`Requested ${t} but table only has columns ["${o.join('", "')}]"`)}if(r.data.length!==1)throw new Error(`Column ${t} has ${r.data.length} buffers, not 1.`);if(!r.type||!r.type.typeId)throw new Error(`Column ${t} has no type.`);if(!r.type||r.type.typeId!==Q.Float32){const s=new Float32Array(e.record_batch.numRows),o=r.data[0];if(r.type.dictionary)for(let f=0;f<e.record_batch.numRows;f++)s[f]=o.values[f];else if(r.type.typeId===Q.Bool)for(let f=0;f<e.record_batch.numRows;f++)s[f]=r.get(f)?1:0;else if(o.stride===2&&r.type.typeId===10){const f=new Int32Array(o.values).buffer,c=new BigInt64Array(f),l=r.type.unit,d=l===0?.001:l===1?1:l===2?1e3:l===3?1e6:42;if(d===42)throw new Error(`Unknown time type ${l}`);for(let p=0;p<e.record_batch.numRows;p++)s[p]=Number(c[p])/d}else for(let f=0;f<e.record_batch.numRows;f++)s[f]=Number(o.values[f]);return s}return r.data[0].values.constructor===Float64Array?new Float32Array(r.data[0].values):r.data[0].values}async create_regl_buffer(t){const{regl_elements:e,renderer:r}=this,s=await this.create_buffer_data(t);if(s.constructor!==Float32Array)throw console.warn(typeof s,s),new Error("Buffer data must be a Float32Array");const o=4,f=s.length,c=r.buffers.allocate_block(f,o);e.set(t,c),c.buffer.subdata(s,c.offset)}}class Qv{constructor(t,e){this.freed_buffers=[],this.regl=t,this.buffer_size=e,this.buffers=[],this.pointer=0,this.generate_new_buffer()}generate_new_buffer(){this.buffers.length&&this.buffer_size-this.pointer>128&&this.freed_buffers.push({buffer:this.buffers[0],offset:this.pointer,stride:4,byte_size:this.buffer_size-this.pointer}),this.pointer=0,this.buffers.unshift(this.regl.buffer({type:"float",length:this.buffer_size,usage:"dynamic"}))}free_block(t){this.freed_buffers.push(t)}allocate_block(t,e){const r=t*e;let s=0;for(const f of this.freed_buffers){if(f.byte_size===r)return this.freed_buffers.splice(s,1),{buffer:f.buffer,offset:f.offset,stride:e,byte_size:r};s+=1}this.pointer+t*e>this.buffer_size&&this.generate_new_buffer();const o={buffer:this.buffers[0],offset:this.pointer,stride:e,byte_size:t*e};return this.pointer+=t*e,o}}let q7=0;class $x{constructor(t){if(this.max_ix=-1,this._children=[],this.transformation_holder={},this.promise=Promise.resolve(),this.download_state="Unattempted",this.key=String(Math.random()),this.parent=null,this.dataset=t,this.ready=!1,t===void 0)throw new Error("No dataset provided");this.numeric_id=q7++}get children(){return this._children}download(){throw new Error("Not implemented")}delete_column_if_exists(t){var e;this._batch&&((e=this._buffer_manager)==null||e.release(t),this._batch=D_(this.record_batch,t,null))}async get_column(t){this._batch===void 0&&await this.promise;const e=this.record_batch.getChild(t);if(e)return e;if(this.dataset.transformations[t])return await this.apply_transformation(t),this.record_batch.getChild(t);throw new Error(`Column ${t} not found`)}async apply_transformation(t){if(this.transformation_holder[t]!==void 0)return this.transformation_holder[t];const e=this.dataset.transformations[t];if(e===void 0)throw new Error(`Transformation ${t} is not defined`);return this.transformation_holder[t]=Promise.resolve(e(this)).then(r=>{if(r===void 0)throw new Error(`Transformation ${t} failed`);this._batch=D_(this.record_batch,t,r)}),this.transformation_holder[t]}add_column(t,e){return this._batch=D_(this.record_batch,t,e),this._batch}is_visible(t,e){if(this.min_ix===void 0||this.min_ix>t)return!1;if(e===void 0)return!0;const r=this.extent;return!(r.x[0]>e.x[1]||r.x[1]<e.x[0]||r.y[0]>e.y[1]||r.y[1]<e.y[0])}*points(t,e=!1){for(const r of this)rg([r.x,r.y],t)&&(yield r);if(e===!1){for(const r of this.children)if(r.ready&&!(t&&!r.is_visible(1e100,t)))for(const s of r.points(t,e))rg([s.x,s.y],t)&&(yield s)}else throw new Error("Sorted iteration not supported")}forEach(t){for(const e of this.points(void 0,!1))e!==void 0&&t(e)}set highest_known_ix(t){(this._highest_known_ix==null||this._highest_known_ix<t)&&(this._highest_known_ix=t,this.parent&&(this.parent.highest_known_ix=t))}get highest_known_ix(){return this._highest_known_ix||-1}get record_batch(){if(this._batch)return this._batch;throw new Error("Attempted to access table on tile without table buffer.")}get min_ix(){return this._min_ix!==void 0?this._min_ix:this.parent?this.parent.max_ix+1:0}async schema(){return await this.download(),await this.promise,this._schema}extend_promise(t){return this.promise=this.promise.then(()=>t()),this.promise}get _schema(){if(this.__schema)return this.__schema;const t=[];for(const e of this.record_batch.schema.fields){const{name:r,type:s}=e;if((s==null?void 0:s.typeId)==5&&t.push({name:r,type:"string",extent:[]}),s&&s.dictionary&&t.push({name:r,type:"dictionary",keys:this.record_batch.getChild(r).data[0].dictionary.toArray(),extent:[0,this.record_batch.getChild(r).data[0].dictionary.length]}),s&&s.typeId==8&&t.push({name:r,type:"date",extent:Gh(this.record_batch.getChild(r).data[0].values)}),(s==null?void 0:s.typeId)===10)return[10,100];s&&s.typeId==3&&t.push({name:r,type:"float",extent:Gh(this.record_batch.getChild(r).data[0].values)})}return this.__schema=t,t}*yielder(){for(const t of this.record_batch)t&&(yield t)}get extent(){return this._extent?this._extent:{x:[Number.MIN_VALUE,Number.MAX_VALUE],y:[Number.MIN_VALUE,Number.MAX_VALUE]}}[Symbol.iterator](){return this.yielder()}get root_extent(){return this.parent===null?{x:[Number.MIN_VALUE,Number.MAX_VALUE],y:[Number.MIN_VALUE,Number.MAX_VALUE]}:this.parent.root_extent}}class Z7 extends $x{constructor(t,e,r,s){super(s),this._children=[],this._already_called=!1,this.child_locations=[],this.url=t,this.parent=r,this.key=e;const[o,f,c]=e.split("/").map(l=>Number.parseInt(l));this.codes=[o,f,c]}get extent(){return this._extent?this._extent:this.theoretical_extent}async download_to_depth(t){await this.download();let e=[];this.max_ix<t&&(e=this.children.map(r=>r.download_to_depth(t))),await Promise.all(e)}async get_arrow(t=void 0){let e=`${this.url}/${this.key}.feather`;t&&(e=e.replace(".feather",`.${t}.feather`));let r,s;if(this.dataset.tileProxy!==void 0){const f=new URL(e).pathname,c=await this.dataset.tileProxy.apiCall(f,"GET",null,null,{octetStreamAsUint8:!0});r=el(c)}else{let f={};window.localStorage.getItem("isLoggedIn")==="true"&&(e=e.replace("/public",""),f={Authorization:`Bearer ${localStorage.getItem("access_token")}`});const c={method:"GET",...f};s=await(await fetch(e,c)).arrayBuffer(),r=el(s)}r.batches.length>1&&console.warn(`More than one record batch at ${e}; all but first batch will be ignored.`);const o=r.batches[0];return t===void 0&&(this.download_state="Complete",this._batch=r.batches[0]),o}async download(){if(this._download!==void 0)return this._download;if(this._already_called)throw"Illegally attempting to download twice";return this._already_called=!0,this.download_state="In progress",this._download=this.get_arrow().then(t=>{this.ready=!0;const e=t.schema.metadata,r=e.get("extent");r&&(this._extent=JSON.parse(r));const s=e.get("children");s&&(this.child_locations=JSON.parse(s));const o=t.getChild("ix");if(o===null)throw"No ix column in table";this._min_ix=Number(o.get(0)),this.max_ix=Number(o.get(o.length-1)),this._min_ix>this.max_ix&&(this.max_ix=this._min_ix+1e5,this._min_ix=0),this.highest_known_ix=this.max_ix}).catch(t=>{throw this.download_state="Failed",console.error(`Error: Remote Tile at ${this.url}/${this.key}.feather not found.
        `),console.warn(t),t})}get macrotile(){return Vx(this.key)}get macro_siblings(){return K7(this.key)}get children(){if(this.download_state!=="Complete")return[];const t=this.constructor;if(this._children.length<this.child_locations.length)for(const e of this.child_locations){const r=new t(this.url,e,this,this.dataset);this._children.push(r)}return this._children}get theoretical_extent(){const t=this.dataset.extent,[e,r,s]=this.codes,f=(t.x[1]-t.x[0])/2**e,l=(t.y[1]-t.y[0])/2**e;return{x:[t.x[0]+r*f,t.x[0]+(r+1)*f],y:[t.y[0]+s*l,t.y[0]+(s+1)*l]}}}class cy extends $x{constructor(t,e,r,s=null){if(super(e),this.full_tab=t,this._batch=t.batches[r],this.download_state="Complete",this.batch_num=r,this.codes=[0,s===null?-1:s.batch_num,r],this._batch.getChild("ix")===null){console.warn("Manually setting ix");const c=this._batch,l=new Float32Array(c.numRows),d=this.dataset._ix_seed;this.dataset._ix_seed+=c.numRows;for(let p=0;p<c.numRows;p++)l[p]=p+d;this._min_ix=d,this._max_ix=d+c.numRows,this.highest_known_ix=this._max_ix,this._batch=D_(this.record_batch,"ix",l)}this._extent={x:Gh(this._batch.getChild("x")),y:Gh(this._batch.getChild("y"))},this.parent=s;const o=this._batch.get(this._batch.numRows-1);if(o===null)throw"No rows in table";this.max_ix=Number(o.ix),this.highest_known_ix=Number(this.max_ix);const f=this._batch.get(0);if(f===null)throw"No rows in table";this._min_ix=Number(f.ix),this.highest_known_ix=Number(this.max_ix),this.create_children(),this.ready=!0}create_children(){let t=this.batch_num*4;for(;++t<=this.batch_num*4+4;)t<this.full_tab.batches.length&&this._children.push(new cy(this.full_tab,this.dataset,t,this));for(const e of this._children)for(const r of["x","y"])this._extent[r][0]=Math.min(this._extent[r][0],e._extent[r][0]),this._extent[r][1]=Math.max(this._extent[r][1],e._extent[r][1])}download(){return Promise.resolve(this._batch)}}function rg(n,t){return t===void 0?!0:n[0]<t.x[1]&&n[0]>t.x[0]&&n[1]<t.y[1]&&n[1]>t.y[0]}function Vx(n,t=2,e=2){let[r,s,o]=n.split("/").map(c=>parseInt(c)),f=0;for(;!(f>=e&&r%t==0);)s=Math.floor(s/2),o=Math.floor(o/2),r=r-1,f++;return`${r}/${s}/${o}`}function K7(n,t=2,e=2){return J7(Vx(n,t,e),t,e)}const p0=new Map;function J7(n,t=2,e=2){if(p0.has(n))return p0.get(n);const r=[[n]];for(;r.length<e;)r.unshift(r[0].map(m0).flat());const s=[r[0].map(m0).flat()];for(;s.length<t;)s.unshift(s[0].map(m0).flat());s.reverse();const o=s.flat();return p0.set(n,o),o}function m0(n){const[t,e,r]=n.split("/").map(o=>parseInt(o)),s=[];for(let o=0;o<4;o++)s.push(`${t+1}/${e*2+o%2}/${r*2+Math.floor(o/2)}`);return s}class Uh{constructor(t){this.transformations={},this.extents={},this._ix_seed=0,this.plot=t}get highest_known_ix(){return this.root_tile.highest_known_ix}register_transformation(t,e,r=[]){const s=async o=>{await Promise.all(r.map(l=>o.get_column(l)));const f=new Float32Array(o.record_batch.numRows);let c=0;for(const l of o.record_batch)f[c]=e(l),c++;return f};this.transformations[t]=s}download_to_depth(t){return Promise.resolve()}get table(){return new Si(this.map(t=>t).filter(t=>t.ready).map(t=>t.record_batch))}static from_quadfeather(t,e){const r={};return e.tileProxy&&(r.tileProxy=e.tileProxy),new Wx(t,e,r)}static from_arrow_table(t,e){return new jx(t,e)}has_column(t){return this.root_tile.record_batch.schema.fields.some(e=>e.name==t)||t in this.transformations}delete_column_if_exists(t){this.map(e=>e.delete_column_if_exists(t)),delete this.transformations[t]}domain(t,e=1e6){var r;if(this.extents[t])return this.extents[t];const s=(r=this._schema)==null?void 0:r.fields.find(o=>o.name===t);if(s!==void 0){let o,f;const c=s.metadata.get("extent");c&&([o,f]=JSON.parse(c));const l=s.metadata.get("min");l&&(o=JSON.parse(l));const d=s.metadata.get("max");if(d&&(f=JSON.parse(d)),s.type.typeId===10&&typeof o=="string"&&(o=Number(new Date(o))),s.type.typeId===10&&typeof f=="string"&&(f=Number(new Date(f))),typeof f=="string")throw new Error("Failed to parse min-max as numbers");if(o!==void 0)return this.extents[t]=[o,f]}return this.extents[t]=Gh([...new Ie(this.map(o=>o).filter(o=>o.ready).map(o=>o.record_batch.getChild(t)).filter(o=>o!==null))])}*points(t,e=1e99){const r=[this.root_tile];let s;for(;s=r.shift();)if(s.download_state=="Complete"&&(t===void 0||s.is_visible(e,t))){for(const o of s)rg([o.x,o.y],t)&&o.ix<=e&&(yield o);r.push(...s.children)}}map(t,e=!1){const r=[];return this.visit(s=>{r.push(t(s))},e),r}visit(t,e=!1,r=s=>!0){const s=[this.root_tile],o=[];let f;for(;f=s.shift();)e?o.push(f):t(f),r(f)&&f.download_state=="Complete"&&s.push(...f.children);if(e)for(;f=o.pop();)t(f)}async visit_full(t,e=!1,r=null,s=f=>!0,o){let f=0;const c=r||this.root_tile;await c.download();const l=JSON.parse(c.record_batch.schema.metadata.get("total_points"));async function d(p){await p.download(),e?(await Promise.all(p.children.map(d)),await t(p),f+=p.record_batch.numRows,o(p,f,l)):(await t(p),f+=p.record_batch.numRows,o(p,f,l),await Promise.all(p.children.map(d)))}await d(c)}async schema(){return await this.ready,this._schema?this._schema:(this._schema=this.root_tile.record_batch.schema,this.root_tile.record_batch.schema)}add_tiled_column(t,e){const r=el(e),s={};for(const o of r.batches){const f=o.getChild("data").data[0];if(f===null)throw new Error('tiled columns must contain "data" field.');const c=f.valueOffsets,l=f.children[0];for(let d=0;d<o.data.length;d++){const p=o.getChild("_tile").get(d);s[p]=l.values.slice(c[d],c[d+1])}}this.transformations[t]=function(o){const{key:f}=o;return s[f]}}add_sparse_identifiers(t,e){this.transformations[t]=function(r){var s;const{key:o}=r,f=r.record_batch.numRows,c=new Float32Array(f),l=(s=e.values[o])!=null?s:[];for(const[d,p]of Object.entries(l))c[Number.parseInt(d)]=p;return c}}add_label_identifiers(t,e,r="_id"){if(this.transformations[e])throw new Error(`Can't overwrite existing transformation for ${e}`);this.transformations[e]=function(s){return eB(s.record_batch,t,e,r)}}async applyTransformationToPoint(t,e){const r=this.findPointRaw(e);if(r.length==0)throw new Error(`No point for ix ${e}`);const[s,o,f]=r[0];return s.record_batch.getChild(t)!==null?o:(await s.apply_transformation(t),s.record_batch.get(f))}findPoint(t){return this.findPointRaw(t).map(([,e])=>e)}findPointRaw(t){const e=[];return this.visit(r=>{if(!(r.ready&&r.record_batch&&r.min_ix<=t&&r.max_ix>=t))return;const s=r.record_batch.getChild("ix"),o=v0(s.toArray(),t),f=r.record_batch.get(o);f!==null&&f.ix===t&&e.push([r,f,o])}),e}}class jx extends Uh{constructor(t,e){super(e),this.promise=Promise.resolve(),this.root_tile=new cy(t,this,0)}get extent(){return this.root_tile.extent}get ready(){return Promise.resolve()}download_most_needed_tiles(...t){}}class Wx extends Uh{constructor(t,e,r={}){super(e),this._download_queue=new Set,r.tileProxy&&(this.tileProxy=r.tileProxy),this.root_tile=new Z7(t,"0/0/0",null,this);const s=this.root_tile.download();this.promise=s.then(o=>{const f=this.root_tile.record_batch.schema;if(f.metadata.has("sidecars")){const c=f.metadata.get("sidecars"),l=JSON.parse(c);for(const[d,p]of Object.entries(l))this.transformations[d]=async function(w){const I=await w.get_arrow(p),C=I.getChild(d);if(C===null)throw new Error(`No column named ${d} in sidecar tile ${I.schema.fields.map(V=>V.name).join(", ")}`);return C}}})}get ready(){return this.root_tile.download()}get extent(){return this.root_tile.extent}async download_to_depth(t){await this.root_tile.download_to_depth(t)}download_most_needed_tiles(t,e,r=4){const s=this._download_queue;if(s.size>=r)return;const o=[];function f(c){if(t===void 0)return 1/c.codes[0];if(c.download_state==="Unattempted"){const l=Q7(c,t);o.push([l,c,t])}}for(this.visit(f),o.sort((c,l)=>Number(c[0])-Number(l[0]));o.length>0&&s.size<r;){const c=o.pop();if(c===void 0)throw new Error("Ran out of tiles unexpectedly");const[l,d,p]=c;d.min_ix&&d.min_ix>e||l<=0||(s.add(d.key),d.download().then(()=>s.delete(d.key)).catch(w=>{throw console.warn("Error on",d.key),s.delete(d.key),w}))}}add_macrotiled_column(t,e){const r={},s={};async function o(f){const{macrotile:c}=f;return r[c]!==void 0?await r[c]:(r[c]=e(f.macro_siblings).then(l=>{const d=el(l);for(const p of d.batches){const w=p.getChild("data");for(let I=0;I<p.data.length;I++){const C=p.getChild("_tile").get(I);s[C]=w.get(I)}}}),r[c])}this.transformations[t]=async function(f){await o(f);const c=s[f.key];if(c instanceof Uint8Array){const l=new Float32Array(c.length);for(let d=0;d<f.record_batch.numRows;d++){const p=c[d];for(let w=0;w<8;w++){const I=p>>w&1;l[d*8+w]=I}}return l}else return c}}}function tb(n){return(n.x[1]-n.x[0])*(n.y[1]-n.y[0])}function Q7(n,t){const e=n.extent;if(e.x[0]>t.x[1]||e.x[1]<t.x[0]||e.y[0]>t.y[1]||e.y[1]<t.y[0])return 0;const r={x:[x0([t.x[0],e.x[0]]),S0([t.x[1],e.x[1]])],y:[x0([t.y[0],e.y[0]]),S0([t.y[1],e.y[1]])]},{x:s,y:o}=r;let f=0;return s[0]>s[1]&&(f-=1),o[0]>o[1]&&(f-=2),f<0?f:tb(r)/tb(t)}let tB=4e4;function D_(n,t,e){const r={};for(const o of n.schema.fields){if(o.name===t){if(e===null)continue;throw new Error(`Name ${o.name} already exists, can't add.`)}const c=n.getChild(o.name).data[0];r[o.name]=c}if(e===void 0)throw new Error("Must pass data to bind_column");if(e!==null)if(e instanceof Float32Array)r[t]=tu({type:new Ng,data:e,length:e.length}).data[0];else if(e instanceof BigInt64Array)r[t]=tu({type:new Up,data:e,length:e.length}).data[0];else if(e instanceof Uint8Array)r[t]=tu({type:new Rg,data:e,length:e.length}).data[0];else if(e.data.length>0){let o=e.data[0];if(o.dictionary){const f=o;o=tu({data:f.values,dictionary:f.dictionary,type:new aa(f.type.dictionary,f.type.indices,tB++)}).data[0]}r[t]=o}else console.warn("Unknown data format object passed to add or remove columns--treating as Data, but this behavior is deprecated",e),r[t]=e;const s=new zi(r);for(const[o,f]of n.schema.metadata)s.schema.metadata.set(o,f);for(const o of n.schema.fields){const f=s.schema.fields.find(c=>c.name===o.name);if(f!==void 0)for(const[c,l]of o.metadata)f.metadata.set(c,l);else if(e!==null)throw new Error("Error!")}if(e!==null){const o=s.schema.fields.find(f=>f.name===t);o==null||o.metadata.set("created by deepscatter",new Date().toISOString())}return s}function eB(n,t,e,r="_id"){const s=new Float32Array(n.numRows),o=n.getChild(r);if(o===null)throw new Error(`Field ${r} not found in batch`);if(o.type.typeId===Q.Int64||o.type.typeId===Q.Uint64){for(let d=0;d<n.numRows;d++){const p=t[String(o.get(d))];p!==void 0&&(s[d]=p)}return s}const f=new Set;for(const d of Object.keys(t)){const p=[0,1,2,3].map(w=>d.charCodeAt(w)||"").join("");f.add(p)}const c=o.data[0].valueOffsets,l=o.data[0].values;for(let d=0;d<n.numRows;d++){const p=l.slice(c[d],c[d+1]),w=p.slice(0,4).join("");if(f.has(w)){const I=String.fromCharCode(...p);t[I]!==void 0&&(s[d]=t[I])}}return s}var Yx={},ig={},nB={get exports(){return ig},set exports(n){ig=n}};(function(n,t){(function(e,r){n.exports=r()})(ls,function(){function e(f,c,l,d,p){r(f,c,l||0,d||f.length-1,p||o)}function r(f,c,l,d,p){for(;d>l;){if(d-l>600){var w=d-l+1,I=c-l+1,C=Math.log(w),V=.5*Math.exp(2*C/3),Wt=.5*Math.sqrt(C*V*(w-V)/w)*(I-w/2<0?-1:1),Qt=Math.max(l,Math.floor(c-I*V/w+Wt)),Rt=Math.min(d,Math.floor(c+(w-I)*V/w+Wt));r(f,c,Qt,Rt,p)}var oe=f[c],Zt=l,st=d;for(s(f,l,c),p(f[d],oe)>0&&s(f,l,d);Zt<st;){for(s(f,Zt,st),Zt++,st--;p(f[Zt],oe)<0;)Zt++;for(;p(f[st],oe)>0;)st--}p(f[l],oe)===0?s(f,l,st):(st++,s(f,st,d)),st<=c&&(l=st+1),c<=st&&(d=st-1)}}function s(f,c,l){var d=f[c];f[c]=f[l],f[l]=d}function o(f,c){return f<c?-1:f>c?1:0}return e})})(nB);(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=ig,e=[],r=function(at){return e.push(at)},s=function(at){at&&(r(at),d(at)||at.children.forEach(s))},o=function(at){var Y=e.pop();return Y?(Y.children=at,Y.height=1,Y.leaf=!0,Y.minX=1/0,Y.minY=1/0,Y.minZ=1/0,Y.maxX=-1/0,Y.maxY=-1/0,Y.maxZ=-1/0):Y={children:at,height:1,leaf:!0,minX:1/0,minY:1/0,minZ:1/0,maxX:-1/0,maxY:-1/0,maxZ:-1/0},Y},f=[],c=function(at){return f.push(at)},l=function(at,Y){var rt=f.pop();return rt?(rt.dist=at,rt.node=Y):rt={dist:at,node:Y},rt},d=function(at){return at.leaf},p=function(at,Y){return at.leaf},w=function(at,Y,rt){if(!rt)return Y.indexOf(at);for(var Bt=0;Bt<Y.length;Bt++)if(rt(at,Y[Bt]))return Bt;return-1},I=function(at){C(at,0,at.children.length,at)},C=function(at,Y,rt,Bt){var Dt=Bt;Dt?(Dt.minX=1/0,Dt.minY=1/0,Dt.minZ=1/0,Dt.maxX=-1/0,Dt.maxY=-1/0,Dt.maxZ=-1/0):Dt=o([]);for(var F=Y,ft=void 0;F<rt;F++)ft=at.children[F],V(Dt,ft);return Dt},V=function(at,Y){return at.minX=Math.min(at.minX,Y.minX),at.minY=Math.min(at.minY,Y.minY),at.minZ=Math.min(at.minZ,Y.minZ),at.maxX=Math.max(at.maxX,Y.maxX),at.maxY=Math.max(at.maxY,Y.maxY),at.maxZ=Math.max(at.maxZ,Y.maxZ),at},Wt=function(at){return(at.maxX-at.minX)*(at.maxY-at.minY)*(at.maxZ-at.minZ)},Qt=function(at){return at.maxX-at.minX+(at.maxY-at.minY)+(at.maxZ-at.minZ)},Rt=function(at,Y){var rt=Math.min(at.minX,Y.minX),Bt=Math.min(at.minY,Y.minY),Dt=Math.min(at.minZ,Y.minZ),F=Math.max(at.maxX,Y.maxX),ft=Math.max(at.maxY,Y.maxY),H=Math.max(at.maxZ,Y.maxZ);return(F-rt)*(ft-Bt)*(H-Dt)},oe=function(at,Y){var rt=Math.max(at.minX,Y.minX),Bt=Math.max(at.minY,Y.minY),Dt=Math.max(at.minZ,Y.minZ),F=Math.min(at.maxX,Y.maxX),ft=Math.min(at.maxY,Y.maxY),H=Math.min(at.maxZ,Y.maxZ);return Math.max(0,F-rt)*Math.max(0,ft-Bt)*Math.max(0,H-Dt)},Zt=function(at,Y){return at.minX<=Y.minX&&at.minY<=Y.minY&&at.minZ<=Y.minZ&&Y.maxX<=at.maxX&&Y.maxY<=at.maxY&&Y.maxZ<=at.maxZ};n.intersects=function(at,Y){return Y.minX<=at.maxX&&Y.minY<=at.maxY&&Y.minZ<=at.maxZ&&Y.maxX>=at.minX&&Y.maxY>=at.minY&&Y.maxZ>=at.minZ},n.boxRayIntersects=function(at,Y,rt,Bt,Dt,F,ft){var H=(at.minX-Y)*Dt,yt=(at.maxX-Y)*Dt,Lt=(at.minY-rt)*F,Kt=(at.maxY-rt)*F,ee=(at.minZ-Bt)*ft,de=(at.maxZ-Bt)*ft,Oe=Math.min(ee,de),ye=Math.max(ee,de),Ze=Math.min(Lt,Kt),on=Math.max(Lt,Kt),En=Math.min(H,yt),Dn=Math.max(H,yt),hn=Math.max(0,En,Ze,Oe),Fn=Math.min(Dn,on,ye);return Fn>=hn?hn:1/0};var st=function(at,Y,rt,Bt,Dt){for(var F=[Y,rt],ft;F.length;)rt=F.pop(),Y=F.pop(),!(rt-Y<=Bt)&&(ft=Y+Math.ceil((rt-Y)/Bt/2)*Bt,t(at,ft,Y,rt,Dt),F.push(Y,ft,ft,rt))},zt=function(at,Y){return at.minX-Y.minX},ue=function(at,Y){return at.minY-Y.minY},ve=function(at,Y){return at.minZ-Y.minZ},an=function(){function at(Y){Y===void 0&&(Y=16),this.maxEntries=Math.max(Y,8),this.minEntries=Math.max(4,Math.ceil(this.maxEntries*.4)),this.clear()}return at.alloc=function(){return this.pool.pop()||new this},at.free=function(Y){Y.clear(),this.pool.push(Y)},at.prototype.search=function(Y){var rt=this.data,Bt=[];if(!n.intersects(Y,rt))return Bt;for(var Dt=[];rt;){for(var F=0,ft=rt.children.length;F<ft;F++){var H=rt.children[F];n.intersects(Y,H)&&(p(rt)?Bt.push(H):Zt(Y,H)?this._all(H,Bt):Dt.push(H))}rt=Dt.pop()}return Bt},at.prototype.collides=function(Y){var rt=this.data;if(!n.intersects(Y,rt))return!1;for(var Bt=[];rt;){for(var Dt=0,F=rt.children.length;Dt<F;Dt++){var ft=rt.children[Dt];if(n.intersects(Y,ft)){if(p(rt)||Zt(Y,ft))return!0;Bt.push(ft)}}rt=Bt.pop()}return!1},at.prototype.raycastInv=function(Y,rt,Bt,Dt,F,ft,H){H===void 0&&(H=1/0);var yt=this.data;if(Dt===1/0&&F===1/0&&ft===1/0||n.boxRayIntersects(yt,Y,rt,Bt,Dt,F,ft)===1/0)return l(1/0,void 0);for(var Lt=[l(0,yt)],Kt=function(hn,Fn){var ir=Lt[hn];Lt[hn]=Lt[Fn],Lt[Fn]=ir},ee=function(){var hn=Lt[0],Fn=Lt.length-1;Lt[0]=Lt[Fn],Lt.length=Fn;for(var ir=0;;){var Kn=ir<<1|1;if(Kn>=Fn)break;var Yr=Kn+1;if(Yr<Fn&&Lt[Yr].dist<Lt[Kn].dist&&(Kn=Yr),Lt[ir].dist<Lt[Kn].dist)break;Kt(ir,Kn),ir=Kn}return c(hn),hn.node},de=function(hn,Fn){var ir=Lt.length;for(Lt.push(l(hn,Fn));ir>0;){var Kn=ir-1>>1;if(Lt[Kn].dist<=Lt[ir].dist)break;Kt(ir,Kn),ir=Kn}},Oe=H,ye;Lt.length&&Lt[0].dist<Oe;){yt=ee();for(var Ze=0,on=yt.children.length;Ze<on;Ze++){var En=yt.children[Ze],Dn=n.boxRayIntersects(En,Y,rt,Bt,Dt,F,ft);if(!p(yt))de(Dn,En);else if(Dn<Oe){if(Dn===0)return l(Dn,En);Oe=Dn,ye=En}}}return l(Oe<H?Oe:1/0,ye)},at.prototype.raycast=function(Y,rt,Bt,Dt,F,ft,H){return H===void 0&&(H=1/0),this.raycastInv(Y,rt,Bt,1/Dt,1/F,1/ft,H)},at.prototype.all=function(){return this._all(this.data,[])},at.prototype.load=function(Y){if(!(Y&&Y.length))return this;if(Y.length<this.minEntries){for(var rt=0,Bt=Y.length;rt<Bt;rt++)this.insert(Y[rt]);return this}var Dt=this.build(Y.slice(),0,Y.length-1,0);if(!this.data.children.length)this.data=Dt;else if(this.data.height===Dt.height)this.splitRoot(this.data,Dt);else{if(this.data.height<Dt.height){var F=this.data;this.data=Dt,Dt=F}this._insert(Dt,this.data.height-Dt.height-1,!0)}return this},at.prototype.insert=function(Y){return Y&&this._insert(Y,this.data.height-1),this},at.prototype.clear=function(){return this.data&&s(this.data),this.data=o([]),this},at.prototype.remove=function(Y,rt){if(!Y)return this;for(var Bt=this.data,Dt=0,F=!1,ft,H,yt=[],Lt=[];Bt||yt.length;){if(Bt||(Bt=yt.pop(),Dt=Lt.pop(),H=yt[yt.length-1],F=!0),d(Bt)&&(ft=w(Y,Bt.children,rt),ft!==-1))return Bt.children.splice(ft,1),yt.push(Bt),this.condense(yt),this;!F&&!d(Bt)&&Zt(Bt,Y)?(yt.push(Bt),Lt.push(Dt),Dt=0,H=Bt,Bt=Bt.children[0]):H?(Dt++,Bt=H.children[Dt],F=!1):Bt=void 0}return this},at.prototype.toJSON=function(){return this.data},at.prototype.fromJSON=function(Y){return s(this.data),this.data=Y,this},at.prototype.build=function(Y,rt,Bt,Dt){var F=Bt-rt+1,ft=this.maxEntries,H;if(F<=ft)return H=o(Y.slice(rt,Bt+1)),I(H),H;Dt||(Dt=Math.ceil(Math.log(F)/Math.log(ft)),ft=Math.ceil(F/Math.pow(ft,Dt-1))),H=o([]),H.leaf=!1,H.height=Dt;var yt=Math.ceil(F/ft),Lt=yt*Math.ceil(Math.pow(ft,2/3)),Kt=yt*Math.ceil(Math.pow(ft,1/3));st(Y,rt,Bt,Kt,zt);for(var ee=rt;ee<=Bt;ee+=Kt){var de=Math.min(ee+Kt-1,Bt);st(Y,ee,de,Lt,ue);for(var Oe=ee;Oe<=de;Oe+=Lt){var ye=Math.min(Oe+Lt-1,de);st(Y,Oe,ye,yt,ve);for(var Ze=Oe;Ze<=ye;Ze+=yt){var on=Math.min(Ze+yt-1,ye);H.children.push(this.build(Y,Ze,on,Dt-1))}}}return I(H),H},at.prototype._all=function(Y,rt){for(var Bt=[];Y;)d(Y)?rt.push.apply(rt,Y.children):Bt.push.apply(Bt,Y.children),Y=Bt.pop();return rt},at.prototype.chooseSubtree=function(Y,rt,Bt,Dt){for(var F,ft,H;Dt.push(rt),!(d(rt)||Dt.length-1===Bt);){F=ft=1/0;for(var yt=0,Lt=rt.children.length;yt<Lt;yt++){var Kt=rt.children[yt],ee=Wt(Kt),de=Rt(Y,Kt)-ee;de<ft?(ft=de,F=ee<F?ee:F,H=Kt):de===ft&&ee<F&&(F=ee,H=Kt)}rt=H||rt.children[0]}return rt},at.prototype.split=function(Y,rt){var Bt=Y[rt],Dt=Bt.children.length,F=this.minEntries;this.chooseSplitAxis(Bt,F,Dt);var ft=this.chooseSplitIndex(Bt,F,Dt),H=o(Bt.children.splice(ft,Bt.children.length-ft));H.height=Bt.height,H.leaf=Bt.leaf,I(Bt),I(H),rt?Y[rt-1].children.push(H):this.splitRoot(Bt,H)},at.prototype.splitRoot=function(Y,rt){this.data=o([Y,rt]),this.data.height=Y.height+1,this.data.leaf=!1,I(this.data)},at.prototype.chooseSplitIndex=function(Y,rt,Bt){for(var Dt=1/0,F=1/0,ft,H=rt;H<=Bt-rt;H++){var yt=C(Y,0,H),Lt=C(Y,H,Bt),Kt=oe(yt,Lt),ee=Wt(yt)+Wt(Lt);Kt<Dt?(Dt=Kt,ft=H,F=ee<F?ee:F):Kt===Dt&&ee<F&&(F=ee,ft=H)}return ft},at.prototype.chooseSplitAxis=function(Y,rt,Bt){var Dt=this.allDistMargin(Y,rt,Bt,zt),F=this.allDistMargin(Y,rt,Bt,ue),ft=this.allDistMargin(Y,rt,Bt,ve);Dt<F&&Dt<ft?Y.children.sort(zt):F<Dt&&F<ft&&Y.children.sort(ue)},at.prototype.allDistMargin=function(Y,rt,Bt,Dt){Y.children.sort(Dt);for(var F=C(Y,0,rt),ft=C(Y,Bt-rt,Bt),H=Qt(F)+Qt(ft),yt=rt;yt<Bt-rt;yt++){var Lt=Y.children[yt];V(F,Lt),H+=Qt(F)}for(var yt=Bt-rt-1;yt>=rt;yt--){var Lt=Y.children[yt];V(ft,Lt),H+=Qt(ft)}return H},at.prototype.adjustParentBBoxes=function(Y,rt,Bt){for(var Dt=Bt;Dt>=0;Dt--)V(rt[Dt],Y)},at.prototype.condense=function(Y){for(var rt=Y.length-1,Bt=void 0;rt>=0;rt--)Y[rt].children.length===0?rt>0?(Bt=Y[rt-1].children,Bt.splice(Bt.indexOf(Y[rt]),1),r(Y[rt])):this.clear():I(Y[rt])},at.prototype._insert=function(Y,rt,Bt){var Dt=[],F=this.chooseSubtree(Y,this.data,rt,Dt);for(F.children.push(Y),V(F,Y);rt>=0&&Dt[rt].children.length>this.maxEntries;)this.split(Dt,rt),rt--;this.adjustParentBBoxes(Y,Dt,rt)},at.pool=[],at}();n.RBush3D=an})(Yx);const g0=H5();function rB(n){const[t,e]=n._zoom.scales().x.range(),[r,s]=n._zoom.scales().x.domain();return(e-t)/(s-r)}const eb=0;class iB extends n1{constructor(t,e,r={}){super(t.div.node(),t._root,t),this.layers=[],this.options={},this.options=r,this.canvas=t.elements[2].selectAll("canvas").node();const s=t.elements[3].selectAll("svg").node(),o=e.replace(/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~]/g,"---"),f=s.querySelectorAll(`#${o}`);if(f.length===0?this.labelgroup=Wn(s).select("#labelrects").append("g").attr("id",o).node():this.labelgroup=f[1],this.canvas===void 0)throw new Error("WTF?");this.ctx=this.canvas.getContext("2d"),this.tree=new oB(this.ctx,rB(t),.5,[.5,1e6],r.margin===void 0?30:r.margin),this.bind_zoom(t._renderer.zoom)}start(t=1e9){this.timer&&this.timer.stop(),Wn(this.labelgroup).attr("display","inline"),this.timer=id(()=>{this.render(),t-=1,t<=0&&this.stop()})}delete(){Wn(this.labelgroup).remove()}stop(){this.timer&&(this.timer.stop(),Wn(this.labelgroup).attr("display","none"),this.ctx.clearRect(0,0,4096,4096),this.timer=void 0)}update(t,e,r){var s;this.label_key=e;for(const o of t.features){const{properties:f,geometry:c}=o;if(f!==null&&c.type==="Point"){const l=(s=f[r])!=null?s:16;let d="";f[e]!==void 0&&f[e]!==null&&(d=f[e]);const p={x:c.coordinates[0]+Math.random()*.1,y:c.coordinates[1]+Math.random()*.1,text:d,height:l,properties:f};this.tree.insert_point(p)}}}render(){const t=this.ctx,{x_:e,y_:r}=this.zoom.scales(),{transform:s}=this.zoom,{width:o,height:f}=this;t.clearRect(0,0,o,f),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=1;const c=1,l=this.zoom.current_corners(),d=this.tree.search({minX:l.x[0],minY:l.y[0],minZ:s.k,maxX:l.x[1],maxY:l.y[1],maxZ:s.k});t.clearRect(0,0,4096,4096);const p=this.scatterplot.dim("color"),w=Wn(this.labelgroup).selectAll("rect.labelbbox").data(d,C=>""+C.minZ+C.minX).join(C=>C.append("rect").attr("class","labellbox").style("opacity",eb)),I=5;for(const C of d){const V=C.data,Wt=e(V.x),Qt=r(V.y);t.globalAlpha=1,t.fillStyle="white";let Rt=!1;for(const Zt of[this.scatterplot.dim("filter"),this.scatterplot.dim("filter2")])V.properties[Zt.field]&&(Zt.apply(V.properties)||(Rt=!0));if(Rt){V.properties.__display="none";continue}else V.properties.__display="inline";this.options.useColorScale===!1||this.options.useColorScale===void 0?(t.shadowColor="#71797E",t.strokeStyle="#71797E"):V.properties[p.field]?p.scale.domain().indexOf(V.properties[p.field])>-1?(t.shadowColor=p.scale(V.properties[p.field]),t.strokeStyle=p.scale(V.properties[p.field])):(t.shadowColor="gray",t.strokeStyle="gray"):t.shadowColor="black";let oe=0;this.hovered===""+C.minZ+C.minX&&(oe+=2),t.font=`${V.height*c+oe}pt verdana`,t.shadowBlur=12+oe*3,t.lineWidth=3+oe,t.strokeText(V.text,Wt,Qt),t.shadowBlur=0,t.lineWidth=4+oe,t.fillStyle="white",t.fillText(V.text,Wt,Qt)}w.attr("class","labelbbox").attr("x",C=>e(C.data.x)-C.data.pixel_width*this.tree.pixel_ratio/2).attr("y",C=>r(C.data.y)-C.data.pixel_height*this.tree.pixel_ratio/2-I).attr("width",C=>C.data.pixel_width*this.tree.pixel_ratio).attr("stroke","red").attr("height",C=>C.data.pixel_height*this.tree.pixel_ratio+I*2).attr("display",C=>C.data.properties.__display||"inline").on("mouseover",(C,V)=>{Wn(C.target).style("opacity",eb),this.hovered=""+V.minZ+V.minX,C.stopPropagation()}).on("mousemove",function(C,V){C.stopPropagation()}).on("click",(C,V)=>{this.scatterplot.label_click(V.data,this.scatterplot,this)}).on("mouseout",(C,V)=>{this.hovered=void 0,C.stopPropagation()}),this.options.draggable_labels&&(g0.on("drag",(C,V)=>{V.data.x=e.invert(C.x),V.data.y=r.invert(C.y)}),g0.on("end",(C,V)=>{console.log({text:V.data.text,x:V.data.x,y:V.data.y})}),w.call(g0)),t.shadowColor="black",t.strokeStyle="black"}}let b_=null;function sB(){if(b_!==null)return b_;const n=document.createElement("canvas");return n.width=500,n.height=400,b_=n.getContext("2d"),b_}function aB(n,t,e){const r=sB();if(r.font=`${n.height}pt verdana`,n.text==="")return null;const s=r.measureText(n.text);let{actualBoundingBoxLeft:o,actualBoundingBoxRight:f,actualBoundingBoxAscent:c,actualBoundingBoxDescent:l}=s;return(Number.isNaN(o)||o===void 0)&&(o=0,f=s.width,c=n.height,l=0),{pixel_height:(c-l)/t+e/t,pixel_width:(f-o)/t+e/t}}class oB extends Yx.RBush3D{constructor(t,e,r=.5,s=[.1,1e3],o=10){super(),this._accessor=f=>[f.x,f.y],this.scale_factor=r,this.mindepth=s[0],this.maxdepth=s[1],this.context=t,this.pixel_ratio=e,this.margin=o}max_collision_depth(t,e){const[r,s]=this._accessor(t),[o,f]=this._accessor(e),c=Math.abs(r-o),d=(t.pixel_width+e.pixel_width)/2/c,p=Math.abs(s-f),I=(t.pixel_height+e.pixel_height)/2/p;return Math.min(d,I)}set accessor(t){this._accessor=t}get accessor(){return this._accessor}to3d(t,e=1,r){const[s,o]=this.accessor(t),{pixel_height:f,pixel_width:c}=t,l={minX:s-c/e/2,maxX:s+c/e/2,minY:o-f/e/2,maxY:o+f/e/2,minZ:e,maxZ:r||this.maxdepth,data:t};if(Number.isNaN(s)||Number.isNaN(o))throw"Missing position"+JSON.stringify(t);if(Number.isNaN(c))throw"Missing Aspect Ratio"+JSON.stringify(t);return l}insert_point(t,e=1/4){if(t.text===void 0||t.text==="")return;let r;t.pixel_width===void 0?r={...t,...aB(t,this.pixel_ratio,this.margin)}:r=t;const s=this.to3d(r,e,this.maxdepth);this.collides(s)?this.insert_after_collisions(s):e<=this.mindepth?this.insert(s):this.insert_point(t,e/2)}insert_after_collisions(t){let e=-1,r;for(const s of this.search(t)){const o=this.max_collision_depth(t.data,s.data);o>e&&(e=o,r=s)}if(r&&e<this.maxdepth){const s=r.data,o=r.minZ,f=r.maxZ;if(o<e){this.remove(r);const l=this.to3d(s,o,e);this.insert(l);const d=this.to3d(s,e,f);this.insert(d)}const c=this.to3d(t.data,e,this.maxdepth);this.insert(c)}}}function fB(n){return n.ids!==void 0}function uB(n){return n.field!==void 0}function cB(n){return n.composition!==void 0}function lB(n){if(n===void 0)throw new Error("Undefined composition");if(!n||!n.length)return!1;const t=n[0];return["AND","OR","XOR","NOT","ANY","ALL"].indexOf(t)==0}async function w_(n,t){if(lB(t))return Hx(n,t);{const e=n.get_column(t.name);return ta.from_arrow(await e)}}async function Hx(n,t){if(t[0],t[0]==="NOT")return(await w_(n,t[1])).not();if(dB(t)){const[e,r,s]=t,o=await w_(n,r),f=await w_(n,s);if(e==="AND")return o.and(f);if(e==="OR")return o.or(f);if(e==="XOR")return o.xor(f);throw new Error("Unknown binary operation")}else if(hB(t)){const e=t[0],r=await Promise.all(t.slice(1).map(o=>w_(n,o))),s=r.slice(1).reduce((o,f)=>{switch(e){case"ALL":return o.and(f);case"ANY":return o.or(f);case"NONE":return o.or(f)}},r[0]);return e==="NONE"?s.not():s}throw console.error("UNABLE TO PARSE",t),new Error("UNABLE TO PARSE")}function hB(n){return new Set(["ANY","ALL","NONE"]).has(n[0])}function dB(n){return new Set(["AND","OR","XOR","NAND"]).has(n[0])}function _B(n){return n.tileFunction!==void 0}class ta{constructor(t,e){this.length=t,this.mask=e||new Uint8Array(Math.ceil(t/8))}static from_arrow(t){const e=t.data[0].values;return new ta(t.length,e)}to_arrow(){return new Ie([Te({type:new Yc,data:this.mask,length:this.length})])}set(t){const e=Math.floor(t/8),r=t%8;this.mask[e]|=1<<r}and(t){const e=new ta(this.length);for(let r=0;r<this.mask.length;r++)e.mask[r]=this.mask[r]&t.mask[r];return e}or(t){const e=new ta(this.length);for(let r=0;r<this.mask.length;r++)e.mask[r]=this.mask[r]|t.mask[r];return e}xor(t){const e=new ta(this.length);for(let r=0;r<this.mask.length;r++)e.mask[r]=this.mask[r]^t.mask[r];return e}not(){const t=new ta(this.length);for(let e=0;e<this.mask.length;e++)t.mask[e]=~this.mask[e];return t}}class Pc{constructor(t,e){this.match_count=[],this.cursor=0,this.complete=!1,this.selectionSize=0,this.evaluationSetSize=0,this.tiles=[],this.composition=null,this.events={},this.plot=t,this.dataset=t.dataset,this.name=e.name;let r=function(){};if(this.ready=new Promise((s,o)=>{r=s}),this.composition=null,fB(e))this.add_identifier_column(e.name,e.ids,e.idField).then(r);else if(uB(e))this.add_boolean_column(e.name,e.field).then(r);else if(_B(e))this.add_function_column(e.name,e.tileFunction).then(r);else if(cB(e)){const{name:s,composition:o}=e;this.composition=o,this.add_function_column(s,async f=>(await Hx(f,o)).to_arrow()).then(r)}}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}dispatch(t,e){this.events[t]&&this.events[t].forEach(r=>r(e))}applyToAllLoadedTiles(){return Promise.all(this.dataset.map(t=>{if(t.ready)return t.get_column(this.name)})).then(()=>{})}applyToAllTiles(){throw new Error("Method not implemented.")}union(t,e){return new Pc(this.plot,{name:e||this.name+" union "+t.name,composition:["OR",this,t]})}intersection(t,e){return new Pc(this.plot,{name:e||this.name+" intersection "+t.name,composition:["AND",this,t]})}moveCursor(t){return this.cursor+=t,this.cursor>=this.selectionSize&&(this.cursor=this.cursor%this.selectionSize),this.cursor<0&&(this.cursor=this.selectionSize+this.cursor),this}async removePoints(t,e){return this.add_or_remove_points(t,e,"remove")}async addPoints(t,e){return this.add_or_remove_points(t,e,"add")}async export(t,e="json"){const r=Object.fromEntries(t.map(s=>[s,[]]));for(let s of this)for(let o of t)r[o].push(s[o]);return r}moveCursorToPoint(t){const e=t.ix;if(t.ix===void 0)throw new Error("Unable to move cursor to point, because it has no `ix` property.");let r=0,s,o=0,f;for(let l of this.match_count){const d=this.tiles[o];if(d.min_ix<e&&d.max_ix>e){const p=v0([...d.record_batch.getChild("ix").data[0].values],t.ix),w=d.record_batch.get(p);if(w!==null&&w.ix===e){s=d,f=p;break}}o+=1,r+=l}if(s===void 0||f===void 0)return null;const c=s.record_batch.getChild(this.name);for(let l=0;l<f;l++)c.get(l)&&(r+=1);this.cursor=r}async add_or_remove_points(t,e,r){let s=0,o;const f=async l=>{s=-1,await this.ready;let d=(await l.get_column(this.name)).toArray();const p=l.record_batch.getChild("ix").data[0].values;for(let w of e){const I=v0([...p],w),C=l.record_batch.get(I);if(C!==null&&C.ix===w)if(d=new Float32Array(d),r==="add"){if(d[I]=1,e.length===1){o=l.key;let V=0;for(let Wt=0;Wt<I;Wt++)d[Wt]>0&&(V+=1);s=V}}else d[I]=0}return d},c=new Pc(this.plot,{name:t,tileFunction:f});c.on("tile loaded",()=>{if(s>=0){c.cursor=s;for(let l=0;l<c.tiles.length&&c.tiles[l].key!==o;l++)c.cursor+=this.match_count[l]}}),await c.ready;for(const l of this.tiles)await l.get_column(t);return c}get ordering(){throw new Error("Method not implemented.")}async add_function_column(t,e){if(this.dataset.has_column(t))throw new Error(`Column ${t} already exists, can't create`);this.plot.dataset.transformations[t]=this.wrapWithSelectionMetadata(e),await this.dataset.root_tile.apply_transformation(t)}wrapWithSelectionMetadata(t){return async e=>{const r=await t(e),s=e.record_batch;let o=0;for(let f=0;f<s.numRows;f++)(r.get&&r.get(f)||r[f])&&o++;return this.match_count.push(o),this.tiles.push(e),this.selectionSize+=o,this.evaluationSetSize+=s.numRows,this.dispatch("tile loaded",e),r}}get totalSetSize(){return this.dataset.highest_known_ix}get(t){if(t===void 0&&(t=this.cursor),t>this.selectionSize)throw new Error(`Index ${t} out of bounds for selection of size ${this.selectionSize}`);let e=0,r,s=0;for(let l of this.match_count){if(t<e+l){r=this.tiles[s];break}s+=1,e+=l}if(r===void 0)return null;const o=r.record_batch.getChild(this.name),f=t-e;let c=0;for(let l=0;l<o.length;l++)if(o.get(l)){if(c===f)return r.record_batch.get(l);c++}throw new Error(`unable to locate point ${t}`)}*[Symbol.iterator](){for(let t of this.tiles){const e=t.record_batch.getChild(this.name);for(let r=0;r<e.length;r++)e.get(r)&&(yield t.record_batch.get(r))}}async add_identifier_column(t,e,r,s={}){if(this.dataset.has_column(t))throw new Error(`Column ${t} already exists, can't create`);if(typeof e[0]=="string"){const o=mB(r,e);this.plot.dataset.transformations[t]=this.wrapWithSelectionMetadata(o),await this.dataset.root_tile.apply_transformation(t)}else if(typeof e[0]=="bigint"){const o=pB(r,e);this.plot.dataset.transformations[t]=this.wrapWithSelectionMetadata(o),await this.dataset.root_tile.apply_transformation(t)}else console.error("Unable to match type",typeof e[0]);if(s.plot_after)return this.apply_to_foreground({})}async add_boolean_column(t,e){throw new Error("Method not implemented.")}apply_to_foreground(t){const e=this.name,r={size:[.5,10],...t};return this.plot.plotAPI({background_options:r,encoding:{foreground:{field:e,op:"gt",a:0}}})}}function pB(n,t){const e=new Set(t);return async function(r){const o=(await r.get_column(n)).data[0].values,f=new ta(r.record_batch.numRows);for(let c=0;c<r.record_batch.numRows;c++)e.has(o[c])&&f.set(c);return f.to_arrow()}}function mB(n,t){if(n===void 0)throw new Error("Field must be defined");const e=[];function r(o){let f=e;for(const c of o)f[c]||(f[c]=[]),f=f[c];f[256]=[]}const s=new TextEncoder;for(const o of t){const f=s.encode(o);r(f)}return async function(o){const f=(await o.get_column(n)).data[0],c=f.values,l=f.valueOffsets,d=new ta(o.record_batch.numRows);function p(w,I){let C=e;for(let V=0;V<I;V++){const Wt=c[w+V];if(C=C[Wt],!C)return!1}return C[256]!==void 0}for(let w=0;w<o.record_batch.numRows;w++){const I=l[w],C=l[w+1];p(I,C-I)&&d.set(w)}return d.to_arrow()}}let gB=7540;function yB(n,t){const e=Ax(n,new Wc);return t===void 0?r=>nb(e,r):nb(e,t)}function nb(n,t){let e;if(t[Symbol.toStringTag]==="Int8Array")e=new Mg;else if(t[Symbol.toStringTag]==="Int16Array")e=new Lg;else if(t[Symbol.toStringTag]==="Int32Array")e=new Qo;else throw new Error("values must be an array of signed integers, 32 bit or smaller.");const r=new aa(n.type,e,gB++,!1);return tu({type:r,length:t.length,nullCount:0,data:t,dictionary:n})}const vB={color:"gray",opacity:[.2,1],size:[.66,1],mouseover:!1},bB={zoom_balance:.35,duration:1e3,max_points:1e3,encoding:{},point_size:1,alpha:40,background_options:vB,zoom_align:"center"},wB=[{id:"canvas-2d-background",nodetype:"canvas"},{id:"webgl-canvas",nodetype:"canvas"},{id:"canvas-2d",nodetype:"canvas"},{id:"deepscatter-svg",nodetype:"svg"}];class cd{constructor(t,e,r,s={}){this.secondary_renderers={},this.selection_history=[],this.util={dictionaryFromArrays:yB,vectorFromArray:Ax},this.plot_queue=Promise.resolve(),this.hooks={},this.mark_ready=function(){},this.bound=!1,t!==void 0&&this.bind(t,e,r),this.width=e,this.height=r,this.ready=new Promise((o,f)=>{this.mark_ready=o}),this.click_handler=new SB(this),this.tooltip_handler=new EB(this),this.label_click_handler=new xB(this),this.handle_highlit_point_change=new AB(this),s.tileProxy&&(this.tileProxy=s.tileProxy),s.dataset&&this.load_dataset(s.dataset),this.prefs={...bB}}bind(t,e,r){if(this.div=Wn(t).selectAll("div.deepscatter_container").data([1]).join("div").attr("class","deepscatter_container").style("position","absolute"),this.div.empty())throw console.error(t),"Must pass a valid div selector";this.elements=[];for(const s of wB){const o=this.div.append("div").attr("id",`container-for-${s.id}`).style("position","absolute").style("top",0).style("left",0).style("pointer-events",s.id==="deepscatter-svg"?"auto":"none"),f=o.append(s.nodetype).attr("id",s.id).attr("width",e||window.innerWidth).attr("height",r||window.innerHeight);s.nodetype==="svg"&&(f.append("g").attr("id","mousepoints"),f.append("g").attr("id","labelrects")),this.elements.push(o)}this.bound=!0}async select_and_plot(t,e=this.prefs.duration){const r=await this.select_data(t);return await r.ready,await this.plotAPI({duration:e,encoding:{foreground:{field:r.name,op:"eq",a:1}}}),r}async select_data(t){if(t.useNameCache&&t.name&&this.selection_history.length>0){const r=this.selection_history.find(s=>s.name===t.name);if(r)return this.selection_history=[...this.selection_history.filter(s=>s.name!==t.name),r],r.selection}const e=new Pc(this,t);return this.selection_history.push({selection:e,name:e.name,flushed:!1}),await e.ready,e}add_identifier_column(t,e,r){const s=Array.isArray(e)?Object.fromEntries(e.map(o=>[o,1])):e;this._root.add_label_identifiers(s,t,r)}async add_labels_from_url(t,e,r,s,o){return await this.ready,await this._root.promise,fetch(t).then(async f=>{const c=await f.json();this.add_labels(c,e,r,s,o)}).catch(f=>{console.warn(f),console.error("Broken addition of ",e)})}add_labels(t,e,r,s,o={}){const f=new iB(this,e,o);f.update(t,r,s),this.secondary_renderers[e]=f,this.secondary_renderers[e].start()}get dataset(){if(this._root===void 0)throw new Error("No dataset has been loaded");return this._root}add_api_label(t){const e={type:"FeatureCollection",features:t.labels.map(r=>({type:"Feature",geometry:{type:"Point",coordinates:[r.x,r.y]},properties:{text:r.text,size:r.size||void 0}}))};this.add_labels(e,t.name,"text","size",t.options||{})}async load_dataset(t){if(t.source_url!==void 0)this._root=Uh.from_quadfeather(t.source_url,this);else if(t.arrow_table!==void 0)this._root=Uh.from_arrow_table(t.arrow_table,this);else if(t.arrow_buffer!==void 0){const e=el(t.arrow_buffer);this._root=Uh.from_arrow_table(e,this)}else throw new Error("No source_url or arrow_table specified");return await this._root.ready,this._root}async reinitialize(){var t;const{prefs:e}=this;await this._root.ready,this._renderer=new H7("#container-for-webgl-canvas",this._root,this),this._zoom=new mT("#deepscatter-svg",this.prefs,this),this._zoom.attach_tiles(this._root),this._zoom.attach_renderer("regl",this._renderer),this._zoom.initialize_zoom();const s=Wn("#container-for-canvas-2d-background").select("canvas").node().getContext("2d");return s.fillStyle=(t=e.background_color)!=null?t:"rgba(133, 133, 111, .8)",s.fillRect(0,0,window.innerWidth*2,window.innerHeight*2),this._renderer.initialize(),this._root.promise.then(()=>this.mark_ready()),this.ready}visualize_tiles(){const e=this.elements[2].selectAll("canvas").node().getContext("2d");e.clearRect(0,0,1e4,1e4);const{x_:r,y_:s}=this._zoom.scales();e.strokeStyle="#888888";const o=this._root.map(f=>f);for(const f of ou(20))setTimeout(()=>{for(const c of o){if(!c.codes||c.codes[0]!=f||!c.extent)continue;const[l,d]=c.extent.x.map(C=>r(C)),[p,w]=c.extent.y.map(C=>s(C)),I=c.codes[0];e.lineWidth=8/Math.sqrt(I),e.globalAlpha=.33,e.strokeRect(l,p,d-l,w-p),c.download_state!=="Unattempted"&&e.fillRect(l,p,d-l,w-p),e.globalAlpha=1}},f*400);setTimeout(()=>e.clearRect(0,0,1e4,1e4),17*400)}destroy(){var t,e,r;(e=(t=this._renderer)==null?void 0:t.regl)==null||e.destroy(),(r=this.div)==null||r.node().parentElement.replaceChildren()}update_prefs(t){if(this.prefs.encoding&&t.encoding)for(const e of Object.keys(this.prefs.encoding))t.encoding[e]!==void 0&&(this.prefs.encoding[e]=t.encoding[e]);W_(this.prefs,t)}add_hook(t,e,r=!1){if(this.hooks[t]!==void 0&&!r)throw new Error(`Hook ${t} already exists`);this.hooks[t]=e}remove_hook(t,e=!1){if(this.hooks[t]===void 0){if(e)return;throw new Error(`Hook ${t} does not exist`)}delete this.hooks[t]}stop_labellers(){console.log("Stopping labels");for(const[t,e]of Object.entries(this.secondary_renderers))e&&e.label_key!==void 0&&(this.secondary_renderers[t].stop(),this.secondary_renderers[t].delete(),this.secondary_renderers[t]=void 0)}dim(t){return this._renderer.aes.dim(t).current}set tooltip_html(t){this.tooltip_handler.f=t}get tooltip_html(){return this.tooltip_handler.f}set label_click(t){this.label_click_handler.f=t}get label_click(){return this.label_click_handler.f.bind(this.label_click_handler)}set highlit_point_change(t){this.handle_highlit_point_change.f=t}get highlit_point_change(){return this.handle_highlit_point_change.f.bind(this.handle_highlit_point_change)}set click_function(t){this.click_handler.f=t}get click_function(){return this.click_handler.f}async plotAPI(t){if(t!==void 0){await this.plot_queue,t&&await this.start_transformations(t),this.plot_queue=this.unsafe_plotAPI(t),await this.plot_queue;for(const[e,r]of Object.entries(this.hooks))r()}}async start_transformations(t,e=110){return new Promise(r=>{this.prefs.duration<e&&(e=this.prefs.duration);const s=new Set;t.encoding||r();for(const[o,f]of Object.entries(t.encoding))f&&typeof f!="string"&&f.field!==void 0&&s.add(f.field);if(this._renderer){const o=[],f=[];for(const c of this._renderer.visible_tiles()){const l=c._buffer_manager;if(l!==void 0&&l.ready())for(const d of s){const{ready:p,promise:w}=l.ready_or_not_here_it_comes(d);p||w!==null&&(o.push(w),c.key==="0/0/0"&&f.push(w))}}if(o.length===0)r();else{const c=Date.now();Promise.all(f).then(()=>{const d=Date.now()-c;d<e?setTimeout(()=>{r()},e-d):r()})}}else r()})}async unsafe_plotAPI(t){var e;if(t===null)return;if(t.click_function&&(this.click_function=Function("datum",t.click_function)),t.tooltip_html&&(this.tooltip_html=Function("datum",t.tooltip_html)),t.background_options&&(t.background_options.opacity&&typeof t.background_options.opacity=="number"&&(t.background_options.opacity=[t.background_options.opacity,1]),t.background_options.size&&typeof t.background_options.size=="number"&&(t.background_options.size=[t.background_options.size,1])),this.update_prefs(t),this._root===void 0){const{source_url:o,arrow_table:f,arrow_buffer:c}=t,l={source_url:o,arrow_table:f,arrow_buffer:c};if(Object.values(l).filter(d=>d!==void 0).length!==1)throw new Error("The initial API call specify exactly one of source_url, arrow_table, or arrow_buffer");await this.load_dataset(l)}if(t.transformations)for(const[o,f]of Object.entries(t.transformations)){const c=Function("datum",f);this.dataset.transformations[o]?console.log("Already",o,f):this.dataset.register_transformation(o,c)}this._zoom===void 0&&await this.reinitialize(),t.basemap_gleofeather&&(t.polygons=[{file:t.basemap_gleofeather}]),this._renderer.render_props.apply_prefs(this.prefs);const{width:r,height:s}=this;if(this.update_prefs(t),t.zoom!==void 0&&(t.zoom===null?(this._zoom.zoom_to(1,r/2,s/2),t.zoom=void 0):(e=t.zoom)!=null&&e.bbox&&this._zoom.zoom_to_bbox(t.zoom.bbox,t.duration)),this._renderer.most_recent_restart=Date.now(),this._renderer.aes.apply_encoding(t.encoding),this._renderer.apply_webgl_scale&&this._renderer.apply_webgl_scale(t),this._renderer.reglframe&&(this._renderer.reglframe.cancel(),this._renderer.reglframe=void 0),this._renderer.reglframe=this._renderer.regl.frame(()=>{this._renderer.tick("Basic")}),t.labels!==void 0)if(TT(t.labels)){const{url:o,label_field:f,size_field:c}=t.labels,l=t.labels.name||o;this.secondary_renderers[l]||(this.stop_labellers(),this.add_labels_from_url(o,l,f,c).catch(d=>{console.error("Label addition failed."),console.error(d)}))}else if(IT(t.labels)){if(!t.labels.name)throw new Error("API field `labels` must have a name.");this.stop_labellers(),this.add_api_label(t.labels)}else if(t.labels===null)this.stop_labellers();else throw new Error("API field `labels` format not recognized.");this._zoom.restart_timer(6e4)}get root_batch(){if(!this._root)throw new Error("No dataset has been loaded");return this.dataset.root_tile.record_batch}get query(){const t=JSON.parse(JSON.stringify(this.prefs));return t.zoom={bbox:this._renderer.zoom.current_corners()},t}drawContours(t,e){const o=(e||Wn("body")).select("#canvas-2d").node().getContext("2d");for(const f of t){o.fillStyle="rgba(25, 25, 29, 1)",o.fillRect(0,0,window.innerWidth*2,window.innerHeight*2),o.strokeStyle="#8a0303",o.fillStyle="rgba(30, 30, 34, 1)",o.lineWidth=x0([.45,.25*Math.exp(Math.log(this._zoom.transform.k/2))]);const c=O5(N5().scale(this._zoom.transform.k).translate([this._zoom.transform.x,this._zoom.transform.y]),o);o.beginPath(),c(f),o.fill()}}sample_points(t=10){const e=[];for(const r of this._root.points(this._zoom.current_corners()))if(e.push({...r}),e.length>=t*3)break;return e.sort((r,s)=>Number(r.ix)-Number(s.ix)),e.slice(0,t)}contours(t){const e=this._renderer.calculate_contours(t),{x:r,y:s,x_:o,y_:f}=this._zoom.scales();function c(l){if(l){if(l.coordinates)return c(l.coordinates);if(l.length!==0){if(l[0].length>0)return l.map(c);l[0]=r(o.invert(l[0])),l[1]=s(f.invert(l[1]))}}}c(e),this.drawContours(e)}}cd.Bitmask=ta;cd.ArrowDataset=jx;cd.QuadtileDataset=Wx;cd.DataSelection=Pc;class Zp{constructor(t){this.string_rep="",this.plot=t}get f(){return this._f===void 0?(t,e)=>this.default(t,e):this._f}set f(t){typeof t=="string"?this.string_rep!==t&&(this.string_rep=t,this._f=Function("datum","plot",t)):this._f=t}}class xB extends Zp{default(t,e=void 0,r=void 0){let s;t!==null&&(t.__activated==!0?(s=null,t.__activated=void 0):(t.__activated=!0,s={field:r.label_key,lambda:`d => d === '${t.properties[r.label_key]}'`}),this.plot.plotAPI({encoding:{filter:s}}))}}class SB extends Zp{default(t,e=void 0){console.log({...t})}}class AB extends Zp{default(t,e=void 0){}}class EB extends Zp{default(t,e=void 0){let r="<dl>";const s=new Set(["x","y","ix",null,"tile_key"]);for(const[o,f]of t)f!==null&&(s.has(o)||f!==""&&(r+=` <dt>${String(o)}</dt>
`,r+=`   <dd>${String(f)}<dd>
`));return`${r}</dl>
`}}const TB={source_url:"/pro-stock-ai/app-data/ds/",max_points:1e6,alpha:25,zoom_balance:.7,point_size:5,background_color:"#ffffff00",click_function:"console.log(JSON.stringify(datum, undefined, 2))",encoding:{x:{field:"x",transform:"literal"},y:{field:"y",transform:"literal"},color:{constant:"#2D0368"}}},IB=new cd("#viz");IB.plotAPI(TB);
